"use strict";var e=require("./three-platformize.js");class t{constructor(e,t){this.parts=e,this.options=t}}for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),s=0;s<r.length;s++)n[r.charCodeAt(s)]=s;class a{createObjectURL(e){if(e instanceof t){const t=function(e){for(var t,n="",s=new Uint8Array(e),a=s.byteLength,o=a%3,i=a-o,c=0;c<i;c+=3)t=s[c]<<16|s[c+1]<<8|s[c+2],n+=r[(16515072&t)>>18]+r[(258048&t)>>12]+r[(4032&t)>>6]+r[63&t];return 1==o?(t=s[i],n+=r[(252&t)>>2]+r[(3&t)<<4]+"=="):2==o&&(t=s[i]<<8|s[i+1],n+=r[(64512&t)>>10]+r[(1008&t)>>4]+r[(15&t)<<2]+"="),n}(e.parts[0]);return`data:${e.options.type};base64,${t}`}return""}revokeObjectURL(){}}function o(e){if((e=(e=`${e}`).replace(/[ \t\n\f\r]/g,"")).length%4==0&&(e=e.replace(/==?$/,"")),e.length%4==1||/[^+/0-9A-Za-z]/.test(e))return null;let t="",r=0,n=0;for(let s=0;s<e.length;s++)r<<=6,r|=i(e[s]),n+=6,24===n&&(t+=String.fromCharCode((16711680&r)>>16),t+=String.fromCharCode((65280&r)>>8),t+=String.fromCharCode(255&r),r=n=0);return 12===n?(r>>=4,t+=String.fromCharCode(r)):18===n&&(r>>=2,t+=String.fromCharCode((65280&r)>>8),t+=String.fromCharCode(255&r)),t}function i(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e);return t<0?void 0:t}const c=new WeakMap;class l{constructor(e){this.identifier=e.identifier,this.force=void 0===e.force?1:e.force,this.pageX=void 0===e.pageX?e.x:e.pageX,this.pageY=void 0===e.pageY?e.y:e.pageY,this.clientX=void 0===e.clientX?e.x:e.clientX,this.clientY=void 0===e.clientY?e.y:e.clientY,this.screenX=this.pageX,this.screenY=this.pageY}}class u{constructor(){c.set(this,{})}addEventListener(e,t,r={}){let n=c.get(this);n||(n={},c.set(this,n)),n[e]||(n[e]=[]),n[e].push(t),r.capture,r.once,r.passive}removeEventListener(e,t){const r=c.get(this);if(r){const n=r[e];if(n&&n.length>0)for(let e=n.length;e--;e>0)if(n[e]===t){n.splice(e,1);break}}}dispatchEvent(e={}){"function"!=typeof e.preventDefault&&(e.preventDefault=()=>{}),"function"!=typeof e.stopPropagation&&(e.stopPropagation=()=>{});const t=c.get(this);if(t){const r=t[e.type];if(r)for(let t=0;t<r.length;t++)r[t](e)}}}const h=new WeakMap,p=new WeakMap,d=new WeakMap;function f(e,t={}){t.target=t.target||this,"function"==typeof this[`on${e}`]&&this[`on${e}`].call(this,t)}function g(e,t={}){this.readyState=e,t.readyState=e,f.call(this,"readystatechange",t)}const{platform:m}=wx.getSystemInfoSync();class v extends u{constructor(){super(),this.onabort=null,this.onerror=null,this.onload=null,this.onloadstart=null,this.onprogress=null,this.ontimeout=null,this.onloadend=null,this.onreadystatechange=null,this.readyState=0,this.response=null,this.responseText=null,this.responseType="text",this.dataType="string",this.responseXML=null,this.status=0,this.statusText="",this.upload={},this.withCredentials=!1,h.set(this,{"content-type":"application/x-www-form-urlencoded"}),p.set(this,{})}abort(){const e=d.get(this);e&&e.abort()}getAllResponseHeaders(){const e=p.get(this);return Object.keys(e).map((t=>`${t}: ${e[t]}`)).join("\n")}getResponseHeader(e){return p.get(this)[e]}open(e,t){this._method=e,this._url=t,g.call(this,v.OPENED)}overrideMimeType(){}send(e=""){if(this.readyState!==v.OPENED)throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");{const r=this._url,n=h.get(this),s=this.responseType,a=this.dataType,o=function(e){return!/^(http|https|ftp|wxfile):\/\/.*/i.test(e)}(r);let i;"arraybuffer"===s||(i="utf8"),delete this.response,this.response=null;let c=!1;const l=({data:e,statusCode:t,header:r})=>{if(!c){if(c=!0,t=void 0===t?200:t,"string"!=typeof e&&!(e instanceof ArrayBuffer))try{e=JSON.stringify(e)}catch(e){}this.status=t,r&&p.set(this,r),f.call(this,"loadstart"),g.call(this,v.HEADERS_RECEIVED),g.call(this,v.LOADING),this.response=e,e instanceof ArrayBuffer?Object.defineProperty(this,"responseText",{enumerable:!0,configurable:!0,get:function(){throw"InvalidStateError : responseType is "+this.responseType}}):this.responseText=e,g.call(this,v.DONE),f.call(this,"load"),f.call(this,"loadend")}},u=({errMsg:e})=>{c||(c=!0,-1!==e.indexOf("abort")?f.call(this,"abort"):f.call(this,"error",{message:e}),f.call(this,"loadend"),o&&console.warn(e))};if(o){const e=wx.getFileSystemManager();var t={filePath:r,success:l,fail:u};return i&&(t.encoding=i),void e.readFile(t)}const d="arraybuffer"===s&&"ios"===m&&v.useFetchPatch;wx.request({data:e,url:r,method:this._method,header:n,dataType:a,responseType:s,enableCache:!1,success:l,fail:u}),d&&setTimeout((function(){wx.request({data:e,url:r,method:this._method,header:n,dataType:a,responseType:s,enableCache:!0,success:l,fail:u})}),v.fetchPatchDelay)}}setRequestHeader(e,t){const r=h.get(this);r[e]=t,h.set(this,r)}addEventListener(e,t){"function"==typeof t&&(this["on"+e]=(e={})=>{e.target=e.target||this,t.call(this,e)})}removeEventListener(e,t){this["on"+e]===t&&(this["on"+e]=null)}}function y(e){return e=(e=e.trim()).replace(/<!--[\s\S]*?-->/g,""),{declaration:t(),root:r()};function t(){if(!s(/^<\?xml\s*/))return;const e={attributes:{}};for(;!a()&&!o("?>");){const t=n();if(!t)return e;e.attributes[t.name]=t.value}return s(/\?>\s*/),s(/<!DOCTYPE[^>]*>\s/),e}function r(){const e=s(/^<([\w-:.]+)\s*/);if(!e)return;const t={name:e[1],attributes:{},children:[]};for(;!(a()||o(">")||o("?>")||o("/>"));){const e=n();if(!e)return t;t.attributes[e.name]=e.value}if(s(/^\s*\/>\s*/))return t;let i;for(s(/\??>\s*/),t.content=function(){const e=s(/^([^<]*)/);return e?e[1]:""}();i=r();)t.children.push(i);return s(/^<\/[\w-:.]+>\s*/),t}function n(){const e=s(/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/);var t;if(e)return{name:e[1],value:(t=e[2],t.replace(/^['"]|['"]$/g,""))}}function s(t){const r=e.match(t);if(r)return e=e.slice(r[0].length),r}function a(){return 0==e.length}function o(t){return 0==e.indexOf(t)}}function b(e,t){t(e),e.children.forEach((e=>b(e,t)))}v.UNSEND=0,v.OPENED=1,v.HEADERS_RECEIVED=2,v.LOADING=3,v.DONE=4,v.useFetchPatch=!1,v.fetchPatchDelay=200;class x{parseFromString(e){const t=y(e),r={hasAttribute(e){return void 0!==this.attributes[e]},getAttribute(e){return this.attributes[e]},getElementsByTagName(e){const t=[];return this.childNodes.forEach((r=>b(r,(r=>e===r.name&&t.push(r))))),t}};b(t.root,(e=>{e.nodeType=1,e.nodeName=e.name,e.style=new Proxy((e.attributes.style||"").split(";").reduce(((e,t)=>{if(t){let[r,n]=t.split(":");e[r.trim()]=n.trim()}return e}),{}),{get:(e,t)=>e[t]||""}),e.textContent=e.content,e.childNodes=e.children,e.__proto__=r}));const n={documentElement:t.root,childNodes:[t.root]};return n.__proto__=r,n}}class w{decode(e){let t="";for(let r=0,n=e.length;r<n;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}}}function S(){return wx.createOffscreenCanvas()}class T extends e.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new I(e)})),this.register((function(e){return new L(e)})),this.register((function(e){return new C(e)})),this.register((function(e){return new M(e)})),this.register((function(e){return new E(e)})),this.register((function(e){return new R(e)}))}load(t,r,n,s){const a=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:e.LoaderUtils.extractUrlBase(t),this.manager.itemStart(t);const i=function(e){s?s(e):console.error(e),a.manager.itemError(t),a.manager.itemEnd(t)},c=new e.FileLoader(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,(function(e){try{a.parse(e,o,(function(e){r(e),a.manager.itemEnd(t)}),i)}catch(e){i(e)}}),n,i)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(t,r,n,s){let a;const o={},i={};if("string"==typeof t)a=t;else{if(e.LoaderUtils.decodeText(new Uint8Array(t,0,4))===O){try{o[k.KHR_BINARY_GLTF]=new D(t)}catch(e){return void(s&&s(e))}a=o[k.KHR_BINARY_GLTF].content}else a=e.LoaderUtils.decodeText(new Uint8Array(t))}const c=JSON.parse(a);if(void 0===c.asset||c.asset.version[0]<2)return void(s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new de(c,{path:r||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](l);i[t.name]=t,o[t.name]=!0}if(c.extensionsUsed)for(let e=0;e<c.extensionsUsed.length;++e){const t=c.extensionsUsed[e],r=c.extensionsRequired||[];switch(t){case k.KHR_MATERIALS_UNLIT:o[t]=new A;break;case k.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[t]=new _;break;case k.KHR_DRACO_MESH_COMPRESSION:o[t]=new P(c,this.dracoLoader);break;case k.KHR_TEXTURE_TRANSFORM:o[t]=new B;break;case k.KHR_MESH_QUANTIZATION:o[t]=new H;break;default:r.indexOf(t)>=0&&void 0===i[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(o),l.setPlugins(i),l.parse(n,s)}}function F(){let e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const k={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class E{constructor(e){this.parser=e,this.name=k.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,n=t.length;r<n;r++){const n=t[r];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(t){const r=this.parser,n="light:"+t;let s=r.cache.get(n);if(s)return s;const a=r.json,o=((a.extensions&&a.extensions[this.name]||{}).lights||[])[t];let i;const c=new e.Color(16777215);void 0!==o.color&&c.fromArray(o.color);const l=void 0!==o.range?o.range:0;switch(o.type){case"directional":i=new e.DirectionalLight(c),i.target.position.set(0,0,-1),i.add(i.target);break;case"point":i=new e.PointLight(c),i.distance=l;break;case"spot":i=new e.SpotLight(c),i.distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,i.angle=o.spot.outerConeAngle,i.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,i.target.position.set(0,0,-1),i.add(i.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return i.position.set(0,0,0),i.decay=2,void 0!==o.intensity&&(i.intensity=o.intensity),i.name=r.createUniqueName(o.name||"light_"+t),s=Promise.resolve(i),r.cache.add(n,s),s}createNodeAttachment(e){const t=this,r=this.parser,n=r.json.nodes[e],s=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===s?null:this._loadLight(s).then((function(e){return r._getNodeRef(t.cache,s,e)}))}}class A{constructor(){this.name=k.KHR_MATERIALS_UNLIT}getMaterialType(){return e.MeshBasicMaterial}extendParams(t,r,n){const s=[];t.color=new e.Color(1,1,1),t.opacity=1;const a=r.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const e=a.baseColorFactor;t.color.fromArray(e),t.opacity=e[3]}void 0!==a.baseColorTexture&&s.push(n.assignTexture(t,"map",a.baseColorTexture))}return Promise.all(s)}}class I{constructor(e){this.parser=e,this.name=k.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const r=this.parser.json.materials[t];return r.extensions&&r.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(t,r){const n=this.parser,s=n.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],o=s.extensions[this.name];if(void 0!==o.clearcoatFactor&&(r.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&a.push(n.assignTexture(r,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(r.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&a.push(n.assignTexture(r,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(a.push(n.assignTexture(r,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const t=o.clearcoatNormalTexture.scale;r.clearcoatNormalScale=new e.Vector2(t,-t)}return Promise.all(a)}}class M{constructor(e){this.parser=e,this.name=k.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const r=this.parser.json.materials[t];return r.extensions&&r.extensions[this.name]?e.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],a=n.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&s.push(r.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(s)}}class L{constructor(e){this.parser=e,this.name=k.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,r=t.json,n=r.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const s=n.extensions[this.name],a=r.images[s.source],o=t.options.ktx2Loader;if(!o){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a,o)}}class C{constructor(e){this.parser=e,this.name=k.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,n=r.json,s=n.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],o=n.images[a.source];let i=r.textureLoader;if(o.uri){const e=r.options.manager.getHandler(o.uri);null!==e&&(i=e)}return this.detectSupport().then((function(s){if(s)return r.loadTextureImage(e,o,i);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class R{constructor(e){this.name=k.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const e=r.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([n,s.ready]).then((function(t){const r=e.byteOffset||0,n=e.byteLength||0,a=e.count,o=e.byteStride,i=new ArrayBuffer(a*o),c=new Uint8Array(t[0],r,n);return s.decodeGltfBuffer(new Uint8Array(i),a,o,c,e.mode,e.filter),i}))}return null}}const O="glTF",N=1313821514,U=5130562;class D{constructor(t){this.name=k.KHR_BINARY_GLTF,this.content=null,this.body=null;const r=new DataView(t,0,12);if(this.header={magic:e.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==O)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,s=new DataView(t,12);let a=0;for(;a<n;){const r=s.getUint32(a,!0);a+=4;const n=s.getUint32(a,!0);if(a+=4,n===N){const n=new Uint8Array(t,12+a,r);this.content=e.LoaderUtils.decodeText(n)}else if(n===U){const e=12+a;this.body=t.slice(e,e+r)}a+=r}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class P{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=k.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const r=this.json,n=this.dracoLoader,s=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},i={},c={};for(const e in a){const t=ee[e]||e.toLowerCase();o[t]=a[e]}for(const t in e.attributes){const n=ee[t]||t.toLowerCase();if(void 0!==a[t]){const s=r.accessors[e.attributes[t]],a=Z[s.componentType];c[n]=a,i[n]=!0===s.normalized}}return t.getDependency("bufferView",s).then((function(e){return new Promise((function(t){n.decodeDracoFile(e,(function(e){for(const t in e.attributes){const r=e.attributes[t],n=i[t];void 0!==n&&(r.normalized=n)}t(e)}),o,c)}))}))}}class B{constructor(){this.name=k.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class G extends e.MeshStandardMaterial{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;const r=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),s=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),a=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),i={specular:{value:(new e.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=i,this.onBeforeCompile=function(e){for(const t in i)e.uniforms[t]=i[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",r).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",s).replace("#include <metalnessmap_fragment>",a).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return i.specular.value},set:function(e){i.specular.value=e}},specularMap:{get:function(){return i.specularMap.value},set:function(e){i.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return i.glossiness.value},set:function(e){i.glossiness.value=e}},glossinessMap:{get:function(){return i.glossinessMap.value},set:function(e){i.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class _{constructor(){this.name=k.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return G}extendParams(t,r,n){const s=r.extensions[this.name];t.color=new e.Color(1,1,1),t.opacity=1;const a=[];if(Array.isArray(s.diffuseFactor)){const e=s.diffuseFactor;t.color.fromArray(e),t.opacity=e[3]}if(void 0!==s.diffuseTexture&&a.push(n.assignTexture(t,"map",s.diffuseTexture)),t.emissive=new e.Color(0,0,0),t.glossiness=void 0!==s.glossinessFactor?s.glossinessFactor:1,t.specular=new e.Color(1,1,1),Array.isArray(s.specularFactor)&&t.specular.fromArray(s.specularFactor),void 0!==s.specularGlossinessTexture){const e=s.specularGlossinessTexture;a.push(n.assignTexture(t,"glossinessMap",e)),a.push(n.assignTexture(t,"specularMap",e))}return Promise.all(a)}createMaterial(t){const r=new G(t);return r.fog=!0,r.color=t.color,r.map=void 0===t.map?null:t.map,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=void 0===t.aoMap?null:t.aoMap,r.aoMapIntensity=1,r.emissive=t.emissive,r.emissiveIntensity=1,r.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,r.bumpMap=void 0===t.bumpMap?null:t.bumpMap,r.bumpScale=1,r.normalMap=void 0===t.normalMap?null:t.normalMap,r.normalMapType=e.TangentSpaceNormalMap,t.normalScale&&(r.normalScale=t.normalScale),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.specularMap=void 0===t.specularMap?null:t.specularMap,r.specular=t.specular,r.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,r.glossiness=t.glossiness,r.alphaMap=null,r.envMap=void 0===t.envMap?null:t.envMap,r.envMapIntensity=1,r.refractionRatio=.98,r}}class H{constructor(){this.name=k.KHR_MESH_QUANTIZATION}}class V extends e.Interpolant{constructor(e,t,r,n){super(e,t,r,n)}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,s=e*n*3+n;for(let e=0;e!==n;e++)t[e]=r[s+e];return t}}V.prototype.beforeStart_=V.prototype.copySampleValue_,V.prototype.afterEnd_=V.prototype.copySampleValue_,V.prototype.interpolate_=function(e,t,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,i=2*o,c=3*o,l=n-t,u=(r-t)/l,h=u*u,p=h*u,d=e*c,f=d-c,g=-2*p+3*h,m=p-h,v=1-g,y=m-h+u;for(let e=0;e!==o;e++){const t=a[f+e+o],r=a[f+e+i]*l,n=a[d+e+o],c=a[d+e]*l;s[e]=v*t+y*r+g*n+m*c}return s};const z=0,j=1,W=2,X=3,q=4,Y=5,K=6,Z={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Q={9728:e.NearestFilter,9729:e.LinearFilter,9984:e.NearestMipmapNearestFilter,9985:e.LinearMipmapNearestFilter,9986:e.NearestMipmapLinearFilter,9987:e.LinearMipmapLinearFilter},$={33071:e.ClampToEdgeWrapping,33648:e.MirroredRepeatWrapping,10497:e.RepeatWrapping},J={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ee={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},te={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},re={CUBICSPLINE:void 0,LINEAR:e.InterpolateLinear,STEP:e.InterpolateDiscrete},ne="OPAQUE",se="MASK",ae="BLEND";function oe(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function ie(e,t,r){for(const n in r.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function ce(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function le(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){const r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(let t=0,n=r.length;t<n;t++)e.morphTargetDictionary[r[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ue(e){const t=e.extensions&&e.extensions[k.KHR_DRACO_MESH_COMPRESSION];let r;return r=t?"draco:"+t.bufferView+":"+t.indices+":"+he(t.attributes):e.indices+":"+he(e.attributes)+":"+e.mode,r}function he(e){let t="";const r=Object.keys(e).sort();for(let n=0,s=r.length;n<s;n++)t+=r[n]+":"+e[r[n]]+";";return t}function pe(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class de{constructor(t={},r={}){this.json=t,this.extensions={},this.plugins={},this.options=r,this.cache=new F,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},void 0!==e.$createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new e.ImageBitmapLoader(this.options.manager):this.textureLoader=new e.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new e.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const r=this,n=this.json,s=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])})).then((function(t){const a={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};ie(s,a,n),ce(a,n),Promise.all(r._invokeAll((function(e){return e.afterRoot&&e.afterRoot(a)}))).then((function(){e(a)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let r=0,n=t.length;r<n;r++){const n=t[r].joints;for(let t=0,r=n.length;t<r;t++)e[n[t]].isBone=!0}for(let t=0,n=e.length;t<n;t++){const n=e[t];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(r[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;const n=r.clone();return n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){const n=e(t[r]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const r=[];for(let n=0;n<t.length;n++){const s=e(t[n]);s&&r.push(s)}return r}getDependency(e,t){const r=e+":"+t;let n=this.cache.get(r);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this.loadAnimation(t);break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(r,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const r=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return r.getDependency(e,n)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[k.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(e,s){r.load(oe(t.uri,n.path),e,void 0,(function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)}))}loadAccessor(t){const r=this,n=this.json,s=this.json.accessors[t];if(void 0===s.bufferView&&void 0===s.sparse)return Promise.resolve(null);const a=[];return void 0!==s.bufferView?a.push(this.getDependency("bufferView",s.bufferView)):a.push(null),void 0!==s.sparse&&(a.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(a).then((function(t){const a=t[0],o=J[s.type],i=Z[s.componentType],c=i.BYTES_PER_ELEMENT,l=c*o,u=s.byteOffset||0,h=void 0!==s.bufferView?n.bufferViews[s.bufferView].byteStride:void 0,p=!0===s.normalized;let d,f;if(h&&h!==l){const t=Math.floor(u/h),n="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+t+":"+s.count;let l=r.cache.get(n);l||(d=new i(a,t*h,s.count*h/c),l=new e.InterleavedBuffer(d,h/c),r.cache.add(n,l)),f=new e.InterleavedBufferAttribute(l,o,u%h/c,p)}else d=null===a?new i(s.count*o):new i(a,u,s.count*o),f=new e.BufferAttribute(d,o,p);if(void 0!==s.sparse){const r=J.SCALAR,n=Z[s.sparse.indices.componentType],c=s.sparse.indices.byteOffset||0,l=s.sparse.values.byteOffset||0,u=new n(t[1],c,s.sparse.count*r),h=new i(t[2],l,s.sparse.count*o);null!==a&&(f=new e.BufferAttribute(f.array.slice(),f.itemSize,f.normalized));for(let e=0,t=u.length;e<t;e++){const t=u[e];if(f.setX(t,h[e*o]),o>=2&&f.setY(t,h[e*o+1]),o>=3&&f.setZ(t,h[e*o+2]),o>=4&&f.setW(t,h[e*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f}))}loadTexture(e){const t=this.json,r=this.options,n=t.textures[e],s=t.images[n.source];let a=this.textureLoader;if(s.uri){const e=r.manager.getHandler(s.uri);null!==e&&(a=e)}return this.loadTextureImage(e,s,a)}loadTextureImage(t,r,n){const s=this,a=this.json,o=this.options,i=a.textures[t],c=(r.uri||r.bufferView)+":"+i.sampler;if(this.textureCache[c])return this.textureCache[c];const l=e.$URL||self.webkitURL;let u=r.uri||"",h=!1,p=!0;const d=u.search(/\.jpe?g($|\?)/i)>0||0===u.search(/^data\:image\/jpeg/);if(("image/jpeg"===r.mimeType||d)&&(p=!1),void 0!==r.bufferView)u=s.getDependency("bufferView",r.bufferView).then((function(t){if("image/png"===r.mimeType){const e=new DataView(t,25,1).getUint8(0,!1);p=6===e||4===e||3===e}h=!0;const n=new e.$Blob([t],{type:r.mimeType});return u=l.createObjectURL(n),u}));else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const f=Promise.resolve(u).then((function(t){return new Promise((function(r,s){let a=r;!0===n.isImageBitmapLoader&&(a=function(t){r(new e.CanvasTexture(t))}),n.load(oe(t,o.path),a,void 0,s)}))})).then((function(r){!0===h&&l.revokeObjectURL(u),r.flipY=!1,i.name&&(r.name=i.name),p||(r.format=e.RGBFormat);const n=(a.samplers||{})[i.sampler]||{};return r.magFilter=Q[n.magFilter]||e.LinearFilter,r.minFilter=Q[n.minFilter]||e.LinearMipmapLinearFilter,r.wrapS=$[n.wrapS]||e.RepeatWrapping,r.wrapT=$[n.wrapT]||e.RepeatWrapping,s.associations.set(r,{type:"textures",index:t}),r}));return this.textureCache[c]=f,f}assignTexture(e,t,r){const n=this;return this.getDependency("texture",r.index).then((function(s){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===t&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),n.extensions[k.KHR_TEXTURE_TRANSFORM]){const e=void 0!==r.extensions?r.extensions[k.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=n.associations.get(s);s=n.extensions[k.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),n.associations.set(s,t)}}e[t]=s}))}assignFinalMaterial(t){const r=t.geometry;let n=t.material;const s=void 0!==r.attributes.tangent,a=void 0!==r.attributes.color,o=void 0===r.attributes.normal,i=Object.keys(r.morphAttributes).length>0,c=i&&void 0!==r.morphAttributes.normal;if(t.isPoints){const t="PointsMaterial:"+n.uuid;let r=this.cache.get(t);r||(r=new e.PointsMaterial,e.Material.prototype.copy.call(r,n),r.color.copy(n.color),r.map=n.map,r.sizeAttenuation=!1,this.cache.add(t,r)),n=r}else if(t.isLine){const t="LineBasicMaterial:"+n.uuid;let r=this.cache.get(t);r||(r=new e.LineBasicMaterial,e.Material.prototype.copy.call(r,n),r.color.copy(n.color),this.cache.add(t,r)),n=r}if(s||a||o||i){let e="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),s&&(e+="vertex-tangents:"),a&&(e+="vertex-colors:"),o&&(e+="flat-shading:"),i&&(e+="morph-targets:"),c&&(e+="morph-normals:");let t=this.cache.get(e);t||(t=n.clone(),a&&(t.vertexColors=!0),o&&(t.flatShading=!0),i&&(t.morphTargets=!0),c&&(t.morphNormals=!0),s&&(t.vertexTangents=!0,t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}n.aoMap&&void 0===r.attributes.uv2&&void 0!==r.attributes.uv&&r.setAttribute("uv2",r.attributes.uv),t.material=n}getMaterialType(){return e.MeshStandardMaterial}loadMaterial(t){const r=this,n=this.json,s=this.extensions,a=n.materials[t];let o;const i={},c=a.extensions||{},l=[];if(c[k.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=s[k.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=e.getMaterialType(),l.push(e.extendParams(i,a,r))}else if(c[k.KHR_MATERIALS_UNLIT]){const e=s[k.KHR_MATERIALS_UNLIT];o=e.getMaterialType(),l.push(e.extendParams(i,a,r))}else{const n=a.pbrMetallicRoughness||{};if(i.color=new e.Color(1,1,1),i.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;i.color.fromArray(e),i.opacity=e[3]}void 0!==n.baseColorTexture&&l.push(r.assignTexture(i,"map",n.baseColorTexture)),i.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,i.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(l.push(r.assignTexture(i,"metalnessMap",n.metallicRoughnessTexture)),l.push(r.assignTexture(i,"roughnessMap",n.metallicRoughnessTexture))),o=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),l.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,i)}))))}!0===a.doubleSided&&(i.side=e.DoubleSide);const u=a.alphaMode||ne;return u===ae?(i.transparent=!0,i.depthWrite=!1):(i.transparent=!1,u===se&&(i.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&o!==e.MeshBasicMaterial&&(l.push(r.assignTexture(i,"normalMap",a.normalTexture)),i.normalScale=new e.Vector2(1,-1),void 0!==a.normalTexture.scale&&i.normalScale.set(a.normalTexture.scale,-a.normalTexture.scale)),void 0!==a.occlusionTexture&&o!==e.MeshBasicMaterial&&(l.push(r.assignTexture(i,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(i.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&o!==e.MeshBasicMaterial&&(i.emissive=(new e.Color).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&o!==e.MeshBasicMaterial&&l.push(r.assignTexture(i,"emissiveMap",a.emissiveTexture)),Promise.all(l).then((function(){let n;return n=o===G?s[k.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(i):new o(i),a.name&&(n.name=a.name),n.map&&(n.map.encoding=e.sRGBEncoding),n.emissiveMap&&(n.emissiveMap.encoding=e.sRGBEncoding),ce(n,a),r.associations.set(n,{type:"materials",index:t}),a.extensions&&ie(s,n,a),n}))}createUniqueName(t){const r=e.PropertyBinding.sanitizeNodeName(t||"");let n=r;for(let e=1;this.nodeNamesUsed[n];++e)n=r+"_"+e;return this.nodeNamesUsed[n]=!0,n}loadGeometries(t){const r=this,n=this.extensions,s=this.primitiveCache;function a(e){return n[k.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,r).then((function(t){return ge(t,e,r)}))}const o=[];for(let n=0,i=t.length;n<i;n++){const i=t[n],c=ue(i),l=s[c];if(l)o.push(l.promise);else{let t;t=i.extensions&&i.extensions[k.KHR_DRACO_MESH_COMPRESSION]?a(i):ge(new e.BufferGeometry,i,r),s[c]={primitive:i,promise:t},o.push(t)}}return Promise.all(o)}loadMesh(t){const r=this,n=this.json,s=this.extensions,a=n.meshes[t],o=a.primitives,i=[];for(let t=0,r=o.length;t<r;t++){const r=void 0===o[t].material?(void 0===(c=this.cache).DefaultMaterial&&(c.DefaultMaterial=new e.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:e.FrontSide})),c.DefaultMaterial):this.getDependency("material",o[t].material);i.push(r)}var c;return i.push(r.loadGeometries(o)),Promise.all(i).then((function(n){const i=n.slice(0,n.length-1),c=n[n.length-1],l=[];for(let n=0,u=c.length;n<u;n++){const u=c[n],h=o[n];let p;const d=i[n];if(h.mode===q||h.mode===Y||h.mode===K||void 0===h.mode)p=!0===a.isSkinnedMesh?new e.SkinnedMesh(u,d):new e.Mesh(u,d),!0!==p.isSkinnedMesh||p.geometry.attributes.skinWeight.normalized||p.normalizeSkinWeights(),h.mode===Y?p.geometry=me(p.geometry,e.TriangleStripDrawMode):h.mode===K&&(p.geometry=me(p.geometry,e.TriangleFanDrawMode));else if(h.mode===j)p=new e.LineSegments(u,d);else if(h.mode===X)p=new e.Line(u,d);else if(h.mode===W)p=new e.LineLoop(u,d);else{if(h.mode!==z)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);p=new e.Points(u,d)}Object.keys(p.geometry.morphAttributes).length>0&&le(p,a),p.name=r.createUniqueName(a.name||"mesh_"+t),ce(p,a),h.extensions&&ie(s,p,h),r.assignFinalMaterial(p),l.push(p)}if(1===l.length)return l[0];const u=new e.Group;for(let e=0,t=l.length;e<t;e++)u.add(l[e]);return u}))}loadCamera(t){let r;const n=this.json.cameras[t],s=n[n.type];if(s)return"perspective"===n.type?r=new e.PerspectiveCamera(e.MathUtils.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):"orthographic"===n.type&&(r=new e.OrthographicCamera(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(r.name=this.createUniqueName(n.name)),ce(r,n),Promise.resolve(r);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],r={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(r):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return r.inverseBindMatrices=e,r}))}loadAnimation(t){const r=this.json.animations[t],n=[],s=[],a=[],o=[],i=[];for(let e=0,t=r.channels.length;e<t;e++){const t=r.channels[e],c=r.samplers[t.sampler],l=t.target,u=void 0!==l.node?l.node:l.id,h=void 0!==r.parameters?r.parameters[c.input]:c.input,p=void 0!==r.parameters?r.parameters[c.output]:c.output;n.push(this.getDependency("node",u)),s.push(this.getDependency("accessor",h)),a.push(this.getDependency("accessor",p)),o.push(c),i.push(l)}return Promise.all([Promise.all(n),Promise.all(s),Promise.all(a),Promise.all(o),Promise.all(i)]).then((function(n){const s=n[0],a=n[1],o=n[2],i=n[3],c=n[4],l=[];for(let t=0,r=s.length;t<r;t++){const r=s[t],n=a[t],u=o[t],h=i[t],p=c[t];if(void 0===r)continue;let d;switch(r.updateMatrix(),r.matrixAutoUpdate=!0,te[p.path]){case te.weights:d=e.NumberKeyframeTrack;break;case te.rotation:d=e.QuaternionKeyframeTrack;break;case te.position:case te.scale:default:d=e.VectorKeyframeTrack}const f=r.name?r.name:r.uuid,g=void 0!==h.interpolation?re[h.interpolation]:e.InterpolateLinear,m=[];te[p.path]===te.weights?r.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&m.push(e.name?e.name:e.uuid)})):m.push(f);let v=u.array;if(u.normalized){const e=pe(v.constructor),t=new Float32Array(v.length);for(let r=0,n=v.length;r<n;r++)t[r]=v[r]*e;v=t}for(let e=0,t=m.length;e<t;e++){const t=new d(m[e]+"."+te[p.path],n.array,v,g);"CUBICSPLINE"===h.interpolation&&(t.createInterpolant=function(e){return new V(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(t)}}const u=r.name?r.name:"animation_"+t;return new e.AnimationClip(u,void 0,l)}))}createNodeMesh(e){const t=this.json,r=this,n=t.nodes[e];return void 0===n.mesh?null:r.getDependency("mesh",n.mesh).then((function(e){const t=r._getNodeRef(r.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,r=n.weights.length;t<r;t++)e.morphTargetInfluences[t]=n.weights[t]})),t}))}loadNode(t){const r=this.json,n=this.extensions,s=this,a=r.nodes[t],o=a.name?s.createUniqueName(a.name):"";return function(){const e=[],r=s._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return r&&e.push(r),void 0!==a.camera&&e.push(s.getDependency("camera",a.camera).then((function(e){return s._getNodeRef(s.cameraCache,a.camera,e)}))),s._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){e.push(t)})),Promise.all(e)}().then((function(r){let i;if(i=!0===a.isBone?new e.Bone:r.length>1?new e.Group:1===r.length?r[0]:new e.Object3D,i!==r[0])for(let e=0,t=r.length;e<t;e++)i.add(r[e]);if(a.name&&(i.userData.name=a.name,i.name=o),ce(i,a),a.extensions&&ie(n,i,a),void 0!==a.matrix){const t=new e.Matrix4;t.fromArray(a.matrix),i.applyMatrix4(t)}else void 0!==a.translation&&i.position.fromArray(a.translation),void 0!==a.rotation&&i.quaternion.fromArray(a.rotation),void 0!==a.scale&&i.scale.fromArray(a.scale);return s.associations.set(i,{type:"nodes",index:t}),i}))}loadScene(t){const r=this.json,n=this.extensions,s=this.json.scenes[t],a=this,o=new e.Group;s.name&&(o.name=a.createUniqueName(s.name)),ce(o,s),s.extensions&&ie(n,o,s);const i=s.nodes||[],c=[];for(let e=0,t=i.length;e<t;e++)c.push(fe(i[e],o,r,a));return Promise.all(c).then((function(){return o}))}}function fe(t,r,n,s){const a=n.nodes[t];return s.getDependency("node",t).then((function(t){if(void 0===a.skin)return t;let r;return s.getDependency("skin",a.skin).then((function(e){r=e;const t=[];for(let e=0,n=r.joints.length;e<n;e++)t.push(s.getDependency("node",r.joints[e]));return Promise.all(t)})).then((function(n){return t.traverse((function(t){if(!t.isMesh)return;const s=[],a=[];for(let t=0,o=n.length;t<o;t++){const o=n[t];if(o){s.push(o);const n=new e.Matrix4;void 0!==r.inverseBindMatrices&&n.fromArray(r.inverseBindMatrices.array,16*t),a.push(n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[t])}t.bind(new e.Skeleton(s,a),t.matrixWorld)})),t}))})).then((function(e){r.add(e);const t=[];if(a.children){const r=a.children;for(let a=0,o=r.length;a<o;a++){const o=r[a];t.push(fe(o,e,n,s))}}return Promise.all(t)}))}function ge(t,r,n){const s=r.attributes,a=[];function o(e,r){return n.getDependency("accessor",e).then((function(e){t.setAttribute(r,e)}))}for(const e in s){const r=ee[e]||e.toLowerCase();r in t.attributes||a.push(o(s[e],r))}if(void 0!==r.indices&&!t.index){const e=n.getDependency("accessor",r.indices).then((function(e){t.setIndex(e)}));a.push(e)}return ce(t,r),function(t,r,n){const s=r.attributes,a=new e.Box3;if(void 0===s.POSITION)return;{const t=n.json.accessors[s.POSITION],r=t.min,o=t.max;if(void 0===r||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(a.set(new e.Vector3(r[0],r[1],r[2]),new e.Vector3(o[0],o[1],o[2])),t.normalized){const e=pe(Z[t.componentType]);a.min.multiplyScalar(e),a.max.multiplyScalar(e)}}const o=r.targets;if(void 0!==o){const t=new e.Vector3,r=new e.Vector3;for(let e=0,s=o.length;e<s;e++){const s=o[e];if(void 0!==s.POSITION){const e=n.json.accessors[s.POSITION],a=e.min,o=e.max;if(void 0!==a&&void 0!==o){if(r.setX(Math.max(Math.abs(a[0]),Math.abs(o[0]))),r.setY(Math.max(Math.abs(a[1]),Math.abs(o[1]))),r.setZ(Math.max(Math.abs(a[2]),Math.abs(o[2]))),e.normalized){const t=pe(Z[e.componentType]);r.multiplyScalar(t)}t.max(r)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(t)}t.boundingBox=a;const i=new e.Sphere;a.getCenter(i.center),i.radius=a.min.distanceTo(a.max)/2,t.boundingSphere=i}(t,r,n),Promise.all(a).then((function(){return void 0!==r.targets?function(e,t,r){let n=!1,s=!1;for(let e=0,r=t.length;e<r;e++){const r=t[e];if(void 0!==r.POSITION&&(n=!0),void 0!==r.NORMAL&&(s=!0),n&&s)break}if(!n&&!s)return Promise.resolve(e);const a=[],o=[];for(let i=0,c=t.length;i<c;i++){const c=t[i];if(n){const t=void 0!==c.POSITION?r.getDependency("accessor",c.POSITION):e.attributes.position;a.push(t)}if(s){const t=void 0!==c.NORMAL?r.getDependency("accessor",c.NORMAL):e.attributes.normal;o.push(t)}}return Promise.all([Promise.all(a),Promise.all(o)]).then((function(t){const r=t[0],a=t[1];return n&&(e.morphAttributes.position=r),s&&(e.morphAttributes.normal=a),e.morphTargetsRelative=!0,e}))}(t,r.targets,n):t}))}function me(t,r){let n=t.getIndex();if(null===n){const e=[],r=t.getAttribute("position");if(void 0===r)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<r.count;t++)e.push(t);t.setIndex(e),n=t.getIndex()}const s=n.count-2,a=[];if(r===e.TriangleFanDrawMode)for(let e=1;e<=s;e++)a.push(n.getX(0)),a.push(n.getX(e)),a.push(n.getX(e+1));else for(let e=0;e<s;e++)e%2==0?(a.push(n.getX(e)),a.push(n.getX(e+1)),a.push(n.getX(e+2))):(a.push(n.getX(e+2)),a.push(n.getX(e+1)),a.push(n.getX(e)));a.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=t.clone();return o.setIndex(a),o}const ve={type:"change"},ye={type:"start"},be={type:"end"};class xe extends e.EventDispatcher{constructor(t,r){super(),void 0===r&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),r===e.$document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=t,this.domElement=r,this.enabled=!0,this.target=new e.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:e.MOUSE.ROTATE,MIDDLE:e.MOUSE.DOLLY,RIGHT:e.MOUSE.PAN},this.touches={ONE:e.TOUCH.ROTATE,TWO:e.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return i.phi},this.getAzimuthalAngle=function(){return i.theta},this.listenToKeyEvents=function(e){e.addEventListener("keydown",H),this._domElementKeyEvents=e},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(ve),n.update(),a=s.NONE},this.update=function(){const r=new e.Vector3,p=(new e.Quaternion).setFromUnitVectors(t.up,new e.Vector3(0,1,0)),d=p.clone().invert(),f=new e.Vector3,g=new e.Quaternion,m=2*Math.PI;return function(){const e=n.object.position;r.copy(e).sub(n.target),r.applyQuaternion(p),i.setFromVector3(r),n.autoRotate&&a===s.NONE&&S(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(i.theta+=c.theta*n.dampingFactor,i.phi+=c.phi*n.dampingFactor):(i.theta+=c.theta,i.phi+=c.phi);let t=n.minAzimuthAngle,v=n.maxAzimuthAngle;return isFinite(t)&&isFinite(v)&&(t<-Math.PI?t+=m:t>Math.PI&&(t-=m),v<-Math.PI?v+=m:v>Math.PI&&(v-=m),i.theta=t<=v?Math.max(t,Math.min(v,i.theta)):i.theta>(t+v)/2?Math.max(t,i.theta):Math.min(v,i.theta)),i.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,i.phi)),i.makeSafe(),i.radius*=l,i.radius=Math.max(n.minDistance,Math.min(n.maxDistance,i.radius)),!0===n.enableDamping?n.target.addScaledVector(u,n.dampingFactor):n.target.add(u),r.setFromSpherical(i),r.applyQuaternion(d),e.copy(n.target).add(r),n.object.lookAt(n.target),!0===n.enableDamping?(c.theta*=1-n.dampingFactor,c.phi*=1-n.dampingFactor,u.multiplyScalar(1-n.dampingFactor)):(c.set(0,0,0),u.set(0,0,0)),l=1,!!(h||f.distanceToSquared(n.object.position)>o||8*(1-g.dot(n.object.quaternion))>o)&&(n.dispatchEvent(ve),f.copy(n.object.position),g.copy(n.object.quaternion),h=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",W),n.domElement.removeEventListener("pointerdown",P),n.domElement.removeEventListener("wheel",_),n.domElement.removeEventListener("touchstart",V),n.domElement.removeEventListener("touchend",j),n.domElement.removeEventListener("touchmove",z),n.domElement.ownerDocument.removeEventListener("pointermove",B),n.domElement.ownerDocument.removeEventListener("pointerup",G),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",H)};const n=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let a=s.NONE;const o=1e-6,i=new e.Spherical,c=new e.Spherical;let l=1;const u=new e.Vector3;let h=!1;const p=new e.Vector2,d=new e.Vector2,f=new e.Vector2,g=new e.Vector2,m=new e.Vector2,v=new e.Vector2,y=new e.Vector2,b=new e.Vector2,x=new e.Vector2;function w(){return Math.pow(.95,n.zoomSpeed)}function S(e){c.theta-=e}function T(e){c.phi-=e}const F=function(){const t=new e.Vector3;return function(e,r){t.setFromMatrixColumn(r,0),t.multiplyScalar(-e),u.add(t)}}(),k=function(){const t=new e.Vector3;return function(e,r){!0===n.screenSpacePanning?t.setFromMatrixColumn(r,1):(t.setFromMatrixColumn(r,0),t.crossVectors(n.object.up,t)),t.multiplyScalar(e),u.add(t)}}(),E=function(){const t=new e.Vector3;return function(e,r){const s=n.domElement;if(n.object.isPerspectiveCamera){const a=n.object.position;t.copy(a).sub(n.target);let o=t.length();o*=Math.tan(n.object.fov/2*Math.PI/180),F(2*e*o/s.clientHeight,n.object.matrix),k(2*r*o/s.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(F(e*(n.object.right-n.object.left)/n.object.zoom/s.clientWidth,n.object.matrix),k(r*(n.object.top-n.object.bottom)/n.object.zoom/s.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function A(e){n.object.isPerspectiveCamera?l/=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function I(e){n.object.isPerspectiveCamera?l*=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function M(e){p.set(e.clientX,e.clientY)}function L(e){g.set(e.clientX,e.clientY)}function C(e){if(1==e.touches.length)p.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);p.set(t,r)}}function R(e){if(1==e.touches.length)g.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);g.set(t,r)}}function O(e){const t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+r*r);y.set(0,n)}function N(e){if(1==e.touches.length)d.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);d.set(t,r)}f.subVectors(d,p).multiplyScalar(n.rotateSpeed);const t=n.domElement;S(2*Math.PI*f.x/t.clientHeight),T(2*Math.PI*f.y/t.clientHeight),p.copy(d)}function U(e){if(1==e.touches.length)m.set(e.touches[0].pageX,e.touches[0].pageY);else{const t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);m.set(t,r)}v.subVectors(m,g).multiplyScalar(n.panSpeed),E(v.x,v.y),g.copy(m)}function D(e){const t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,s=Math.sqrt(t*t+r*r);b.set(0,s),x.set(0,Math.pow(b.y/y.y,n.zoomSpeed)),A(x.y),y.copy(b)}function P(t){if(!1!==n.enabled)switch(t.pointerType){case"mouse":case"pen":!function(t){let r;switch(t.preventDefault(),n.domElement.focus?n.domElement.focus():e.$window.focus(),t.button){case 0:r=n.mouseButtons.LEFT;break;case 1:r=n.mouseButtons.MIDDLE;break;case 2:r=n.mouseButtons.RIGHT;break;default:r=-1}switch(r){case e.MOUSE.DOLLY:if(!1===n.enableZoom)return;!function(e){y.set(e.clientX,e.clientY)}(t),a=s.DOLLY;break;case e.MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enablePan)return;L(t),a=s.PAN}else{if(!1===n.enableRotate)return;M(t),a=s.ROTATE}break;case e.MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enableRotate)return;M(t),a=s.ROTATE}else{if(!1===n.enablePan)return;L(t),a=s.PAN}break;default:a=s.NONE}a!==s.NONE&&(n.domElement.ownerDocument.addEventListener("pointermove",B),n.domElement.ownerDocument.addEventListener("pointerup",G),n.dispatchEvent(ye))}(t)}}function B(e){if(!1!==n.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===n.enabled)return;switch(e.preventDefault(),a){case s.ROTATE:if(!1===n.enableRotate)return;!function(e){d.set(e.clientX,e.clientY),f.subVectors(d,p).multiplyScalar(n.rotateSpeed);const t=n.domElement;S(2*Math.PI*f.x/t.clientHeight),T(2*Math.PI*f.y/t.clientHeight),p.copy(d),n.update()}(e);break;case s.DOLLY:if(!1===n.enableZoom)return;!function(e){b.set(e.clientX,e.clientY),x.subVectors(b,y),x.y>0?A(w()):x.y<0&&I(w()),y.copy(b),n.update()}(e);break;case s.PAN:if(!1===n.enablePan)return;!function(e){m.set(e.clientX,e.clientY),v.subVectors(m,g).multiplyScalar(n.panSpeed),E(v.x,v.y),g.copy(m),n.update()}(e)}}(e)}}function G(e){switch(e.pointerType){case"mouse":case"pen":!function(e){if(n.domElement.ownerDocument.removeEventListener("pointermove",B),n.domElement.ownerDocument.removeEventListener("pointerup",G),!1===n.enabled)return;n.dispatchEvent(be),a=s.NONE}()}}function _(e){!1===n.enabled||!1===n.enableZoom||a!==s.NONE&&a!==s.ROTATE||(e.preventDefault(),n.dispatchEvent(ye),function(e){e.deltaY<0?I(w()):e.deltaY>0&&A(w()),n.update()}(e),n.dispatchEvent(be))}function H(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:E(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:E(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:E(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:E(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function V(t){if(!1!==n.enabled){switch(t.preventDefault(),t.touches.length){case 1:switch(n.touches.ONE){case e.TOUCH.ROTATE:if(!1===n.enableRotate)return;C(t),a=s.TOUCH_ROTATE;break;case e.TOUCH.PAN:if(!1===n.enablePan)return;R(t),a=s.TOUCH_PAN;break;default:a=s.NONE}break;case 2:switch(n.touches.TWO){case e.TOUCH.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&O(e),n.enablePan&&R(e)}(t),a=s.TOUCH_DOLLY_PAN;break;case e.TOUCH.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&O(e),n.enableRotate&&C(e)}(t),a=s.TOUCH_DOLLY_ROTATE;break;default:a=s.NONE}break;default:a=s.NONE}a!==s.NONE&&n.dispatchEvent(ye)}}function z(e){if(!1!==n.enabled)switch(e.preventDefault(),a){case s.TOUCH_ROTATE:if(!1===n.enableRotate)return;N(e),n.update();break;case s.TOUCH_PAN:if(!1===n.enablePan)return;U(e),n.update();break;case s.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&D(e),n.enablePan&&U(e)}(e),n.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&D(e),n.enableRotate&&N(e)}(e),n.update();break;default:a=s.NONE}}function j(e){!1!==n.enabled&&(n.dispatchEvent(be),a=s.NONE)}function W(e){!1!==n.enabled&&e.preventDefault()}n.domElement.addEventListener("contextmenu",W),n.domElement.addEventListener("pointerdown",P),n.domElement.addEventListener("wheel",_,{passive:!1}),n.domElement.addEventListener("touchstart",V,{passive:!1}),n.domElement.addEventListener("touchend",j),n.domElement.addEventListener("touchmove",z,{passive:!1}),this.update()}}function we(e){e.isMesh?(e.geometry&&e.geometry.dispose(),e.material&&Object.keys(e.material).forEach((t=>{const r=e.material[t];r&&r.dispose instanceof Function&&r.dispose()}))):e.isScene&&(e.background&&e.background.dispose&&e.background.dispose(),e.environment&&e.environment.dispose&&e.environment.dispose())}function Se(e,t=we){for(var r=e.children.length-1;r>=0;r--){var n=e.children[r];Se(n,t),t(n)}t(e)}function Te(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}return r}const Fe="https://techbrood.com/threejs/examples/";class ke{__init(){this._objects=[]}__init2(){this._cameraObjects=[]}constructor(e){ke.prototype.__init.call(this),ke.prototype.__init2.call(this),this.deps=e}add(e){this._objects.push(e),this.deps.scene.add(e)}addCamera(e){this._cameraObjects.push(e),this.deps.camera.add(e)}addControl(){const{camera:e,renderer:t}=this.deps;this.orbitControl=new xe(e,t.domElement),this.orbitControl.enableDamping=!0,this.orbitControl.dampingFactor=.05}reset(t=!0){const{camera:r,scene:n,renderer:s}=this.deps;r.position.set(0,0,0),r.quaternion.set(0,0,0,1),Te([n.background,"optionalAccess",e=>e.dispose,"optionalCall",e=>e()]),n.background=new e.Color(16777215),n.fog=null,n.position.z=-3,s.shadowMap.enabled=!1,s.physicallyCorrectLights=!1,s.outputEncoding=e.sRGBEncoding,Se(this.deps.scene),this._objects.forEach((e=>Te([e,"access",e=>e.material,"optionalAccess",e=>e.dispose,"optionalCall",e=>e()]))),this._cameraObjects.forEach((e=>Te([e,"access",e=>e.material,"optionalAccess",e=>e.dispose,"optionalCall",e=>e()]))),n.remove(...this._objects),r.remove(...this._cameraObjects),this._objects.length=0,this._cameraObjects.length=0,Te([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.dispose,"call",e=>e()]),t&&(this.orbitControl=null,this.deps=null)}}var Ee,Ae,Ie=function(e){if("object"!=typeof WXWebAssembly)return{supported:!1};var t,r,n=new Promise((e=>{r=e}));function s(e,r,n,s,a,o){var i=t.exports.sbrk,c=n+3&-4,l=i(c*s),u=i(a.length),h=new Uint8Array(t.exports.memory.buffer);h.set(a,u);var p=e(l,n,s,u,a.length);if(0==p&&o&&o(l,c,s),r.set(h.subarray(l,l+n*s)),i(l-i(0)),0!=p)throw new Error("Malformed buffer data: "+p)}var a={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},o={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{setWasmPath:function(e){WXWebAssembly.instantiate(e,{}).then((function(e){(t=e.instance).exports.__wasm_call_ctors(),r()}))},ready:n,supported:!0,decodeVertexBuffer:function(e,r,n,o,i){s(t.exports.meshopt_decodeVertexBuffer,e,r,n,o,t.exports[a[i]])},decodeIndexBuffer:function(e,r,n,a){s(t.exports.meshopt_decodeIndexBuffer,e,r,n,a)},decodeIndexSequence:function(e,r,n,a){s(t.exports.meshopt_decodeIndexSequence,e,r,n,a)},decodeGltfBuffer:function(e,r,n,i,c,l){s(t.exports[o[c]],e,r,n,i,t.exports[a[l]])}}}();class Me extends e.DataTextureLoader{constructor(e){super(e)}parse(t){const r=0,n=1,s=2,a=3,o=9,i=10,c=11,l=48,u=4,h=0,p=1,d=2,f=3;t.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");let g=0;const m=new Uint8Array(t),v={id_length:m[g++],colormap_type:m[g++],image_type:m[g++],colormap_index:m[g++]|m[g++]<<8,colormap_length:m[g++]|m[g++]<<8,colormap_size:m[g++],origin:[m[g++]|m[g++]<<8,m[g++]|m[g++]<<8],width:m[g++]|m[g++]<<8,height:m[g++]|m[g++]<<8,pixel_size:m[g++],flags:m[g++]};!function(e){switch(e.image_type){case n:case o:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case s:case a:case i:case c:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case r:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(v),v.id_length+g>t.length&&console.error("THREE.TGALoader: No data."),g+=v.id_length;let y=!1,b=!1,x=!1;switch(v.image_type){case o:y=!0,b=!0;break;case n:b=!0;break;case i:y=!0;break;case s:break;case c:y=!0,x=!0;break;case a:x=!0}const w=new Uint8Array(v.width*v.height*4),S=function(e,t,r,n,s){let a,o;const i=r.pixel_size>>3,c=r.width*r.height*i;if(t&&(o=s.subarray(n,n+=r.colormap_length*(r.colormap_size>>3))),e){let e,t,r;a=new Uint8Array(c);let o=0;const l=new Uint8Array(i);for(;o<c;)if(e=s[n++],t=1+(127&e),128&e){for(r=0;r<i;++r)l[r]=s[n++];for(r=0;r<t;++r)a.set(l,o+r*i);o+=i*t}else{for(t*=i,r=0;r<t;++r)a[o+r]=s[n++];o+=t}}else a=s.subarray(n,n+=t?r.width*r.height:c);return{pixel_data:a,palettes:o}}(y,b,v,g,m);return function(e,t,r,n,s){let a,o,i,c,g,m;switch((v.flags&l)>>u){default:case d:a=0,i=1,g=t,o=0,c=1,m=r;break;case h:a=0,i=1,g=t,o=r-1,c=-1,m=-1;break;case f:a=t-1,i=-1,g=-1,o=0,c=1,m=r;break;case p:a=t-1,i=-1,g=-1,o=r-1,c=-1,m=-1}if(x)switch(v.pixel_size){case 8:!function(e,t,r,n,s,a,o,i){let c,l,u,h=0;const p=v.width;for(u=t;u!==n;u+=r)for(l=s;l!==o;l+=a,h++)c=i[h],e[4*(l+p*u)+0]=c,e[4*(l+p*u)+1]=c,e[4*(l+p*u)+2]=c,e[4*(l+p*u)+3]=255}(e,o,c,m,a,i,g,n);break;case 16:!function(e,t,r,n,s,a,o,i){let c,l,u=0;const h=v.width;for(l=t;l!==n;l+=r)for(c=s;c!==o;c+=a,u+=2)e[4*(c+h*l)+0]=i[u+0],e[4*(c+h*l)+1]=i[u+0],e[4*(c+h*l)+2]=i[u+0],e[4*(c+h*l)+3]=i[u+1]}(e,o,c,m,a,i,g,n);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(v.pixel_size){case 8:!function(e,t,r,n,s,a,o,i,c){const l=c;let u,h,p,d=0;const f=v.width;for(p=t;p!==n;p+=r)for(h=s;h!==o;h+=a,d++)u=i[d],e[4*(h+f*p)+3]=255,e[4*(h+f*p)+2]=l[3*u+0],e[4*(h+f*p)+1]=l[3*u+1],e[4*(h+f*p)+0]=l[3*u+2]}(e,o,c,m,a,i,g,n,s);break;case 16:!function(e,t,r,n,s,a,o,i){let c,l,u,h=0;const p=v.width;for(u=t;u!==n;u+=r)for(l=s;l!==o;l+=a,h+=2)c=i[h+0]+(i[h+1]<<8),e[4*(l+p*u)+0]=(31744&c)>>7,e[4*(l+p*u)+1]=(992&c)>>2,e[4*(l+p*u)+2]=(31&c)>>3,e[4*(l+p*u)+3]=32768&c?0:255}(e,o,c,m,a,i,g,n);break;case 24:!function(e,t,r,n,s,a,o,i){let c,l,u=0;const h=v.width;for(l=t;l!==n;l+=r)for(c=s;c!==o;c+=a,u+=3)e[4*(c+h*l)+3]=255,e[4*(c+h*l)+2]=i[u+0],e[4*(c+h*l)+1]=i[u+1],e[4*(c+h*l)+0]=i[u+2]}(e,o,c,m,a,i,g,n);break;case 32:!function(e,t,r,n,s,a,o,i){let c,l,u=0;const h=v.width;for(l=t;l!==n;l+=r)for(c=s;c!==o;c+=a,u+=4)e[4*(c+h*l)+2]=i[u+0],e[4*(c+h*l)+1]=i[u+1],e[4*(c+h*l)+0]=i[u+2],e[4*(c+h*l)+3]=i[u+3]}(e,o,c,m,a,i,g,n);break;default:console.error("THREE.TGALoader: Format not supported.")}}(w,v.width,v.height,S.pixel_data,S.palettes),{data:w,width:v.width,height:v.height,flipY:!0,generateMipmaps:!0,minFilter:e.LinearMipmapLinearFilter}}}class Le extends e.Loader{constructor(e){super(e)}load(t,r,n,s){const a=this,o=new e.FileLoader(a.manager);o.setPath(a.path),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(t,(function(e){try{r(a.parse(e))}catch(e){s?s(e):console.error(e),a.manager.itemError(t)}}),n,s)}parse(t){function r(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function n(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}function s(e,t,r,n){const s=parseInt(u[n].substr(e,t));if(s){const e=(a=r,o=s,"s"+Math.min(a,o)+"e"+Math.max(a,o));void 0===c[e]&&(i.push([r-1,s-1,1]),c[e]=i.length-1)}var a,o}const a={h:[255,255,255],he:[217,255,255],li:[204,128,255],be:[194,255,0],b:[255,181,181],c:[144,144,144],n:[48,80,248],o:[255,13,13],f:[144,224,80],ne:[179,227,245],na:[171,92,242],mg:[138,255,0],al:[191,166,166],si:[240,200,160],p:[255,128,0],s:[255,255,48],cl:[31,240,31],ar:[128,209,227],k:[143,64,212],ca:[61,255,0],sc:[230,230,230],ti:[191,194,199],v:[166,166,171],cr:[138,153,199],mn:[156,122,199],fe:[224,102,51],co:[240,144,160],ni:[80,208,80],cu:[200,128,51],zn:[125,128,176],ga:[194,143,143],ge:[102,143,143],as:[189,128,227],se:[255,161,0],br:[166,41,41],kr:[92,184,209],rb:[112,46,176],sr:[0,255,0],y:[148,255,255],zr:[148,224,224],nb:[115,194,201],mo:[84,181,181],tc:[59,158,158],ru:[36,143,143],rh:[10,125,140],pd:[0,105,133],ag:[192,192,192],cd:[255,217,143],in:[166,117,115],sn:[102,128,128],sb:[158,99,181],te:[212,122,0],i:[148,0,148],xe:[66,158,176],cs:[87,23,143],ba:[0,201,0],la:[112,212,255],ce:[255,255,199],pr:[217,255,199],nd:[199,255,199],pm:[163,255,199],sm:[143,255,199],eu:[97,255,199],gd:[69,255,199],tb:[48,255,199],dy:[31,255,199],ho:[0,255,156],er:[0,230,117],tm:[0,212,82],yb:[0,191,56],lu:[0,171,36],hf:[77,194,255],ta:[77,166,255],w:[33,148,214],re:[38,125,171],os:[38,102,150],ir:[23,84,135],pt:[208,208,224],au:[255,209,35],hg:[184,184,208],tl:[166,84,77],pb:[87,89,97],bi:[158,79,181],po:[171,92,0],at:[117,79,69],rn:[66,130,150],fr:[66,0,102],ra:[0,125,0],ac:[112,171,250],th:[0,186,255],pa:[0,161,255],u:[0,143,255],np:[0,128,255],pu:[0,107,255],am:[84,92,242],cm:[120,92,227],bk:[138,79,227],cf:[161,54,212],es:[179,31,212],fm:[179,31,186],md:[179,13,166],no:[189,13,135],lr:[199,0,102],rf:[204,0,89],db:[209,0,79],sg:[217,0,69],bh:[224,0,56],hs:[230,0,46],mt:[235,0,38],ds:[235,0,38],rg:[235,0,38],cn:[235,0,38],uut:[235,0,38],uuq:[235,0,38],uup:[235,0,38],uuh:[235,0,38],uus:[235,0,38],uuo:[235,0,38]},o=[],i=[],c={},l={},u=t.split("\n");for(let e=0,t=u.length;e<t;e++)if("ATOM"===u[e].substr(0,4)||"HETATM"===u[e].substr(0,6)){const t=parseFloat(u[e].substr(30,7)),s=parseFloat(u[e].substr(38,7)),i=parseFloat(u[e].substr(46,7)),c=parseInt(u[e].substr(6,5))-1;let h=r(u[e].substr(76,2)).toLowerCase();""===h&&(h=r(u[e].substr(12,2)).toLowerCase());const p=[t,s,i,a[h],n(h)];o.push(p),l[c]=p}else if("CONECT"===u[e].substr(0,6)){const t=parseInt(u[e].substr(6,5));s(11,5,t,e),s(16,5,t,e),s(21,5,t,e),s(26,5,t,e)}return function(){const t={geometryAtoms:new e.BufferGeometry,geometryBonds:new e.BufferGeometry,json:{atoms:o}},r=t.geometryAtoms,n=t.geometryBonds,s=[],a=[],c=[];for(let e=0,t=o.length;e<t;e++){const t=o[e],r=t[0],n=t[1],i=t[2];s.push(r,n,i);const c=t[3][0]/255,l=t[3][1]/255,u=t[3][2]/255;a.push(c,l,u)}for(let e=0,t=i.length;e<t;e++){const t=i[e],r=t[0],n=t[1],s=l[r],a=l[n];let o=s[0],u=s[1],h=s[2];c.push(o,u,h),o=a[0],u=a[1],h=a[2],c.push(o,u,h)}return r.setAttribute("position",new e.Float32BufferAttribute(s,3)),r.setAttribute("color",new e.Float32BufferAttribute(a,3)),n.setAttribute("position",new e.Float32BufferAttribute(c,3)),t}()}}class Ce extends e.Loader{constructor(e){super(e)}load(t,r,n,s){const a=this,o=new e.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(e){try{r(a.parse(e))}catch(e){s?s(e):console.error(e),a.manager.itemError(t)}}),n,s)}parse(t){function r(e,t,r){for(let n=0,s=e.length;n<s;n++)if(e[n]!==t.getUint8(r+n,!1))return!1;return!0}const n=function(e){if("string"==typeof e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}(t);return function(e){const t=new DataView(e);if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;const n=[115,111,108,105,100];for(let e=0;e<5;e++)if(r(n,t,e))return!1;return!0}(n)?function(t){const r=new DataView(t),n=r.getUint32(80,!0);let s,a,o,i,c,l,u,h,p=!1;for(let e=0;e<70;e++)1129270351==r.getUint32(e,!1)&&82==r.getUint8(e+4)&&61==r.getUint8(e+5)&&(p=!0,i=new Float32Array(3*n*3),c=r.getUint8(e+6)/255,l=r.getUint8(e+7)/255,u=r.getUint8(e+8)/255,h=r.getUint8(e+9)/255);const d=new e.BufferGeometry,f=new Float32Array(3*n*3),g=new Float32Array(3*n*3);for(let e=0;e<n;e++){const t=84+50*e,n=r.getFloat32(t,!0),h=r.getFloat32(t+4,!0),d=r.getFloat32(t+8,!0);if(p){const e=r.getUint16(t+48,!0);0==(32768&e)?(s=(31&e)/31,a=(e>>5&31)/31,o=(e>>10&31)/31):(s=c,a=l,o=u)}for(let c=1;c<=3;c++){const l=t+12*c,u=3*e*3+3*(c-1);f[u]=r.getFloat32(l,!0),f[u+1]=r.getFloat32(l+4,!0),f[u+2]=r.getFloat32(l+8,!0),g[u]=n,g[u+1]=h,g[u+2]=d,p&&(i[u]=s,i[u+1]=a,i[u+2]=o)}}return d.setAttribute("position",new e.BufferAttribute(f,3)),d.setAttribute("normal",new e.BufferAttribute(g,3)),p&&(d.setAttribute("color",new e.BufferAttribute(i,3)),d.hasColors=!0,d.alpha=h),d}(n):function(t){const r=new e.BufferGeometry,n=/solid([\s\S]*?)endsolid/g,s=/facet([\s\S]*?)endfacet/g;let a=0;const o=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,i=new RegExp("vertex"+o+o+o,"g"),c=new RegExp("normal"+o+o+o,"g"),l=[],u=[],h=new e.Vector3;let p,d=0,f=0,g=0;for(;null!==(p=n.exec(t));){f=g;const e=p[0];for(;null!==(p=s.exec(e));){let e=0,t=0;const r=p[0];for(;null!==(p=c.exec(r));)h.x=parseFloat(p[1]),h.y=parseFloat(p[2]),h.z=parseFloat(p[3]),t++;for(;null!==(p=i.exec(r));)l.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),u.push(h.x,h.y,h.z),e++,g++;1!==t&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+a),3!==e&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+a),a++}const t=f,n=g-f;r.addGroup(t,n,d),d++}return r.setAttribute("position",new e.Float32BufferAttribute(l,3)),r.setAttribute("normal",new e.Float32BufferAttribute(u,3)),r}("string"!=typeof(s=t)?e.LoaderUtils.decodeText(new Uint8Array(s)):s);var s}}String.prototype.codePointAt||(Ee=function(){try{var e={},t=Object.defineProperty,r=t(e,e,e)&&t}catch(e){}return r}(),Ae=function(e){if(null==this)throw TypeError();var t=String(this),r=t.length,n=e?Number(e):0;if(n!=n&&(n=0),!(n<0||n>=r)){var s,a=t.charCodeAt(n);return a>=55296&&a<=56319&&r>n+1&&(s=t.charCodeAt(n+1))>=56320&&s<=57343?1024*(a-55296)+s-56320+65536:a}},Ee?Ee(String.prototype,"codePointAt",{value:Ae,configurable:!0,writable:!0}):String.prototype.codePointAt=Ae);function Re(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function Oe(e,t){this.source=e,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=t,this.destLen=0,this.ltree=new Re,this.dtree=new Re}var Ne=new Re,Ue=new Re,De=new Uint8Array(30),Pe=new Uint16Array(30),Be=new Uint8Array(30),Ge=new Uint16Array(30),_e=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),He=new Re,Ve=new Uint8Array(320);function ze(e,t,r,n){var s,a;for(s=0;s<r;++s)e[s]=0;for(s=0;s<30-r;++s)e[s+r]=s/r|0;for(a=n,s=0;s<30;++s)t[s]=a,a+=1<<e[s]}var je=new Uint16Array(16);function We(e,t,r,n){var s,a;for(s=0;s<16;++s)e.table[s]=0;for(s=0;s<n;++s)e.table[t[r+s]]++;for(e.table[0]=0,a=0,s=0;s<16;++s)je[s]=a,a+=e.table[s];for(s=0;s<n;++s)t[r+s]&&(e.trans[je[t[r+s]]++]=s)}function Xe(e){e.bitcount--||(e.tag=e.source[e.sourceIndex++],e.bitcount=7);var t=1&e.tag;return e.tag>>>=1,t}function qe(e,t,r){if(!t)return r;for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var n=e.tag&65535>>>16-t;return e.tag>>>=t,e.bitcount-=t,n+r}function Ye(e,t){for(;e.bitcount<24;)e.tag|=e.source[e.sourceIndex++]<<e.bitcount,e.bitcount+=8;var r=0,n=0,s=0,a=e.tag;do{n=2*n+(1&a),a>>>=1,++s,r+=t.table[s],n-=t.table[s]}while(n>=0);return e.tag=a,e.bitcount-=s,t.trans[r+n]}function Ke(e,t,r){var n,s,a,o,i,c;for(n=qe(e,5,257),s=qe(e,5,1),a=qe(e,4,4),o=0;o<19;++o)Ve[o]=0;for(o=0;o<a;++o){var l=qe(e,3,0);Ve[_e[o]]=l}for(We(He,Ve,0,19),i=0;i<n+s;){var u=Ye(e,He);switch(u){case 16:var h=Ve[i-1];for(c=qe(e,2,3);c;--c)Ve[i++]=h;break;case 17:for(c=qe(e,3,3);c;--c)Ve[i++]=0;break;case 18:for(c=qe(e,7,11);c;--c)Ve[i++]=0;break;default:Ve[i++]=u}}We(t,Ve,0,n),We(r,Ve,n,s)}function Ze(e,t,r){for(;;){var n,s,a,o,i=Ye(e,t);if(256===i)return 0;if(i<256)e.dest[e.destLen++]=i;else for(n=qe(e,De[i-=257],Pe[i]),s=Ye(e,r),o=a=e.destLen-qe(e,Be[s],Ge[s]);o<a+n;++o)e.dest[e.destLen++]=e.dest[o]}}function Qe(e){for(var t,r;e.bitcount>8;)e.sourceIndex--,e.bitcount-=8;if((t=256*(t=e.source[e.sourceIndex+1])+e.source[e.sourceIndex])!==(65535&~(256*e.source[e.sourceIndex+3]+e.source[e.sourceIndex+2])))return-3;for(e.sourceIndex+=4,r=t;r;--r)e.dest[e.destLen++]=e.source[e.sourceIndex++];return e.bitcount=0,0}!function(e,t){var r;for(r=0;r<7;++r)e.table[r]=0;for(e.table[7]=24,e.table[8]=152,e.table[9]=112,r=0;r<24;++r)e.trans[r]=256+r;for(r=0;r<144;++r)e.trans[24+r]=r;for(r=0;r<8;++r)e.trans[168+r]=280+r;for(r=0;r<112;++r)e.trans[176+r]=144+r;for(r=0;r<5;++r)t.table[r]=0;for(t.table[5]=32,r=0;r<32;++r)t.trans[r]=r}(Ne,Ue),ze(De,Pe,4,3),ze(Be,Ge,2,1),De[28]=0,Pe[28]=258;var $e=function(e,t){var r,n,s=new Oe(e,t);do{switch(r=Xe(s),qe(s,2,0)){case 0:n=Qe(s);break;case 1:n=Ze(s,Ne,Ue);break;case 2:Ke(s,s.ltree,s.dtree),n=Ze(s,s.ltree,s.dtree);break;default:n=-3}if(0!==n)throw new Error("Data error")}while(!r);return s.destLen<s.dest.length?"function"==typeof s.dest.slice?s.dest.slice(0,s.destLen):s.dest.subarray(0,s.destLen):s.dest};function Je(e,t,r,n,s){return Math.pow(1-s,3)*e+3*Math.pow(1-s,2)*s*t+3*(1-s)*Math.pow(s,2)*r+Math.pow(s,3)*n}function et(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}function tt(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}function rt(e){throw new Error(e)}function nt(e,t){e||rt(t)}et.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)},et.prototype.addPoint=function(e,t){"number"==typeof e&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),"number"==typeof t&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))},et.prototype.addX=function(e){this.addPoint(e,null)},et.prototype.addY=function(e){this.addPoint(null,e)},et.prototype.addBezier=function(e,t,r,n,s,a,o,i){var c=[e,t],l=[r,n],u=[s,a],h=[o,i];this.addPoint(e,t),this.addPoint(o,i);for(var p=0;p<=1;p++){var d=6*c[p]-12*l[p]+6*u[p],f=-3*c[p]+9*l[p]-9*u[p]+3*h[p],g=3*l[p]-3*c[p];if(0!==f){var m=Math.pow(d,2)-4*g*f;if(!(m<0)){var v=(-d+Math.sqrt(m))/(2*f);0<v&&v<1&&(0===p&&this.addX(Je(c[p],l[p],u[p],h[p],v)),1===p&&this.addY(Je(c[p],l[p],u[p],h[p],v)));var y=(-d-Math.sqrt(m))/(2*f);0<y&&y<1&&(0===p&&this.addX(Je(c[p],l[p],u[p],h[p],y)),1===p&&this.addY(Je(c[p],l[p],u[p],h[p],y)))}}else{if(0===d)continue;var b=-g/d;0<b&&b<1&&(0===p&&this.addX(Je(c[p],l[p],u[p],h[p],b)),1===p&&this.addY(Je(c[p],l[p],u[p],h[p],b)))}}},et.prototype.addQuad=function(e,t,r,n,s,a){var o=e+2/3*(r-e),i=t+2/3*(n-t),c=o+1/3*(s-e),l=i+1/3*(a-t);this.addBezier(e,t,o,i,c,l,s,a)},tt.prototype.moveTo=function(e,t){this.commands.push({type:"M",x:e,y:t})},tt.prototype.lineTo=function(e,t){this.commands.push({type:"L",x:e,y:t})},tt.prototype.curveTo=tt.prototype.bezierCurveTo=function(e,t,r,n,s,a){this.commands.push({type:"C",x1:e,y1:t,x2:r,y2:n,x:s,y:a})},tt.prototype.quadTo=tt.prototype.quadraticCurveTo=function(e,t,r,n){this.commands.push({type:"Q",x1:e,y1:t,x:r,y:n})},tt.prototype.close=tt.prototype.closePath=function(){this.commands.push({type:"Z"})},tt.prototype.extend=function(e){if(e.commands)e=e.commands;else if(e instanceof et){var t=e;return this.moveTo(t.x1,t.y1),this.lineTo(t.x2,t.y1),this.lineTo(t.x2,t.y2),this.lineTo(t.x1,t.y2),void this.close()}Array.prototype.push.apply(this.commands,e)},tt.prototype.getBoundingBox=function(){for(var e=new et,t=0,r=0,n=0,s=0,a=0;a<this.commands.length;a++){var o=this.commands[a];switch(o.type){case"M":e.addPoint(o.x,o.y),t=n=o.x,r=s=o.y;break;case"L":e.addPoint(o.x,o.y),n=o.x,s=o.y;break;case"Q":e.addQuad(n,s,o.x1,o.y1,o.x,o.y),n=o.x,s=o.y;break;case"C":e.addBezier(n,s,o.x1,o.y1,o.x2,o.y2,o.x,o.y),n=o.x,s=o.y;break;case"Z":n=t,s=r;break;default:throw new Error("Unexpected path command "+o.type)}}return e.isEmpty()&&e.addPoint(0,0),e},tt.prototype.draw=function(e){e.beginPath();for(var t=0;t<this.commands.length;t+=1){var r=this.commands[t];"M"===r.type?e.moveTo(r.x,r.y):"L"===r.type?e.lineTo(r.x,r.y):"C"===r.type?e.bezierCurveTo(r.x1,r.y1,r.x2,r.y2,r.x,r.y):"Q"===r.type?e.quadraticCurveTo(r.x1,r.y1,r.x,r.y):"Z"===r.type&&e.closePath()}this.fill&&(e.fillStyle=this.fill,e.fill()),this.stroke&&(e.strokeStyle=this.stroke,e.lineWidth=this.strokeWidth,e.stroke())},tt.prototype.toPathData=function(e){function t(t){return Math.round(t)===t?""+Math.round(t):t.toFixed(e)}function r(){for(var e=arguments,r="",n=0;n<arguments.length;n+=1){var s=e[n];s>=0&&n>0&&(r+=" "),r+=t(s)}return r}e=void 0!==e?e:2;for(var n="",s=0;s<this.commands.length;s+=1){var a=this.commands[s];"M"===a.type?n+="M"+r(a.x,a.y):"L"===a.type?n+="L"+r(a.x,a.y):"C"===a.type?n+="C"+r(a.x1,a.y1,a.x2,a.y2,a.x,a.y):"Q"===a.type?n+="Q"+r(a.x1,a.y1,a.x,a.y):"Z"===a.type&&(n+="Z")}return n},tt.prototype.toSVG=function(e){var t='<path d="';return t+=this.toPathData(e),t+='"',this.fill&&"black"!==this.fill&&(null===this.fill?t+=' fill="none"':t+=' fill="'+this.fill+'"'),this.stroke&&(t+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),t+="/>"},tt.prototype.toDOMElement=function(e){var t=this.toPathData(e),r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",t),r};var st={fail:rt,argument:nt,assert:nt},at={},ot={},it={};function ct(e){return function(){return e}}ot.BYTE=function(e){return st.argument(e>=0&&e<=255,"Byte value should be between 0 and 255."),[e]},it.BYTE=ct(1),ot.CHAR=function(e){return[e.charCodeAt(0)]},it.CHAR=ct(1),ot.CHARARRAY=function(e){for(var t=[],r=0;r<e.length;r+=1)t[r]=e.charCodeAt(r);return t},it.CHARARRAY=function(e){return e.length},ot.USHORT=function(e){return[e>>8&255,255&e]},it.USHORT=ct(2),ot.SHORT=function(e){return e>=32768&&(e=-(65536-e)),[e>>8&255,255&e]},it.SHORT=ct(2),ot.UINT24=function(e){return[e>>16&255,e>>8&255,255&e]},it.UINT24=ct(3),ot.ULONG=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]},it.ULONG=ct(4),ot.LONG=function(e){return e>=2147483648&&(e=-(4294967296-e)),[e>>24&255,e>>16&255,e>>8&255,255&e]},it.LONG=ct(4),ot.FIXED=ot.ULONG,it.FIXED=it.ULONG,ot.FWORD=ot.SHORT,it.FWORD=it.SHORT,ot.UFWORD=ot.USHORT,it.UFWORD=it.USHORT,ot.LONGDATETIME=function(e){return[0,0,0,0,e>>24&255,e>>16&255,e>>8&255,255&e]},it.LONGDATETIME=ct(8),ot.TAG=function(e){return st.argument(4===e.length,"Tag should be exactly 4 ASCII characters."),[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]},it.TAG=ct(4),ot.Card8=ot.BYTE,it.Card8=it.BYTE,ot.Card16=ot.USHORT,it.Card16=it.USHORT,ot.OffSize=ot.BYTE,it.OffSize=it.BYTE,ot.SID=ot.USHORT,it.SID=it.USHORT,ot.NUMBER=function(e){return e>=-107&&e<=107?[e+139]:e>=108&&e<=1131?[247+((e-=108)>>8),255&e]:e>=-1131&&e<=-108?[251+((e=-e-108)>>8),255&e]:e>=-32768&&e<=32767?ot.NUMBER16(e):ot.NUMBER32(e)},it.NUMBER=function(e){return ot.NUMBER(e).length},ot.NUMBER16=function(e){return[28,e>>8&255,255&e]},it.NUMBER16=ct(3),ot.NUMBER32=function(e){return[29,e>>24&255,e>>16&255,e>>8&255,255&e]},it.NUMBER32=ct(5),ot.REAL=function(e){var t=e.toString(),r=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(t);if(r){var n=parseFloat("1e"+((r[2]?+r[2]:0)+r[1].length));t=(Math.round(e*n)/n).toString()}for(var s="",a=0,o=t.length;a<o;a+=1){var i=t[a];s+="e"===i?"-"===t[++a]?"c":"b":"."===i?"a":"-"===i?"e":i}for(var c=[30],l=0,u=(s+=1&s.length?"f":"ff").length;l<u;l+=2)c.push(parseInt(s.substr(l,2),16));return c},it.REAL=function(e){return ot.REAL(e).length},ot.NAME=ot.CHARARRAY,it.NAME=it.CHARARRAY,ot.STRING=ot.CHARARRAY,it.STRING=it.CHARARRAY,at.UTF8=function(e,t,r){for(var n=[],s=r,a=0;a<s;a++,t+=1)n[a]=e.getUint8(t);return String.fromCharCode.apply(null,n)},at.UTF16=function(e,t,r){for(var n=[],s=r/2,a=0;a<s;a++,t+=2)n[a]=e.getUint16(t);return String.fromCharCode.apply(null,n)},ot.UTF16=function(e){for(var t=[],r=0;r<e.length;r+=1){var n=e.charCodeAt(r);t[t.length]=n>>8&255,t[t.length]=255&n}return t},it.UTF16=function(e){return 2*e.length};var lt={"x-mac-croatian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®Š™´¨≠ŽØ∞±≤≥∆µ∂∑∏š∫ªºΩžø¿¡¬√ƒ≈Ć«Č… ÀÃÕŒœĐ—“”‘’÷◊©⁄€‹›Æ»–·‚„‰ÂćÁčÈÍÎÏÌÓÔđÒÚÛÙıˆ˜¯πË˚¸Êæˇ","x-mac-cyrillic":"АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ†°Ґ£§•¶І®©™Ђђ≠Ѓѓ∞±≤≥іµґЈЄєЇїЉљЊњјЅ¬√ƒ≈∆«»… ЋћЌќѕ–—“”‘’÷„ЎўЏџ№Ёёяабвгдежзийклмнопрстуфхцчшщъыьэю","x-mac-gaelic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØḂ±≤≥ḃĊċḊḋḞḟĠġṀæøṁṖṗɼƒſṠ«»… ÀÃÕŒœ–—“”‘’ṡẛÿŸṪ€‹›Ŷŷṫ·Ỳỳ⁊ÂÊÁËÈÍÎÏÌÓÔ♣ÒÚÛÙıÝýŴŵẄẅẀẁẂẃ","x-mac-greek":"Ä¹²É³ÖÜ΅àâä΄¨çéèêë£™îï•½‰ôö¦€ùûü†ΓΔΘΛΞΠß®©ΣΪ§≠°·Α±≤≥¥ΒΕΖΗΙΚΜΦΫΨΩάΝ¬ΟΡ≈Τ«»… ΥΧΆΈœ–―“”‘’÷ΉΊΌΎέήίόΏύαβψδεφγηιξκλμνοπώρστθωςχυζϊϋΐΰ­","x-mac-icelandic":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûüÝ°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€ÐðÞþý·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-inuit":"ᐃᐄᐅᐆᐊᐋᐱᐲᐳᐴᐸᐹᑉᑎᑏᑐᑑᑕᑖᑦᑭᑮᑯᑰᑲᑳᒃᒋᒌᒍᒎᒐᒑ°ᒡᒥᒦ•¶ᒧ®©™ᒨᒪᒫᒻᓂᓃᓄᓅᓇᓈᓐᓯᓰᓱᓲᓴᓵᔅᓕᓖᓗᓘᓚᓛᓪᔨᔩᔪᔫᔭ… ᔮᔾᕕᕖᕗ–—“”‘’ᕘᕙᕚᕝᕆᕇᕈᕉᕋᕌᕐᕿᖀᖁᖂᖃᖄᖅᖏᖐᖑᖒᖓᖔᖕᙱᙲᙳᙴᙵᙶᖖᖠᖡᖢᖣᖤᖥᖦᕼŁł","x-mac-ce":"ÄĀāÉĄÖÜáąČäčĆćéŹźĎíďĒēĖóėôöõúĚěü†°Ę£§•¶ß®©™ę¨≠ģĮįĪ≤≥īĶ∂∑łĻļĽľĹĺŅņŃ¬√ńŇ∆«»… ňŐÕőŌ–—“”‘’÷◊ōŔŕŘ‹›řŖŗŠ‚„šŚśÁŤťÍŽžŪÓÔūŮÚůŰűŲųÝýķŻŁżĢˇ",macintosh:"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›ﬁﬂ‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-romanian":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ĂȘ∞±≤≥¥µ∂∑∏π∫ªºΩăș¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸ⁄€‹›Țț‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙıˆ˜¯˘˙˚¸˝˛ˇ","x-mac-turkish":"ÄÅÇÉÑÖÜáàâäãåçéèêëíìîïñóòôöõúùûü†°¢£§•¶ß®©™´¨≠ÆØ∞±≤≥¥µ∂∑∏π∫ªºΩæø¿¡¬√ƒ≈∆«»… ÀÃÕŒœ–—“”‘’÷◊ÿŸĞğİıŞş‡·‚„‰ÂÊÁËÈÍÎÏÌÓÔÒÚÛÙˆ˜¯˘˙˚¸˝˛ˇ"};at.MACSTRING=function(e,t,r,n){var s=lt[n];if(void 0!==s){for(var a="",o=0;o<r;o++){var i=e.getUint8(t+o);a+=i<=127?String.fromCharCode(i):s[127&i]}return a}};var ut,ht="function"==typeof WeakMap&&new WeakMap;function pt(e){return e>=-128&&e<=127}function dt(e,t,r){for(var n=0,s=e.length;t<s&&n<64&&0===e[t];)++t,++n;return r.push(128|n-1),t}function ft(e,t,r){for(var n=0,s=e.length,a=t;a<s&&n<64;){var o=e[a];if(!pt(o))break;if(0===o&&a+1<s&&0===e[a+1])break;++a,++n}r.push(n-1);for(var i=t;i<a;++i)r.push(e[i]+256&255);return a}function gt(e,t,r){for(var n=0,s=e.length,a=t;a<s&&n<64;){var o=e[a];if(0===o)break;if(pt(o)&&a+1<s&&pt(e[a+1]))break;++a,++n}r.push(64|n-1);for(var i=t;i<a;++i){var c=e[i];r.push(c+65536>>8&255,c+256&255)}return a}ot.MACSTRING=function(e,t){var r=function(e){if(!ut)for(var t in ut={},lt)ut[t]=new String(t);var r=ut[e];if(void 0!==r){if(ht){var n=ht.get(r);if(void 0!==n)return n}var s=lt[e];if(void 0!==s){for(var a={},o=0;o<s.length;o++)a[s.charCodeAt(o)]=o+128;return ht&&ht.set(r,a),a}}}(t);if(void 0!==r){for(var n=[],s=0;s<e.length;s++){var a=e.charCodeAt(s);if(a>=128&&void 0===(a=r[a]))return;n[s]=a}return n}},it.MACSTRING=function(e,t){var r=ot.MACSTRING(e,t);return void 0!==r?r.length:0},ot.VARDELTAS=function(e){for(var t=0,r=[];t<e.length;){var n=e[t];t=0===n?dt(e,t,r):n>=-128&&n<=127?ft(e,t,r):gt(e,t,r)}return r},ot.INDEX=function(e){for(var t=1,r=[t],n=[],s=0;s<e.length;s+=1){var a=ot.OBJECT(e[s]);Array.prototype.push.apply(n,a),t+=a.length,r.push(t)}if(0===n.length)return[0,0];for(var o=[],i=1+Math.floor(Math.log(t)/Math.log(2))/8|0,c=[void 0,ot.BYTE,ot.USHORT,ot.UINT24,ot.ULONG][i],l=0;l<r.length;l+=1){var u=c(r[l]);Array.prototype.push.apply(o,u)}return Array.prototype.concat(ot.Card16(e.length),ot.OffSize(i),o,n)},it.INDEX=function(e){return ot.INDEX(e).length},ot.DICT=function(e){for(var t=[],r=Object.keys(e),n=r.length,s=0;s<n;s+=1){var a=parseInt(r[s],0),o=e[a];t=(t=t.concat(ot.OPERAND(o.value,o.type))).concat(ot.OPERATOR(a))}return t},it.DICT=function(e){return ot.DICT(e).length},ot.OPERATOR=function(e){return e<1200?[e]:[12,e-1200]},ot.OPERAND=function(e,t){var r=[];if(Array.isArray(t))for(var n=0;n<t.length;n+=1)st.argument(e.length===t.length,"Not enough arguments given for type"+t),r=r.concat(ot.OPERAND(e[n],t[n]));else if("SID"===t)r=r.concat(ot.NUMBER(e));else if("offset"===t)r=r.concat(ot.NUMBER32(e));else if("number"===t)r=r.concat(ot.NUMBER(e));else{if("real"!==t)throw new Error("Unknown operand type "+t);r=r.concat(ot.REAL(e))}return r},ot.OP=ot.BYTE,it.OP=it.BYTE;var mt="function"==typeof WeakMap&&new WeakMap;function vt(e,t,r){for(var n=0;n<t.length;n+=1){var s=t[n];this[s.name]=s.value}if(this.tableName=e,this.fields=t,r)for(var a=Object.keys(r),o=0;o<a.length;o+=1){var i=a[o],c=r[i];void 0!==this[i]&&(this[i]=c)}}function yt(e,t,r){void 0===r&&(r=t.length);var n=new Array(t.length+1);n[0]={name:e+"Count",type:"USHORT",value:r};for(var s=0;s<t.length;s++)n[s+1]={name:e+s,type:"USHORT",value:t[s]};return n}function bt(e,t,r){var n=t.length,s=new Array(n+1);s[0]={name:e+"Count",type:"USHORT",value:n};for(var a=0;a<n;a++)s[a+1]={name:e+a,type:"TABLE",value:r(t[a],a)};return s}function xt(e,t,r){var n=t.length,s=[];s[0]={name:e+"Count",type:"USHORT",value:n};for(var a=0;a<n;a++)s=s.concat(r(t[a],a));return s}function wt(e){1===e.format?vt.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(yt("glyph",e.glyphs))):st.assert(!1,"Can't create coverage table format 2 yet.")}function St(e){vt.call(this,"scriptListTable",xt("scriptRecord",e,(function(e,t){var r=e.script,n=r.defaultLangSys;return st.assert(!!n,"Unable to write GSUB: script "+e.tag+" has no default language system."),[{name:"scriptTag"+t,type:"TAG",value:e.tag},{name:"script"+t,type:"TABLE",value:new vt("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new vt("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:n.reqFeatureIndex}].concat(yt("featureIndex",n.featureIndexes)))}].concat(xt("langSys",r.langSysRecords,(function(e,t){var r=e.langSys;return[{name:"langSysTag"+t,type:"TAG",value:e.tag},{name:"langSys"+t,type:"TABLE",value:new vt("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:r.reqFeatureIndex}].concat(yt("featureIndex",r.featureIndexes)))}]}))))}]})))}function Tt(e){vt.call(this,"featureListTable",xt("featureRecord",e,(function(e,t){var r=e.feature;return[{name:"featureTag"+t,type:"TAG",value:e.tag},{name:"feature"+t,type:"TABLE",value:new vt("featureTable",[{name:"featureParams",type:"USHORT",value:r.featureParams}].concat(yt("lookupListIndex",r.lookupListIndexes)))}]})))}function Ft(e,t){vt.call(this,"lookupListTable",bt("lookup",e,(function(e){var r=t[e.lookupType];return st.assert(!!r,"Unable to write GSUB lookup type "+e.lookupType+" tables."),new vt("lookupTable",[{name:"lookupType",type:"USHORT",value:e.lookupType},{name:"lookupFlag",type:"USHORT",value:e.lookupFlag}].concat(bt("subtable",e.subtables,r)))})))}ot.CHARSTRING=function(e){if(mt){var t=mt.get(e);if(void 0!==t)return t}for(var r=[],n=e.length,s=0;s<n;s+=1){var a=e[s];r=r.concat(ot[a.type](a.value))}return mt&&mt.set(e,r),r},it.CHARSTRING=function(e){return ot.CHARSTRING(e).length},ot.OBJECT=function(e){var t=ot[e.type];return st.argument(void 0!==t,"No encoding function for type "+e.type),t(e.value)},it.OBJECT=function(e){var t=it[e.type];return st.argument(void 0!==t,"No sizeOf function for type "+e.type),t(e.value)},ot.TABLE=function(e){for(var t=[],r=e.fields.length,n=[],s=[],a=0;a<r;a+=1){var o=e.fields[a],i=ot[o.type];st.argument(void 0!==i,"No encoding function for field type "+o.type+" ("+o.name+")");var c=e[o.name];void 0===c&&(c=o.value);var l=i(c);"TABLE"===o.type?(s.push(t.length),t=t.concat([0,0]),n.push(l)):t=t.concat(l)}for(var u=0;u<n.length;u+=1){var h=s[u],p=t.length;st.argument(p<65536,"Table "+e.tableName+" too big."),t[h]=p>>8,t[h+1]=255&p,t=t.concat(n[u])}return t},it.TABLE=function(e){for(var t=0,r=e.fields.length,n=0;n<r;n+=1){var s=e.fields[n],a=it[s.type];st.argument(void 0!==a,"No sizeOf function for field type "+s.type+" ("+s.name+")");var o=e[s.name];void 0===o&&(o=s.value),t+=a(o),"TABLE"===s.type&&(t+=2)}return t},ot.RECORD=ot.TABLE,it.RECORD=it.TABLE,ot.LITERAL=function(e){return e},it.LITERAL=function(e){return e.length},vt.prototype.encode=function(){return ot.TABLE(this)},vt.prototype.sizeOf=function(){return it.TABLE(this)},wt.prototype=Object.create(vt.prototype),wt.prototype.constructor=wt,St.prototype=Object.create(vt.prototype),St.prototype.constructor=St,Tt.prototype=Object.create(vt.prototype),Tt.prototype.constructor=Tt,Ft.prototype=Object.create(vt.prototype),Ft.prototype.constructor=Ft;var kt={Table:vt,Record:vt,Coverage:wt,ScriptList:St,FeatureList:Tt,LookupList:Ft,ushortList:yt,tableList:bt,recordList:xt};function Et(e,t){return e.getUint8(t)}function At(e,t){return e.getUint16(t,!1)}function It(e,t){return e.getUint32(t,!1)}function Mt(e,t){return e.getInt16(t,!1)+e.getUint16(t+2,!1)/65535}var Lt={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function Ct(e,t){this.data=e,this.offset=t,this.relativeOffset=0}Ct.prototype.parseByte=function(){var e=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},Ct.prototype.parseChar=function(){var e=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,e},Ct.prototype.parseCard8=Ct.prototype.parseByte,Ct.prototype.parseUShort=function(){var e=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},Ct.prototype.parseCard16=Ct.prototype.parseUShort,Ct.prototype.parseSID=Ct.prototype.parseUShort,Ct.prototype.parseOffset16=Ct.prototype.parseUShort,Ct.prototype.parseShort=function(){var e=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,e},Ct.prototype.parseF2Dot14=function(){var e=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,e},Ct.prototype.parseULong=function(){var e=It(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},Ct.prototype.parseOffset32=Ct.prototype.parseULong,Ct.prototype.parseFixed=function(){var e=Mt(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,e},Ct.prototype.parseString=function(e){var t=this.data,r=this.offset+this.relativeOffset,n="";this.relativeOffset+=e;for(var s=0;s<e;s++)n+=String.fromCharCode(t.getUint8(r+s));return n},Ct.prototype.parseTag=function(){return this.parseString(4)},Ct.prototype.parseLongDateTime=function(){var e=It(this.data,this.offset+this.relativeOffset+4);return e-=2082844800,this.relativeOffset+=8,e},Ct.prototype.parseVersion=function(e){var t=At(this.data,this.offset+this.relativeOffset),r=At(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,void 0===e&&(e=4096),t+r/e/10},Ct.prototype.skip=function(e,t){void 0===t&&(t=1),this.relativeOffset+=Lt[e]*t},Ct.prototype.parseULongList=function(e){void 0===e&&(e=this.parseULong());for(var t=new Array(e),r=this.data,n=this.offset+this.relativeOffset,s=0;s<e;s++)t[s]=r.getUint32(n),n+=4;return this.relativeOffset+=4*e,t},Ct.prototype.parseOffset16List=Ct.prototype.parseUShortList=function(e){void 0===e&&(e=this.parseUShort());for(var t=new Array(e),r=this.data,n=this.offset+this.relativeOffset,s=0;s<e;s++)t[s]=r.getUint16(n),n+=2;return this.relativeOffset+=2*e,t},Ct.prototype.parseShortList=function(e){for(var t=new Array(e),r=this.data,n=this.offset+this.relativeOffset,s=0;s<e;s++)t[s]=r.getInt16(n),n+=2;return this.relativeOffset+=2*e,t},Ct.prototype.parseByteList=function(e){for(var t=new Array(e),r=this.data,n=this.offset+this.relativeOffset,s=0;s<e;s++)t[s]=r.getUint8(n++);return this.relativeOffset+=e,t},Ct.prototype.parseList=function(e,t){t||(t=e,e=this.parseUShort());for(var r=new Array(e),n=0;n<e;n++)r[n]=t.call(this);return r},Ct.prototype.parseList32=function(e,t){t||(t=e,e=this.parseULong());for(var r=new Array(e),n=0;n<e;n++)r[n]=t.call(this);return r},Ct.prototype.parseRecordList=function(e,t){t||(t=e,e=this.parseUShort());for(var r=new Array(e),n=Object.keys(t),s=0;s<e;s++){for(var a={},o=0;o<n.length;o++){var i=n[o],c=t[i];a[i]=c.call(this)}r[s]=a}return r},Ct.prototype.parseRecordList32=function(e,t){t||(t=e,e=this.parseULong());for(var r=new Array(e),n=Object.keys(t),s=0;s<e;s++){for(var a={},o=0;o<n.length;o++){var i=n[o],c=t[i];a[i]=c.call(this)}r[s]=a}return r},Ct.prototype.parseStruct=function(e){if("function"==typeof e)return e.call(this);for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var s=t[n],a=e[s];r[s]=a.call(this)}return r},Ct.prototype.parseValueRecord=function(e){if(void 0===e&&(e=this.parseUShort()),0!==e){var t={};return 1&e&&(t.xPlacement=this.parseShort()),2&e&&(t.yPlacement=this.parseShort()),4&e&&(t.xAdvance=this.parseShort()),8&e&&(t.yAdvance=this.parseShort()),16&e&&(t.xPlaDevice=void 0,this.parseShort()),32&e&&(t.yPlaDevice=void 0,this.parseShort()),64&e&&(t.xAdvDevice=void 0,this.parseShort()),128&e&&(t.yAdvDevice=void 0,this.parseShort()),t}},Ct.prototype.parseValueRecordList=function(){for(var e=this.parseUShort(),t=this.parseUShort(),r=new Array(t),n=0;n<t;n++)r[n]=this.parseValueRecord(e);return r},Ct.prototype.parsePointer=function(e){var t=this.parseOffset16();if(t>0)return new Ct(this.data,this.offset+t).parseStruct(e)},Ct.prototype.parsePointer32=function(e){var t=this.parseOffset32();if(t>0)return new Ct(this.data,this.offset+t).parseStruct(e)},Ct.prototype.parseListOfLists=function(e){for(var t=this.parseOffset16List(),r=t.length,n=this.relativeOffset,s=new Array(r),a=0;a<r;a++){var o=t[a];if(0!==o)if(this.relativeOffset=o,e){for(var i=this.parseOffset16List(),c=new Array(i.length),l=0;l<i.length;l++)this.relativeOffset=o+i[l],c[l]=e.call(this);s[a]=c}else s[a]=this.parseUShortList();else s[a]=void 0}return this.relativeOffset=n,s},Ct.prototype.parseCoverage=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort(),r=this.parseUShort();if(1===t)return{format:1,glyphs:this.parseUShortList(r)};if(2===t){for(var n=new Array(r),s=0;s<r;s++)n[s]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:n}}throw new Error("0x"+e.toString(16)+": Coverage format must be 1 or 2.")},Ct.prototype.parseClassDef=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(1===t)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(2===t)return{format:2,ranges:this.parseRecordList({start:Ct.uShort,end:Ct.uShort,classId:Ct.uShort})};throw new Error("0x"+e.toString(16)+": ClassDef format must be 1 or 2.")},Ct.list=function(e,t){return function(){return this.parseList(e,t)}},Ct.list32=function(e,t){return function(){return this.parseList32(e,t)}},Ct.recordList=function(e,t){return function(){return this.parseRecordList(e,t)}},Ct.recordList32=function(e,t){return function(){return this.parseRecordList32(e,t)}},Ct.pointer=function(e){return function(){return this.parsePointer(e)}},Ct.pointer32=function(e){return function(){return this.parsePointer32(e)}},Ct.tag=Ct.prototype.parseTag,Ct.byte=Ct.prototype.parseByte,Ct.uShort=Ct.offset16=Ct.prototype.parseUShort,Ct.uShortList=Ct.prototype.parseUShortList,Ct.uLong=Ct.offset32=Ct.prototype.parseULong,Ct.uLongList=Ct.prototype.parseULongList,Ct.struct=Ct.prototype.parseStruct,Ct.coverage=Ct.prototype.parseCoverage,Ct.classDef=Ct.prototype.parseClassDef;var Rt={reserved:Ct.uShort,reqFeatureIndex:Ct.uShort,featureIndexes:Ct.uShortList};Ct.prototype.parseScriptList=function(){return this.parsePointer(Ct.recordList({tag:Ct.tag,script:Ct.pointer({defaultLangSys:Ct.pointer(Rt),langSysRecords:Ct.recordList({tag:Ct.tag,langSys:Ct.pointer(Rt)})})}))||[]},Ct.prototype.parseFeatureList=function(){return this.parsePointer(Ct.recordList({tag:Ct.tag,feature:Ct.pointer({featureParams:Ct.offset16,lookupListIndexes:Ct.uShortList})}))||[]},Ct.prototype.parseLookupList=function(e){return this.parsePointer(Ct.list(Ct.pointer((function(){var t=this.parseUShort();st.argument(1<=t&&t<=9,"GPOS/GSUB lookup type "+t+" unknown.");var r=this.parseUShort(),n=16&r;return{lookupType:t,lookupFlag:r,subtables:this.parseList(Ct.pointer(e[t])),markFilteringSet:n?this.parseUShort():void 0}}))))||[]},Ct.prototype.parseFeatureVariationsList=function(){return this.parsePointer32((function(){var e=this.parseUShort(),t=this.parseUShort();return st.argument(1===e&&t<1,"GPOS/GSUB feature variations table unknown."),this.parseRecordList32({conditionSetOffset:Ct.offset32,featureTableSubstitutionOffset:Ct.offset32})}))||[]};var Ot={getByte:Et,getCard8:Et,getUShort:At,getCard16:At,getShort:function(e,t){return e.getInt16(t,!1)},getULong:It,getFixed:Mt,getTag:function(e,t){for(var r="",n=t;n<t+4;n+=1)r+=String.fromCharCode(e.getInt8(n));return r},getOffset:function(e,t,r){for(var n=0,s=0;s<r;s+=1)n<<=8,n+=e.getUint8(t+s);return n},getBytes:function(e,t,r){for(var n=[],s=t;s<r;s+=1)n.push(e.getUint8(s));return n},bytesToString:function(e){for(var t="",r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return t},Parser:Ct};function Nt(e,t,r){e.segments.push({end:t,start:t,delta:-(t-r),offset:0,glyphIndex:r})}var Ut={parse:function(e,t){var r={};r.version=Ot.getUShort(e,t),st.argument(0===r.version,"cmap table version should be 0."),r.numTables=Ot.getUShort(e,t+2);for(var n=-1,s=r.numTables-1;s>=0;s-=1){var a=Ot.getUShort(e,t+4+8*s),o=Ot.getUShort(e,t+4+8*s+2);if(3===a&&(0===o||1===o||10===o)||0===a&&(0===o||1===o||2===o||3===o||4===o)){n=Ot.getULong(e,t+4+8*s+4);break}}if(-1===n)throw new Error("No valid cmap sub-tables found.");var i=new Ot.Parser(e,t+n);if(r.format=i.parseUShort(),12===r.format)!function(e,t){var r;t.parseUShort(),e.length=t.parseULong(),e.language=t.parseULong(),e.groupCount=r=t.parseULong(),e.glyphIndexMap={};for(var n=0;n<r;n+=1)for(var s=t.parseULong(),a=t.parseULong(),o=t.parseULong(),i=s;i<=a;i+=1)e.glyphIndexMap[i]=o,o++}(r,i);else{if(4!==r.format)throw new Error("Only format 4 and 12 cmap tables are supported (found format "+r.format+").");!function(e,t,r,n,s){var a;e.length=t.parseUShort(),e.language=t.parseUShort(),e.segCount=a=t.parseUShort()>>1,t.skip("uShort",3),e.glyphIndexMap={};for(var o=new Ot.Parser(r,n+s+14),i=new Ot.Parser(r,n+s+16+2*a),c=new Ot.Parser(r,n+s+16+4*a),l=new Ot.Parser(r,n+s+16+6*a),u=n+s+16+8*a,h=0;h<a-1;h+=1)for(var p=void 0,d=o.parseUShort(),f=i.parseUShort(),g=c.parseShort(),m=l.parseUShort(),v=f;v<=d;v+=1)0!==m?(u=l.offset+l.relativeOffset-2,u+=m,u+=2*(v-f),0!==(p=Ot.getUShort(r,u))&&(p=p+g&65535)):p=v+g&65535,e.glyphIndexMap[v]=p}(r,i,e,t,n)}return r},make:function(e){var t,r=!0;for(t=e.length-1;t>0;t-=1){if(e.get(t).unicode>65535){console.log("Adding CMAP format 12 (needed!)"),r=!1;break}}var n=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:r?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:r?12:20}];r||(n=n.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),n=n.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var s=new kt.Table("cmap",n);for(s.segments=[],t=0;t<e.length;t+=1){for(var a=e.get(t),o=0;o<a.unicodes.length;o+=1)Nt(s,a.unicodes[o],t);s.segments=s.segments.sort((function(e,t){return e.start-t.start}))}!function(e){e.segments.push({end:65535,start:65535,delta:1,offset:0})}(s);var i=s.segments.length,c=0,l=[],u=[],h=[],p=[],d=[],f=[];for(t=0;t<i;t+=1){var g=s.segments[t];g.end<=65535&&g.start<=65535?(l=l.concat({name:"end_"+t,type:"USHORT",value:g.end}),u=u.concat({name:"start_"+t,type:"USHORT",value:g.start}),h=h.concat({name:"idDelta_"+t,type:"SHORT",value:g.delta}),p=p.concat({name:"idRangeOffset_"+t,type:"USHORT",value:g.offset}),void 0!==g.glyphId&&(d=d.concat({name:"glyph_"+t,type:"USHORT",value:g.glyphId}))):c+=1,r||void 0===g.glyphIndex||(f=(f=(f=f.concat({name:"cmap12Start_"+t,type:"ULONG",value:g.start})).concat({name:"cmap12End_"+t,type:"ULONG",value:g.end})).concat({name:"cmap12Glyph_"+t,type:"ULONG",value:g.glyphIndex}))}if(s.segCountX2=2*(i-c),s.searchRange=2*Math.pow(2,Math.floor(Math.log(i-c)/Math.log(2))),s.entrySelector=Math.log(s.searchRange/2)/Math.log(2),s.rangeShift=s.segCountX2-s.searchRange,s.fields=s.fields.concat(l),s.fields.push({name:"reservedPad",type:"USHORT",value:0}),s.fields=s.fields.concat(u),s.fields=s.fields.concat(h),s.fields=s.fields.concat(p),s.fields=s.fields.concat(d),s.cmap4Length=14+2*l.length+2+2*u.length+2*h.length+2*p.length+2*d.length,!r){var m=16+4*f.length;s.cmap12Offset=20+s.cmap4Length,s.fields=s.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:m},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:f.length/3}]),s.fields=s.fields.concat(f)}return s}},Dt=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],Pt=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],Bt=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],Gt=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function _t(e){this.font=e}function Ht(e){this.cmap=e}function Vt(e,t){this.encoding=e,this.charset=t}function zt(e){switch(e.version){case 1:this.names=Gt.slice();break;case 2:this.names=new Array(e.numberOfGlyphs);for(var t=0;t<e.numberOfGlyphs;t++)e.glyphNameIndex[t]<Gt.length?this.names[t]=Gt[e.glyphNameIndex[t]]:this.names[t]=e.names[e.glyphNameIndex[t]-Gt.length];break;case 2.5:this.names=new Array(e.numberOfGlyphs);for(var r=0;r<e.numberOfGlyphs;r++)this.names[r]=Gt[r+e.glyphNameIndex[r]];break;case 3:default:this.names=[]}}function jt(e,t){t.lowMemory?function(e){e._IndexToUnicodeMap={};for(var t=e.tables.cmap.glyphIndexMap,r=Object.keys(t),n=0;n<r.length;n+=1){var s=r[n],a=t[s];void 0===e._IndexToUnicodeMap[a]?e._IndexToUnicodeMap[a]={unicodes:[parseInt(s)]}:e._IndexToUnicodeMap[a].unicodes.push(parseInt(s))}}(e):function(e){for(var t,r=e.tables.cmap.glyphIndexMap,n=Object.keys(r),s=0;s<n.length;s+=1){var a=n[s],o=r[a];(t=e.glyphs.get(o)).addUnicode(parseInt(a))}for(var i=0;i<e.glyphs.length;i+=1)t=e.glyphs.get(i),e.cffEncoding?e.isCIDFont?t.name="gid"+i:t.name=e.cffEncoding.charset[i]:e.glyphNames.names&&(t.name=e.glyphNames.glyphIndexToName(i))}(e)}_t.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),r=this.font.glyphs;if(r)for(var n=0;n<r.length;n+=1)for(var s=r.get(n),a=0;a<s.unicodes.length;a+=1)if(s.unicodes[a]===t)return n;return null},Ht.prototype.charToGlyphIndex=function(e){return this.cmap.glyphIndexMap[e.codePointAt(0)]||0},Vt.prototype.charToGlyphIndex=function(e){var t=e.codePointAt(0),r=this.encoding[t];return this.charset.indexOf(r)},zt.prototype.nameToGlyphIndex=function(e){return this.names.indexOf(e)},zt.prototype.glyphIndexToName=function(e){return this.names[e]};var Wt={line:function(e,t,r,n,s){e.beginPath(),e.moveTo(t,r),e.lineTo(n,s),e.stroke()}};function Xt(e){this.bindConstructorValues(e)}function qt(e,t,r){Object.defineProperty(e,t,{get:function(){return e.path,e[r]},set:function(t){e[r]=t},enumerable:!0,configurable:!0})}function Yt(e,t){if(this.font=e,this.glyphs={},Array.isArray(t))for(var r=0;r<t.length;r++){var n=t[r];n.path.unitsPerEm=e.unitsPerEm,this.glyphs[r]=n}this.length=t&&t.length||0}Xt.prototype.bindConstructorValues=function(e){var t,r;this.index=e.index||0,this.name=e.name||null,this.unicode=e.unicode||void 0,this.unicodes=e.unicodes||void 0!==e.unicode?[e.unicode]:[],"xMin"in e&&(this.xMin=e.xMin),"yMin"in e&&(this.yMin=e.yMin),"xMax"in e&&(this.xMax=e.xMax),"yMax"in e&&(this.yMax=e.yMax),"advanceWidth"in e&&(this.advanceWidth=e.advanceWidth),Object.defineProperty(this,"path",(t=e.path,r=t||new tt,{configurable:!0,get:function(){return"function"==typeof r&&(r=r()),r},set:function(e){r=e}}))},Xt.prototype.addUnicode=function(e){0===this.unicodes.length&&(this.unicode=e),this.unicodes.push(e)},Xt.prototype.getBoundingBox=function(){return this.path.getBoundingBox()},Xt.prototype.getPath=function(e,t,r,n,s){var a,o;e=void 0!==e?e:0,t=void 0!==t?t:0,r=void 0!==r?r:72,n||(n={});var i=n.xScale,c=n.yScale;if(n.hinting&&s&&s.hinting&&(o=this.path&&s.hinting.exec(this,r)),o)a=s.hinting.getCommands(o),e=Math.round(e),t=Math.round(t),i=c=1;else{a=this.path.commands;var l=1/(this.path.unitsPerEm||1e3)*r;void 0===i&&(i=l),void 0===c&&(c=l)}for(var u=new tt,h=0;h<a.length;h+=1){var p=a[h];"M"===p.type?u.moveTo(e+p.x*i,t+-p.y*c):"L"===p.type?u.lineTo(e+p.x*i,t+-p.y*c):"Q"===p.type?u.quadraticCurveTo(e+p.x1*i,t+-p.y1*c,e+p.x*i,t+-p.y*c):"C"===p.type?u.curveTo(e+p.x1*i,t+-p.y1*c,e+p.x2*i,t+-p.y2*c,e+p.x*i,t+-p.y*c):"Z"===p.type&&u.closePath()}return u},Xt.prototype.getContours=function(){if(void 0===this.points)return[];for(var e=[],t=[],r=0;r<this.points.length;r+=1){var n=this.points[r];t.push(n),n.lastPointOfContour&&(e.push(t),t=[])}return st.argument(0===t.length,"There are still points left in the current contour."),e},Xt.prototype.getMetrics=function(){for(var e=this.path.commands,t=[],r=[],n=0;n<e.length;n+=1){var s=e[n];"Z"!==s.type&&(t.push(s.x),r.push(s.y)),"Q"!==s.type&&"C"!==s.type||(t.push(s.x1),r.push(s.y1)),"C"===s.type&&(t.push(s.x2),r.push(s.y2))}var a={xMin:Math.min.apply(null,t),yMin:Math.min.apply(null,r),xMax:Math.max.apply(null,t),yMax:Math.max.apply(null,r),leftSideBearing:this.leftSideBearing};return isFinite(a.xMin)||(a.xMin=0),isFinite(a.xMax)||(a.xMax=this.advanceWidth),isFinite(a.yMin)||(a.yMin=0),isFinite(a.yMax)||(a.yMax=0),a.rightSideBearing=this.advanceWidth-a.leftSideBearing-(a.xMax-a.xMin),a},Xt.prototype.draw=function(e,t,r,n,s){this.getPath(t,r,n,s).draw(e)},Xt.prototype.drawPoints=function(e,t,r,n){function s(t,r,n,s){e.beginPath();for(var a=0;a<t.length;a+=1)e.moveTo(r+t[a].x*s,n+t[a].y*s),e.arc(r+t[a].x*s,n+t[a].y*s,2,0,2*Math.PI,!1);e.closePath(),e.fill()}t=void 0!==t?t:0,r=void 0!==r?r:0,n=void 0!==n?n:24;for(var a=1/this.path.unitsPerEm*n,o=[],i=[],c=this.path,l=0;l<c.commands.length;l+=1){var u=c.commands[l];void 0!==u.x&&o.push({x:u.x,y:-u.y}),void 0!==u.x1&&i.push({x:u.x1,y:-u.y1}),void 0!==u.x2&&i.push({x:u.x2,y:-u.y2})}e.fillStyle="blue",s(o,t,r,a),e.fillStyle="red",s(i,t,r,a)},Xt.prototype.drawMetrics=function(e,t,r,n){var s;t=void 0!==t?t:0,r=void 0!==r?r:0,n=void 0!==n?n:24,s=1/this.path.unitsPerEm*n,e.lineWidth=1,e.strokeStyle="black",Wt.line(e,t,-1e4,t,1e4),Wt.line(e,-1e4,r,1e4,r);var a=this.xMin||0,o=this.yMin||0,i=this.xMax||0,c=this.yMax||0,l=this.advanceWidth||0;e.strokeStyle="blue",Wt.line(e,t+a*s,-1e4,t+a*s,1e4),Wt.line(e,t+i*s,-1e4,t+i*s,1e4),Wt.line(e,-1e4,r+-o*s,1e4,r+-o*s),Wt.line(e,-1e4,r+-c*s,1e4,r+-c*s),e.strokeStyle="green",Wt.line(e,t+l*s,-1e4,t+l*s,1e4)},Yt.prototype.get=function(e){if(void 0===this.glyphs[e]){this.font._push(e),"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]());var t=this.glyphs[e],r=this.font._IndexToUnicodeMap[e];if(r)for(var n=0;n<r.unicodes.length;n++)t.addUnicode(r.unicodes[n]);this.font.cffEncoding?this.font.isCIDFont?t.name="gid"+e:t.name=this.font.cffEncoding.charset[e]:this.font.glyphNames.names&&(t.name=this.font.glyphNames.glyphIndexToName(e)),this.glyphs[e].advanceWidth=this.font._hmtxTableData[e].advanceWidth,this.glyphs[e].leftSideBearing=this.font._hmtxTableData[e].leftSideBearing}else"function"==typeof this.glyphs[e]&&(this.glyphs[e]=this.glyphs[e]());return this.glyphs[e]},Yt.prototype.push=function(e,t){this.glyphs[e]=t,this.length++};var Kt={GlyphSet:Yt,glyphLoader:function(e,t){return new Xt({index:t,font:e})},ttfGlyphLoader:function(e,t,r,n,s,a){return function(){var o=new Xt({index:t,font:e});return o.path=function(){r(o,n,s);var t=a(e.glyphs,o);return t.unitsPerEm=e.unitsPerEm,t},qt(o,"xMin","_xMin"),qt(o,"xMax","_xMax"),qt(o,"yMin","_yMin"),qt(o,"yMax","_yMax"),o}},cffGlyphLoader:function(e,t,r,n){return function(){var s=new Xt({index:t,font:e});return s.path=function(){var t=r(e,s,n);return t.unitsPerEm=e.unitsPerEm,t},s}}};function Zt(e,t){if(e===t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r+=1)if(!Zt(e[r],t[r]))return!1;return!0}return!1}function Qt(e){return e.length<1240?107:e.length<33900?1131:32768}function $t(e,t,r){var n,s,a=[],o=[],i=Ot.getCard16(e,t);if(0!==i){var c=Ot.getByte(e,t+2);n=t+(i+1)*c+2;for(var l=t+3,u=0;u<i+1;u+=1)a.push(Ot.getOffset(e,l,c)),l+=c;s=n+a[i]}else s=t+2;for(var h=0;h<a.length-1;h+=1){var p=Ot.getBytes(e,n+a[h],n+a[h+1]);r&&(p=r(p)),o.push(p)}return{objects:o,startOffset:t,endOffset:s}}function Jt(e,t){if(28===t)return e.parseByte()<<8|e.parseByte();if(29===t)return e.parseByte()<<24|e.parseByte()<<16|e.parseByte()<<8|e.parseByte();if(30===t)return function(e){for(var t="",r=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var n=e.parseByte(),s=n>>4,a=15&n;if(15===s)break;if(t+=r[s],15===a)break;t+=r[a]}return parseFloat(t)}(e);if(t>=32&&t<=246)return t-139;if(t>=247&&t<=250)return 256*(t-247)+e.parseByte()+108;if(t>=251&&t<=254)return 256*-(t-251)-e.parseByte()-108;throw new Error("Invalid b0 "+t)}function er(e,t,r){t=void 0!==t?t:0;var n=new Ot.Parser(e,t),s=[],a=[];for(r=void 0!==r?r:e.length;n.relativeOffset<r;){var o=n.parseByte();o<=21?(12===o&&(o=1200+n.parseByte()),s.push([o,a]),a=[]):a.push(Jt(n,o))}return function(e){for(var t={},r=0;r<e.length;r+=1){var n=e[r][0],s=e[r][1],a=void 0;if(a=1===s.length?s[0]:s,t.hasOwnProperty(n)&&!isNaN(t[n]))throw new Error("Object "+t+" already has key "+n);t[n]=a}return t}(s)}function tr(e,t){return t=t<=390?Dt[t]:e[t-391]}function rr(e,t,r){for(var n,s={},a=0;a<t.length;a+=1){var o=t[a];if(Array.isArray(o.type)){var i=[];i.length=o.type.length;for(var c=0;c<o.type.length;c++)void 0===(n=void 0!==e[o.op]?e[o.op][c]:void 0)&&(n=void 0!==o.value&&void 0!==o.value[c]?o.value[c]:null),"SID"===o.type[c]&&(n=tr(r,n)),i[c]=n;s[o.name]=i}else void 0===(n=e[o.op])&&(n=void 0!==o.value?o.value:null),"SID"===o.type&&(n=tr(r,n)),s[o.name]=n}return s}var nr=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],sr=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function ar(e,t){return rr(er(e,0,e.byteLength),nr,t)}function or(e,t,r,n){return rr(er(e,t,r),sr,n)}function ir(e,t,r,n){for(var s=[],a=0;a<r.length;a+=1){var o=ar(new DataView(new Uint8Array(r[a]).buffer),n);o._subrs=[],o._subrsBias=0;var i=o.private[0],c=o.private[1];if(0!==i&&0!==c){var l=or(e,c+t,i,n);if(o._defaultWidthX=l.defaultWidthX,o._nominalWidthX=l.nominalWidthX,0!==l.subrs){var u=$t(e,c+l.subrs+t);o._subrs=u.objects,o._subrsBias=Qt(o._subrs)}o._privateDict=l}s.push(o)}return s}function cr(e,t,r){var n,s,a,o,i,c,l,u,h=new tt,p=[],d=0,f=!1,g=!1,m=0,v=0;if(e.isCIDFont){var y=e.tables.cff.topDict._fdSelect[t.index],b=e.tables.cff.topDict._fdArray[y];i=b._subrs,c=b._subrsBias,l=b._defaultWidthX,u=b._nominalWidthX}else i=e.tables.cff.topDict._subrs,c=e.tables.cff.topDict._subrsBias,l=e.tables.cff.topDict._defaultWidthX,u=e.tables.cff.topDict._nominalWidthX;var x=l;function w(e,t){g&&h.closePath(),h.moveTo(e,t),g=!0}function S(){p.length%2!=0&&!f&&(x=p.shift()+u),d+=p.length>>1,p.length=0,f=!0}return function r(l){for(var y,b,T,F,k,E,A,I,M,L,C,R,O=0;O<l.length;){var N=l[O];switch(O+=1,N){case 1:case 3:S();break;case 4:p.length>1&&!f&&(x=p.shift()+u,f=!0),v+=p.pop(),w(m,v);break;case 5:for(;p.length>0;)m+=p.shift(),v+=p.shift(),h.lineTo(m,v);break;case 6:for(;p.length>0&&(m+=p.shift(),h.lineTo(m,v),0!==p.length);)v+=p.shift(),h.lineTo(m,v);break;case 7:for(;p.length>0&&(v+=p.shift(),h.lineTo(m,v),0!==p.length);)m+=p.shift(),h.lineTo(m,v);break;case 8:for(;p.length>0;)n=m+p.shift(),s=v+p.shift(),a=n+p.shift(),o=s+p.shift(),m=a+p.shift(),v=o+p.shift(),h.curveTo(n,s,a,o,m,v);break;case 10:k=p.pop()+c,(E=i[k])&&r(E);break;case 11:return;case 12:switch(N=l[O],O+=1,N){case 35:n=m+p.shift(),s=v+p.shift(),a=n+p.shift(),o=s+p.shift(),A=a+p.shift(),I=o+p.shift(),M=A+p.shift(),L=I+p.shift(),C=M+p.shift(),R=L+p.shift(),m=C+p.shift(),v=R+p.shift(),p.shift(),h.curveTo(n,s,a,o,A,I),h.curveTo(M,L,C,R,m,v);break;case 34:n=m+p.shift(),s=v,a=n+p.shift(),o=s+p.shift(),A=a+p.shift(),I=o,M=A+p.shift(),L=o,C=M+p.shift(),R=v,m=C+p.shift(),h.curveTo(n,s,a,o,A,I),h.curveTo(M,L,C,R,m,v);break;case 36:n=m+p.shift(),s=v+p.shift(),a=n+p.shift(),o=s+p.shift(),A=a+p.shift(),I=o,M=A+p.shift(),L=o,C=M+p.shift(),R=L+p.shift(),m=C+p.shift(),h.curveTo(n,s,a,o,A,I),h.curveTo(M,L,C,R,m,v);break;case 37:n=m+p.shift(),s=v+p.shift(),a=n+p.shift(),o=s+p.shift(),A=a+p.shift(),I=o+p.shift(),M=A+p.shift(),L=I+p.shift(),C=M+p.shift(),R=L+p.shift(),Math.abs(C-m)>Math.abs(R-v)?m=C+p.shift():v=R+p.shift(),h.curveTo(n,s,a,o,A,I),h.curveTo(M,L,C,R,m,v);break;default:console.log("Glyph "+t.index+": unknown operator 1200"+N),p.length=0}break;case 14:p.length>0&&!f&&(x=p.shift()+u,f=!0),g&&(h.closePath(),g=!1);break;case 18:S();break;case 19:case 20:S(),O+=d+7>>3;break;case 21:p.length>2&&!f&&(x=p.shift()+u,f=!0),v+=p.pop(),w(m+=p.pop(),v);break;case 22:p.length>1&&!f&&(x=p.shift()+u,f=!0),w(m+=p.pop(),v);break;case 23:S();break;case 24:for(;p.length>2;)n=m+p.shift(),s=v+p.shift(),a=n+p.shift(),o=s+p.shift(),m=a+p.shift(),v=o+p.shift(),h.curveTo(n,s,a,o,m,v);m+=p.shift(),v+=p.shift(),h.lineTo(m,v);break;case 25:for(;p.length>6;)m+=p.shift(),v+=p.shift(),h.lineTo(m,v);n=m+p.shift(),s=v+p.shift(),a=n+p.shift(),o=s+p.shift(),m=a+p.shift(),v=o+p.shift(),h.curveTo(n,s,a,o,m,v);break;case 26:for(p.length%2&&(m+=p.shift());p.length>0;)n=m,s=v+p.shift(),a=n+p.shift(),o=s+p.shift(),m=a,v=o+p.shift(),h.curveTo(n,s,a,o,m,v);break;case 27:for(p.length%2&&(v+=p.shift());p.length>0;)n=m+p.shift(),s=v,a=n+p.shift(),o=s+p.shift(),m=a+p.shift(),v=o,h.curveTo(n,s,a,o,m,v);break;case 28:y=l[O],b=l[O+1],p.push((y<<24|b<<16)>>16),O+=2;break;case 29:k=p.pop()+e.gsubrsBias,(E=e.gsubrs[k])&&r(E);break;case 30:for(;p.length>0&&(n=m,s=v+p.shift(),a=n+p.shift(),o=s+p.shift(),m=a+p.shift(),v=o+(1===p.length?p.shift():0),h.curveTo(n,s,a,o,m,v),0!==p.length);)n=m+p.shift(),s=v,a=n+p.shift(),o=s+p.shift(),v=o+p.shift(),m=a+(1===p.length?p.shift():0),h.curveTo(n,s,a,o,m,v);break;case 31:for(;p.length>0&&(n=m+p.shift(),s=v,a=n+p.shift(),o=s+p.shift(),v=o+p.shift(),m=a+(1===p.length?p.shift():0),h.curveTo(n,s,a,o,m,v),0!==p.length);)n=m,s=v+p.shift(),a=n+p.shift(),o=s+p.shift(),m=a+p.shift(),v=o+(1===p.length?p.shift():0),h.curveTo(n,s,a,o,m,v);break;default:N<32?console.log("Glyph "+t.index+": unknown operator "+N):N<247?p.push(N-139):N<251?(y=l[O],O+=1,p.push(256*(N-247)+y+108)):N<255?(y=l[O],O+=1,p.push(256*-(N-251)-y-108)):(y=l[O],b=l[O+1],T=l[O+2],F=l[O+3],O+=4,p.push((y<<24|b<<16|T<<8|F)/65536))}}}(r),t.advanceWidth=x,h}function lr(e,t){var r,n=Dt.indexOf(e);return n>=0&&(r=n),(n=t.indexOf(e))>=0?r=n+Dt.length:(r=Dt.length+t.length,t.push(e)),r}function ur(e,t,r){for(var n={},s=0;s<e.length;s+=1){var a=e[s],o=t[a.name];void 0===o||Zt(o,a.value)||("SID"===a.type&&(o=lr(o,r)),n[a.op]={name:a.name,type:a.type,value:o})}return n}function hr(e,t){var r=new kt.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=ur(nr,e,t),r}function pr(e){var t=new kt.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return t.topDicts=[{name:"topDict_0",type:"TABLE",value:e}],t}function dr(e){var t=[],r=e.path;t.push({name:"width",type:"NUMBER",value:e.advanceWidth});for(var n=0,s=0,a=0;a<r.commands.length;a+=1){var o=void 0,i=void 0,c=r.commands[a];if("Q"===c.type){var l=1/3,u=2/3;c={type:"C",x:c.x,y:c.y,x1:l*n+u*c.x1,y1:l*s+u*c.y1,x2:l*c.x+u*c.x1,y2:l*c.y+u*c.y1}}if("M"===c.type)o=Math.round(c.x-n),i=Math.round(c.y-s),t.push({name:"dx",type:"NUMBER",value:o}),t.push({name:"dy",type:"NUMBER",value:i}),t.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(c.x),s=Math.round(c.y);else if("L"===c.type)o=Math.round(c.x-n),i=Math.round(c.y-s),t.push({name:"dx",type:"NUMBER",value:o}),t.push({name:"dy",type:"NUMBER",value:i}),t.push({name:"rlineto",type:"OP",value:5}),n=Math.round(c.x),s=Math.round(c.y);else if("C"===c.type){var h=Math.round(c.x1-n),p=Math.round(c.y1-s),d=Math.round(c.x2-c.x1),f=Math.round(c.y2-c.y1);o=Math.round(c.x-c.x2),i=Math.round(c.y-c.y2),t.push({name:"dx1",type:"NUMBER",value:h}),t.push({name:"dy1",type:"NUMBER",value:p}),t.push({name:"dx2",type:"NUMBER",value:d}),t.push({name:"dy2",type:"NUMBER",value:f}),t.push({name:"dx",type:"NUMBER",value:o}),t.push({name:"dy",type:"NUMBER",value:i}),t.push({name:"rrcurveto",type:"OP",value:8}),n=Math.round(c.x),s=Math.round(c.y)}}return t.push({name:"endchar",type:"OP",value:14}),t}var fr={parse:function(e,t,r,n){r.tables.cff={};var s=function(e,t){var r={};return r.formatMajor=Ot.getCard8(e,t),r.formatMinor=Ot.getCard8(e,t+1),r.size=Ot.getCard8(e,t+2),r.offsetSize=Ot.getCard8(e,t+3),r.startOffset=t,r.endOffset=t+4,r}(e,t),a=$t(e,s.endOffset,Ot.bytesToString),o=$t(e,a.endOffset),i=$t(e,o.endOffset,Ot.bytesToString),c=$t(e,i.endOffset);r.gsubrs=c.objects,r.gsubrsBias=Qt(r.gsubrs);var l=ir(e,t,o.objects,i.objects);if(1!==l.length)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+l.length);var u=l[0];if(r.tables.cff.topDict=u,u._privateDict&&(r.defaultWidthX=u._privateDict.defaultWidthX,r.nominalWidthX=u._privateDict.nominalWidthX),void 0!==u.ros[0]&&void 0!==u.ros[1]&&(r.isCIDFont=!0),r.isCIDFont){var h=u.fdArray,p=u.fdSelect;if(0===h||0===p)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");var d=$t(e,h+=t),f=ir(e,t,d.objects,i.objects);u._fdArray=f,p+=t,u._fdSelect=function(e,t,r,n){var s,a=[],o=new Ot.Parser(e,t),i=o.parseCard8();if(0===i)for(var c=0;c<r;c++){if((s=o.parseCard8())>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+s+" (FD count "+n+")");a.push(s)}else{if(3!==i)throw new Error("CFF Table CID Font FDSelect table has unsupported format "+i);var l,u=o.parseCard16(),h=o.parseCard16();if(0!==h)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+h);for(var p=0;p<u;p++){if(s=o.parseCard8(),l=o.parseCard16(),s>=n)throw new Error("CFF table CID Font FDSelect has bad FD index value "+s+" (FD count "+n+")");if(l>r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+l);for(;h<l;h++)a.push(s);h=l}if(l!==r)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+l)}return a}(e,p,r.numGlyphs,f.length)}var g,m=t+u.private[1],v=or(e,m,u.private[0],i.objects);if(r.defaultWidthX=v.defaultWidthX,r.nominalWidthX=v.nominalWidthX,0!==v.subrs){var y=m+v.subrs,b=$t(e,y);r.subrs=b.objects,r.subrsBias=Qt(r.subrs)}else r.subrs=[],r.subrsBias=0;n.lowMemory?(g=function(e,t){var r,n,s=[],a=Ot.getCard16(e,t);if(0!==a){var o=Ot.getByte(e,t+2);r=t+(a+1)*o+2;for(var i=t+3,c=0;c<a+1;c+=1)s.push(Ot.getOffset(e,i,o)),i+=o;n=r+s[a]}else n=t+2;return{offsets:s,startOffset:t,endOffset:n}}(e,t+u.charStrings),r.nGlyphs=g.offsets.length):(g=$t(e,t+u.charStrings),r.nGlyphs=g.objects.length);var x=function(e,t,r,n){var s,a,o=new Ot.Parser(e,t);r-=1;var i=[".notdef"],c=o.parseCard8();if(0===c)for(var l=0;l<r;l+=1)s=o.parseSID(),i.push(tr(n,s));else if(1===c)for(;i.length<=r;){s=o.parseSID(),a=o.parseCard8();for(var u=0;u<=a;u+=1)i.push(tr(n,s)),s+=1}else{if(2!==c)throw new Error("Unknown charset format "+c);for(;i.length<=r;){s=o.parseSID(),a=o.parseCard16();for(var h=0;h<=a;h+=1)i.push(tr(n,s)),s+=1}}return i}(e,t+u.charset,r.nGlyphs,i.objects);if(0===u.encoding?r.cffEncoding=new Vt(Pt,x):1===u.encoding?r.cffEncoding=new Vt(Bt,x):r.cffEncoding=function(e,t,r){var n,s={},a=new Ot.Parser(e,t),o=a.parseCard8();if(0===o)for(var i=a.parseCard8(),c=0;c<i;c+=1)s[n=a.parseCard8()]=c;else{if(1!==o)throw new Error("Unknown encoding format "+o);var l=a.parseCard8();n=1;for(var u=0;u<l;u+=1)for(var h=a.parseCard8(),p=a.parseCard8(),d=h;d<=h+p;d+=1)s[d]=n,n+=1}return new Vt(s,r)}(e,t+u.encoding,x),r.encoding=r.encoding||r.cffEncoding,r.glyphs=new Kt.GlyphSet(r),n.lowMemory)r._push=function(n){var s=function(e,t,r,n,s){var a=Ot.getCard16(r,n),o=0;0!==a&&(o=n+(a+1)*Ot.getByte(r,n+2)+2);var i=Ot.getBytes(r,o+t[e],o+t[e+1]);return s&&(i=s(i)),i}(n,g.offsets,e,t+u.charStrings);r.glyphs.push(n,Kt.cffGlyphLoader(r,n,cr,s))};else for(var w=0;w<r.nGlyphs;w+=1){var S=g.objects[w];r.glyphs.push(w,Kt.cffGlyphLoader(r,w,cr,S))}},make:function(e,t){for(var r,n=new kt.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),s=1/t.unitsPerEm,a={version:t.version,fullName:t.fullName,familyName:t.familyName,weight:t.weightName,fontBBox:t.fontBBox||[0,0,0,0],fontMatrix:[s,0,0,s,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},o=[],i=1;i<e.length;i+=1)r=e.get(i),o.push(r.name);var c=[];n.header=new kt.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}]),n.nameIndex=function(e){var t=new kt.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);t.names=[];for(var r=0;r<e.length;r+=1)t.names.push({name:"name_"+r,type:"NAME",value:e[r]});return t}([t.postScriptName]);var l=hr(a,c);n.topDictIndex=pr(l),n.globalSubrIndex=new kt.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}]),n.charsets=function(e,t){for(var r=new kt.Record("Charsets",[{name:"format",type:"Card8",value:0}]),n=0;n<e.length;n+=1){var s=lr(e[n],t);r.fields.push({name:"glyph_"+n,type:"SID",value:s})}return r}(o,c),n.charStringsIndex=function(e){for(var t=new kt.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),r=0;r<e.length;r+=1){var n=e.get(r),s=dr(n);t.charStrings.push({name:n.name,type:"CHARSTRING",value:s})}return t}(e),n.privateDict=function(e,t){var r=new kt.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return r.dict=ur(sr,e,t),r}({},c),n.stringIndex=function(e){var t=new kt.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);t.strings=[];for(var r=0;r<e.length;r+=1)t.strings.push({name:"string_"+r,type:"STRING",value:e[r]});return t}(c);var u=n.header.sizeOf()+n.nameIndex.sizeOf()+n.topDictIndex.sizeOf()+n.stringIndex.sizeOf()+n.globalSubrIndex.sizeOf();return a.charset=u,a.encoding=0,a.charStrings=a.charset+n.charsets.sizeOf(),a.private[1]=a.charStrings+n.charStringsIndex.sizeOf(),l=hr(a,c),n.topDictIndex=pr(l),n}};var gr={parse:function(e,t){var r={},n=new Ot.Parser(e,t);return r.version=n.parseVersion(),r.fontRevision=Math.round(1e3*n.parseFixed())/1e3,r.checkSumAdjustment=n.parseULong(),r.magicNumber=n.parseULong(),st.argument(1594834165===r.magicNumber,"Font header has wrong magic number."),r.flags=n.parseUShort(),r.unitsPerEm=n.parseUShort(),r.created=n.parseLongDateTime(),r.modified=n.parseLongDateTime(),r.xMin=n.parseShort(),r.yMin=n.parseShort(),r.xMax=n.parseShort(),r.yMax=n.parseShort(),r.macStyle=n.parseUShort(),r.lowestRecPPEM=n.parseUShort(),r.fontDirectionHint=n.parseShort(),r.indexToLocFormat=n.parseShort(),r.glyphDataFormat=n.parseShort(),r},make:function(e){var t=Math.round((new Date).getTime()/1e3)+2082844800,r=t;return e.createdTimestamp&&(r=e.createdTimestamp+2082844800),new kt.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:r},{name:"modified",type:"LONGDATETIME",value:t},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],e)}};var mr={parse:function(e,t){var r={},n=new Ot.Parser(e,t);return r.version=n.parseVersion(),r.ascender=n.parseShort(),r.descender=n.parseShort(),r.lineGap=n.parseShort(),r.advanceWidthMax=n.parseUShort(),r.minLeftSideBearing=n.parseShort(),r.minRightSideBearing=n.parseShort(),r.xMaxExtent=n.parseShort(),r.caretSlopeRise=n.parseShort(),r.caretSlopeRun=n.parseShort(),r.caretOffset=n.parseShort(),n.relativeOffset+=8,r.metricDataFormat=n.parseShort(),r.numberOfHMetrics=n.parseUShort(),r},make:function(e){return new kt.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],e)}};var vr={parse:function(e,t,r,n,s,a,o){o.lowMemory?function(e,t,r,n,s){var a,o;e._hmtxTableData={};for(var i=new Ot.Parser(t,r),c=0;c<s;c+=1)c<n&&(a=i.parseUShort(),o=i.parseShort()),e._hmtxTableData[c]={advanceWidth:a,leftSideBearing:o}}(e,t,r,n,s):function(e,t,r,n,s){for(var a,o,i=new Ot.Parser(e,t),c=0;c<n;c+=1){c<r&&(a=i.parseUShort(),o=i.parseShort());var l=s.get(c);l.advanceWidth=a,l.leftSideBearing=o}}(t,r,n,s,a)},make:function(e){for(var t=new kt.Table("hmtx",[]),r=0;r<e.length;r+=1){var n=e.get(r),s=n.advanceWidth||0,a=n.leftSideBearing||0;t.fields.push({name:"advanceWidth_"+r,type:"USHORT",value:s}),t.fields.push({name:"leftSideBearing_"+r,type:"SHORT",value:a})}return t}};var yr={make:function(e){for(var t=new kt.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:e.length}]),r="",n=12+4*e.length,s=0;s<e.length;++s){var a=r.indexOf(e[s]);a<0&&(a=r.length,r+=e[s]),t.fields.push({name:"offset "+s,type:"USHORT",value:n+a}),t.fields.push({name:"length "+s,type:"USHORT",value:e[s].length})}return t.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),t},parse:function(e,t){var r=new Ot.Parser(e,t),n=r.parseULong();st.argument(1===n,"Unsupported ltag table version."),r.skip("uLong",1);for(var s=r.parseULong(),a=[],o=0;o<s;o++){for(var i="",c=t+r.parseUShort(),l=r.parseUShort(),u=c;u<c+l;++u)i+=String.fromCharCode(e.getInt8(u));a.push(i)}return a}};var br={parse:function(e,t){var r={},n=new Ot.Parser(e,t);return r.version=n.parseVersion(),r.numGlyphs=n.parseUShort(),1===r.version&&(r.maxPoints=n.parseUShort(),r.maxContours=n.parseUShort(),r.maxCompositePoints=n.parseUShort(),r.maxCompositeContours=n.parseUShort(),r.maxZones=n.parseUShort(),r.maxTwilightPoints=n.parseUShort(),r.maxStorage=n.parseUShort(),r.maxFunctionDefs=n.parseUShort(),r.maxInstructionDefs=n.parseUShort(),r.maxStackElements=n.parseUShort(),r.maxSizeOfInstructions=n.parseUShort(),r.maxComponentElements=n.parseUShort(),r.maxComponentDepth=n.parseUShort()),r},make:function(e){return new kt.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:e}])}},xr=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],wr={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},Sr={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},Tr={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function Fr(e,t,r){switch(e){case 0:if(65535===t)return"und";if(r)return r[t];break;case 1:return wr[t];case 3:return Tr[t]}}var kr={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},Er={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function Ar(e,t,r){switch(e){case 0:return"utf-16";case 1:return Er[r]||kr[t];case 3:if(1===t||10===t)return"utf-16"}}function Ir(e){var t={};for(var r in e)t[e[r]]=parseInt(r);return t}function Mr(e,t,r,n,s,a){return new kt.Record("NameRecord",[{name:"platformID",type:"USHORT",value:e},{name:"encodingID",type:"USHORT",value:t},{name:"languageID",type:"USHORT",value:r},{name:"nameID",type:"USHORT",value:n},{name:"length",type:"USHORT",value:s},{name:"offset",type:"USHORT",value:a}])}function Lr(e,t){var r=function(e,t){var r=e.length,n=t.length-r+1;e:for(var s=0;s<n;s++)for(;s<n;s++){for(var a=0;a<r;a++)if(t[s+a]!==e[a])continue e;return s}return-1}(e,t);if(r<0){r=t.length;for(var n=0,s=e.length;n<s;++n)t.push(e[n])}return r}var Cr={parse:function(e,t,r){for(var n={},s=new Ot.Parser(e,t),a=s.parseUShort(),o=s.parseUShort(),i=s.offset+s.parseUShort(),c=0;c<o;c++){var l=s.parseUShort(),u=s.parseUShort(),h=s.parseUShort(),p=s.parseUShort(),d=xr[p]||p,f=s.parseUShort(),g=s.parseUShort(),m=Fr(l,h,r),v=Ar(l,u,h);if(void 0!==v&&void 0!==m){var y=void 0;if(y="utf-16"===v?at.UTF16(e,i+g,f):at.MACSTRING(e,i+g,f,v)){var b=n[d];void 0===b&&(b=n[d]={}),b[m]=y}}}return 1===a&&s.parseUShort(),n},make:function(e,t){var r,n=[],s={},a=Ir(xr);for(var o in e){var i=a[o];if(void 0===i&&(i=o),r=parseInt(i),isNaN(r))throw new Error('Name table entry "'+o+'" does not exist, see nameTableNames for complete list.');s[r]=e[o],n.push(r)}for(var c=Ir(wr),l=Ir(Tr),u=[],h=[],p=0;p<n.length;p++){var d=s[r=n[p]];for(var f in d){var g=d[f],m=1,v=c[f],y=Sr[v],b=Ar(m,y,v),x=ot.MACSTRING(g,b);void 0===x&&(m=0,(v=t.indexOf(f))<0&&(v=t.length,t.push(f)),y=4,x=ot.UTF16(g));var w=Lr(x,h);u.push(Mr(m,y,v,r,x.length,w));var S=l[f];if(void 0!==S){var T=ot.UTF16(g),F=Lr(T,h);u.push(Mr(3,1,S,r,T.length,F))}}}u.sort((function(e,t){return e.platformID-t.platformID||e.encodingID-t.encodingID||e.languageID-t.languageID||e.nameID-t.nameID}));for(var k=new kt.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:u.length},{name:"stringOffset",type:"USHORT",value:6+12*u.length}]),E=0;E<u.length;E++)k.fields.push({name:"record_"+E,type:"RECORD",value:u[E]});return k.fields.push({name:"strings",type:"LITERAL",value:h}),k}},Rr=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];var Or={parse:function(e,t){var r={},n=new Ot.Parser(e,t);r.version=n.parseUShort(),r.xAvgCharWidth=n.parseShort(),r.usWeightClass=n.parseUShort(),r.usWidthClass=n.parseUShort(),r.fsType=n.parseUShort(),r.ySubscriptXSize=n.parseShort(),r.ySubscriptYSize=n.parseShort(),r.ySubscriptXOffset=n.parseShort(),r.ySubscriptYOffset=n.parseShort(),r.ySuperscriptXSize=n.parseShort(),r.ySuperscriptYSize=n.parseShort(),r.ySuperscriptXOffset=n.parseShort(),r.ySuperscriptYOffset=n.parseShort(),r.yStrikeoutSize=n.parseShort(),r.yStrikeoutPosition=n.parseShort(),r.sFamilyClass=n.parseShort(),r.panose=[];for(var s=0;s<10;s++)r.panose[s]=n.parseByte();return r.ulUnicodeRange1=n.parseULong(),r.ulUnicodeRange2=n.parseULong(),r.ulUnicodeRange3=n.parseULong(),r.ulUnicodeRange4=n.parseULong(),r.achVendID=String.fromCharCode(n.parseByte(),n.parseByte(),n.parseByte(),n.parseByte()),r.fsSelection=n.parseUShort(),r.usFirstCharIndex=n.parseUShort(),r.usLastCharIndex=n.parseUShort(),r.sTypoAscender=n.parseShort(),r.sTypoDescender=n.parseShort(),r.sTypoLineGap=n.parseShort(),r.usWinAscent=n.parseUShort(),r.usWinDescent=n.parseUShort(),r.version>=1&&(r.ulCodePageRange1=n.parseULong(),r.ulCodePageRange2=n.parseULong()),r.version>=2&&(r.sxHeight=n.parseShort(),r.sCapHeight=n.parseShort(),r.usDefaultChar=n.parseUShort(),r.usBreakChar=n.parseUShort(),r.usMaxContent=n.parseUShort()),r},make:function(e){return new kt.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],e)},unicodeRanges:Rr,getUnicodeRange:function(e){for(var t=0;t<Rr.length;t+=1){var r=Rr[t];if(e>=r.begin&&e<r.end)return t}return-1}};var Nr={parse:function(e,t){var r={},n=new Ot.Parser(e,t);switch(r.version=n.parseVersion(),r.italicAngle=n.parseFixed(),r.underlinePosition=n.parseShort(),r.underlineThickness=n.parseShort(),r.isFixedPitch=n.parseULong(),r.minMemType42=n.parseULong(),r.maxMemType42=n.parseULong(),r.minMemType1=n.parseULong(),r.maxMemType1=n.parseULong(),r.version){case 1:r.names=Gt.slice();break;case 2:r.numberOfGlyphs=n.parseUShort(),r.glyphNameIndex=new Array(r.numberOfGlyphs);for(var s=0;s<r.numberOfGlyphs;s++)r.glyphNameIndex[s]=n.parseUShort();r.names=[];for(var a=0;a<r.numberOfGlyphs;a++)if(r.glyphNameIndex[a]>=Gt.length){var o=n.parseChar();r.names.push(n.parseString(o))}break;case 2.5:r.numberOfGlyphs=n.parseUShort(),r.offset=new Array(r.numberOfGlyphs);for(var i=0;i<r.numberOfGlyphs;i++)r.offset[i]=n.parseChar()}return r},make:function(){return new kt.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}},Ur=new Array(9);Ur[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(Ct.coverage),deltaGlyphId:this.parseUShort()}:2===t?{substFormat:2,coverage:this.parsePointer(Ct.coverage),substitute:this.parseOffset16List()}:void st.assert(!1,"0x"+e.toString(16)+": lookup type 1 format must be 1 or 2.")},Ur[2]=function(){var e=this.parseUShort();return st.argument(1===e,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Ct.coverage),sequences:this.parseListOfLists()}},Ur[3]=function(){var e=this.parseUShort();return st.argument(1===e,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Ct.coverage),alternateSets:this.parseListOfLists()}},Ur[4]=function(){var e=this.parseUShort();return st.argument(1===e,"GSUB ligature table identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Ct.coverage),ligatureSets:this.parseListOfLists((function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}}))}};var Dr={sequenceIndex:Ct.uShort,lookupListIndex:Ct.uShort};Ur[5]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();if(1===t)return{substFormat:t,coverage:this.parsePointer(Ct.coverage),ruleSets:this.parseListOfLists((function(){var e=this.parseUShort(),t=this.parseUShort();return{input:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,Dr)}}))};if(2===t)return{substFormat:t,coverage:this.parsePointer(Ct.coverage),classDef:this.parsePointer(Ct.classDef),classSets:this.parseListOfLists((function(){var e=this.parseUShort(),t=this.parseUShort();return{classes:this.parseUShortList(e-1),lookupRecords:this.parseRecordList(t,Dr)}}))};if(3===t){var r=this.parseUShort(),n=this.parseUShort();return{substFormat:t,coverages:this.parseList(r,Ct.pointer(Ct.coverage)),lookupRecords:this.parseRecordList(n,Dr)}}st.assert(!1,"0x"+e.toString(16)+": lookup type 5 format must be 1, 2 or 3.")},Ur[6]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{substFormat:1,coverage:this.parsePointer(Ct.coverage),chainRuleSets:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Dr)}}))}:2===t?{substFormat:2,coverage:this.parsePointer(Ct.coverage),backtrackClassDef:this.parsePointer(Ct.classDef),inputClassDef:this.parsePointer(Ct.classDef),lookaheadClassDef:this.parsePointer(Ct.classDef),chainClassSet:this.parseListOfLists((function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(Dr)}}))}:3===t?{substFormat:3,backtrackCoverage:this.parseList(Ct.pointer(Ct.coverage)),inputCoverage:this.parseList(Ct.pointer(Ct.coverage)),lookaheadCoverage:this.parseList(Ct.pointer(Ct.coverage)),lookupRecords:this.parseRecordList(Dr)}:void st.assert(!1,"0x"+e.toString(16)+": lookup type 6 format must be 1, 2 or 3.")},Ur[7]=function(){var e=this.parseUShort();st.argument(1===e,"GSUB Extension Substitution subtable identifier-format must be 1");var t=this.parseUShort(),r=new Ct(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:t,extension:Ur[t].call(r)}},Ur[8]=function(){var e=this.parseUShort();return st.argument(1===e,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:e,coverage:this.parsePointer(Ct.coverage),backtrackCoverage:this.parseList(Ct.pointer(Ct.coverage)),lookaheadCoverage:this.parseList(Ct.pointer(Ct.coverage)),substitutes:this.parseUShortList()}};var Pr=new Array(9);Pr[1]=function(e){return 1===e.substFormat?new kt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new kt.Coverage(e.coverage)},{name:"deltaGlyphID",type:"USHORT",value:e.deltaGlyphId}]):new kt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new kt.Coverage(e.coverage)}].concat(kt.ushortList("substitute",e.substitute)))},Pr[3]=function(e){return st.assert(1===e.substFormat,"Lookup type 3 substFormat must be 1."),new kt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new kt.Coverage(e.coverage)}].concat(kt.tableList("altSet",e.alternateSets,(function(e){return new kt.Table("alternateSetTable",kt.ushortList("alternate",e))}))))},Pr[4]=function(e){return st.assert(1===e.substFormat,"Lookup type 4 substFormat must be 1."),new kt.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new kt.Coverage(e.coverage)}].concat(kt.tableList("ligSet",e.ligatureSets,(function(e){return new kt.Table("ligatureSetTable",kt.tableList("ligature",e,(function(e){return new kt.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:e.ligGlyph}].concat(kt.ushortList("component",e.components,e.components.length+1)))})))}))))};var Br={parse:function(e,t){var r=new Ct(e,t=t||0),n=r.parseVersion(1);return st.argument(1===n||1.1===n,"Unsupported GSUB table version."),1===n?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Ur)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Ur),variations:r.parseFeatureVariationsList()}},make:function(e){return new kt.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new kt.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new kt.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new kt.LookupList(e.lookups,Pr)}])}};var Gr={parse:function(e,t){var r=new Ot.Parser(e,t),n=r.parseULong();st.argument(1===n,"Unsupported META table version."),r.parseULong(),r.parseULong();for(var s=r.parseULong(),a={},o=0;o<s;o++){var i=r.parseTag(),c=r.parseULong(),l=r.parseULong(),u=at.UTF8(e,t+c,l);a[i]=u}return a},make:function(e){var t=Object.keys(e).length,r="",n=16+12*t,s=new kt.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:n},{name:"numTags",type:"ULONG",value:t}]);for(var a in e){var o=r.length;r+=e[a],s.fields.push({name:"tag "+a,type:"TAG",value:a}),s.fields.push({name:"offset "+a,type:"ULONG",value:n+o}),s.fields.push({name:"length "+a,type:"ULONG",value:e[a].length})}return s.fields.push({name:"stringPool",type:"CHARARRAY",value:r}),s}};function _r(e){return Math.log(e)/Math.log(2)|0}function Hr(e){for(;e.length%4!=0;)e.push(0);for(var t=0,r=0;r<e.length;r+=4)t+=(e[r]<<24)+(e[r+1]<<16)+(e[r+2]<<8)+e[r+3];return t%=Math.pow(2,32)}function Vr(e,t,r,n){return new kt.Record("Table Record",[{name:"tag",type:"TAG",value:void 0!==e?e:""},{name:"checkSum",type:"ULONG",value:void 0!==t?t:0},{name:"offset",type:"ULONG",value:void 0!==r?r:0},{name:"length",type:"ULONG",value:void 0!==n?n:0}])}function zr(e){var t=new kt.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);t.tables=e,t.numTables=e.length;var r=Math.pow(2,_r(t.numTables));t.searchRange=16*r,t.entrySelector=_r(r),t.rangeShift=16*t.numTables-t.searchRange;for(var n=[],s=[],a=t.sizeOf()+Vr().sizeOf()*t.numTables;a%4!=0;)a+=1,s.push({name:"padding",type:"BYTE",value:0});for(var o=0;o<e.length;o+=1){var i=e[o];st.argument(4===i.tableName.length,"Table name"+i.tableName+" is invalid.");var c=i.sizeOf(),l=Vr(i.tableName,Hr(i.encode()),a,c);for(n.push({name:l.tag+" Table Record",type:"RECORD",value:l}),s.push({name:i.tableName+" table",type:"RECORD",value:i}),a+=c,st.argument(!isNaN(a),"Something went wrong calculating the offset.");a%4!=0;)a+=1,s.push({name:"padding",type:"BYTE",value:0})}return n.sort((function(e,t){return e.value.tag>t.value.tag?1:-1})),t.fields=t.fields.concat(n),t.fields=t.fields.concat(s),t}function jr(e,t,r){for(var n=0;n<t.length;n+=1){var s=e.charToGlyphIndex(t[n]);if(s>0)return e.glyphs.get(s).getMetrics()}return r}function Wr(e){for(var t=0,r=0;r<e.length;r+=1)t+=e[r];return t/e.length}var Xr={make:zr,fontToTable:function(e){for(var t,r=[],n=[],s=[],a=[],o=[],i=[],c=[],l=0,u=0,h=0,p=0,d=0,f=0;f<e.glyphs.length;f+=1){var g=e.glyphs.get(f),m=0|g.unicode;if(isNaN(g.advanceWidth))throw new Error("Glyph "+g.name+" ("+f+"): advanceWidth is not a number.");(t>m||void 0===t)&&m>0&&(t=m),l<m&&(l=m);var v=Or.getUnicodeRange(m);if(v<32)u|=1<<v;else if(v<64)h|=1<<v-32;else if(v<96)p|=1<<v-64;else{if(!(v<123))throw new Error("Unicode ranges bits > 123 are reserved for internal usage");d|=1<<v-96}if(".notdef"!==g.name){var y=g.getMetrics();r.push(y.xMin),n.push(y.yMin),s.push(y.xMax),a.push(y.yMax),i.push(y.leftSideBearing),c.push(y.rightSideBearing),o.push(g.advanceWidth)}}var b={xMin:Math.min.apply(null,r),yMin:Math.min.apply(null,n),xMax:Math.max.apply(null,s),yMax:Math.max.apply(null,a),advanceWidthMax:Math.max.apply(null,o),advanceWidthAvg:Wr(o),minLeftSideBearing:Math.min.apply(null,i),maxLeftSideBearing:Math.max.apply(null,i),minRightSideBearing:Math.min.apply(null,c)};b.ascender=e.ascender,b.descender=e.descender;var x=gr.make({flags:3,unitsPerEm:e.unitsPerEm,xMin:b.xMin,yMin:b.yMin,xMax:b.xMax,yMax:b.yMax,lowestRecPPEM:3,createdTimestamp:e.createdTimestamp}),w=mr.make({ascender:b.ascender,descender:b.descender,advanceWidthMax:b.advanceWidthMax,minLeftSideBearing:b.minLeftSideBearing,minRightSideBearing:b.minRightSideBearing,xMaxExtent:b.maxLeftSideBearing+(b.xMax-b.xMin),numberOfHMetrics:e.glyphs.length}),S=br.make(e.glyphs.length),T=Or.make(Object.assign({xAvgCharWidth:Math.round(b.advanceWidthAvg),usFirstCharIndex:t,usLastCharIndex:l,ulUnicodeRange1:u,ulUnicodeRange2:h,ulUnicodeRange3:p,ulUnicodeRange4:d,sTypoAscender:b.ascender,sTypoDescender:b.descender,sTypoLineGap:0,usWinAscent:b.yMax,usWinDescent:Math.abs(b.yMin),ulCodePageRange1:1,sxHeight:jr(e,"xyvw",{yMax:Math.round(b.ascender/2)}).yMax,sCapHeight:jr(e,"HIKLEFJMNTZBDPRAGOQSUVWXY",b).yMax,usDefaultChar:e.hasChar(" ")?32:0,usBreakChar:e.hasChar(" ")?32:0},e.tables.os2)),F=vr.make(e.glyphs),k=Ut.make(e.glyphs),E=e.getEnglishName("fontFamily"),A=e.getEnglishName("fontSubfamily"),I=E+" "+A,M=e.getEnglishName("postScriptName");M||(M=E.replace(/\s/g,"")+"-"+A);var L={};for(var C in e.names)L[C]=e.names[C];L.uniqueID||(L.uniqueID={en:e.getEnglishName("manufacturer")+":"+I}),L.postScriptName||(L.postScriptName={en:M}),L.preferredFamily||(L.preferredFamily=e.names.fontFamily),L.preferredSubfamily||(L.preferredSubfamily=e.names.fontSubfamily);var R=[],O=Cr.make(L,R),N=R.length>0?yr.make(R):void 0,U=Nr.make(),D=fr.make(e.glyphs,{version:e.getEnglishName("version"),fullName:I,familyName:E,weightName:A,postScriptName:M,unitsPerEm:e.unitsPerEm,fontBBox:[0,b.yMin,b.ascender,b.advanceWidthMax]}),P=e.metas&&Object.keys(e.metas).length>0?Gr.make(e.metas):void 0,B=[x,w,S,T,O,k,U,D,F];N&&B.push(N),e.tables.gsub&&B.push(Br.make(e.tables.gsub)),P&&B.push(P);for(var G=zr(B),_=Hr(G.encode()),H=G.fields,V=!1,z=0;z<H.length;z+=1)if("head table"===H[z].name){H[z].value.checkSumAdjustment=2981146554-_,V=!0;break}if(!V)throw new Error("Could not find head table with checkSum to adjust.");return G},computeCheckSum:Hr};function qr(e,t){for(var r=0,n=e.length-1;r<=n;){var s=r+n>>>1,a=e[s].tag;if(a===t)return s;a<t?r=s+1:n=s-1}return-r-1}function Yr(e,t){for(var r=0,n=e.length-1;r<=n;){var s=r+n>>>1,a=e[s];if(a===t)return s;a<t?r=s+1:n=s-1}return-r-1}function Kr(e,t){for(var r,n=0,s=e.length-1;n<=s;){var a=n+s>>>1,o=(r=e[a]).start;if(o===t)return r;o<t?n=a+1:s=a-1}if(n>0)return t>(r=e[n-1]).end?0:r}function Zr(e,t){this.font=e,this.tableName=t}function Qr(e){Zr.call(this,e,"gpos")}function $r(e){Zr.call(this,e,"gsub")}function Jr(e,t){var r=e.length;if(r!==t.length)return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function en(e,t,r){for(var n=e.subtables,s=0;s<n.length;s++){var a=n[s];if(a.substFormat===t)return a}if(r)return n.push(r),r}function tn(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;++n)r[n]=e[n];return t}function rn(e,t){if(!e)throw t}function nn(e,t,r,n,s){var a;return(t&n)>0?(a=e.parseByte(),0==(t&s)&&(a=-a),a=r+a):a=(t&s)>0?r:r+e.parseShort(),a}function sn(e,t,r){var n,s,a=new Ot.Parser(t,r);if(e.numberOfContours=a.parseShort(),e._xMin=a.parseShort(),e._yMin=a.parseShort(),e._xMax=a.parseShort(),e._yMax=a.parseShort(),e.numberOfContours>0){for(var o=e.endPointIndices=[],i=0;i<e.numberOfContours;i+=1)o.push(a.parseUShort());e.instructionLength=a.parseUShort(),e.instructions=[];for(var c=0;c<e.instructionLength;c+=1)e.instructions.push(a.parseByte());var l=o[o.length-1]+1;n=[];for(var u=0;u<l;u+=1)if(s=a.parseByte(),n.push(s),(8&s)>0)for(var h=a.parseByte(),p=0;p<h;p+=1)n.push(s),u+=1;if(st.argument(n.length===l,"Bad flags."),o.length>0){var d,f=[];if(l>0){for(var g=0;g<l;g+=1)s=n[g],(d={}).onCurve=!!(1&s),d.lastPointOfContour=o.indexOf(g)>=0,f.push(d);for(var m=0,v=0;v<l;v+=1)s=n[v],(d=f[v]).x=nn(a,s,m,2,16),m=d.x;for(var y=0,b=0;b<l;b+=1)s=n[b],(d=f[b]).y=nn(a,s,y,4,32),y=d.y}e.points=f}else e.points=[]}else if(0===e.numberOfContours)e.points=[];else{e.isComposite=!0,e.points=[],e.components=[];for(var x=!0;x;){n=a.parseUShort();var w={glyphIndex:a.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(1&n)>0?(2&n)>0?(w.dx=a.parseShort(),w.dy=a.parseShort()):w.matchedPoints=[a.parseUShort(),a.parseUShort()]:(2&n)>0?(w.dx=a.parseChar(),w.dy=a.parseChar()):w.matchedPoints=[a.parseByte(),a.parseByte()],(8&n)>0?w.xScale=w.yScale=a.parseF2Dot14():(64&n)>0?(w.xScale=a.parseF2Dot14(),w.yScale=a.parseF2Dot14()):(128&n)>0&&(w.xScale=a.parseF2Dot14(),w.scale01=a.parseF2Dot14(),w.scale10=a.parseF2Dot14(),w.yScale=a.parseF2Dot14()),e.components.push(w),x=!!(32&n)}if(256&n){e.instructionLength=a.parseUShort(),e.instructions=[];for(var S=0;S<e.instructionLength;S+=1)e.instructions.push(a.parseByte())}}}function an(e,t){for(var r=[],n=0;n<e.length;n+=1){var s=e[n],a={x:t.xScale*s.x+t.scale01*s.y+t.dx,y:t.scale10*s.x+t.yScale*s.y+t.dy,onCurve:s.onCurve,lastPointOfContour:s.lastPointOfContour};r.push(a)}return r}function on(e){var t=new tt;if(!e)return t;for(var r=function(e){for(var t=[],r=[],n=0;n<e.length;n+=1){var s=e[n];r.push(s),s.lastPointOfContour&&(t.push(r),r=[])}return st.argument(0===r.length,"There are still points left in the current contour."),t}(e),n=0;n<r.length;++n){var s=r[n],a=null,o=s[s.length-1],i=s[0];if(o.onCurve)t.moveTo(o.x,o.y);else if(i.onCurve)t.moveTo(i.x,i.y);else{var c={x:.5*(o.x+i.x),y:.5*(o.y+i.y)};t.moveTo(c.x,c.y)}for(var l=0;l<s.length;++l)if(a=o,o=i,i=s[(l+1)%s.length],o.onCurve)t.lineTo(o.x,o.y);else{var u=i;a.onCurve||(o.x,a.x,o.y,a.y),i.onCurve||(u={x:.5*(o.x+i.x),y:.5*(o.y+i.y)}),t.quadraticCurveTo(o.x,o.y,u.x,u.y)}t.closePath()}return t}function cn(e,t){if(t.isComposite)for(var r=0;r<t.components.length;r+=1){var n=t.components[r],s=e.get(n.glyphIndex);if(s.getPath(),s.points){var a=void 0;if(void 0===n.matchedPoints)a=an(s.points,n);else{if(n.matchedPoints[0]>t.points.length-1||n.matchedPoints[1]>s.points.length-1)throw Error("Matched points out of range in "+t.name);var o=t.points[n.matchedPoints[0]],i=s.points[n.matchedPoints[1]],c={xScale:n.xScale,scale01:n.scale01,scale10:n.scale10,yScale:n.yScale,dx:0,dy:0};i=an([i],c)[0],c.dx=o.x-i.x,c.dy=o.y-i.y,a=an(s.points,c)}t.points=t.points.concat(a)}}return on(t.points)}Zr.prototype={searchTag:qr,binSearch:Yr,getTable:function(e){var t=this.font.tables[this.tableName];return!t&&e&&(t=this.font.tables[this.tableName]=this.createDefaultTable()),t},getScriptNames:function(){var e=this.getTable();return e?e.scripts.map((function(e){return e.tag})):[]},getDefaultScriptName:function(){var e=this.getTable();if(e){for(var t=!1,r=0;r<e.scripts.length;r++){var n=e.scripts[r].tag;if("DFLT"===n)return n;"latn"===n&&(t=!0)}return t?"latn":void 0}},getScriptTable:function(e,t){var r=this.getTable(t);if(r){e=e||"DFLT";var n=r.scripts,s=qr(r.scripts,e);if(s>=0)return n[s].script;if(t){var a={tag:e,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return n.splice(-1-s,0,a),a.script}}},getLangSysTable:function(e,t,r){var n=this.getScriptTable(e,r);if(n){if(!t||"dflt"===t||"DFLT"===t)return n.defaultLangSys;var s=qr(n.langSysRecords,t);if(s>=0)return n.langSysRecords[s].langSys;if(r){var a={tag:t,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return n.langSysRecords.splice(-1-s,0,a),a.langSys}}},getFeatureTable:function(e,t,r,n){var s=this.getLangSysTable(e,t,n);if(s){for(var a,o=s.featureIndexes,i=this.font.tables[this.tableName].features,c=0;c<o.length;c++)if((a=i[o[c]]).tag===r)return a.feature;if(n){var l=i.length;return st.assert(0===l||r>=i[l-1].tag,"Features must be added in alphabetical order."),a={tag:r,feature:{params:0,lookupListIndexes:[]}},i.push(a),o.push(l),a.feature}}},getLookupTables:function(e,t,r,n,s){var a=this.getFeatureTable(e,t,r,s),o=[];if(a){for(var i,c=a.lookupListIndexes,l=this.font.tables[this.tableName].lookups,u=0;u<c.length;u++)(i=l[c[u]]).lookupType===n&&o.push(i);if(0===o.length&&s){i={lookupType:n,lookupFlag:0,subtables:[],markFilteringSet:void 0};var h=l.length;return l.push(i),c.push(h),[i]}}return o},getGlyphClass:function(e,t){switch(e.format){case 1:return e.startGlyph<=t&&t<e.startGlyph+e.classes.length?e.classes[t-e.startGlyph]:0;case 2:var r=Kr(e.ranges,t);return r?r.classId:0}},getCoverageIndex:function(e,t){switch(e.format){case 1:var r=Yr(e.glyphs,t);return r>=0?r:-1;case 2:var n=Kr(e.ranges,t);return n?n.index+t-n.start:-1}},expandCoverage:function(e){if(1===e.format)return e.glyphs;for(var t=[],r=e.ranges,n=0;n<r.length;n++)for(var s=r[n],a=s.start,o=s.end,i=a;i<=o;i++)t.push(i);return t}},Qr.prototype=Zr.prototype,Qr.prototype.init=function(){var e=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(e)},Qr.prototype.getKerningValue=function(e,t,r){for(var n=0;n<e.length;n++)for(var s=e[n].subtables,a=0;a<s.length;a++){var o=s[a],i=this.getCoverageIndex(o.coverage,t);if(!(i<0))switch(o.posFormat){case 1:for(var c=o.pairSets[i],l=0;l<c.length;l++){var u=c[l];if(u.secondGlyph===r)return u.value1&&u.value1.xAdvance||0}break;case 2:var h=this.getGlyphClass(o.classDef1,t),p=this.getGlyphClass(o.classDef2,r),d=o.classRecords[h][p];return d.value1&&d.value1.xAdvance||0}}return 0},Qr.prototype.getKerningTables=function(e,t){if(this.font.tables.gpos)return this.getLookupTables(e,t,"kern",2)},$r.prototype=Zr.prototype,$r.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}},$r.prototype.getSingle=function(e,t,r){for(var n=[],s=this.getLookupTables(t,r,e,1),a=0;a<s.length;a++)for(var o=s[a].subtables,i=0;i<o.length;i++){var c=o[i],l=this.expandCoverage(c.coverage),u=void 0;if(1===c.substFormat){var h=c.deltaGlyphId;for(u=0;u<l.length;u++){var p=l[u];n.push({sub:p,by:p+h})}}else{var d=c.substitute;for(u=0;u<l.length;u++)n.push({sub:l[u],by:d[u]})}}return n},$r.prototype.getAlternates=function(e,t,r){for(var n=[],s=this.getLookupTables(t,r,e,3),a=0;a<s.length;a++)for(var o=s[a].subtables,i=0;i<o.length;i++)for(var c=o[i],l=this.expandCoverage(c.coverage),u=c.alternateSets,h=0;h<l.length;h++)n.push({sub:l[h],by:u[h]});return n},$r.prototype.getLigatures=function(e,t,r){for(var n=[],s=this.getLookupTables(t,r,e,4),a=0;a<s.length;a++)for(var o=s[a].subtables,i=0;i<o.length;i++)for(var c=o[i],l=this.expandCoverage(c.coverage),u=c.ligatureSets,h=0;h<l.length;h++)for(var p=l[h],d=u[h],f=0;f<d.length;f++){var g=d[f];n.push({sub:[p].concat(g.components),by:g.ligGlyph})}return n},$r.prototype.addSingle=function(e,t,r,n){var s=en(this.getLookupTables(r,n,e,1,!0)[0],2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});st.assert(1===s.coverage.format,"Ligature: unable to modify coverage table format "+s.coverage.format);var a=t.sub,o=this.binSearch(s.coverage.glyphs,a);o<0&&(o=-1-o,s.coverage.glyphs.splice(o,0,a),s.substitute.splice(o,0,0)),s.substitute[o]=t.by},$r.prototype.addAlternate=function(e,t,r,n){var s=en(this.getLookupTables(r,n,e,3,!0)[0],1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});st.assert(1===s.coverage.format,"Ligature: unable to modify coverage table format "+s.coverage.format);var a=t.sub,o=this.binSearch(s.coverage.glyphs,a);o<0&&(o=-1-o,s.coverage.glyphs.splice(o,0,a),s.alternateSets.splice(o,0,0)),s.alternateSets[o]=t.by},$r.prototype.addLigature=function(e,t,r,n){var s=this.getLookupTables(r,n,e,4,!0)[0],a=s.subtables[0];a||(a={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},s.subtables[0]=a),st.assert(1===a.coverage.format,"Ligature: unable to modify coverage table format "+a.coverage.format);var o=t.sub[0],i=t.sub.slice(1),c={ligGlyph:t.by,components:i},l=this.binSearch(a.coverage.glyphs,o);if(l>=0){for(var u=a.ligatureSets[l],h=0;h<u.length;h++)if(Jr(u[h].components,i))return;u.push(c)}else l=-1-l,a.coverage.glyphs.splice(l,0,o),a.ligatureSets.splice(l,0,[c])},$r.prototype.getFeature=function(e,t,r){if(/ss\d\d/.test(e))return this.getSingle(e,t,r);switch(e){case"aalt":case"salt":return this.getSingle(e,t,r).concat(this.getAlternates(e,t,r));case"dlig":case"liga":case"rlig":return this.getLigatures(e,t,r)}},$r.prototype.add=function(e,t,r,n){if(/ss\d\d/.test(e))return this.addSingle(e,t,r,n);switch(e){case"aalt":case"salt":return"number"==typeof t.by?this.addSingle(e,t,r,n):this.addAlternate(e,t,r,n);case"dlig":case"liga":case"rlig":return this.addLigature(e,t,r,n)}};var ln,un,hn,pn,dn={getPath:on,parse:function(e,t,r,n,s){return s.lowMemory?function(e,t,r,n){var s=new Kt.GlyphSet(n);return n._push=function(a){var o=r[a];o!==r[a+1]?s.push(a,Kt.ttfGlyphLoader(n,a,sn,e,t+o,cn)):s.push(a,Kt.glyphLoader(n,a))},s}(e,t,r,n):function(e,t,r,n){for(var s=new Kt.GlyphSet(n),a=0;a<r.length-1;a+=1){var o=r[a];o!==r[a+1]?s.push(a,Kt.ttfGlyphLoader(n,a,sn,e,t+o,cn)):s.push(a,Kt.glyphLoader(n,a))}return s}(e,t,r,n)}};function fn(e){this.font=e,this.getCommands=function(e){return dn.getPath(e).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function gn(e){return e}function mn(e){return Math.sign(e)*Math.round(Math.abs(e))}function vn(e){return Math.sign(e)*Math.round(Math.abs(2*e))/2}function yn(e){return Math.sign(e)*(Math.round(Math.abs(e)+.5)-.5)}function bn(e){return Math.sign(e)*Math.ceil(Math.abs(e))}function xn(e){return Math.sign(e)*Math.floor(Math.abs(e))}var wn=function(e){var t=this.srPeriod,r=this.srPhase,n=1;return e<0&&(e=-e,n=-1),e+=this.srThreshold-r,e=Math.trunc(e/t)*t,(e+=r)<0?r*n:e*n},Sn={x:1,y:0,axis:"x",distance:function(e,t,r,n){return(r?e.xo:e.x)-(n?t.xo:t.x)},interpolate:function(e,t,r,n){var s,a,o,i,c,l,u;if(!n||n===this)return s=e.xo-t.xo,a=e.xo-r.xo,c=t.x-t.xo,l=r.x-r.xo,0===(u=(o=Math.abs(s))+(i=Math.abs(a)))?void(e.x=e.xo+(c+l)/2):void(e.x=e.xo+(c*i+l*o)/u);s=n.distance(e,t,!0,!0),a=n.distance(e,r,!0,!0),c=n.distance(t,t,!1,!0),l=n.distance(r,r,!1,!0),0!==(u=(o=Math.abs(s))+(i=Math.abs(a)))?Sn.setRelative(e,e,(c*i+l*o)/u,n,!0):Sn.setRelative(e,e,(c+l)/2,n,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(e,t,r,n,s){if(n&&n!==this){var a=s?t.xo:t.x,o=s?t.yo:t.y,i=a+r*n.x,c=o+r*n.y;e.x=i+(e.y-c)/n.normalSlope}else e.x=(s?t.xo:t.x)+r},slope:0,touch:function(e){e.xTouched=!0},touched:function(e){return e.xTouched},untouch:function(e){e.xTouched=!1}},Tn={x:0,y:1,axis:"y",distance:function(e,t,r,n){return(r?e.yo:e.y)-(n?t.yo:t.y)},interpolate:function(e,t,r,n){var s,a,o,i,c,l,u;if(!n||n===this)return s=e.yo-t.yo,a=e.yo-r.yo,c=t.y-t.yo,l=r.y-r.yo,0===(u=(o=Math.abs(s))+(i=Math.abs(a)))?void(e.y=e.yo+(c+l)/2):void(e.y=e.yo+(c*i+l*o)/u);s=n.distance(e,t,!0,!0),a=n.distance(e,r,!0,!0),c=n.distance(t,t,!1,!0),l=n.distance(r,r,!1,!0),0!==(u=(o=Math.abs(s))+(i=Math.abs(a)))?Tn.setRelative(e,e,(c*i+l*o)/u,n,!0):Tn.setRelative(e,e,(c+l)/2,n,!0)},normalSlope:0,setRelative:function(e,t,r,n,s){if(n&&n!==this){var a=s?t.xo:t.x,o=s?t.yo:t.y,i=a+r*n.x,c=o+r*n.y;e.y=c+n.normalSlope*(e.x-i)}else e.y=(s?t.yo:t.y)+r},slope:Number.POSITIVE_INFINITY,touch:function(e){e.yTouched=!0},touched:function(e){return e.yTouched},untouch:function(e){e.yTouched=!1}};function Fn(e,t){this.x=e,this.y=t,this.axis=void 0,this.slope=t/e,this.normalSlope=-e/t,Object.freeze(this)}function kn(e,t){var r=Math.sqrt(e*e+t*t);return t/=r,1===(e/=r)&&0===t?Sn:0===e&&1===t?Tn:new Fn(e,t)}function En(e,t,r,n){this.x=this.xo=Math.round(64*e)/64,this.y=this.yo=Math.round(64*t)/64,this.lastPointOfContour=r,this.onCurve=n,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}Object.freeze(Sn),Object.freeze(Tn),Fn.prototype.distance=function(e,t,r,n){return this.x*Sn.distance(e,t,r,n)+this.y*Tn.distance(e,t,r,n)},Fn.prototype.interpolate=function(e,t,r,n){var s,a,o,i,c,l,u;o=n.distance(e,t,!0,!0),i=n.distance(e,r,!0,!0),s=n.distance(t,t,!1,!0),a=n.distance(r,r,!1,!0),0!==(u=(c=Math.abs(o))+(l=Math.abs(i)))?this.setRelative(e,e,(s*l+a*c)/u,n,!0):this.setRelative(e,e,(s+a)/2,n,!0)},Fn.prototype.setRelative=function(e,t,r,n,s){n=n||this;var a=s?t.xo:t.x,o=s?t.yo:t.y,i=a+r*n.x,c=o+r*n.y,l=n.normalSlope,u=this.slope,h=e.x,p=e.y;e.x=(u*h-l*i+c-p)/(u-l),e.y=u*(e.x-h)+p},Fn.prototype.touch=function(e){e.xTouched=!0,e.yTouched=!0},En.prototype.nextTouched=function(e){for(var t=this.nextPointOnContour;!e.touched(t)&&t!==this;)t=t.nextPointOnContour;return t},En.prototype.prevTouched=function(e){for(var t=this.prevPointOnContour;!e.touched(t)&&t!==this;)t=t.prevPointOnContour;return t};var An=Object.freeze(new En(0,0)),In={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function Mn(e,t){switch(this.env=e,this.stack=[],this.prog=t,e){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=Sn,this.round=mn}}function Ln(e){for(var t=e.tZone=new Array(e.gZone.length),r=0;r<t.length;r++)t[r]=new En(0,0)}function Cn(e,t){var r,n=e.prog,s=e.ip,a=1;do{if(88===(r=n[++s]))a++;else if(89===r)a--;else if(64===r)s+=n[s+1]+1;else if(65===r)s+=2*n[s+1]+1;else if(r>=176&&r<=183)s+=r-176+1;else if(r>=184&&r<=191)s+=2*(r-184+1);else if(t&&1===a&&27===r)break}while(a>0);e.ip=s}function Rn(e,t){exports.DEBUG&&console.log(t.step,"SVTCA["+e.axis+"]"),t.fv=t.pv=t.dpv=e}function On(e,t){exports.DEBUG&&console.log(t.step,"SPVTCA["+e.axis+"]"),t.pv=t.dpv=e}function Nn(e,t){exports.DEBUG&&console.log(t.step,"SFVTCA["+e.axis+"]"),t.fv=e}function Un(e,t){var r,n,s=t.stack,a=s.pop(),o=s.pop(),i=t.z2[a],c=t.z1[o];exports.DEBUG&&console.log("SPVTL["+e+"]",a,o),e?(r=i.y-c.y,n=c.x-i.x):(r=c.x-i.x,n=c.y-i.y),t.pv=t.dpv=kn(r,n)}function Dn(e,t){var r,n,s=t.stack,a=s.pop(),o=s.pop(),i=t.z2[a],c=t.z1[o];exports.DEBUG&&console.log("SFVTL["+e+"]",a,o),e?(r=i.y-c.y,n=c.x-i.x):(r=c.x-i.x,n=c.y-i.y),t.fv=kn(r,n)}function Pn(e){exports.DEBUG&&console.log(e.step,"POP[]"),e.stack.pop()}function Bn(e,t){var r=t.stack.pop(),n=t.z0[r],s=t.fv,a=t.pv;exports.DEBUG&&console.log(t.step,"MDAP["+e+"]",r);var o=a.distance(n,An);e&&(o=t.round(o)),s.setRelative(n,An,o,a),s.touch(n),t.rp0=t.rp1=r}function Gn(e,t){var r,n,s,a=t.z2,o=a.length-2;exports.DEBUG&&console.log(t.step,"IUP["+e.axis+"]");for(var i=0;i<o;i++)r=a[i],e.touched(r)||(n=r.prevTouched(e))!==r&&(n===(s=r.nextTouched(e))&&e.setRelative(r,r,e.distance(n,n,!1,!0),e,!0),e.interpolate(r,n,s,e))}function _n(e,t){for(var r=t.stack,n=e?t.rp1:t.rp2,s=(e?t.z0:t.z1)[n],a=t.fv,o=t.pv,i=t.loop,c=t.z2;i--;){var l=r.pop(),u=c[l],h=o.distance(s,s,!1,!0);a.setRelative(u,u,h,o),a.touch(u),exports.DEBUG&&console.log(t.step,(t.loop>1?"loop "+(t.loop-i)+": ":"")+"SHP["+(e?"rp1":"rp2")+"]",l)}t.loop=1}function Hn(e,t){var r=t.stack,n=e?t.rp1:t.rp2,s=(e?t.z0:t.z1)[n],a=t.fv,o=t.pv,i=r.pop(),c=t.z2[t.contours[i]],l=c;exports.DEBUG&&console.log(t.step,"SHC["+e+"]",i);var u=o.distance(s,s,!1,!0);do{l!==s&&a.setRelative(l,l,u,o),l=l.nextPointOnContour}while(l!==c)}function Vn(e,t){var r,n,s=t.stack,a=e?t.rp1:t.rp2,o=(e?t.z0:t.z1)[a],i=t.fv,c=t.pv,l=s.pop();switch(exports.DEBUG&&console.log(t.step,"SHZ["+e+"]",l),l){case 0:r=t.tZone;break;case 1:r=t.gZone;break;default:throw new Error("Invalid zone")}for(var u=c.distance(o,o,!1,!0),h=r.length-2,p=0;p<h;p++)n=r[p],i.setRelative(n,n,u,c)}function zn(e,t){var r=t.stack,n=r.pop()/64,s=r.pop(),a=t.z1[s],o=t.z0[t.rp0],i=t.fv,c=t.pv;i.setRelative(a,o,n,c),i.touch(a),exports.DEBUG&&console.log(t.step,"MSIRP["+e+"]",n,s),t.rp1=t.rp0,t.rp2=s,e&&(t.rp0=s)}function jn(e,t){var r=t.stack,n=r.pop(),s=r.pop(),a=t.z0[s],o=t.fv,i=t.pv,c=t.cvt[n];exports.DEBUG&&console.log(t.step,"MIAP["+e+"]",n,"(",c,")",s);var l=i.distance(a,An);e&&(Math.abs(l-c)<t.cvCutIn&&(l=c),l=t.round(l)),o.setRelative(a,An,l,i),0===t.zp0&&(a.xo=a.x,a.yo=a.y),o.touch(a),t.rp0=t.rp1=s}function Wn(e,t){var r=t.stack,n=r.pop(),s=t.z2[n];exports.DEBUG&&console.log(t.step,"GC["+e+"]",n),r.push(64*t.dpv.distance(s,An,e,!1))}function Xn(e,t){var r=t.stack,n=r.pop(),s=r.pop(),a=t.z1[n],o=t.z0[s],i=t.dpv.distance(o,a,e,e);exports.DEBUG&&console.log(t.step,"MD["+e+"]",n,s,"->",i),t.stack.push(Math.round(64*i))}function qn(e,t){var r=t.stack,n=r.pop(),s=t.fv,a=t.pv,o=t.ppem,i=t.deltaBase+16*(e-1),c=t.deltaShift,l=t.z0;exports.DEBUG&&console.log(t.step,"DELTAP["+e+"]",n,r);for(var u=0;u<n;u++){var h=r.pop(),p=r.pop();if(i+((240&p)>>4)===o){var d=(15&p)-8;d>=0&&d++,exports.DEBUG&&console.log(t.step,"DELTAPFIX",h,"by",d*c);var f=l[h];s.setRelative(f,f,d*c,a)}}}function Yn(e,t){var r=t.stack,n=r.pop();exports.DEBUG&&console.log(t.step,"ROUND[]"),r.push(64*t.round(n/64))}function Kn(e,t){var r=t.stack,n=r.pop(),s=t.ppem,a=t.deltaBase+16*(e-1),o=t.deltaShift;exports.DEBUG&&console.log(t.step,"DELTAC["+e+"]",n,r);for(var i=0;i<n;i++){var c=r.pop(),l=r.pop();if(a+((240&l)>>4)===s){var u=(15&l)-8;u>=0&&u++;var h=u*o;exports.DEBUG&&console.log(t.step,"DELTACFIX",c,"by",h),t.cvt[c]+=h}}}function Zn(e,t){var r,n,s=t.stack,a=s.pop(),o=s.pop(),i=t.z2[a],c=t.z1[o];exports.DEBUG&&console.log(t.step,"SDPVTL["+e+"]",a,o),e?(r=i.y-c.y,n=c.x-i.x):(r=c.x-i.x,n=c.y-i.y),t.dpv=kn(r,n)}function Qn(e,t){var r=t.stack,n=t.prog,s=t.ip;exports.DEBUG&&console.log(t.step,"PUSHB["+e+"]");for(var a=0;a<e;a++)r.push(n[++s]);t.ip=s}function $n(e,t){var r=t.ip,n=t.prog,s=t.stack;exports.DEBUG&&console.log(t.ip,"PUSHW["+e+"]");for(var a=0;a<e;a++){var o=n[++r]<<8|n[++r];32768&o&&(o=-(1+(65535^o))),s.push(o)}t.ip=r}function Jn(e,t,r,n,s,a){var o,i,c,l,u=a.stack,h=e&&u.pop(),p=u.pop(),d=a.rp0,f=a.z0[d],g=a.z1[p],m=a.minDis,v=a.fv,y=a.dpv;c=(i=o=y.distance(g,f,!0,!0))>=0?1:-1,i=Math.abs(i),e&&(l=a.cvt[h],n&&Math.abs(i-l)<a.cvCutIn&&(i=l)),r&&i<m&&(i=m),n&&(i=a.round(i)),v.setRelative(g,f,c*i,y),v.touch(g),exports.DEBUG&&console.log(a.step,(e?"MIRP[":"MDRP[")+(t?"M":"m")+(r?">":"_")+(n?"R":"_")+(0===s?"Gr":1===s?"Bl":2===s?"Wh":"")+"]",e?h+"("+a.cvt[h]+","+l+")":"",p,"(d =",o,"->",c*i,")"),a.rp1=a.rp0,a.rp2=p,t&&(a.rp0=p)}function es(e){this.char=e,this.state={},this.activeState=null}function ts(e,t,r){this.contextName=r,this.startIndex=e,this.endOffset=t}function rs(e,t,r){this.contextName=e,this.openRange=null,this.ranges=[],this.checkStart=t,this.checkEnd=r}function ns(e,t){this.context=e,this.index=t,this.length=e.length,this.current=e[t],this.backtrack=e.slice(0,t),this.lookahead=e.slice(t+1)}function ss(e){this.eventId=e,this.subscribers=[]}function as(e){var t=this,r=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];r.forEach((function(e){Object.defineProperty(t.events,e,{value:new ss(e)})})),e&&r.forEach((function(r){var n=e[r];"function"==typeof n&&t.events[r].subscribe(n)}));["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"].forEach((function(e){t.events[e].subscribe(t.updateContextsRanges)}))}function os(e){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],as.call(this,e)}function is(e){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(e)}function cs(e){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(e)}function ls(e){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(e)}function us(e){return/[A-z]/.test(e)}function hs(e){this.font=e,this.features={}}function ps(e){this.id=e.id,this.tag=e.tag,this.substitution=e.substitution}function ds(e,t){if(!e)return-1;switch(t.format){case 1:return t.glyphs.indexOf(e);case 2:for(var r=t.ranges,n=0;n<r.length;n++){var s=r[n];if(e>=s.start&&e<=s.end){var a=e-s.start;return s.index+a}}break;default:return-1}return-1}function fs(e,t){return-1===ds(e,t.coverage)?null:e+t.deltaGlyphId}function gs(e,t){var r=ds(e,t.coverage);return-1===r?null:t.substitute[r]}function ms(e,t){for(var r=[],n=0;n<e.length;n++){var s=e[n],a=t.current,o=ds(a=Array.isArray(a)?a[0]:a,s);-1!==o&&r.push(o)}return r.length!==e.length?-1:r}function vs(e,t){var r=t.inputCoverage.length+t.lookaheadCoverage.length+t.backtrackCoverage.length;if(e.context.length<r)return[];var n=ms(t.inputCoverage,e);if(-1===n)return[];var s=t.inputCoverage.length-1;if(e.lookahead.length<t.lookaheadCoverage.length)return[];for(var a=e.lookahead.slice(s);a.length&&ls(a[0].char);)a.shift();var o=new ns(a,0),i=ms(t.lookaheadCoverage,o),c=[].concat(e.backtrack);for(c.reverse();c.length&&ls(c[0].char);)c.shift();if(c.length<t.backtrackCoverage.length)return[];var l=new ns(c,0),u=ms(t.backtrackCoverage,l),h=[];if(n.length===t.inputCoverage.length&&i.length===t.lookaheadCoverage.length&&u.length===t.backtrackCoverage.length)for(var p=0;p<t.lookupRecords.length;p++)for(var d=t.lookupRecords[p].lookupListIndex,f=this.getLookupByIndex(d),g=0;g<f.subtables.length;g++){var m=f.subtables[g],v=this.getLookupMethod(f,m);if("12"===this.getSubstitutionType(f,m))for(var y=0;y<n.length;y++){var b=v(e.get(y));b&&h.push(b)}}return h}function ys(e,t){var r,n=ds(e.current,t.coverage);if(-1===n)return null;for(var s=t.ligatureSets[n],a=0;a<s.length;a++){r=s[a];for(var o=0;o<r.components.length;o++){if(e.lookahead[o]!==r.components[o])break;if(o===r.components.length-1)return r}}return null}function bs(e,t){var r=ds(e,t.coverage);return-1===r?null:t.sequences[r]}fn.prototype.exec=function(e,t){if("number"!=typeof t)throw new Error("Point size is not a number!");if(!(this._errorState>2)){var r=this.font,n=this._prepState;if(!n||n.ppem!==t){var s=this._fpgmState;if(!s){Mn.prototype=In,(s=this._fpgmState=new Mn("fpgm",r.tables.fpgm)).funcs=[],s.font=r,exports.DEBUG&&(console.log("---EXEC FPGM---"),s.step=-1);try{un(s)}catch(e){return console.log("Hinting error in FPGM:"+e),void(this._errorState=3)}}Mn.prototype=s,(n=this._prepState=new Mn("prep",r.tables.prep)).ppem=t;var a=r.tables.cvt;if(a)for(var o=n.cvt=new Array(a.length),i=t/r.unitsPerEm,c=0;c<a.length;c++)o[c]=a[c]*i;else n.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),n.step=-1);try{un(n)}catch(e){this._errorState<2&&console.log("Hinting error in PREP:"+e),this._errorState=2}}if(!(this._errorState>1))try{return hn(e,n)}catch(e){return this._errorState<1&&(console.log("Hinting error:"+e),console.log("Note: further hinting errors are silenced")),void(this._errorState=1)}}},hn=function(e,t){var r,n,s,a=t.ppem/t.font.unitsPerEm,o=a,i=e.components;if(Mn.prototype=t,i){var c=t.font;n=[],r=[];for(var l=0;l<i.length;l++){var u=i[l],h=c.glyphs.get(u.glyphIndex);s=new Mn("glyf",h.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+l+"---"),s.step=-1),pn(h,s,a,o);for(var p=Math.round(u.dx*a),d=Math.round(u.dy*o),f=s.gZone,g=s.contours,m=0;m<f.length;m++){var v=f[m];v.xTouched=v.yTouched=!1,v.xo=v.x=v.x+p,v.yo=v.y=v.y+d}var y=n.length;n.push.apply(n,f);for(var b=0;b<g.length;b++)r.push(g[b]+y)}e.instructions&&!s.inhibitGridFit&&((s=new Mn("glyf",e.instructions)).gZone=s.z0=s.z1=s.z2=n,s.contours=r,n.push(new En(0,0),new En(Math.round(e.advanceWidth*a),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),s.step=-1),un(s),n.length-=2)}else s=new Mn("glyf",e.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),s.step=-1),pn(e,s,a,o),n=s.gZone;return n},pn=function(e,t,r,n){for(var s,a,o,i=e.points||[],c=i.length,l=t.gZone=t.z0=t.z1=t.z2=[],u=t.contours=[],h=0;h<c;h++)s=i[h],l[h]=new En(s.x*r,s.y*n,s.lastPointOfContour,s.onCurve);for(var p=0;p<c;p++)s=l[p],a||(a=s,u.push(p)),s.lastPointOfContour?(s.nextPointOnContour=a,a.prevPointOnContour=s,a=void 0):(o=l[p+1],s.nextPointOnContour=o,o.prevPointOnContour=s);if(!t.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",t.stack);for(var d=0;d<c;d++)console.log(d,l[d].x,l[d].y)}if(l.push(new En(0,0),new En(Math.round(e.advanceWidth*r),0)),un(t),l.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",t.stack);for(var f=0;f<c;f++)console.log(f,l[f].x,l[f].y)}}},un=function(e){var t=e.prog;if(t){var r,n=t.length;for(e.ip=0;e.ip<n;e.ip++){if(exports.DEBUG&&e.step++,!(r=ln[t[e.ip]]))throw new Error("unknown instruction: 0x"+Number(t[e.ip]).toString(16));r(e)}}},ln=[Rn.bind(void 0,Tn),Rn.bind(void 0,Sn),On.bind(void 0,Tn),On.bind(void 0,Sn),Nn.bind(void 0,Tn),Nn.bind(void 0,Sn),Un.bind(void 0,0),Un.bind(void 0,1),Dn.bind(void 0,0),Dn.bind(void 0,1),function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"SPVFS[]",r,n),e.pv=e.dpv=kn(n,r)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"SPVFS[]",r,n),e.fv=kn(n,r)},function(e){var t=e.stack,r=e.pv;exports.DEBUG&&console.log(e.step,"GPV[]"),t.push(16384*r.x),t.push(16384*r.y)},function(e){var t=e.stack,r=e.fv;exports.DEBUG&&console.log(e.step,"GFV[]"),t.push(16384*r.x),t.push(16384*r.y)},function(e){e.fv=e.pv,exports.DEBUG&&console.log(e.step,"SFVTPV[]")},function(e){var t=e.stack,r=t.pop(),n=t.pop(),s=t.pop(),a=t.pop(),o=t.pop(),i=e.z0,c=e.z1,l=i[r],u=i[n],h=c[s],p=c[a],d=e.z2[o];exports.DEBUG&&console.log("ISECT[], ",r,n,s,a,o);var f=l.x,g=l.y,m=u.x,v=u.y,y=h.x,b=h.y,x=p.x,w=p.y,S=(f-m)*(b-w)-(g-v)*(y-x),T=f*v-g*m,F=y*w-b*x;d.x=(T*(y-x)-F*(f-m))/S,d.y=(T*(b-w)-F*(g-v))/S},function(e){e.rp0=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SRP0[]",e.rp0)},function(e){e.rp1=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SRP1[]",e.rp1)},function(e){e.rp2=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SRP2[]",e.rp2)},function(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZP0[]",t),e.zp0=t,t){case 0:e.tZone||Ln(e),e.z0=e.tZone;break;case 1:e.z0=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZP1[]",t),e.zp1=t,t){case 0:e.tZone||Ln(e),e.z1=e.tZone;break;case 1:e.z1=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZP2[]",t),e.zp2=t,t){case 0:e.tZone||Ln(e),e.z2=e.tZone;break;case 1:e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){var t=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SZPS[]",t),e.zp0=e.zp1=e.zp2=t,t){case 0:e.tZone||Ln(e),e.z0=e.z1=e.z2=e.tZone;break;case 1:e.z0=e.z1=e.z2=e.gZone;break;default:throw new Error("Invalid zone pointer")}},function(e){e.loop=e.stack.pop(),exports.DEBUG&&console.log(e.step,"SLOOP[]",e.loop)},function(e){exports.DEBUG&&console.log(e.step,"RTG[]"),e.round=mn},function(e){exports.DEBUG&&console.log(e.step,"RTHG[]"),e.round=yn},function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SMD[]",t),e.minDis=t/64},function(e){exports.DEBUG&&console.log(e.step,"ELSE[]"),Cn(e,!1)},function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"JMPR[]",t),e.ip+=t-1},function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SCVTCI[]",t),e.cvCutIn=t/64},void 0,void 0,function(e){var t=e.stack;exports.DEBUG&&console.log(e.step,"DUP[]"),t.push(t[t.length-1])},Pn,function(e){exports.DEBUG&&console.log(e.step,"CLEAR[]"),e.stack.length=0},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"SWAP[]"),t.push(r),t.push(n)},function(e){var t=e.stack;exports.DEBUG&&console.log(e.step,"DEPTH[]"),t.push(t.length)},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"CINDEX[]",r),t.push(t[t.length-r])},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"MINDEX[]",r),t.push(t.splice(t.length-r,1)[0])},void 0,void 0,void 0,function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"LOOPCALL[]",r,n);var s=e.ip,a=e.prog;e.prog=e.funcs[r];for(var o=0;o<n;o++)un(e),exports.DEBUG&&console.log(++e.step,o+1<n?"next loopcall":"done loopcall",o);e.ip=s,e.prog=a},function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"CALL[]",t);var r=e.ip,n=e.prog;e.prog=e.funcs[t],un(e),e.ip=r,e.prog=n,exports.DEBUG&&console.log(++e.step,"returning from",t)},function(e){if("fpgm"!==e.env)throw new Error("FDEF not allowed here");var t=e.stack,r=e.prog,n=e.ip,s=t.pop(),a=n;for(exports.DEBUG&&console.log(e.step,"FDEF[]",s);45!==r[++n];);e.ip=n,e.funcs[s]=r.slice(a+1,n)},void 0,Bn.bind(void 0,0),Bn.bind(void 0,1),Gn.bind(void 0,Tn),Gn.bind(void 0,Sn),_n.bind(void 0,0),_n.bind(void 0,1),Hn.bind(void 0,0),Hn.bind(void 0,1),Vn.bind(void 0,0),Vn.bind(void 0,1),function(e){for(var t=e.stack,r=e.loop,n=e.fv,s=t.pop()/64,a=e.z2;r--;){var o=t.pop(),i=a[o];exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-r)+": ":"")+"SHPIX[]",o,s),n.setRelative(i,i,s),n.touch(i)}e.loop=1},function(e){for(var t=e.stack,r=e.rp1,n=e.rp2,s=e.loop,a=e.z0[r],o=e.z1[n],i=e.fv,c=e.dpv,l=e.z2;s--;){var u=t.pop(),h=l[u];exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-s)+": ":"")+"IP[]",u,r,"<->",n),i.interpolate(h,a,o,c),i.touch(h)}e.loop=1},zn.bind(void 0,0),zn.bind(void 0,1),function(e){for(var t=e.stack,r=e.rp0,n=e.z0[r],s=e.loop,a=e.fv,o=e.pv,i=e.z1;s--;){var c=t.pop(),l=i[c];exports.DEBUG&&console.log(e.step,(e.loop>1?"loop "+(e.loop-s)+": ":"")+"ALIGNRP[]",c),a.setRelative(l,n,0,o),a.touch(l)}e.loop=1},function(e){exports.DEBUG&&console.log(e.step,"RTDG[]"),e.round=vn},jn.bind(void 0,0),jn.bind(void 0,1),function(e){var t=e.prog,r=e.ip,n=e.stack,s=t[++r];exports.DEBUG&&console.log(e.step,"NPUSHB[]",s);for(var a=0;a<s;a++)n.push(t[++r]);e.ip=r},function(e){var t=e.ip,r=e.prog,n=e.stack,s=r[++t];exports.DEBUG&&console.log(e.step,"NPUSHW[]",s);for(var a=0;a<s;a++){var o=r[++t]<<8|r[++t];32768&o&&(o=-(1+(65535^o))),n.push(o)}e.ip=t},function(e){var t=e.stack,r=e.store;r||(r=e.store=[]);var n=t.pop(),s=t.pop();exports.DEBUG&&console.log(e.step,"WS",n,s),r[s]=n},function(e){var t=e.stack,r=e.store,n=t.pop();exports.DEBUG&&console.log(e.step,"RS",n);var s=r&&r[n]||0;t.push(s)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"WCVTP",r,n),e.cvt[n]=r/64},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"RCVT",r),t.push(64*e.cvt[r])},Wn.bind(void 0,0),Wn.bind(void 0,1),void 0,Xn.bind(void 0,0),Xn.bind(void 0,1),function(e){exports.DEBUG&&console.log(e.step,"MPPEM[]"),e.stack.push(e.ppem)},void 0,function(e){exports.DEBUG&&console.log(e.step,"FLIPON[]"),e.autoFlip=!0},void 0,void 0,function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"LT[]",r,n),t.push(n<r?1:0)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"LTEQ[]",r,n),t.push(n<=r?1:0)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"GT[]",r,n),t.push(n>r?1:0)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"GTEQ[]",r,n),t.push(n>=r?1:0)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"EQ[]",r,n),t.push(r===n?1:0)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"NEQ[]",r,n),t.push(r!==n?1:0)},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"ODD[]",r),t.push(Math.trunc(r)%2?1:0)},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"EVEN[]",r),t.push(Math.trunc(r)%2?0:1)},function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"IF[]",t),t||(Cn(e,!0),exports.DEBUG&&console.log(e.step,"EIF[]"))},function(e){exports.DEBUG&&console.log(e.step,"EIF[]")},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"AND[]",r,n),t.push(r&&n?1:0)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"OR[]",r,n),t.push(r||n?1:0)},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"NOT[]",r),t.push(r?0:1)},qn.bind(void 0,1),function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SDB[]",t),e.deltaBase=t},function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SDS[]",t),e.deltaShift=Math.pow(.5,t)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"ADD[]",r,n),t.push(n+r)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"SUB[]",r,n),t.push(n-r)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"DIV[]",r,n),t.push(64*n/r)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"MUL[]",r,n),t.push(n*r/64)},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"ABS[]",r),t.push(Math.abs(r))},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"NEG[]",r),t.push(-r)},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"FLOOR[]",r),t.push(64*Math.floor(r/64))},function(e){var t=e.stack,r=t.pop();exports.DEBUG&&console.log(e.step,"CEILING[]",r),t.push(64*Math.ceil(r/64))},Yn.bind(void 0,0),Yn.bind(void 0,1),Yn.bind(void 0,2),Yn.bind(void 0,3),void 0,void 0,void 0,void 0,function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"WCVTF[]",r,n),e.cvt[n]=r*e.ppem/e.font.unitsPerEm},qn.bind(void 0,2),qn.bind(void 0,3),Kn.bind(void 0,1),Kn.bind(void 0,2),Kn.bind(void 0,3),function(e){var t,r=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"SROUND[]",r),e.round=wn,192&r){case 0:t=.5;break;case 64:t=1;break;case 128:t=2;break;default:throw new Error("invalid SROUND value")}switch(e.srPeriod=t,48&r){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*t;break;case 32:e.srPhase=.5*t;break;case 48:e.srPhase=.75*t;break;default:throw new Error("invalid SROUND value")}r&=15,e.srThreshold=0===r?0:(r/8-.5)*t},function(e){var t,r=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"S45ROUND[]",r),e.round=wn,192&r){case 0:t=Math.sqrt(2)/2;break;case 64:t=Math.sqrt(2);break;case 128:t=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(e.srPeriod=t,48&r){case 0:e.srPhase=0;break;case 16:e.srPhase=.25*t;break;case 32:e.srPhase=.5*t;break;case 48:e.srPhase=.75*t;break;default:throw new Error("invalid S45ROUND value")}r&=15,e.srThreshold=0===r?0:(r/8-.5)*t},void 0,void 0,function(e){exports.DEBUG&&console.log(e.step,"ROFF[]"),e.round=gn},void 0,function(e){exports.DEBUG&&console.log(e.step,"RUTG[]"),e.round=bn},function(e){exports.DEBUG&&console.log(e.step,"RDTG[]"),e.round=xn},Pn,Pn,void 0,void 0,void 0,void 0,void 0,function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SCANCTRL[]",t)},Zn.bind(void 0,0),Zn.bind(void 0,1),function(e){var t=e.stack,r=t.pop(),n=0;exports.DEBUG&&console.log(e.step,"GETINFO[]",r),1&r&&(n=35),32&r&&(n|=4096),t.push(n)},void 0,function(e){var t=e.stack,r=t.pop(),n=t.pop(),s=t.pop();exports.DEBUG&&console.log(e.step,"ROLL[]"),t.push(n),t.push(r),t.push(s)},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"MAX[]",r,n),t.push(Math.max(n,r))},function(e){var t=e.stack,r=t.pop(),n=t.pop();exports.DEBUG&&console.log(e.step,"MIN[]",r,n),t.push(Math.min(n,r))},function(e){var t=e.stack.pop();exports.DEBUG&&console.log(e.step,"SCANTYPE[]",t)},function(e){var t=e.stack.pop(),r=e.stack.pop();switch(exports.DEBUG&&console.log(e.step,"INSTCTRL[]",t,r),t){case 1:return void(e.inhibitGridFit=!!r);case 2:return void(e.ignoreCvt=!!r);default:throw new Error("invalid INSTCTRL[] selector")}},void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,Qn.bind(void 0,1),Qn.bind(void 0,2),Qn.bind(void 0,3),Qn.bind(void 0,4),Qn.bind(void 0,5),Qn.bind(void 0,6),Qn.bind(void 0,7),Qn.bind(void 0,8),$n.bind(void 0,1),$n.bind(void 0,2),$n.bind(void 0,3),$n.bind(void 0,4),$n.bind(void 0,5),$n.bind(void 0,6),$n.bind(void 0,7),$n.bind(void 0,8),Jn.bind(void 0,0,0,0,0,0),Jn.bind(void 0,0,0,0,0,1),Jn.bind(void 0,0,0,0,0,2),Jn.bind(void 0,0,0,0,0,3),Jn.bind(void 0,0,0,0,1,0),Jn.bind(void 0,0,0,0,1,1),Jn.bind(void 0,0,0,0,1,2),Jn.bind(void 0,0,0,0,1,3),Jn.bind(void 0,0,0,1,0,0),Jn.bind(void 0,0,0,1,0,1),Jn.bind(void 0,0,0,1,0,2),Jn.bind(void 0,0,0,1,0,3),Jn.bind(void 0,0,0,1,1,0),Jn.bind(void 0,0,0,1,1,1),Jn.bind(void 0,0,0,1,1,2),Jn.bind(void 0,0,0,1,1,3),Jn.bind(void 0,0,1,0,0,0),Jn.bind(void 0,0,1,0,0,1),Jn.bind(void 0,0,1,0,0,2),Jn.bind(void 0,0,1,0,0,3),Jn.bind(void 0,0,1,0,1,0),Jn.bind(void 0,0,1,0,1,1),Jn.bind(void 0,0,1,0,1,2),Jn.bind(void 0,0,1,0,1,3),Jn.bind(void 0,0,1,1,0,0),Jn.bind(void 0,0,1,1,0,1),Jn.bind(void 0,0,1,1,0,2),Jn.bind(void 0,0,1,1,0,3),Jn.bind(void 0,0,1,1,1,0),Jn.bind(void 0,0,1,1,1,1),Jn.bind(void 0,0,1,1,1,2),Jn.bind(void 0,0,1,1,1,3),Jn.bind(void 0,1,0,0,0,0),Jn.bind(void 0,1,0,0,0,1),Jn.bind(void 0,1,0,0,0,2),Jn.bind(void 0,1,0,0,0,3),Jn.bind(void 0,1,0,0,1,0),Jn.bind(void 0,1,0,0,1,1),Jn.bind(void 0,1,0,0,1,2),Jn.bind(void 0,1,0,0,1,3),Jn.bind(void 0,1,0,1,0,0),Jn.bind(void 0,1,0,1,0,1),Jn.bind(void 0,1,0,1,0,2),Jn.bind(void 0,1,0,1,0,3),Jn.bind(void 0,1,0,1,1,0),Jn.bind(void 0,1,0,1,1,1),Jn.bind(void 0,1,0,1,1,2),Jn.bind(void 0,1,0,1,1,3),Jn.bind(void 0,1,1,0,0,0),Jn.bind(void 0,1,1,0,0,1),Jn.bind(void 0,1,1,0,0,2),Jn.bind(void 0,1,1,0,0,3),Jn.bind(void 0,1,1,0,1,0),Jn.bind(void 0,1,1,0,1,1),Jn.bind(void 0,1,1,0,1,2),Jn.bind(void 0,1,1,0,1,3),Jn.bind(void 0,1,1,1,0,0),Jn.bind(void 0,1,1,1,0,1),Jn.bind(void 0,1,1,1,0,2),Jn.bind(void 0,1,1,1,0,3),Jn.bind(void 0,1,1,1,1,0),Jn.bind(void 0,1,1,1,1,1),Jn.bind(void 0,1,1,1,1,2),Jn.bind(void 0,1,1,1,1,3)],es.prototype.setState=function(e,t){return this.state[e]=t,this.activeState={key:e,value:this.state[e]},this.activeState},es.prototype.getState=function(e){return this.state[e]||null},os.prototype.inboundIndex=function(e){return e>=0&&e<this.tokens.length},os.prototype.composeRUD=function(e){var t=this,r=e.map((function(e){return t[e[0]].apply(t,e.slice(1).concat(true))})),n=function(e){return"object"==typeof e&&e.hasOwnProperty("FAIL")};if(r.every(n))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:r.filter(n)};this.dispatch("composeRUD",[r.filter((function(e){return!n(e)}))])},os.prototype.replaceRange=function(e,t,r,n){t=null!==t?t:this.tokens.length;var s=r.every((function(e){return e instanceof es}));if(!isNaN(e)&&this.inboundIndex(e)&&s){var a=this.tokens.splice.apply(this.tokens,[e,t].concat(r));return n||this.dispatch("replaceToken",[e,t,r]),[a,r]}return{FAIL:"replaceRange: invalid tokens or startIndex."}},os.prototype.replaceToken=function(e,t,r){if(!isNaN(e)&&this.inboundIndex(e)&&t instanceof es){var n=this.tokens.splice(e,1,t);return r||this.dispatch("replaceToken",[e,t]),[n[0],t]}return{FAIL:"replaceToken: invalid token or index."}},os.prototype.removeRange=function(e,t,r){t=isNaN(t)?this.tokens.length:t;var n=this.tokens.splice(e,t);return r||this.dispatch("removeRange",[n,e,t]),n},os.prototype.removeToken=function(e,t){if(!isNaN(e)&&this.inboundIndex(e)){var r=this.tokens.splice(e,1);return t||this.dispatch("removeToken",[r,e]),r}return{FAIL:"removeToken: invalid token index."}},os.prototype.insertToken=function(e,t,r){return e.every((function(e){return e instanceof es}))?(this.tokens.splice.apply(this.tokens,[t,0].concat(e)),r||this.dispatch("insertToken",[e,t]),e):{FAIL:"insertToken: invalid token(s)."}},os.prototype.registerModifier=function(e,t,r){this.events.newToken.subscribe((function(n,s){var a=[n,s],o=[n,s];if(null===t||!0===t.apply(this,a)){var i=r.apply(this,o);n.setState(e,i)}})),this.registeredModifiers.push(e)},ss.prototype.subscribe=function(e){return"function"==typeof e?this.subscribers.push(e)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}},ss.prototype.unsubscribe=function(e){this.subscribers.splice(e,1)},ns.prototype.setCurrentIndex=function(e){this.index=e,this.current=this.context[e],this.backtrack=this.context.slice(0,e),this.lookahead=this.context.slice(e+1)},ns.prototype.get=function(e){switch(!0){case 0===e:return this.current;case e<0&&Math.abs(e)<=this.backtrack.length:return this.backtrack.slice(e)[0];case e>0&&e<=this.lookahead.length:return this.lookahead[e-1];default:return null}},os.prototype.rangeToText=function(e){if(e instanceof ts)return this.getRangeTokens(e).map((function(e){return e.char})).join("")},os.prototype.getText=function(){return this.tokens.map((function(e){return e.char})).join("")},os.prototype.getContext=function(e){var t=this.registeredContexts[e];return t||null},os.prototype.on=function(e,t){var r=this.events[e];return r?r.subscribe(t):null},os.prototype.dispatch=function(e,t){var r=this,n=this.events[e];n instanceof ss&&n.subscribers.forEach((function(e){e.apply(r,t||[])}))},os.prototype.registerContextChecker=function(e,t,r){if(this.getContext(e))return{FAIL:"context name '"+e+"' is already registered."};if("function"!=typeof t)return{FAIL:"missing context start check."};if("function"!=typeof r)return{FAIL:"missing context end check."};var n=new rs(e,t,r);return this.registeredContexts[e]=n,this.contextCheckers.push(n),n},os.prototype.getRangeTokens=function(e){var t=e.startIndex+e.endOffset;return[].concat(this.tokens.slice(e.startIndex,t))},os.prototype.getContextRanges=function(e){var t=this.getContext(e);return t?t.ranges:{FAIL:"context checker '"+e+"' is not registered."}},os.prototype.resetContextsRanges=function(){var e=this.registeredContexts;for(var t in e){if(e.hasOwnProperty(t))e[t].ranges=[]}},os.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var e=this.tokens.map((function(e){return e.char})),t=0;t<e.length;t++){var r=new ns(e,t);this.runContextCheck(r)}this.dispatch("updateContextsRanges",[this.registeredContexts])},os.prototype.setEndOffset=function(e,t){var r=new ts(this.getContext(t).openRange.startIndex,e,t),n=this.getContext(t).ranges;return r.rangeId=t+"."+n.length,n.push(r),this.getContext(t).openRange=null,r},os.prototype.runContextCheck=function(e){var t=this,r=e.index;this.contextCheckers.forEach((function(n){var s=n.contextName,a=t.getContext(s).openRange;if(!a&&n.checkStart(e)&&(a=new ts(r,null,s),t.getContext(s).openRange=a,t.dispatch("contextStart",[s,r])),a&&n.checkEnd(e)){var o=r-a.startIndex+1,i=t.setEndOffset(o,s);t.dispatch("contextEnd",[s,i])}}))},os.prototype.tokenize=function(e){this.tokens=[],this.resetContextsRanges();var t=Array.from(e);this.dispatch("start");for(var r=0;r<t.length;r++){var n=t[r],s=new ns(t,r);this.dispatch("next",[s]),this.runContextCheck(s);var a=new es(n);this.tokens.push(a),this.dispatch("newToken",[a,s])}return this.dispatch("end",[this.tokens]),this.tokens},hs.prototype.getDefaultScriptFeaturesIndexes=function(){for(var e=this.font.tables.gsub.scripts,t=0;t<e.length;t++){var r=e[t];if("DFLT"===r.tag)return r.script.defaultLangSys.featureIndexes}return[]},hs.prototype.getScriptFeaturesIndexes=function(e){if(!this.font.tables.gsub)return[];if(!e)return this.getDefaultScriptFeaturesIndexes();for(var t=this.font.tables.gsub.scripts,r=0;r<t.length;r++){var n=t[r];if(n.tag===e&&n.script.defaultLangSys)return n.script.defaultLangSys.featureIndexes;var s=n.langSysRecords;if(s)for(var a=0;a<s.length;a++){var o=s[a];if(o.tag===e)return o.langSys.featureIndexes}}return this.getDefaultScriptFeaturesIndexes()},hs.prototype.mapTagsToFeatures=function(e,t){for(var r={},n=0;n<e.length;n++){var s=e[n].tag,a=e[n].feature;r[s]=a}this.features[t].tags=r},hs.prototype.getScriptFeatures=function(e){var t=this.features[e];if(this.features.hasOwnProperty(e))return t;var r=this.getScriptFeaturesIndexes(e);if(!r)return null;var n=this.font.tables.gsub;return t=r.map((function(e){return n.features[e]})),this.features[e]=t,this.mapTagsToFeatures(t,e),t},hs.prototype.getSubstitutionType=function(e,t){return e.lookupType.toString()+t.substFormat.toString()},hs.prototype.getLookupMethod=function(e,t){var r=this;switch(this.getSubstitutionType(e,t)){case"11":return function(e){return fs.apply(r,[e,t])};case"12":return function(e){return gs.apply(r,[e,t])};case"63":return function(e){return vs.apply(r,[e,t])};case"41":return function(e){return ys.apply(r,[e,t])};case"21":return function(e){return bs.apply(r,[e,t])};default:throw new Error("lookupType: "+e.lookupType+" - substFormat: "+t.substFormat+" is not yet supported")}},hs.prototype.lookupFeature=function(e){var t=e.contextParams,r=t.index,n=this.getFeature({tag:e.tag,script:e.script});if(!n)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+e.tag+"' for script '"+e.script+"'.");for(var s=this.getFeatureLookups(n),a=[].concat(t.context),o=0;o<s.length;o++)for(var i=s[o],c=this.getLookupSubtables(i),l=0;l<c.length;l++){var u=c[l],h=this.getSubstitutionType(i,u),p=this.getLookupMethod(i,u),d=void 0;switch(h){case"11":(d=p(t.current))&&a.splice(r,1,new ps({id:11,tag:e.tag,substitution:d}));break;case"12":(d=p(t.current))&&a.splice(r,1,new ps({id:12,tag:e.tag,substitution:d}));break;case"63":d=p(t),Array.isArray(d)&&d.length&&a.splice(r,1,new ps({id:63,tag:e.tag,substitution:d}));break;case"41":(d=p(t))&&a.splice(r,1,new ps({id:41,tag:e.tag,substitution:d}));break;case"21":(d=p(t.current))&&a.splice(r,1,new ps({id:21,tag:e.tag,substitution:d}))}t=new ns(a,r),Array.isArray(d)&&!d.length||(d=null)}return a.length?a:null},hs.prototype.supports=function(e){if(!e.script)return!1;this.getScriptFeatures(e.script);var t=this.features.hasOwnProperty(e.script);if(!e.tag)return t;var r=this.features[e.script].some((function(t){return t.tag===e.tag}));return t&&r},hs.prototype.getLookupSubtables=function(e){return e.subtables||null},hs.prototype.getLookupByIndex=function(e){return this.font.tables.gsub.lookups[e]||null},hs.prototype.getFeatureLookups=function(e){return e.lookupListIndexes.map(this.getLookupByIndex.bind(this))},hs.prototype.getFeature=function(e){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(e.script)||this.getScriptFeatures(e.script);var t=this.features[e.script];return t?t.tags[e.tag]?this.features[e.script].tags[e.tag]:null:{FAIL:"No feature for script "+e.script}};var xs={startCheck:function(e){var t=e.current,r=e.get(-1);return null===r&&is(t)||!is(r)&&is(t)},endCheck:function(e){var t=e.get(1);return null===t||!is(t)}};var ws={startCheck:function(e){var t=e.current,r=e.get(-1);return(is(t)||ls(t))&&!is(r)},endCheck:function(e){var t=e.get(1);switch(!0){case null===t:return!0;case!is(t)&&!ls(t):var r=/\s/.test(t);if(!r)return!0;if(r){if(!e.lookahead.some((function(e){return is(e)||ls(e)})))return!0}break;default:return!1}}};var Ss={11:function(e,t,r){t[r].setState(e.tag,e.substitution)},12:function(e,t,r){t[r].setState(e.tag,e.substitution)},63:function(e,t,r){e.substitution.forEach((function(n,s){t[r+s].setState(e.tag,n)}))},41:function(e,t,r){var n=t[r];n.setState(e.tag,e.substitution.ligGlyph);for(var s=e.substitution.components.length,a=0;a<s;a++)(n=t[r+a+1]).setState("deleted",!0)}};function Ts(e,t,r){e instanceof ps&&Ss[e.id]&&Ss[e.id](e,t,r)}function Fs(e){var t=this,r="arab",n=this.featuresTags.arab,s=this.tokenizer.getRangeTokens(e);if(1!==s.length){var a=new ns(s.map((function(e){return e.getState("glyphIndex")})),0),o=new ns(s.map((function(e){return e.char})),0);s.forEach((function(e,i){if(!ls(e.char)){a.setCurrentIndex(i),o.setCurrentIndex(i);var c,l=0;switch(function(e){for(var t=[].concat(e.backtrack),r=t.length-1;r>=0;r--){var n=t[r],s=cs(n),a=ls(n);if(!s&&!a)return!0;if(s)return!1}return!1}(o)&&(l|=1),function(e){if(cs(e.current))return!1;for(var t=0;t<e.lookahead.length;t++)if(!ls(e.lookahead[t]))return!0;return!1}(o)&&(l|=2),l){case 1:c="fina";break;case 2:c="init";break;case 3:c="medi"}if(-1!==n.indexOf(c)){var u=t.query.lookupFeature({tag:c,script:r,contextParams:a});if(u instanceof Error)return console.info(u.message);u.forEach((function(e,t){e instanceof ps&&(Ts(e,s,t),a.context[t]=e.substitution)}))}}}))}}function ks(e,t){return new ns(e.map((function(e){return e.activeState.value})),t||0)}function Es(e){var t=this,r=this.tokenizer.getRangeTokens(e),n=ks(r);n.context.forEach((function(e,s){n.setCurrentIndex(s);var a=t.query.lookupFeature({tag:"rlig",script:"arab",contextParams:n});a.length&&(a.forEach((function(e){return Ts(e,r,s)})),n=ks(r))}))}var As={startCheck:function(e){var t=e.current,r=e.get(-1);return null===r&&us(t)||!us(r)&&us(t)},endCheck:function(e){var t=e.get(1);return null===t||!us(t)}};function Is(e,t){return new ns(e.map((function(e){return e.activeState.value})),t||0)}function Ms(e){var t=this,r=this.tokenizer.getRangeTokens(e),n=Is(r);n.context.forEach((function(e,s){n.setCurrentIndex(s);var a=t.query.lookupFeature({tag:"liga",script:"latn",contextParams:n});a.length&&(a.forEach((function(e){return Ts(e,r,s)})),n=Is(r))}))}function Ls(e){this.baseDir=e||"ltr",this.tokenizer=new os,this.featuresTags={}}function Cs(e){var t=this.contextChecks[e+"Check"];return this.tokenizer.registerContextChecker(e,t.startCheck,t.endCheck)}function Rs(){return Cs.call(this,"latinWord"),Cs.call(this,"arabicWord"),Cs.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function Os(){var e=this;this.tokenizer.getContextRanges("arabicSentence").forEach((function(t){var r=e.tokenizer.getRangeTokens(t);e.tokenizer.replaceRange(t.startIndex,t.endOffset,r.reverse())}))}function Ns(){if(-1===this.tokenizer.registeredModifiers.indexOf("glyphIndex"))throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function Us(){var e=this;this.featuresTags.hasOwnProperty("arab")&&(Ns.call(this),this.tokenizer.getContextRanges("arabicWord").forEach((function(t){Fs.call(e,t)})))}function Ds(){var e=this,t="arab";this.featuresTags.hasOwnProperty(t)&&(-1!==this.featuresTags.arab.indexOf("rlig")&&(Ns.call(this),this.tokenizer.getContextRanges("arabicWord").forEach((function(t){Es.call(e,t)}))))}function Ps(){var e=this,t="latn";this.featuresTags.hasOwnProperty(t)&&(-1!==this.featuresTags.latn.indexOf("liga")&&(Ns.call(this),this.tokenizer.getContextRanges("latinWord").forEach((function(t){Ms.call(e,t)}))))}function Bs(e){(e=e||{}).tables=e.tables||{},e.empty||(rn(e.familyName,"When creating a new Font object, familyName is required."),rn(e.styleName,"When creating a new Font object, styleName is required."),rn(e.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),rn(e.ascender,"When creating a new Font object, ascender is required."),rn(e.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:e.familyName||" "},fontSubfamily:{en:e.styleName||" "},fullName:{en:e.fullName||e.familyName+" "+e.styleName},postScriptName:{en:e.postScriptName||(e.familyName+e.styleName).replace(/\s/g,"")},designer:{en:e.designer||" "},designerURL:{en:e.designerURL||" "},manufacturer:{en:e.manufacturer||" "},manufacturerURL:{en:e.manufacturerURL||" "},license:{en:e.license||" "},licenseURL:{en:e.licenseURL||" "},version:{en:e.version||"Version 0.1"},description:{en:e.description||" "},copyright:{en:e.copyright||" "},trademark:{en:e.trademark||" "}},this.unitsPerEm=e.unitsPerEm||1e3,this.ascender=e.ascender,this.descender=e.descender,this.createdTimestamp=e.createdTimestamp,this.tables=Object.assign(e.tables,{os2:Object.assign({usWeightClass:e.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:e.widthClass||this.usWidthClasses.MEDIUM,fsSelection:e.fsSelection||this.fsSelectionValues.REGULAR},e.tables.os2)})),this.supported=!0,this.glyphs=new Kt.GlyphSet(this,e.glyphs||[]),this.encoding=new _t(this),this.position=new Qr(this),this.substitution=new $r(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){return this._hinting?this._hinting:"truetype"===this.outlinesFormat?this._hinting=new fn(this):void 0}})}function Gs(e,t){var r=JSON.stringify(e),n=256;for(var s in t){var a=parseInt(s);if(a&&!(a<256)){if(JSON.stringify(t[s])===r)return a;n<=a&&(n=a+1)}}return t[n]=e,n}function _s(e,t,r){var n=Gs(t.name,r);return[{name:"tag_"+e,type:"TAG",value:t.tag},{name:"minValue_"+e,type:"FIXED",value:t.minValue<<16},{name:"defaultValue_"+e,type:"FIXED",value:t.defaultValue<<16},{name:"maxValue_"+e,type:"FIXED",value:t.maxValue<<16},{name:"flags_"+e,type:"USHORT",value:0},{name:"nameID_"+e,type:"USHORT",value:n}]}function Hs(e,t,r){var n={},s=new Ot.Parser(e,t);return n.tag=s.parseTag(),n.minValue=s.parseFixed(),n.defaultValue=s.parseFixed(),n.maxValue=s.parseFixed(),s.skip("uShort",1),n.name=r[s.parseUShort()]||{},n}function Vs(e,t,r,n){for(var s=[{name:"nameID_"+e,type:"USHORT",value:Gs(t.name,n)},{name:"flags_"+e,type:"USHORT",value:0}],a=0;a<r.length;++a){var o=r[a].tag;s.push({name:"axis_"+e+" "+o,type:"FIXED",value:t.coordinates[o]<<16})}return s}function zs(e,t,r,n){var s={},a=new Ot.Parser(e,t);s.name=n[a.parseUShort()]||{},a.skip("uShort",1),s.coordinates={};for(var o=0;o<r.length;++o)s.coordinates[r[o].tag]=a.parseFixed();return s}Ls.prototype.setText=function(e){this.text=e},Ls.prototype.contextChecks={latinWordCheck:As,arabicWordCheck:xs,arabicSentenceCheck:ws},Ls.prototype.registerFeatures=function(e,t){var r=this,n=t.filter((function(t){return r.query.supports({script:e,tag:t})}));this.featuresTags.hasOwnProperty(e)?this.featuresTags[e]=this.featuresTags[e].concat(n):this.featuresTags[e]=n},Ls.prototype.applyFeatures=function(e,t){if(!e)throw new Error("No valid font was provided to apply features");this.query||(this.query=new hs(e));for(var r=0;r<t.length;r++){var n=t[r];this.query.supports({script:n.script})&&this.registerFeatures(n.script,n.tags)}},Ls.prototype.registerModifier=function(e,t,r){this.tokenizer.registerModifier(e,t,r)},Ls.prototype.checkContextReady=function(e){return!!this.tokenizer.getContext(e)},Ls.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(Us.call(this),Ds.call(this)),this.checkContextReady("latinWord")&&Ps.call(this),this.checkContextReady("arabicSentence")&&Os.call(this)},Ls.prototype.processText=function(e){this.text&&this.text===e||(this.setText(e),Rs.call(this),this.applyFeaturesToContexts())},Ls.prototype.getBidiText=function(e){return this.processText(e),this.tokenizer.getText()},Ls.prototype.getTextGlyphs=function(e){this.processText(e);for(var t=[],r=0;r<this.tokenizer.tokens.length;r++){var n=this.tokenizer.tokens[r];if(!n.state.deleted){var s=n.activeState.value;t.push(Array.isArray(s)?s[0]:s)}}return t},Bs.prototype.hasChar=function(e){return null!==this.encoding.charToGlyphIndex(e)},Bs.prototype.charToGlyphIndex=function(e){return this.encoding.charToGlyphIndex(e)},Bs.prototype.charToGlyph=function(e){var t=this.charToGlyphIndex(e),r=this.glyphs.get(t);return r||(r=this.glyphs.get(0)),r},Bs.prototype.updateFeatures=function(e){return this.defaultRenderOptions.features.map((function(t){return"latn"===t.script?{script:"latn",tags:t.tags.filter((function(t){return e[t]}))}:t}))},Bs.prototype.stringToGlyphs=function(e,t){var r=this,n=new Ls;n.registerModifier("glyphIndex",null,(function(e){return r.charToGlyphIndex(e.char)}));var s=t?this.updateFeatures(t.features):this.defaultRenderOptions.features;n.applyFeatures(this,s);for(var a=n.getTextGlyphs(e),o=a.length,i=new Array(o),c=this.glyphs.get(0),l=0;l<o;l+=1)i[l]=this.glyphs.get(a[l])||c;return i},Bs.prototype.nameToGlyphIndex=function(e){return this.glyphNames.nameToGlyphIndex(e)},Bs.prototype.nameToGlyph=function(e){var t=this.nameToGlyphIndex(e),r=this.glyphs.get(t);return r||(r=this.glyphs.get(0)),r},Bs.prototype.glyphIndexToName=function(e){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(e):""},Bs.prototype.getKerningValue=function(e,t){e=e.index||e,t=t.index||t;var r=this.position.defaultKerningTables;return r?this.position.getKerningValue(r,e,t):this.kerningPairs[e+","+t]||0},Bs.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]},Bs.prototype.forEachGlyph=function(e,t,r,n,s,a){t=void 0!==t?t:0,r=void 0!==r?r:0,n=void 0!==n?n:72,s=Object.assign({},this.defaultRenderOptions,s);var o,i=1/this.unitsPerEm*n,c=this.stringToGlyphs(e,s);if(s.kerning){var l=s.script||this.position.getDefaultScriptName();o=this.position.getKerningTables(l,s.language)}for(var u=0;u<c.length;u+=1){var h=c[u];if(a.call(this,h,t,r,n,s),h.advanceWidth&&(t+=h.advanceWidth*i),s.kerning&&u<c.length-1)t+=(o?this.position.getKerningValue(o,h.index,c[u+1].index):this.getKerningValue(h,c[u+1]))*i;s.letterSpacing?t+=s.letterSpacing*n:s.tracking&&(t+=s.tracking/1e3*n)}return t},Bs.prototype.getPath=function(e,t,r,n,s){var a=new tt;return this.forEachGlyph(e,t,r,n,s,(function(e,t,r,n){var o=e.getPath(t,r,n,s,this);a.extend(o)})),a},Bs.prototype.getPaths=function(e,t,r,n,s){var a=[];return this.forEachGlyph(e,t,r,n,s,(function(e,t,r,n){var o=e.getPath(t,r,n,s,this);a.push(o)})),a},Bs.prototype.getAdvanceWidth=function(e,t,r){return this.forEachGlyph(e,0,0,t,r,(function(){}))},Bs.prototype.draw=function(e,t,r,n,s,a){this.getPath(t,r,n,s,a).draw(e)},Bs.prototype.drawPoints=function(e,t,r,n,s,a){this.forEachGlyph(t,r,n,s,a,(function(t,r,n,s){t.drawPoints(e,r,n,s)}))},Bs.prototype.drawMetrics=function(e,t,r,n,s,a){this.forEachGlyph(t,r,n,s,a,(function(t,r,n,s){t.drawMetrics(e,r,n,s)}))},Bs.prototype.getEnglishName=function(e){var t=this.names[e];if(t)return t.en},Bs.prototype.validate=function(){var e=this;function t(t){var r=e.getEnglishName(t);r&&r.trim().length}t("fontFamily"),t("weightName"),t("manufacturer"),t("copyright"),t("version"),this.unitsPerEm},Bs.prototype.toTables=function(){return Xr.fontToTable(this)},Bs.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()},Bs.prototype.toArrayBuffer=function(){for(var e=this.toTables().encode(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e[n];return t},Bs.prototype.download=function(e){var t=this.getEnglishName("fontFamily"),r=this.getEnglishName("fontSubfamily");e=e||t.replace(/\s/g,"")+"-"+r+".otf";var n=this.toArrayBuffer();if("undefined"!=typeof window)if(window.URL=window.URL||window.webkitURL,window.URL){var s=new DataView(n),a=new Blob([s],{type:"font/opentype"}),o=document.createElement("a");o.href=window.URL.createObjectURL(a),o.download=e;var i=document.createEvent("MouseEvents");i.initEvent("click",!0,!1),o.dispatchEvent(i)}else console.warn("Font file could not be downloaded. Try using a different browser.");else{var c=require("fs"),l=function(e){for(var t=new Buffer(e.byteLength),r=new Uint8Array(e),n=0;n<t.length;++n)t[n]=r[n];return t}(n);c.writeFileSync(e,l)}},Bs.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512},Bs.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9},Bs.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};var js={make:function(e,t){var r=new kt.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:e.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:e.instances.length},{name:"instanceSize",type:"USHORT",value:4+4*e.axes.length}]);r.offsetToData=r.sizeOf();for(var n=0;n<e.axes.length;n++)r.fields=r.fields.concat(_s(n,e.axes[n],t));for(var s=0;s<e.instances.length;s++)r.fields=r.fields.concat(Vs(s,e.instances[s],e.axes,t));return r},parse:function(e,t,r){var n=new Ot.Parser(e,t),s=n.parseULong();st.argument(65536===s,"Unsupported fvar table version.");var a=n.parseOffset16();n.skip("uShort",1);for(var o=n.parseUShort(),i=n.parseUShort(),c=n.parseUShort(),l=n.parseUShort(),u=[],h=0;h<o;h++)u.push(Hs(e,t+a+h*i,r));for(var p=[],d=t+a+o*i,f=0;f<c;f++)p.push(zs(e,d+f*l,u,r));return{axes:u,instances:p}}},Ws=new Array(10);Ws[1]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();return 1===t?{posFormat:1,coverage:this.parsePointer(Ct.coverage),value:this.parseValueRecord()}:2===t?{posFormat:2,coverage:this.parsePointer(Ct.coverage),values:this.parseValueRecordList()}:void st.assert(!1,"0x"+e.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")},Ws[2]=function(){var e=this.offset+this.relativeOffset,t=this.parseUShort();st.assert(1===t||2===t,"0x"+e.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var r=this.parsePointer(Ct.coverage),n=this.parseUShort(),s=this.parseUShort();if(1===t)return{posFormat:t,coverage:r,valueFormat1:n,valueFormat2:s,pairSets:this.parseList(Ct.pointer(Ct.list((function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(n),value2:this.parseValueRecord(s)}}))))};if(2===t){var a=this.parsePointer(Ct.classDef),o=this.parsePointer(Ct.classDef),i=this.parseUShort(),c=this.parseUShort();return{posFormat:t,coverage:r,valueFormat1:n,valueFormat2:s,classDef1:a,classDef2:o,class1Count:i,class2Count:c,classRecords:this.parseList(i,Ct.list(c,(function(){return{value1:this.parseValueRecord(n),value2:this.parseValueRecord(s)}})))}}},Ws[3]=function(){return{error:"GPOS Lookup 3 not supported"}},Ws[4]=function(){return{error:"GPOS Lookup 4 not supported"}},Ws[5]=function(){return{error:"GPOS Lookup 5 not supported"}},Ws[6]=function(){return{error:"GPOS Lookup 6 not supported"}},Ws[7]=function(){return{error:"GPOS Lookup 7 not supported"}},Ws[8]=function(){return{error:"GPOS Lookup 8 not supported"}},Ws[9]=function(){return{error:"GPOS Lookup 9 not supported"}};var Xs=new Array(10);var qs={parse:function(e,t){var r=new Ct(e,t=t||0),n=r.parseVersion(1);return st.argument(1===n||1.1===n,"Unsupported GPOS table version "+n),1===n?{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Ws)}:{version:n,scripts:r.parseScriptList(),features:r.parseFeatureList(),lookups:r.parseLookupList(Ws),variations:r.parseFeatureVariationsList()}},make:function(e){return new kt.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new kt.ScriptList(e.scripts)},{name:"features",type:"TABLE",value:new kt.FeatureList(e.features)},{name:"lookups",type:"TABLE",value:new kt.LookupList(e.lookups,Xs)}])}};var Ys={parse:function(e,t){var r=new Ot.Parser(e,t),n=r.parseUShort();if(0===n)return function(e){var t={};e.skip("uShort");var r=e.parseUShort();st.argument(0===r,"Unsupported kern sub-table version."),e.skip("uShort",2);var n=e.parseUShort();e.skip("uShort",3);for(var s=0;s<n;s+=1){var a=e.parseUShort(),o=e.parseUShort(),i=e.parseShort();t[a+","+o]=i}return t}(r);if(1===n)return function(e){var t={};e.skip("uShort"),e.parseULong()>1&&console.warn("Only the first kern subtable is supported."),e.skip("uLong");var r=255&e.parseUShort();if(e.skip("uShort"),0===r){var n=e.parseUShort();e.skip("uShort",3);for(var s=0;s<n;s+=1){var a=e.parseUShort(),o=e.parseUShort(),i=e.parseShort();t[a+","+o]=i}}return t}(r);throw new Error("Unsupported kern table version ("+n+").")}};var Ks={parse:function(e,t,r,n){for(var s=new Ot.Parser(e,t),a=n?s.parseUShort:s.parseULong,o=[],i=0;i<r+1;i+=1){var c=a.call(s);n&&(c*=2),o.push(c)}return o}};function Zs(e,t){require("fs").readFile(e,(function(e,r){if(e)return t(e.message);t(null,tn(r))}))}function Qs(e,t){var r=new XMLHttpRequest;r.open("get",e,!0),r.responseType="arraybuffer",r.onload=function(){return r.response?t(null,r.response):t("Font could not be loaded: "+r.statusText)},r.onerror=function(){t("Font could not be loaded")},r.send()}function $s(e,t){for(var r=[],n=12,s=0;s<t;s+=1){var a=Ot.getTag(e,n),o=Ot.getULong(e,n+4),i=Ot.getULong(e,n+8),c=Ot.getULong(e,n+12);r.push({tag:a,checksum:o,offset:i,length:c,compression:!1}),n+=16}return r}function Js(e,t){if("WOFF"===t.compression){var r=new Uint8Array(e.buffer,t.offset+2,t.compressedLength-2),n=new Uint8Array(t.length);if($e(r,n),n.byteLength!==t.length)throw new Error("Decompression error: "+t.tag+" decompressed length doesn't match recorded length");return{data:new DataView(n.buffer,0),offset:0}}return{data:e,offset:t.offset}}function ea(e,t){var r,n;t=null==t?{}:t;var s,a,o,i,c,l,u,h,p,d,f,g,m=new Bs({empty:!0}),v=new DataView(e,0),y=[],b=Ot.getTag(v,0);if(b===String.fromCharCode(0,1,0,0)||"true"===b||"typ1"===b)m.outlinesFormat="truetype",y=$s(v,s=Ot.getUShort(v,4));else if("OTTO"===b)m.outlinesFormat="cff",y=$s(v,s=Ot.getUShort(v,4));else{if("wOFF"!==b)throw new Error("Unsupported OpenType signature "+b);var x=Ot.getTag(v,4);if(x===String.fromCharCode(0,1,0,0))m.outlinesFormat="truetype";else{if("OTTO"!==x)throw new Error("Unsupported OpenType flavor "+b);m.outlinesFormat="cff"}y=function(e,t){for(var r=[],n=44,s=0;s<t;s+=1){var a=Ot.getTag(e,n),o=Ot.getULong(e,n+4),i=Ot.getULong(e,n+8),c=Ot.getULong(e,n+12),l=void 0;l=i<c&&"WOFF",r.push({tag:a,offset:o,compression:l,compressedLength:i,length:c}),n+=20}return r}(v,s=Ot.getUShort(v,12))}for(var w=0;w<s;w+=1){var S=y[w],T=void 0;switch(S.tag){case"cmap":T=Js(v,S),m.tables.cmap=Ut.parse(T.data,T.offset),m.encoding=new Ht(m.tables.cmap);break;case"cvt ":T=Js(v,S),g=new Ot.Parser(T.data,T.offset),m.tables.cvt=g.parseShortList(S.length/2);break;case"fvar":o=S;break;case"fpgm":T=Js(v,S),g=new Ot.Parser(T.data,T.offset),m.tables.fpgm=g.parseByteList(S.length);break;case"head":T=Js(v,S),m.tables.head=gr.parse(T.data,T.offset),m.unitsPerEm=m.tables.head.unitsPerEm,r=m.tables.head.indexToLocFormat;break;case"hhea":T=Js(v,S),m.tables.hhea=mr.parse(T.data,T.offset),m.ascender=m.tables.hhea.ascender,m.descender=m.tables.hhea.descender,m.numberOfHMetrics=m.tables.hhea.numberOfHMetrics;break;case"hmtx":u=S;break;case"ltag":T=Js(v,S),n=yr.parse(T.data,T.offset);break;case"maxp":T=Js(v,S),m.tables.maxp=br.parse(T.data,T.offset),m.numGlyphs=m.tables.maxp.numGlyphs;break;case"name":d=S;break;case"OS/2":T=Js(v,S),m.tables.os2=Or.parse(T.data,T.offset);break;case"post":T=Js(v,S),m.tables.post=Nr.parse(T.data,T.offset),m.glyphNames=new zt(m.tables.post);break;case"prep":T=Js(v,S),g=new Ot.Parser(T.data,T.offset),m.tables.prep=g.parseByteList(S.length);break;case"glyf":i=S;break;case"loca":p=S;break;case"CFF ":a=S;break;case"kern":h=S;break;case"GPOS":c=S;break;case"GSUB":l=S;break;case"meta":f=S}}var F=Js(v,d);if(m.tables.name=Cr.parse(F.data,F.offset,n),m.names=m.tables.name,i&&p){var k=0===r,E=Js(v,p),A=Ks.parse(E.data,E.offset,m.numGlyphs,k),I=Js(v,i);m.glyphs=dn.parse(I.data,I.offset,A,m,t)}else{if(!a)throw new Error("Font doesn't contain TrueType or CFF outlines.");var M=Js(v,a);fr.parse(M.data,M.offset,m,t)}var L=Js(v,u);if(vr.parse(m,L.data,L.offset,m.numberOfHMetrics,m.numGlyphs,m.glyphs,t),jt(m,t),h){var C=Js(v,h);m.kerningPairs=Ys.parse(C.data,C.offset)}else m.kerningPairs={};if(c){var R=Js(v,c);m.tables.gpos=qs.parse(R.data,R.offset),m.position.init()}if(l){var O=Js(v,l);m.tables.gsub=Br.parse(O.data,O.offset)}if(o){var N=Js(v,o);m.tables.fvar=js.parse(N.data,N.offset,m.names)}if(f){var U=Js(v,f);m.tables.meta=Gr.parse(U.data,U.offset),m.metas=m.tables.meta}return m}var ta=Object.freeze({__proto__:null,Font:Bs,Glyph:Xt,Path:tt,BoundingBox:et,_parse:Ot,parse:ea,load:function(e,t,r){var n="undefined"==typeof window?Zs:Qs;return new Promise((function(s,a){n(e,(function(e,n){if(e){if(t)return t(e);a(e)}var o;try{o=ea(n,r)}catch(e){if(t)return t(e,null);a(e)}if(t)return t(null,o);s(o)}))}))},loadSync:function(e,t){return ea(tn(require("fs").readFileSync(e)),t)}});class ra extends e.Loader{constructor(e){super(e),this.reversed=!1}load(t,r,n,s){const a=this,o=new e.FileLoader(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(e){try{r(a.parse(e))}catch(e){s?s(e):console.error(e),a.manager.itemError(t)}}),n,s)}parse(e){function t(e){const t=[];let r;e.forEach((function(e){"m"===e.type.toLowerCase()?(r=[e],t.push(r)):"z"!==e.type.toLowerCase()&&r.push(e)}));const n=[];return t.forEach((function(e){const t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};n.push(t);for(let t=e.length-1;t>0;t--){const r=e[t],s={type:r.type};void 0!==r.x2&&void 0!==r.y2?(s.x1=r.x2,s.y1=r.y2,s.x2=r.x1,s.y2=r.y1):void 0!==r.x1&&void 0!==r.y1&&(s.x1=r.x1,s.y1=r.y1),s.x=e[t-1].x,s.y=e[t-1].y,n.push(s)}})),n}return void 0===ta?(console.warn("THREE.TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(e,r){const n=Math.round,s={},a=1e5/(72*(e.unitsPerEm||2048)),o=e.encoding.cmap.glyphIndexMap,i=Object.keys(o);for(let c=0;c<i.length;c++){const l=i[c],u=e.glyphs.glyphs[o[l]];if(void 0!==l){const e={ha:n(u.advanceWidth*a),x_min:n(u.xMin*a),x_max:n(u.xMax*a),o:""};r&&(u.path.commands=t(u.path.commands)),u.path.commands.forEach((function(t){"c"===t.type.toLowerCase()&&(t.type="b"),e.o+=t.type.toLowerCase()+" ",void 0!==t.x&&void 0!==t.y&&(e.o+=n(t.x*a)+" "+n(t.y*a)+" "),void 0!==t.x1&&void 0!==t.y1&&(e.o+=n(t.x1*a)+" "+n(t.y1*a)+" "),void 0!==t.x2&&void 0!==t.y2&&(e.o+=n(t.x2*a)+" "+n(t.y2*a)+" ")})),s[String.fromCodePoint(u.unicode)]=e}}return{glyphs:s,familyName:e.getEnglishName("fullName"),ascender:n(e.ascender*a),descender:n(e.descender*a),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(ta.parse(e),this.reversed)}}class na extends e.Loader{constructor(e){super(e),this.animateBonePositions=!0,this.animateBoneRotations=!0}load(t,r,n,s){const a=this,o=new e.FileLoader(a.manager);o.setPath(a.path),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(t,(function(e){try{r(a.parse(e))}catch(e){s?s(e):console.error(e),a.manager.itemError(t)}}),n,s)}parse(t){function r(t,n,s){if("ENDSITE"===s.type)return;const a={time:n,position:new e.Vector3,rotation:new e.Quaternion};s.frames.push(a);const o=new e.Quaternion,i=new e.Vector3(1,0,0),c=new e.Vector3(0,1,0),l=new e.Vector3(0,0,1);for(let e=0;e<s.channels.length;e++)switch(s.channels[e]){case"Xposition":a.position.x=parseFloat(t.shift().trim());break;case"Yposition":a.position.y=parseFloat(t.shift().trim());break;case"Zposition":a.position.z=parseFloat(t.shift().trim());break;case"Xrotation":o.setFromAxisAngle(i,parseFloat(t.shift().trim())*Math.PI/180),a.rotation.multiply(o);break;case"Yrotation":o.setFromAxisAngle(c,parseFloat(t.shift().trim())*Math.PI/180),a.rotation.multiply(o);break;case"Zrotation":o.setFromAxisAngle(l,parseFloat(t.shift().trim())*Math.PI/180),a.rotation.multiply(o);break;default:console.warn("THREE.BVHLoader: Invalid channel type.")}for(let e=0;e<s.children.length;e++)r(t,n,s.children[e])}function n(t,r,a){const o={name:"",type:"",frames:[]};a.push(o);let i=r.split(/[\s]+/);"END"===i[0].toUpperCase()&&"SITE"===i[1].toUpperCase()?(o.type="ENDSITE",o.name="ENDSITE"):(o.name=i[1],o.type=i[0].toUpperCase()),"{"!==s(t)&&console.error("THREE.BVHLoader: Expected opening { after type & name"),i=s(t).split(/[\s]+/),"OFFSET"!==i[0]&&console.error("THREE.BVHLoader: Expected OFFSET but got: "+i[0]),4!==i.length&&console.error("THREE.BVHLoader: Invalid number of values for OFFSET.");const c=new e.Vector3(parseFloat(i[1]),parseFloat(i[2]),parseFloat(i[3]));if((isNaN(c.x)||isNaN(c.y)||isNaN(c.z))&&console.error("THREE.BVHLoader: Invalid values of OFFSET."),o.offset=c,"ENDSITE"!==o.type){i=s(t).split(/[\s]+/),"CHANNELS"!==i[0]&&console.error("THREE.BVHLoader: Expected CHANNELS definition.");const e=parseInt(i[1]);o.channels=i.splice(2,e),o.children=[]}for(;;){const e=s(t);if("}"===e)return o;o.children.push(n(t,e,a))}}function s(e){let t;for(;0===(t=e.shift().trim()).length;);return t}const a=this,o=function(e){"HIERARCHY"!==s(e)&&console.error("THREE.BVHLoader: HIERARCHY expected.");const t=[],a=n(e,s(e),t);"MOTION"!==s(e)&&console.error("THREE.BVHLoader: MOTION expected.");let o=s(e).split(/[\s]+/);const i=parseInt(o[1]);isNaN(i)&&console.error("THREE.BVHLoader: Failed to read number of frames."),o=s(e).split(/[\s]+/);const c=parseFloat(o[2]);isNaN(c)&&console.error("THREE.BVHLoader: Failed to read frame time.");for(let t=0;t<i;t++)o=s(e).split(/[\s]+/),r(o,t*c,a);return t}(t.split(/[\r\n]+/g)),i=[];!function t(r,n){const s=new e.Bone;if(n.push(s),s.position.add(r.offset),s.name=r.name,"ENDSITE"!==r.type)for(let e=0;e<r.children.length;e++)s.add(t(r.children[e],n));return s}(o[0],i);const c=function(t){const r=[];for(let n=0;n<t.length;n++){const s=t[n];if("ENDSITE"===s.type)continue;const o=[],i=[],c=[];for(let e=0;e<s.frames.length;e++){const t=s.frames[e];o.push(t.time),i.push(t.position.x+s.offset.x),i.push(t.position.y+s.offset.y),i.push(t.position.z+s.offset.z),c.push(t.rotation.x),c.push(t.rotation.y),c.push(t.rotation.z),c.push(t.rotation.w)}a.animateBonePositions&&r.push(new e.VectorKeyframeTrack(".bones["+s.name+"].position",o,i)),a.animateBoneRotations&&r.push(new e.QuaternionKeyframeTrack(".bones["+s.name+"].quaternion",o,c))}return new e.AnimationClip("animation",-1,r)}(o);return{skeleton:new e.Skeleton(i),clip:c}}}function sa(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}return r}var aa={},oa=function(t){return e.$URL.createObjectURL(new e.$Blob([t],{type:"text/javascript"}))},ia=function(e){return new Worker(e)};try{e.$URL.revokeObjectURL(oa(""))}catch(e){oa=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},ia=function(e){return new Worker(e,{type:"module"})}}var ca=Uint8Array,la=Uint16Array,ua=Uint32Array,ha=new ca([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),pa=new ca([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),da=new ca([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),fa=function(e,t){for(var r=new la(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];var s=new ua(r[30]);for(n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)s[a]=a-r[n]<<5|n;return[r,s]},ga=fa(ha,2),ma=ga[0],va=ga[1];ma[28]=258,va[258]=28;for(var ya=fa(pa,0),ba=ya[0],xa=ya[1],wa=new la(32768),Sa=0;Sa<32768;++Sa){var Ta=(43690&Sa)>>>1|(21845&Sa)<<1;Ta=(61680&(Ta=(52428&Ta)>>>2|(13107&Ta)<<2))>>>4|(3855&Ta)<<4,wa[Sa]=((65280&Ta)>>>8|(255&Ta)<<8)>>>1}var Fa=function(e,t,r){for(var n=e.length,s=0,a=new la(t);s<n;++s)++a[e[s]-1];var o,i=new la(t);for(s=0;s<t;++s)i[s]=i[s-1]+a[s-1]<<1;if(r){o=new la(1<<t);var c=15-t;for(s=0;s<n;++s)if(e[s])for(var l=s<<4|e[s],u=t-e[s],h=i[e[s]-1]++<<u,p=h|(1<<u)-1;h<=p;++h)o[wa[h]>>>c]=l}else for(o=new la(n),s=0;s<n;++s)e[s]&&(o[s]=wa[i[e[s]-1]++]>>>15-e[s]);return o},ka=new ca(288);for(Sa=0;Sa<144;++Sa)ka[Sa]=8;for(Sa=144;Sa<256;++Sa)ka[Sa]=9;for(Sa=256;Sa<280;++Sa)ka[Sa]=7;for(Sa=280;Sa<288;++Sa)ka[Sa]=8;var Ea=new ca(32);for(Sa=0;Sa<32;++Sa)Ea[Sa]=5;var Aa=Fa(ka,9,0),Ia=Fa(ka,9,1),Ma=Fa(Ea,5,0),La=Fa(Ea,5,1),Ca=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},Ra=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},Oa=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},Na=function(e){return(e/8|0)+(7&e&&1)},Ua=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var n=new(e instanceof la?la:e instanceof ua?ua:ca)(r-t);return n.set(e.subarray(t,r)),n},Da=function(e,t,r){var n=e.length;if(!n||r&&!r.l&&n<5)return t||new ca(0);var s=!t||r,a=!r||r.i;r||(r={}),t||(t=new ca(3*n));var o=function(e){var r=t.length;if(e>r){var n=new ca(Math.max(2*r,e));n.set(t),t=n}},i=r.f||0,c=r.p||0,l=r.b||0,u=r.l,h=r.d,p=r.m,d=r.n,f=8*n;do{if(!u){r.f=i=Ra(e,c,1);var g=Ra(e,c+1,3);if(c+=3,!g){var m=e[(A=Na(c)+4)-4]|e[A-3]<<8,v=A+m;if(v>n){if(a)throw"unexpected EOF";break}s&&o(l+m),t.set(e.subarray(A,v),l),r.b=l+=m,r.p=c=8*v;continue}if(1==g)u=Ia,h=La,p=9,d=5;else{if(2!=g)throw"invalid block type";var y=Ra(e,c,31)+257,b=Ra(e,c+10,15)+4,x=y+Ra(e,c+5,31)+1;c+=14;for(var w=new ca(x),S=new ca(19),T=0;T<b;++T)S[da[T]]=Ra(e,c+3*T,7);c+=3*b;var F=Ca(S),k=(1<<F)-1,E=Fa(S,F,1);for(T=0;T<x;){var A,I=E[Ra(e,c,k)];if(c+=15&I,(A=I>>>4)<16)w[T++]=A;else{var M=0,L=0;for(16==A?(L=3+Ra(e,c,3),c+=2,M=w[T-1]):17==A?(L=3+Ra(e,c,7),c+=3):18==A&&(L=11+Ra(e,c,127),c+=7);L--;)w[T++]=M}}var C=w.subarray(0,y),R=w.subarray(y);p=Ca(C),d=Ca(R),u=Fa(C,p,1),h=Fa(R,d,1)}if(c>f){if(a)throw"unexpected EOF";break}}s&&o(l+131072);for(var O=(1<<p)-1,N=(1<<d)-1,U=c;;U=c){var D=(M=u[Oa(e,c)&O])>>>4;if((c+=15&M)>f){if(a)throw"unexpected EOF";break}if(!M)throw"invalid length/literal";if(D<256)t[l++]=D;else{if(256==D){U=c,u=null;break}var P=D-254;if(D>264){var B=ha[T=D-257];P=Ra(e,c,(1<<B)-1)+ma[T],c+=B}var G=h[Oa(e,c)&N],_=G>>>4;if(!G)throw"invalid distance";c+=15&G;R=ba[_];if(_>3){B=pa[_];R+=Oa(e,c)&(1<<B)-1,c+=B}if(c>f){if(a)throw"unexpected EOF";break}s&&o(l+131072);for(var H=l+P;l<H;l+=4)t[l]=t[l-R],t[l+1]=t[l+1-R],t[l+2]=t[l+2-R],t[l+3]=t[l+3-R];l=H}}r.l=u,r.p=U,r.b=l,u&&(i=1,r.m=p,r.d=h,r.n=d)}while(!i);return l==t.length?t:Ua(t,0,l)},Pa=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8},Ba=function(e,t,r){r<<=7&t;var n=t/8|0;e[n]|=r,e[n+1]|=r>>>8,e[n+2]|=r>>>16},Ga=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var s=r.length,a=r.slice();if(!s)return[Xa,0];if(1==s){var o=new ca(r[0].s+1);return o[r[0].s]=1,[o,1]}r.sort((function(e,t){return e.f-t.f})),r.push({s:-1,f:25001});var i=r[0],c=r[1],l=0,u=1,h=2;for(r[0]={s:-1,f:i.f+c.f,l:i,r:c};u!=s-1;)i=r[r[l].f<r[h].f?l++:h++],c=r[l!=u&&r[l].f<r[h].f?l++:h++],r[u++]={s:-1,f:i.f+c.f,l:i,r:c};var p=a[0].s;for(n=1;n<s;++n)a[n].s>p&&(p=a[n].s);var d=new la(p+1),f=_a(r[u-1],d,0);if(f>t){n=0;var g=0,m=f-t,v=1<<m;for(a.sort((function(e,t){return d[t.s]-d[e.s]||e.f-t.f}));n<s;++n){var y=a[n].s;if(!(d[y]>t))break;g+=v-(1<<f-d[y]),d[y]=t}for(g>>>=m;g>0;){var b=a[n].s;d[b]<t?g-=1<<t-d[b]++-1:++n}for(;n>=0&&g;--n){var x=a[n].s;d[x]==t&&(--d[x],++g)}f=t}return[new ca(d),f]},_a=function(e,t,r){return-1==e.s?Math.max(_a(e.l,t,r+1),_a(e.r,t,r+1)):t[e.s]=r},Ha=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new la(++t),n=0,s=e[0],a=1,o=function(e){r[n++]=e},i=1;i<=t;++i)if(e[i]==s&&i!=t)++a;else{if(!s&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(s),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(s);a=1,s=e[i]}return[r.subarray(0,n),t]},Va=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},za=function(e,t,r){var n=r.length,s=Na(t+2);e[s]=255&n,e[s+1]=n>>>8,e[s+2]=255^e[s],e[s+3]=255^e[s+1];for(var a=0;a<n;++a)e[s+a+4]=r[a];return 8*(s+4+n)},ja=function(e,t,r,n,s,a,o,i,c,l,u){Pa(t,u++,r),++s[256];for(var h=Ga(s,15),p=h[0],d=h[1],f=Ga(a,15),g=f[0],m=f[1],v=Ha(p),y=v[0],b=v[1],x=Ha(g),w=x[0],S=x[1],T=new la(19),F=0;F<y.length;++F)T[31&y[F]]++;for(F=0;F<w.length;++F)T[31&w[F]]++;for(var k=Ga(T,7),E=k[0],A=k[1],I=19;I>4&&!E[da[I-1]];--I);var M,L,C,R,O=l+5<<3,N=Va(s,ka)+Va(a,Ea)+o,U=Va(s,p)+Va(a,g)+o+14+3*I+Va(T,E)+(2*T[16]+3*T[17]+7*T[18]);if(O<=N&&O<=U)return za(t,u,e.subarray(c,c+l));if(Pa(t,u,1+(U<N)),u+=2,U<N){M=Fa(p,d,0),L=p,C=Fa(g,m,0),R=g;var D=Fa(E,A,0);Pa(t,u,b-257),Pa(t,u+5,S-1),Pa(t,u+10,I-4),u+=14;for(F=0;F<I;++F)Pa(t,u+3*F,E[da[F]]);u+=3*I;for(var P=[y,w],B=0;B<2;++B){var G=P[B];for(F=0;F<G.length;++F){var _=31&G[F];Pa(t,u,D[_]),u+=E[_],_>15&&(Pa(t,u,G[F]>>>5&127),u+=G[F]>>>12)}}}else M=Aa,L=ka,C=Ma,R=Ea;for(F=0;F<i;++F)if(n[F]>255){_=n[F]>>>18&31;Ba(t,u,M[_+257]),u+=L[_+257],_>7&&(Pa(t,u,n[F]>>>23&31),u+=ha[_]);var H=31&n[F];Ba(t,u,C[H]),u+=R[H],H>3&&(Ba(t,u,n[F]>>>5&8191),u+=pa[H])}else Ba(t,u,M[n[F]]),u+=L[n[F]];return Ba(t,u,M[256]),u+L[256]},Wa=new ua([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Xa=new ca(0),qa=function(e,t,r,n,s,a){var o=e.length,i=new ca(n+o+5*(1+Math.ceil(o/7e3))+s),c=i.subarray(n,i.length-s),l=0;if(!t||o<8)for(var u=0;u<=o;u+=65535){var h=u+65535;h<o?l=za(c,l,e.subarray(u,h)):(c[u]=a,l=za(c,l,e.subarray(u,o)))}else{for(var p=Wa[t-1],d=p>>>13,f=8191&p,g=(1<<r)-1,m=new la(32768),v=new la(g+1),y=Math.ceil(r/3),b=2*y,x=function(t){return(e[t]^e[t+1]<<y^e[t+2]<<b)&g},w=new ua(25e3),S=new la(288),T=new la(32),F=0,k=0,E=(u=0,0),A=0,I=0;u<o;++u){var M=x(u),L=32767&u,C=v[M];if(m[L]=C,v[M]=L,A<=u){var R=o-u;if((F>7e3||E>24576)&&R>423){l=ja(e,c,0,w,S,T,k,E,I,u-I,l),E=F=k=0,I=u;for(var O=0;O<286;++O)S[O]=0;for(O=0;O<30;++O)T[O]=0}var N=2,U=0,D=f,P=L-C&32767;if(R>2&&M==x(u-P))for(var B=Math.min(d,R)-1,G=Math.min(32767,u),_=Math.min(258,R);P<=G&&--D&&L!=C;){if(e[u+N]==e[u+N-P]){for(var H=0;H<_&&e[u+H]==e[u+H-P];++H);if(H>N){if(N=H,U=P,H>B)break;var V=Math.min(P,H-2),z=0;for(O=0;O<V;++O){var j=u-P+O+32768&32767,W=j-m[j]+32768&32767;W>z&&(z=W,C=j)}}}P+=(L=C)-(C=m[L])+32768&32767}if(U){w[E++]=268435456|va[N]<<18|xa[U];var X=31&va[N],q=31&xa[U];k+=ha[X]+pa[q],++S[257+X],++T[q],A=u+N,++F}else w[E++]=e[u],++S[e[u]]}}l=ja(e,c,a,w,S,T,k,E,I,u-I,l),!a&&7&l&&(l=za(c,l+1,Xa))}return Ua(i,0,n+Na(l)+s)},Ya=function(){for(var e=new ua(256),t=0;t<256;++t){for(var r=t,n=9;--n;)r=(1&r&&3988292384)^r>>>1;e[t]=r}return e}(),Ka=function(){var e=-1;return{p:function(t){for(var r=e,n=0;n<t.length;++n)r=Ya[255&r^t[n]]^r>>>8;e=r},d:function(){return~e}}},Za=function(){var e=1,t=0;return{p:function(r){for(var n=e,s=t,a=r.length,o=0;o!=a;){for(var i=Math.min(o+2655,a);o<i;++o)s+=n+=r[o];n=(65535&n)+15*(n>>16),s=(65535&s)+15*(s>>16)}e=n,t=s},d:function(){return(255&(e%=65521))<<24|e>>>8<<16|(255&(t%=65521))<<8|t>>>8}}},Qa=function(e,t,r,n,s){return qa(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,r,n,!s)},$a=function(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r},Ja=function(e,t,r){for(var n=e(),s=e.toString(),a=s.slice(s.indexOf("[")+1,s.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<n.length;++o){var i=n[o],c=a[o];if("function"==typeof i){t+=";"+c+"=";var l=i.toString();if(i.prototype)if(-1!=l.indexOf("[native code]")){var u=l.indexOf(" ",8)+1;t+=l.slice(u,l.indexOf("(",u))}else for(var h in t+=l,i.prototype)t+=";"+c+".prototype."+h+"="+i.prototype[h].toString();else t+=l}else r[c]=i}return[t,r]},eo=[],to=function(e,t,r,n){var s;if(!eo[r]){for(var a="",o={},i=e.length-1,c=0;c<i;++c)a=(s=Ja(e[c],a,o))[0],o=s[1];eo[r]=Ja(e[i],a,o)}var l=$a({},eo[r][1]);return function(e,t,r,n,s){var a=ia(aa[t]||(aa[t]=oa(e)));return a.onerror=function(e){return s(e.error,null)},a.onmessage=function(e){return s(null,e.data)},a.postMessage(r,n),a}(eo[r][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,l,function(e){var t=[];for(var r in e)(e[r]instanceof ca||e[r]instanceof la||e[r]instanceof ua)&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t}(l),n)},ro=function(){return[ca,la,ua,ha,pa,da,ma,ba,Ia,La,wa,Fa,Ca,Ra,Oa,Na,Ua,Da,Ro,co,lo]},no=function(){return[ca,la,ua,ha,pa,da,va,xa,Aa,ka,Ma,Ea,wa,Wa,Xa,Fa,Pa,Ba,Ga,_a,Ha,Va,za,ja,Na,Ua,qa,Qa,Io,co]},so=function(){return[yo,wo,vo,Ka,Ya]},ao=function(){return[bo,xo]},oo=function(){return[So,vo,Za]},io=function(){return[To]},co=function(e){return postMessage(e,[e.buffer])},lo=function(e){return e&&e.size&&new ca(e.size)},uo=function(e,t,r,n,s,a){var o=to(r,n,s,(function(e,t){o.terminate(),a(e,t)}));return o.postMessage([e,t],t.consume?[e.buffer]:[]),function(){o.terminate()}},ho=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},po=function(e,t,r,n,s){var a,o=to(e,n,s,(function(e,r){e?(o.terminate(),t.ondata.call(t,e)):(r[1]&&o.terminate(),t.ondata.call(t,e,r[0],r[1]))}));o.postMessage(r),t.push=function(e,r){if(a)throw"stream finished";if(!t.ondata)throw"no stream handler";o.postMessage([e,a=r],[e.buffer])},t.terminate=function(){o.terminate()}},fo=function(e,t){return e[t]|e[t+1]<<8},go=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},mo=function(e,t){return go(e,t)+4294967296*go(e,t+4)},vo=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},yo=function(e,t){var r=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&vo(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),r){e[3]=8;for(var n=0;n<=r.length;++n)e[n+10]=r.charCodeAt(n)}},bo=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],r=10;4&t&&(r+=e[10]|2+(e[11]<<8));for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!e[r++]);return r+(2&t)},xo=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},wo=function(e){return 10+(e.filename&&e.filename.length+1||0)},So=function(e,t){var r=t.level,n=0==r?0:r<6?1:9==r?3:2;e[0]=120,e[1]=n<<6|(n?32-2*n:1)},To=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function Fo(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var ko=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(Qa(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),Eo=function(){return function(e,t){po([no,function(){return[ho,ko]}],this,Fo.call(this,e,t),(function(e){var t=new ko(e.data);onmessage=ho(t)}),6)}}();function Ao(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return uo(e,t,[no],(function(e){return co(Io(e.data[0],e.data[1]))}),0,r)}function Io(e,t){return Qa(e,t||{},0,0)}var Mo=function(){function e(e){this.s={},this.p=new ca(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,r=new ca(t+e.length);r.set(this.p),r.set(e,t),this.p=r},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,r=Da(this.p,this.o,this.s);this.ondata(Ua(r,t,this.s.b),this.d),this.o=Ua(r,this.s.b-32768),this.s.b=this.o.length,this.p=Ua(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),Lo=function(){return function(e){this.ondata=e,po([ro,function(){return[ho,Mo]}],this,0,(function(){var e=new Mo;onmessage=ho(e)}),7)}}();function Co(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return uo(e,t,[ro],(function(e){return co(Ro(e.data[0],lo(e.data[1])))}),1,r)}function Ro(e,t){return Da(e,t)}var Oo=function(){function e(e,t){this.c=Ka(),this.l=0,this.v=1,ko.call(this,e,t)}return e.prototype.push=function(e,t){ko.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var r=Qa(e,this.o,this.v&&wo(this.o),t&&8,!t);this.v&&(yo(r,this.o),this.v=0),t&&(vo(r,r.length-8,this.c.d()),vo(r,r.length-4,this.l)),this.ondata(r,t)},e}(),No=function(){return function(e,t){po([no,so,function(){return[ho,ko,Oo]}],this,Fo.call(this,e,t),(function(e){var t=new Oo(e.data);onmessage=ho(t)}),8)}}();function Uo(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return uo(e,t,[no,so,function(){return[Do]}],(function(e){return co(Do(e.data[0],e.data[1]))}),2,r)}function Do(e,t){t||(t={});var r=Ka(),n=e.length;r.p(e);var s=Qa(e,t,wo(t),8),a=s.length;return yo(s,t),vo(s,a-8,r.d()),vo(s,a-4,n),s}var Po=function(){function e(e){this.v=1,Mo.call(this,e)}return e.prototype.push=function(e,t){if(Mo.prototype.e.call(this,e),this.v){var r=this.p.length>3?bo(this.p):4;if(r>=this.p.length&&!t)return;this.p=this.p.subarray(r),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Mo.prototype.c.call(this,t)},e}(),Bo=function(){return function(e){this.ondata=e,po([ro,ao,function(){return[ho,Mo,Po]}],this,0,(function(){var e=new Po;onmessage=ho(e)}),9)}}();function Go(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return uo(e,t,[ro,ao,function(){return[_o]}],(function(e){return co(_o(e.data[0]))}),3,r)}function _o(e,t){return Da(e.subarray(bo(e),-8),t||new ca(xo(e)))}var Ho=function(){function e(e,t){this.c=Za(),this.v=1,ko.call(this,e,t)}return e.prototype.push=function(e,t){ko.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var r=Qa(e,this.o,this.v&&2,t&&4,!t);this.v&&(So(r,this.o),this.v=0),t&&vo(r,r.length-4,this.c.d()),this.ondata(r,t)},e}(),Vo=function(){return function(e,t){po([no,oo,function(){return[ho,ko,Ho]}],this,Fo.call(this,e,t),(function(e){var t=new Ho(e.data);onmessage=ho(t)}),10)}}();function zo(e,t){t||(t={});var r=Za();r.p(e);var n=Qa(e,t,2,4);return So(n,t),vo(n,n.length-4,r.d()),n}var jo=function(){function e(e){this.v=1,Mo.call(this,e)}return e.prototype.push=function(e,t){if(Mo.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Mo.prototype.c.call(this,t)},e}(),Wo=function(){return function(e){this.ondata=e,po([ro,io,function(){return[ho,Mo,jo]}],this,0,(function(){var e=new jo;onmessage=ho(e)}),11)}}();function Xo(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return uo(e,t,[ro,io,function(){return[qo]}],(function(e){return co(qo(e.data[0],lo(e.data[1])))}),5,r)}function qo(e,t){return Da((To(e),e.subarray(2,-4)),t)}var Yo=function(){function e(e){this.G=Po,this.I=Mo,this.Z=jo,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var r=new ca(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var n=this,s=function(){n.ondata.apply(n,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(s):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(s):new this.Z(s),this.s.push(this.p,t),this.p=null}}},e}(),Ko=function(){function e(e){this.G=Bo,this.I=Lo,this.Z=Wo,this.ondata=e}return e.prototype.push=function(e,t){Yo.prototype.push.call(this,e,t)},e}();var Zo=function(e,t,r,n){for(var s in e){var a=e[s],o=t+s;a instanceof ca?r[o]=[a,n]:Array.isArray(a)?r[o]=[a[0],$a(n,a[1])]:Zo(a,o+"/",r,n)}},Qo="undefined"!=typeof TextEncoder&&new TextEncoder,$o=void 0!==e.$TextDecoder&&new e.$TextDecoder,Jo=0;try{$o.decode(Xa,{stream:!0}),Jo=1}catch(e){}var ei=function(e){for(var t="",r=0;;){var n=e[r++],s=(n>127)+(n>223)+(n>239);if(r+s>e.length)return[t,Ua(e,r-1)];s?3==s?(n=((15&n)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536,t+=String.fromCharCode(55296|n>>10,56320|1023&n)):t+=1&s?String.fromCharCode((31&n)<<6|63&e[r++]):String.fromCharCode((15&n)<<12|(63&e[r++])<<6|63&e[r++]):t+=String.fromCharCode(n)}},ti=function(){function t(t){this.ondata=t,Jo?this.t=new e.$TextDecoder:this.p=Xa}return t.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var r=new ca(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length);var n=ei(r),s=n[0],a=n[1];if(t){if(a.length)throw"invalid utf-8 data";this.p=null}else this.p=a;this.ondata(s,t)}},t}(),ri=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(ni(e),this.d=t||!1)},e}();function ni(e,t){if(t){for(var r=new ca(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r}if(Qo)return Qo.encode(e);var s=e.length,a=new ca(e.length+(e.length>>1)),o=0,i=function(e){a[o++]=e};for(n=0;n<s;++n){if(o+5>a.length){var c=new ca(o+8+(s-n<<1));c.set(a),a=c}var l=e.charCodeAt(n);l<128||t?i(l):l<2048?(i(192|l>>6),i(128|63&l)):l>55295&&l<57344?(i(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++n))>>18),i(128|l>>12&63),i(128|l>>6&63),i(128|63&l)):(i(224|l>>12),i(128|l>>6&63),i(128|63&l))}return Ua(a,0,o)}function si(e,t){if(t){for(var r="",n=0;n<e.length;n+=16384)r+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return r}if($o)return $o.decode(e);var s=ei(e),a=s[0];if(s[1].length)throw"invalid utf-8 data";return a}var ai=function(e){return 1==e?3:e<6?2:9==e?1:0},oi=function(e,t){return t+30+fo(e,t+26)+fo(e,t+28)},ii=function(e,t,r){var n=fo(e,t+28),s=si(e.subarray(t+46,t+46+n),!(2048&fo(e,t+8))),a=t+46+n,o=go(e,t+20),i=r&&4294967295==o?ci(e,a):[o,go(e,t+24),go(e,t+42)],c=i[0],l=i[1],u=i[2];return[fo(e,t+10),c,l,s,a+fo(e,t+30)+fo(e,t+32),u]},ci=function(e,t){for(;1!=fo(e,t);t+=4+fo(e,t+2));return[mo(e,t+12),mo(e,t+4),mo(e,t+20)]},li=function(e){var t=0;if(e)for(var r in e){var n=e[r].length;if(n>65535)throw"extra field too long";t+=n+4}return t},ui=function(e,t,r,n,s,a,o,i){var c=n.length,l=r.extra,u=i&&i.length,h=li(l);vo(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=r.os),e[t]=20,t+=2,e[t++]=r.flag<<1|(null==a&&8),e[t++]=s&&8,e[t++]=255&r.compression,e[t++]=r.compression>>8;var p=new Date(null==r.mtime?Date.now():r.mtime),d=p.getFullYear()-1980;if(d<0||d>119)throw"date not in range 1980-2099";if(vo(e,t,d<<25|p.getMonth()+1<<21|p.getDate()<<16|p.getHours()<<11|p.getMinutes()<<5|p.getSeconds()>>>1),t+=4,null!=a&&(vo(e,t,r.crc),vo(e,t+4,a),vo(e,t+8,r.size)),vo(e,t+12,c),vo(e,t+14,h),t+=16,null!=o&&(vo(e,t,u),vo(e,t+6,r.attrs),vo(e,t+10,o),t+=14),e.set(n,t),t+=c,h)for(var f in l){var g=l[f],m=g.length;vo(e,t,+f),vo(e,t+2,m),e.set(g,t+4),t+=4+m}return u&&(e.set(i,t),t+=u),t},hi=function(e,t,r,n,s){vo(e,t,101010256),vo(e,t+8,r),vo(e,t+10,r),vo(e,t+12,n),vo(e,t+16,s)},pi=function(){function e(e){this.filename=e,this.c=Ka(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),di=function(){function e(e,t){var r=this;t||(t={}),pi.call(this,e),this.d=new ko(t,(function(e,t){r.ondata(null,e,t)})),this.compression=8,this.flag=ai(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(e){this.ondata(e,null,t)}},e.prototype.push=function(e,t){pi.prototype.push.call(this,e,t)},e}(),fi=function(){function e(e,t){var r=this;t||(t={}),pi.call(this,e),this.d=new Eo(t,(function(e,t,n){r.ondata(e,t,n)})),this.compression=8,this.flag=ai(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){pi.prototype.push.call(this,e,t)},e}(),gi=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var r=ni(e.filename),n=r.length,s=e.comment,a=s&&ni(s),o=n!=e.filename.length||a&&s.length!=a.length,i=n+li(e.extra)+30;if(n>65535)throw"filename too long";var c=new ca(i);ui(c,0,e,r,o);var l=[c],u=function(){for(var e=0,r=l;e<r.length;e++){var n=r[e];t.ondata(null,n,!1)}l=[]},h=this.d;this.d=0;var p=this.u.length,d=$a(e,{f:r,u:o,o:a,t:function(){e.terminate&&e.terminate()},r:function(){if(u(),h){var e=t.u[p+1];e?e.r():t.d=1}h=1}}),f=0;e.ondata=function(r,n,s){if(r)t.ondata(r,n,s),t.terminate();else if(f+=n.length,l.push(n),s){var a=new ca(16);vo(a,0,134695760),vo(a,4,e.crc),vo(a,8,f),vo(a,12,e.size),l.push(a),d.c=f,d.b=i+f+16,d.crc=e.crc,d.size=e.size,h&&d.r(),h=1}else h&&u()},this.u.push(d)},e.prototype.end=function(){var e=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,r=0,n=0,s=this.u;n<s.length;n++){r+=46+(c=s[n]).f.length+li(c.extra)+(c.o?c.o.length:0)}for(var a=new ca(r+22),o=0,i=this.u;o<i.length;o++){var c=i[o];ui(a,e,c,c.f,c.u,c.c,t,c.o),e+=46+c.f.length+li(c.extra)+(c.o?c.o.length:0),t+=c.b}hi(a,e,this.u.length,r,t),this.ondata(null,a,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){t[e].t()}this.d=2},e}();var mi=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}(),vi=function(){function e(){var e=this;this.i=new Mo((function(t,r){e.ondata(null,t,r)}))}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(r){this.ondata(r,e,t)}},e.compression=8,e}(),yi=function(){function e(e,t){var r=this;t<32e4?this.i=new Mo((function(e,t){r.ondata(null,e,t)})):(this.i=new Lo((function(e,t,n){r.ondata(e,t,n)})),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=Ua(e,0)),this.i.push(e,t)},e.compression=8,e}(),bi=function(){function e(e){this.onfile=e,this.k=[],this.o={0:mi},this.p=Xa}return e.prototype.push=function(e,t){var r=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var n=Math.min(this.c,e.length),s=e.subarray(0,n);if(this.c-=n,this.d?this.d.push(s,!this.c):this.k[0].push(s),(e=e.subarray(n)).length)return this.push(e,t)}else{var a=0,o=0,i=void 0,c=void 0;this.p.length?e.length?((c=new ca(this.p.length+e.length)).set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var l=c.length,u=this.c,h=u&&this.d,p=function(){var e,t=go(c,o);if(67324752==t){a=1,i=o,d.d=null,d.c=0;var n=fo(c,o+6),s=fo(c,o+8),h=2048&n,p=8&n,f=fo(c,o+26),g=fo(c,o+28);if(l>o+30+f+g){var m=[];d.k.unshift(m),a=2;var v,y=go(c,o+18),b=go(c,o+22),x=si(c.subarray(o+30,o+=30+f),!h);4294967295==y?(e=p?[-2]:ci(c,o),y=e[0],b=e[1]):p&&(y=-1),o+=g,d.c=y;var w={name:x,compression:s,start:function(){if(!w.ondata)throw"no callback";if(y){var e=r.o[s];if(!e)throw"unknown compression type "+s;(v=y<0?new e(x):new e(x,y,b)).ondata=function(e,t,r){w.ondata(e,t,r)};for(var t=0,n=m;t<n.length;t++){var a=n[t];v.push(a,!1)}r.k[0]==m&&r.c?r.d=v:v.push(Xa,!0)}else w.ondata(null,Xa,!0)},terminate:function(){v&&v.terminate&&v.terminate()}};y>=0&&(w.size=y,w.originalSize=b),d.onfile(w)}return"break"}if(u){if(134695760==t)return i=o+=12+(-2==u&&8),a=3,d.c=0,"break";if(33639248==t)return i=o-=4,a=3,d.c=0,"break"}},d=this;o<l-4;++o){if("break"===p())break}if(this.p=Xa,u<0){var f=a?c.subarray(0,i-12-(-2==u&&8)-(134695760==go(c,i-16)&&4)):c.subarray(0,o);h?h.push(f,!!a):this.k[+(2==a)].push(f)}if(2&a)return this.push(c.subarray(o),t);this.p=c.subarray(o)}if(t){if(this.c)throw"invalid zip file";this.p=null}},e.prototype.register=function(e){this.o[e.compression]=e},e}();var xi=Object.freeze({__proto__:null,AsyncCompress:No,AsyncDecompress:Ko,AsyncDeflate:Eo,AsyncGunzip:Bo,AsyncGzip:No,AsyncInflate:Lo,AsyncUnzipInflate:yi,AsyncUnzlib:Wo,AsyncZipDeflate:fi,AsyncZlib:Vo,Compress:Oo,DecodeUTF8:ti,Decompress:Yo,Deflate:ko,EncodeUTF8:ri,Gunzip:Po,Gzip:Oo,Inflate:Mo,Unzip:bi,UnzipInflate:vi,UnzipPassThrough:mi,Unzlib:jo,Zip:gi,ZipDeflate:di,ZipPassThrough:pi,Zlib:Ho,compress:Uo,compressSync:Do,decompress:function(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?Go(e,t,r):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Co(e,t,r):Xo(e,t,r)},decompressSync:function(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?_o(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Ro(e,t):qo(e,t)},deflate:Ao,deflateSync:Io,gunzip:Go,gunzipSync:_o,gzip:Uo,gzipSync:Do,inflate:Co,inflateSync:Ro,strFromU8:si,strToU8:ni,unzip:function(e,t){if("function"!=typeof t)throw"no callback";for(var r=[],n=function(){for(var e=0;e<r.length;++e)r[e]()},s={},a=e.length-22;101010256!=go(e,a);--a)if(!a||e.length-a>65558)return void t("invalid zip file",null);var o=fo(e,a+8);o||t(null,{});var i=o,c=go(e,a+16),l=4294967295==c;if(l){if(a=go(e,a-12),101075792!=go(e,a))return void t("invalid zip file",null);i=o=go(e,a+32),c=go(e,a+48)}for(var u=function(a){var i=ii(e,c,l),u=i[0],h=i[1],p=i[2],d=i[3],f=i[4],g=i[5],m=oi(e,g);c=f;var v=function(e,r){e?(n(),t(e,null)):(s[d]=r,--o||t(null,s))};if(u)if(8==u){var y=e.subarray(m,m+h);if(h<32e4)try{v(null,Ro(y,new ca(p)))}catch(e){v(e,null)}else r.push(Co(y,{size:p},v))}else v("unknown compression type "+u,null);else v(null,Ua(e,m,m+h))},h=0;h<i;++h)u();return n},unzipSync:function(e){for(var t={},r=e.length-22;101010256!=go(e,r);--r)if(!r||e.length-r>65558)throw"invalid zip file";var n=fo(e,r+8);if(!n)return{};var s=go(e,r+16),a=4294967295==s;if(a){if(r=go(e,r-12),101075792!=go(e,r))throw"invalid zip file";n=go(e,r+32),s=go(e,r+48)}for(var o=0;o<n;++o){var i=ii(e,s,a),c=i[0],l=i[1],u=i[2],h=i[3],p=i[4],d=i[5],f=oi(e,d);if(s=p,c){if(8!=c)throw"unknown compression type "+c;t[h]=Ro(e.subarray(f,f+l),new ca(u))}else t[h]=Ua(e,f,f+l)}return t},unzlib:Xo,unzlibSync:qo,zip:function(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";var n={};Zo(e,"",n,t);var s=Object.keys(n),a=s.length,o=0,i=0,c=a,l=new Array(a),u=[],h=function(){for(var e=0;e<u.length;++e)u[e]()},p=function(){var e=new ca(i+22),t=o,n=i-o;i=0;for(var s=0;s<c;++s){var a=l[s];try{var u=a.c.length;ui(e,i,a,a.f,a.u,u);var h=30+a.f.length+li(a.extra),p=i+h;e.set(a.c,p),ui(e,o,a,a.f,a.u,u,i,a.m),o+=16+h+(a.m?a.m.length:0),i=p+u}catch(e){return r(e,null)}}hi(e,o,l.length,n,t),r(null,e)};a||p();for(var d=function(e){var t=s[e],c=n[t],d=c[0],f=c[1],g=Ka(),m=d.length;g.p(d);var v=ni(t),y=v.length,b=f.comment,x=b&&ni(b),w=x&&x.length,S=li(f.extra),T=0==f.level?0:8,F=function(n,s){if(n)h(),r(n,null);else{var c=s.length;l[e]=$a(f,{size:m,crc:g.d(),c:s,f:v,m:x,u:y!=t.length||x&&b.length!=w,compression:T}),o+=30+y+S+c,i+=76+2*(y+S)+(w||0)+c,--a||p()}};if(y>65535&&F("filename too long",null),T)if(m<16e4)try{F(null,Io(d,f))}catch(e){F(e,null)}else u.push(Ao(d,f,F));else F(null,d)},f=0;f<c;++f)d(f);return h},zipSync:function(e,t){t||(t={});var r={},n=[];Zo(e,"",r,t);var s=0,a=0;for(var o in r){var i=r[o],c=i[0],l=i[1],u=0==l.level?0:8,h=(T=ni(o)).length,p=l.comment,d=p&&ni(p),f=d&&d.length,g=li(l.extra);if(h>65535)throw"filename too long";var m=u?Io(c,l):c,v=m.length,y=Ka();y.p(c),n.push($a(l,{size:c.length,crc:y.d(),c:m,f:T,m:d,u:h!=o.length||d&&p.length!=f,o:s,compression:u})),s+=30+h+g+v,a+=76+2*(h+g)+(f||0)+v}for(var b=new ca(a+22),x=s,w=a-s,S=0;S<n.length;++S){var T=n[S];ui(b,T.o,T,T.f,T.u,T.c.length);var F=30+T.f.length+li(T.extra);b.set(T.c,T.o+F),ui(b,s,T,T.f,T.u,T.c.length,T.o,T.m),s+=16+F+(T.m?T.m.length:0)}return hi(b,s,n.length,w,x),b},zlib:function(e,t,r){if(r||(r=t,t={}),"function"!=typeof r)throw"no callback";return uo(e,t,[no,oo,function(){return[zo]}],(function(e){return co(zo(e.data[0],e.data[1]))}),4,r)},zlibSync:zo});class wi{static findSpan(e,t,r){const n=r.length-e-1;if(t>=r[n])return n-1;if(t<=r[e])return e;let s=e,a=n,o=Math.floor((s+a)/2);for(;t<r[o]||t>=r[o+1];)t<r[o]?a=o:s=o,o=Math.floor((s+a)/2);return o}static calcBasisFunctions(e,t,r,n){const s=[],a=[],o=[];s[0]=1;for(let i=1;i<=r;++i){a[i]=t-n[e+1-i],o[i]=n[e+i]-t;let r=0;for(let e=0;e<i;++e){const t=o[e+1],n=a[i-e],c=s[e]/(t+n);s[e]=r+t*c,r=n*c}s[i]=r}return s}static calcBSplinePoint(t,r,n,s){const a=this.findSpan(t,s,r),o=this.calcBasisFunctions(a,s,t,r),i=new e.Vector4(0,0,0,0);for(let e=0;e<=t;++e){const r=n[a-t+e],s=o[e],c=r.w*s;i.x+=r.x*c,i.y+=r.y*c,i.z+=r.z*c,i.w+=r.w*s}return i}static calcBasisFunctionDerivatives(e,t,r,n,s){const a=[];for(let e=0;e<=r;++e)a[e]=0;const o=[];for(let e=0;e<=n;++e)o[e]=a.slice(0);const i=[];for(let e=0;e<=r;++e)i[e]=a.slice(0);i[0][0]=1;const c=a.slice(0),l=a.slice(0);for(let n=1;n<=r;++n){c[n]=t-s[e+1-n],l[n]=s[e+n]-t;let r=0;for(let e=0;e<n;++e){const t=l[e+1],s=c[n-e];i[n][e]=t+s;const a=i[e][n-1]/i[n][e];i[e][n]=r+t*a,r=s*a}i[n][n]=r}for(let e=0;e<=r;++e)o[0][e]=i[e][r];for(let e=0;e<=r;++e){let t=0,s=1;const c=[];for(let e=0;e<=r;++e)c[e]=a.slice(0);c[0][0]=1;for(let a=1;a<=n;++a){let n=0;const l=e-a,u=r-a;e>=a&&(c[s][0]=c[t][0]/i[u+1][l],n=c[s][0]*i[l][u]);const h=e-1<=u?a-1:r-e;for(let e=l>=-1?1:-l;e<=h;++e)c[s][e]=(c[t][e]-c[t][e-1])/i[u+1][l+e],n+=c[s][e]*i[l+e][u];e<=u&&(c[s][a]=-c[t][a-1]/i[u+1][e],n+=c[s][a]*i[e][u]),o[a][e]=n;const p=t;t=s,s=p}}let u=r;for(let e=1;e<=n;++e){for(let t=0;t<=r;++t)o[e][t]*=u;u*=r-e}return o}static calcBSplineDerivatives(t,r,n,s,a){const o=a<t?a:t,i=[],c=this.findSpan(t,s,r),l=this.calcBasisFunctionDerivatives(c,s,t,o,r),u=[];for(let e=0;e<n.length;++e){const t=n[e].clone(),r=t.w;t.x*=r,t.y*=r,t.z*=r,u[e]=t}for(let e=0;e<=o;++e){const r=u[c-t].clone().multiplyScalar(l[e][0]);for(let n=1;n<=t;++n)r.add(u[c-t+n].clone().multiplyScalar(l[e][n]));i[e]=r}for(let t=o+1;t<=a+1;++t)i[t]=new e.Vector4(0,0,0);return i}static calcKoverI(e,t){let r=1;for(let t=2;t<=e;++t)r*=t;let n=1;for(let e=2;e<=t;++e)n*=e;for(let r=2;r<=e-t;++r)n*=r;return r/n}static calcRationalCurveDerivatives(t){const r=t.length,n=[],s=[];for(let a=0;a<r;++a){const r=t[a];n[a]=new e.Vector3(r.x,r.y,r.z),s[a]=r.w}const a=[];for(let e=0;e<r;++e){const t=n[e].clone();for(let r=1;r<=e;++r)t.sub(a[e-r].clone().multiplyScalar(this.calcKoverI(e,r)*s[r]));a[e]=t.divideScalar(s[0])}return a}static calcNURBSDerivatives(e,t,r,n,s){const a=this.calcBSplineDerivatives(e,t,r,n,s);return this.calcRationalCurveDerivatives(a)}static calcSurfacePoint(t,r,n,s,a,o,i,c){const l=this.findSpan(t,o,n),u=this.findSpan(r,i,s),h=this.calcBasisFunctions(l,o,t,n),p=this.calcBasisFunctions(u,i,r,s),d=[];for(let n=0;n<=r;++n){d[n]=new e.Vector4(0,0,0,0);for(let e=0;e<=t;++e){const s=a[l-t+e][u-r+n].clone(),o=s.w;s.x*=o,s.y*=o,s.z*=o,d[n].add(s.multiplyScalar(h[e]))}}const f=new e.Vector4(0,0,0,0);for(let e=0;e<=r;++e)f.add(d[e].multiplyScalar(p[e]));f.divideScalar(f.w),c.set(f.x,f.y,f.z)}}class Si extends e.Curve{constructor(t,r,n,s,a){super(),this.degree=t,this.knots=r,this.controlPoints=[],this.startKnot=s||0,this.endKnot=a||this.knots.length-1;for(let t=0;t<n.length;++t){const r=n[t];this.controlPoints[t]=new e.Vector4(r.x,r.y,r.z,r.w)}}getPoint(t,r=new e.Vector3){const n=r,s=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=wi.calcBSplinePoint(this.degree,this.knots,this.controlPoints,s);return 1!==a.w&&a.divideScalar(a.w),n.set(a.x,a.y,a.z)}getTangent(t,r=new e.Vector3){const n=r,s=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),a=wi.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,s,1);return n.copy(a[1]).normalize(),n}}let Ti,Fi,ki;class Ei extends e.Loader{constructor(e){super(e)}load(t,r,n,s){const a=this,o=""===a.path?e.LoaderUtils.extractUrlBase(t):a.path,i=new e.FileLoader(this.manager);i.setPath(a.path),i.setResponseType("arraybuffer"),i.setRequestHeader(a.requestHeader),i.setWithCredentials(a.withCredentials),i.load(t,(function(e){try{r(a.parse(e,o))}catch(e){s?s(e):console.error(e),a.manager.itemError(t)}}),n,s)}parse(t,r){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===zi(e,0,t.length)}(t))Ti=(new Ci).parse(t);else{const e=zi(t);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let r=0;function n(t){const n=e[t-1];return e=e.slice(r+t),r++,n}for(let e=0;e<t.length;++e){if(n(1)===t[e])return!1}return!0}(e))throw new Error("THREE.FBXLoader: Unknown format.");if(Ni(e)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Ni(e));Ti=(new Li).parse(e)}const n=new e.TextureLoader(this.manager).setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin);return new Ai(n,this.manager).parse(Ti)}}class Ai{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){Fi=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),r=this.parseMaterials(t),n=this.parseDeformers(),s=(new Ii).parse(n);return this.parseScene(n,s,r),ki}parseConnections(){const e=new Map;if("Connections"in Ti){Ti.Connections.connections.forEach((function(t){const r=t[0],n=t[1],s=t[2];e.has(r)||e.set(r,{parents:[],children:[]});const a={ID:n,relationship:s};e.get(r).parents.push(a),e.has(n)||e.set(n,{parents:[],children:[]});const o={ID:r,relationship:s};e.get(n).children.push(o)}))}return e}parseImages(){const e={},t={};if("Video"in Ti.Objects){const r=Ti.Objects.Video;for(const n in r){const s=r[n];if(e[parseInt(n)]=s.RelativeFilename||s.Filename,"Content"in s){const e=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,a="string"==typeof s.Content&&""!==s.Content;if(e||a){const e=this.parseImage(r[n]);t[s.RelativeFilename||s.Filename]=e}}}}for(const r in e){const n=e[r];void 0!==t[n]?e[r]=t[n]:e[r]=e[r].split("\\").pop()}return e}parseImage(t){const r=t.Content,n=t.RelativeFilename||t.Filename,s=n.slice(n.lastIndexOf(".")+1).toLowerCase();let a;switch(s){case"bmp":a="image/bmp";break;case"jpg":case"jpeg":a="image/jpeg";break;case"png":a="image/png";break;case"tif":a="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),a="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+s+'" is not supported.')}if("string"==typeof r)return"data:"+a+";base64,"+r;{const t=new Uint8Array(r);return e.$window.URL.createObjectURL(new e.$Blob([t],{type:a}))}}parseTextures(e){const t=new Map;if("Texture"in Ti.Objects){const r=Ti.Objects.Texture;for(const n in r){const s=this.parseTexture(r[n],e);t.set(parseInt(n),s)}}return t}parseTexture(t,r){const n=this.loadTexture(t,r);n.ID=t.id,n.name=t.attrName;const s=t.WrapModeU,a=t.WrapModeV,o=void 0!==s?s.value:0,i=void 0!==a?a.value:0;if(n.wrapS=0===o?e.RepeatWrapping:e.ClampToEdgeWrapping,n.wrapT=0===i?e.RepeatWrapping:e.ClampToEdgeWrapping,"Scaling"in t){const e=t.Scaling.value;n.repeat.x=e[0],n.repeat.y=e[1]}return n}loadTexture(t,r){let n;const s=this.textureLoader.path,a=Fi.get(t.id).children;let o;void 0!==a&&a.length>0&&void 0!==r[a[0].ID]&&(n=r[a[0].ID],0!==n.indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));const i=t.FileName.slice(-3).toLowerCase();if("tga"===i){const r=this.manager.getHandler(".tga");null===r?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),o=new e.Texture):(r.setPath(this.textureLoader.path),o=r.load(n))}else"psd"===i?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),o=new e.Texture):o=this.textureLoader.load(n);return this.textureLoader.setPath(s),o}parseMaterials(e){const t=new Map;if("Material"in Ti.Objects){const r=Ti.Objects.Material;for(const n in r){const s=this.parseMaterial(r[n],e);null!==s&&t.set(parseInt(n),s)}}return t}parseMaterial(t,r){const n=t.id,s=t.attrName;let a=t.ShadingModel;if("object"==typeof a&&(a=a.value),!Fi.has(n))return null;const o=this.parseParameters(t,r,n);let i;switch(a.toLowerCase()){case"phong":i=new e.MeshPhongMaterial;break;case"lambert":i=new e.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),i=new e.MeshPhongMaterial}return i.setValues(o),i.name=s,i}parseParameters(t,r,n){const s={};t.BumpFactor&&(s.bumpScale=t.BumpFactor.value),t.Diffuse?s.color=(new e.Color).fromArray(t.Diffuse.value):!t.DiffuseColor||"Color"!==t.DiffuseColor.type&&"ColorRGB"!==t.DiffuseColor.type||(s.color=(new e.Color).fromArray(t.DiffuseColor.value)),t.DisplacementFactor&&(s.displacementScale=t.DisplacementFactor.value),t.Emissive?s.emissive=(new e.Color).fromArray(t.Emissive.value):!t.EmissiveColor||"Color"!==t.EmissiveColor.type&&"ColorRGB"!==t.EmissiveColor.type||(s.emissive=(new e.Color).fromArray(t.EmissiveColor.value)),t.EmissiveFactor&&(s.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(s.opacity=parseFloat(t.Opacity.value)),s.opacity<1&&(s.transparent=!0),t.ReflectionFactor&&(s.reflectivity=t.ReflectionFactor.value),t.Shininess&&(s.shininess=t.Shininess.value),t.Specular?s.specular=(new e.Color).fromArray(t.Specular.value):t.SpecularColor&&"Color"===t.SpecularColor.type&&(s.specular=(new e.Color).fromArray(t.SpecularColor.value));const a=this;return Fi.get(n).children.forEach((function(t){const n=t.relationship;switch(n){case"Bump":s.bumpMap=a.getTexture(r,t.ID);break;case"Maya|TEX_ao_map":s.aoMap=a.getTexture(r,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=a.getTexture(r,t.ID),s.map.encoding=e.sRGBEncoding;break;case"DisplacementColor":s.displacementMap=a.getTexture(r,t.ID);break;case"EmissiveColor":s.emissiveMap=a.getTexture(r,t.ID),s.emissiveMap.encoding=e.sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=a.getTexture(r,t.ID);break;case"ReflectionColor":s.envMap=a.getTexture(r,t.ID),s.envMap.mapping=e.EquirectangularReflectionMapping,s.envMap.encoding=e.sRGBEncoding;break;case"SpecularColor":s.specularMap=a.getTexture(r,t.ID),s.specularMap.encoding=e.sRGBEncoding;break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=a.getTexture(r,t.ID),s.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}})),s}getTexture(e,t){return"LayeredTexture"in Ti.Objects&&t in Ti.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=Fi.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Ti.Objects){const r=Ti.Objects.Deformer;for(const n in r){const s=r[n],a=Fi.get(parseInt(n));if("Skin"===s.attrType){const t=this.parseSkeleton(a,r);t.ID=n,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=a.parents[0].ID,e[n]=t}else if("BlendShape"===s.attrType){const e={id:n};e.rawTargets=this.parseMorphTargets(a,r),e.id=n,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[n]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(t,r){const n=[];return t.children.forEach((function(t){const s=r[t.ID];if("Cluster"!==s.attrType)return;const a={ID:t.ID,indices:[],weights:[],transformLink:(new e.Matrix4).fromArray(s.TransformLink.a)};"Indexes"in s&&(a.indices=s.Indexes.a,a.weights=s.Weights.a),n.push(a)})),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const r=[];for(let n=0;n<e.children.length;n++){const s=e.children[n],a=t[s.ID],o={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;o.geoID=Fi.get(parseInt(s.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,r.push(o)}return r}parseScene(t,r,n){ki=new e.Group;const s=this.parseModels(t.skeletons,r,n),a=Ti.Objects.Model,o=this;s.forEach((function(e){const t=a[e.ID];o.setLookAtProperties(e,t);Fi.get(e.ID).parents.forEach((function(t){const r=s.get(t.ID);void 0!==r&&r.add(e)})),null===e.parent&&ki.add(e)})),this.bindSkeleton(t.skeletons,r,s),this.createAmbientLight(),this.setupMorphMaterials(),ki.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=_i(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const i=(new Mi).parse();1===ki.children.length&&ki.children[0].isGroup&&(ki.children[0].animations=i,ki=ki.children[0]),ki.animations=i}parseModels(t,r,n){const s=new Map,a=Ti.Objects.Model;for(const o in a){const i=parseInt(o),c=a[o],l=Fi.get(i);let u=this.buildSkeleton(l,t,i,c.attrName);if(!u){switch(c.attrType){case"Camera":u=this.createCamera(l);break;case"Light":u=this.createLight(l);break;case"Mesh":u=this.createMesh(l,r,n);break;case"NurbsCurve":u=this.createCurve(l,r);break;case"LimbNode":case"Root":u=new e.Bone;break;case"Null":default:u=new e.Group}u.name=c.attrName?e.PropertyBinding.sanitizeNodeName(c.attrName):"",u.ID=i}this.getTransformData(u,c),s.set(i,u)}return s}buildSkeleton(t,r,n,s){let a=null;return t.parents.forEach((function(t){for(const o in r){const i=r[o];i.rawBones.forEach((function(r,o){if(r.ID===t.ID){const t=a;a=new e.Bone,a.matrixWorld.copy(r.transformLink),a.name=s?e.PropertyBinding.sanitizeNodeName(s):"",a.ID=n,i.bones[o]=a,null!==t&&a.add(t)}}))}})),a}createCamera(t){let r,n;if(t.children.forEach((function(e){const t=Ti.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)r=new e.Object3D;else{let t=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(t=1);let s=1;void 0!==n.NearPlane&&(s=n.NearPlane.value/1e3);let a=1e3;void 0!==n.FarPlane&&(a=n.FarPlane.value/1e3);let o=e.$window.innerWidth,i=e.$window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(o=n.AspectWidth.value,i=n.AspectHeight.value);const c=o/i;let l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);const u=n.FocalLength?n.FocalLength.value:null;switch(t){case 0:r=new e.PerspectiveCamera(l,c,s,a),null!==u&&r.setFocalLength(u);break;case 1:r=new e.OrthographicCamera(-o/2,o/2,i/2,-i/2,s,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+t+"."),r=new e.Object3D}}return r}createLight(t){let r,n;if(t.children.forEach((function(e){const t=Ti.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)r=new e.Object3D;else{let t;t=void 0===n.LightType?0:n.LightType.value;let s=16777215;void 0!==n.Color&&(s=(new e.Color).fromArray(n.Color.value));let a=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(a=0);let o=0;void 0!==n.FarAttenuationEnd&&(o=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);const i=1;switch(t){case 0:r=new e.PointLight(s,a,o,i);break;case 1:r=new e.DirectionalLight(s,a);break;case 2:let t=Math.PI/3;void 0!==n.InnerAngle&&(t=e.MathUtils.degToRad(n.InnerAngle.value));let c=0;void 0!==n.OuterAngle&&(c=e.MathUtils.degToRad(n.OuterAngle.value),c=Math.max(c,1)),r=new e.SpotLight(s,a,o,t,c,i);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),r=new e.PointLight(s,a)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(r.castShadow=!0)}return r}createMesh(t,r,n){let s,a=null,o=null;const i=[];return t.children.forEach((function(e){r.has(e.ID)&&(a=r.get(e.ID)),n.has(e.ID)&&i.push(n.get(e.ID))})),i.length>1?o=i:i.length>0?o=i[0]:(o=new e.MeshPhongMaterial({color:13421772}),i.push(o)),"color"in a.attributes&&i.forEach((function(e){e.vertexColors=!0})),a.FBX_Deformer?(s=new e.SkinnedMesh(a,o),s.normalizeSkinWeights()):s=new e.Mesh(a,o),s}createCurve(t,r){const n=t.children.reduce((function(e,t){return r.has(t.ID)&&(e=r.get(t.ID)),e}),null),s=new e.LineBasicMaterial({color:3342591,linewidth:1});return new e.Line(n,s)}getTransformData(e,t){const r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?Hi(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(t,r){if("LookAtProperty"in r){Fi.get(t.ID).children.forEach((function(r){if("LookAtProperty"===r.relationship){const n=Ti.Objects.Model[r.ID];if("Lcl_Translation"in n){const r=n.Lcl_Translation.value;void 0!==t.target?(t.target.position.fromArray(r),ki.add(t.target)):t.lookAt((new e.Vector3).fromArray(r))}}}))}}bindSkeleton(t,r,n){const s=this.parsePoseNodes();for(const a in t){const o=t[a];Fi.get(parseInt(o.ID)).parents.forEach((function(t){if(r.has(t.ID)){const r=t.ID;Fi.get(r).parents.forEach((function(t){if(n.has(t.ID)){n.get(t.ID).bind(new e.Skeleton(o.bones),s[t.ID])}}))}}))}}parsePoseNodes(){const t={};if("Pose"in Ti.Objects){const r=Ti.Objects.Pose;for(const n in r)if("BindPose"===r[n].attrType){const s=r[n].PoseNode;Array.isArray(s)?s.forEach((function(r){t[r.Node]=(new e.Matrix4).fromArray(r.Matrix.a)})):t[s.Node]=(new e.Matrix4).fromArray(s.Matrix.a)}}return t}createAmbientLight(){if("GlobalSettings"in Ti&&"AmbientColor"in Ti.GlobalSettings){const t=Ti.GlobalSettings.AmbientColor.value,r=t[0],n=t[1],s=t[2];if(0!==r||0!==n||0!==s){const t=new e.Color(r,n,s);ki.add(new e.AmbientLight(t,1))}}}setupMorphMaterials(){const e=this;ki.traverse((function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach((function(r,n){e.setupMorphMaterial(t,r,n)})):e.setupMorphMaterial(t,t.material))}))}setupMorphMaterial(e,t,r){const n=e.uuid,s=t.uuid;let a=!1;if(ki.traverse((function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(t){t.uuid===s&&e.uuid!==n&&(a=!0)})):e.material.uuid===s&&e.uuid!==n&&(a=!0))})),!0===a){const n=t.clone();n.morphTargets=!0,void 0===r?e.material=n:e.material[r]=n}else t.morphTargets=!0}}class Ii{parse(e){const t=new Map;if("Geometry"in Ti.Objects){const r=Ti.Objects.Geometry;for(const n in r){const s=Fi.get(parseInt(n)),a=this.parseGeometry(s,r[n],e);t.set(parseInt(n),a)}}return t}parseGeometry(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,r){const n=r.skeletons,s=[],a=e.parents.map((function(e){return Ti.Objects.Model[e.ID]}));if(0===a.length)return;const o=e.children.reduce((function(e,t){return void 0!==n[t.ID]&&(e=n[t.ID]),e}),null);e.children.forEach((function(e){void 0!==r.morphTargets[e.ID]&&s.push(r.morphTargets[e.ID])}));const i=a[0],c={};"RotationOrder"in i&&(c.eulerOrder=Hi(i.RotationOrder.value)),"InheritType"in i&&(c.inheritType=parseInt(i.InheritType.value)),"GeometricTranslation"in i&&(c.translation=i.GeometricTranslation.value),"GeometricRotation"in i&&(c.rotation=i.GeometricRotation.value),"GeometricScaling"in i&&(c.scale=i.GeometricScaling.value);const l=_i(c);return this.genGeometry(t,o,s,l)}genGeometry(t,r,n,s){const a=new e.BufferGeometry;t.attrName&&(a.name=t.attrName);const o=this.parseGeoNode(t,r),i=this.genBuffers(o),c=new e.Float32BufferAttribute(i.vertex,3);if(c.applyMatrix4(s),a.setAttribute("position",c),i.colors.length>0&&a.setAttribute("color",new e.Float32BufferAttribute(i.colors,3)),r&&(a.setAttribute("skinIndex",new e.Uint16BufferAttribute(i.weightsIndices,4)),a.setAttribute("skinWeight",new e.Float32BufferAttribute(i.vertexWeights,4)),a.FBX_Deformer=r),i.normal.length>0){const t=(new e.Matrix3).getNormalMatrix(s),r=new e.Float32BufferAttribute(i.normal,3);r.applyNormalMatrix(t),a.setAttribute("normal",r)}if(i.uvs.forEach((function(t,r){let n="uv"+(r+1).toString();0===r&&(n="uv"),a.setAttribute(n,new e.Float32BufferAttribute(i.uvs[r],2))})),o.material&&"AllSame"!==o.material.mappingType){let e=i.materialIndex[0],t=0;if(i.materialIndex.forEach((function(r,n){r!==e&&(a.addGroup(t,n-t,e),e=r,t=n)})),a.groups.length>0){const t=a.groups[a.groups.length-1],r=t.start+t.count;r!==i.materialIndex.length&&a.addGroup(r,i.materialIndex.length-r,e)}0===a.groups.length&&a.addGroup(0,i.materialIndex.length,i.materialIndex[0])}return this.addMorphTargets(a,t,n,s),a}parseGeoNode(e,t){const r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(n,s){void 0===r.weightTable[n]&&(r.weightTable[n]=[]),r.weightTable[n].push({id:t,weight:e.weights[s]})}))}))),r}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let r=0,n=0,s=!1,a=[],o=[],i=[],c=[],l=[],u=[];const h=this;return e.vertexIndices.forEach((function(p,d){let f,g=!1;p<0&&(p^=-1,g=!0);let m=[],v=[];if(a.push(3*p,3*p+1,3*p+2),e.color){const t=Pi(d,r,p,e.color);i.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[p]&&e.weightTable[p].forEach((function(e){v.push(e.weight),m.push(e.id)})),v.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const e=[0,0,0,0],t=[0,0,0,0];v.forEach((function(r,n){let s=r,a=m[n];t.forEach((function(t,r,n){if(s>t){n[r]=s,s=t;const o=e[r];e[r]=a,a=o}}))})),m=e,v=t}for(;v.length<4;)v.push(0),m.push(0);for(let e=0;e<4;++e)l.push(v[e]),u.push(m[e])}if(e.normal){const t=Pi(d,r,p,e.normal);o.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=Pi(d,r,p,e.material)[0]),e.uv&&e.uv.forEach((function(e,t){const n=Pi(d,r,p,e);void 0===c[t]&&(c[t]=[]),c[t].push(n[0]),c[t].push(n[1])})),n++,g&&(h.genFace(t,e,a,f,o,i,c,l,u,n),r++,n=0,a=[],o=[],i=[],c=[],l=[],u=[])})),t}genFace(e,t,r,n,s,a,o,i,c,l){for(let u=2;u<l;u++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[3*(u-1)]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[r[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[r[3*u]]),e.vertex.push(t.vertexPositions[r[3*u+1]]),e.vertex.push(t.vertexPositions[r[3*u+2]]),t.skeleton&&(e.vertexWeights.push(i[0]),e.vertexWeights.push(i[1]),e.vertexWeights.push(i[2]),e.vertexWeights.push(i[3]),e.vertexWeights.push(i[4*(u-1)]),e.vertexWeights.push(i[4*(u-1)+1]),e.vertexWeights.push(i[4*(u-1)+2]),e.vertexWeights.push(i[4*(u-1)+3]),e.vertexWeights.push(i[4*u]),e.vertexWeights.push(i[4*u+1]),e.vertexWeights.push(i[4*u+2]),e.vertexWeights.push(i[4*u+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[4*(u-1)]),e.weightsIndices.push(c[4*(u-1)+1]),e.weightsIndices.push(c[4*(u-1)+2]),e.weightsIndices.push(c[4*(u-1)+3]),e.weightsIndices.push(c[4*u]),e.weightsIndices.push(c[4*u+1]),e.weightsIndices.push(c[4*u+2]),e.weightsIndices.push(c[4*u+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[3*(u-1)]),e.colors.push(a[3*(u-1)+1]),e.colors.push(a[3*(u-1)+2]),e.colors.push(a[3*u]),e.colors.push(a[3*u+1]),e.colors.push(a[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(n),e.materialIndex.push(n),e.materialIndex.push(n)),t.normal&&(e.normal.push(s[0]),e.normal.push(s[1]),e.normal.push(s[2]),e.normal.push(s[3*(u-1)]),e.normal.push(s[3*(u-1)+1]),e.normal.push(s[3*(u-1)+2]),e.normal.push(s[3*u]),e.normal.push(s[3*u+1]),e.normal.push(s[3*u+2])),t.uv&&t.uv.forEach((function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(o[r][0]),e.uvs[r].push(o[r][1]),e.uvs[r].push(o[r][2*(u-1)]),e.uvs[r].push(o[r][2*(u-1)+1]),e.uvs[r].push(o[r][2*u]),e.uvs[r].push(o[r][2*u+1])}))}addMorphTargets(e,t,r,n){if(0===r.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;r.forEach((function(r){r.rawTargets.forEach((function(r){const a=Ti.Objects.Geometry[r.geoID];void 0!==a&&s.genMorphGeometry(e,t,a,n,r.name)}))}))}genMorphGeometry(t,r,n,s,a){const o=void 0!==r.PolygonVertexIndex?r.PolygonVertexIndex.a:[],i=void 0!==n.Vertices?n.Vertices.a:[],c=void 0!==n.Indexes?n.Indexes.a:[],l=3*t.attributes.position.count,u=new Float32Array(l);for(let e=0;e<c.length;e++){const t=3*c[e];u[t]=i[3*e],u[t+1]=i[3*e+1],u[t+2]=i[3*e+2]}const h={vertexIndices:o,vertexPositions:u},p=this.genBuffers(h),d=new e.Float32BufferAttribute(p.vertex,3);d.name=a||n.attrName,d.applyMatrix4(s),t.morphAttributes.position.push(d)}parseNormals(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Normals.a;let s=[];return"IndexToDirect"===r&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:n,indices:s,mappingType:t,referenceType:r}}parseUVs(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.UV.a;let s=[];return"IndexToDirect"===r&&(s=e.UVIndex.a),{dataSize:2,buffer:n,indices:s,mappingType:t,referenceType:r}}parseVertexColors(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,n=e.Colors.a;let s=[];return"IndexToDirect"===r&&(s=e.ColorIndex.a),{dataSize:4,buffer:n,indices:s,mappingType:t,referenceType:r}}parseMaterialIndices(e){const t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};const n=e.Materials.a,s=[];for(let e=0;e<n.length;++e)s.push(e);return{dataSize:1,buffer:n,indices:s,mappingType:t,referenceType:r}}parseNurbsGeometry(t){if(void 0===Si)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new e.BufferGeometry;const r=parseInt(t.Order);if(isNaN(r))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new e.BufferGeometry;const n=r-1,s=t.KnotVector.a,a=[],o=t.Points.a;for(let t=0,r=o.length;t<r;t+=4)a.push((new e.Vector4).fromArray(o,t));let i,c;if("Closed"===t.Form)a.push(a[0]);else if("Periodic"===t.Form){i=n,c=s.length-1-i;for(let e=0;e<n;++e)a.push(a[e])}const l=new Si(n,s,a,i,c).getPoints(7*a.length),u=new Float32Array(3*l.length);l.forEach((function(e,t){e.toArray(u,3*t)}));const h=new e.BufferGeometry;return h.setAttribute("position",new e.BufferAttribute(u,3)),h}}class Mi{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const r in t){const n=t[r],s=this.addClip(n);e.push(s)}return e}parseClips(){if(void 0===Ti.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Ti.Objects.AnimationCurveNode,t=new Map;for(const r in e){const n=e[r];if(null!==n.attrName.match(/S|R|T|DeformPercent/)){const e={id:n.id,attr:n.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=Ti.Objects.AnimationCurve;for(const r in t){const n={id:t[r].id,times:t[r].KeyTime.a.map(Ui),values:t[r].KeyValueFloat.a},s=Fi.get(n.id);if(void 0!==s){const t=s.parents[0].ID,r=s.parents[0].relationship;r.match(/X/)?e.get(t).curves.x=n:r.match(/Y/)?e.get(t).curves.y=n:r.match(/Z/)?e.get(t).curves.z=n:r.match(/d|DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=n)}}}parseAnimationLayers(t){const r=Ti.Objects.AnimationLayer,n=new Map;for(const s in r){const r=[],a=Fi.get(parseInt(s));if(void 0!==a){a.children.forEach((function(n,s){if(t.has(n.ID)){const a=t.get(n.ID);if(void 0!==a.curves.x||void 0!==a.curves.y||void 0!==a.curves.z){if(void 0===r[s]){const t=Fi.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==t){const a=Ti.Objects.Model[t.toString()];if(void 0===a)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",n);const o={modelName:a.attrName?e.PropertyBinding.sanitizeNodeName(a.attrName):"",ID:a.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};ki.traverse((function(e){e.ID===a.id&&(o.transform=e.matrix,e.userData.transformData&&(o.eulerOrder=e.userData.transformData.eulerOrder))})),o.transform||(o.transform=new e.Matrix4),"PreRotation"in a&&(o.preRotation=a.PreRotation.value),"PostRotation"in a&&(o.postRotation=a.PostRotation.value),r[s]=o}}r[s]&&(r[s][a.attr]=a)}else if(void 0!==a.curves.morph){if(void 0===r[s]){const t=Fi.get(n.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,a=Fi.get(t).parents[0].ID,o=Fi.get(a).parents[0].ID,i=Fi.get(o).parents[0].ID,c=Ti.Objects.Model[i],l={modelName:c.attrName?e.PropertyBinding.sanitizeNodeName(c.attrName):"",morphName:Ti.Objects.Deformer[t].attrName};r[s]=l}r[s][a.attr]=a}}})),n.set(parseInt(s),r)}}return n}parseAnimStacks(e){const t=Ti.Objects.AnimationStack,r={};for(const n in t){const s=Fi.get(parseInt(n)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const a=e.get(s[0].ID);r[n]={name:t[n].attrName,layer:a}}return r}addClip(t){let r=[];const n=this;return t.layer.forEach((function(e){r=r.concat(n.generateTracks(e))})),new e.AnimationClip(t.name,-1,r)}generateTracks(t){const r=[];let n=new e.Vector3,s=new e.Quaternion,a=new e.Vector3;if(t.transform&&t.transform.decompose(n,s,a),n=n.toArray(),s=(new e.Euler).setFromQuaternion(s,t.eulerOrder).toArray(),a=a.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){const e=this.generateVectorTrack(t.modelName,t.T.curves,n,"position");void 0!==e&&r.push(e)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){const e=this.generateRotationTrack(t.modelName,t.R.curves,s,t.preRotation,t.postRotation,t.eulerOrder);void 0!==e&&r.push(e)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){const e=this.generateVectorTrack(t.modelName,t.S.curves,a,"scale");void 0!==e&&r.push(e)}if(void 0!==t.DeformPercent){const e=this.generateMorphTrack(t);void 0!==e&&r.push(e)}return r}generateVectorTrack(t,r,n,s){const a=this.getTimesForAllAxes(r),o=this.getKeyframeTrackValues(a,r,n);return new e.VectorKeyframeTrack(t+"."+s,a,o)}generateRotationTrack(t,r,n,s,a,o){void 0!==r.x&&(this.interpolateRotations(r.x),r.x.values=r.x.values.map(e.MathUtils.degToRad)),void 0!==r.y&&(this.interpolateRotations(r.y),r.y.values=r.y.values.map(e.MathUtils.degToRad)),void 0!==r.z&&(this.interpolateRotations(r.z),r.z.values=r.z.values.map(e.MathUtils.degToRad));const i=this.getTimesForAllAxes(r),c=this.getKeyframeTrackValues(i,r,n);void 0!==s&&((s=s.map(e.MathUtils.degToRad)).push(o),s=(new e.Euler).fromArray(s),s=(new e.Quaternion).setFromEuler(s)),void 0!==a&&((a=a.map(e.MathUtils.degToRad)).push(o),a=(new e.Euler).fromArray(a),a=(new e.Quaternion).setFromEuler(a).invert());const l=new e.Quaternion,u=new e.Euler,h=[];for(let e=0;e<c.length;e+=3)u.set(c[e],c[e+1],c[e+2],o),l.setFromEuler(u),void 0!==s&&l.premultiply(s),void 0!==a&&l.multiply(a),l.toArray(h,e/3*4);return new e.QuaternionKeyframeTrack(t+".quaternion",i,h)}generateMorphTrack(t){const r=t.DeformPercent.curves.morph,n=r.values.map((function(e){return e/100})),s=ki.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new e.NumberKeyframeTrack(t.modelName+".morphTargetInfluences["+s+"]",r.times,n)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,r=t[0];for(let n=1;n<t.length;n++){const s=t[n];s!==r&&(t[e]=s,r=s,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,r){const n=r,s=[];let a=-1,o=-1,i=-1;return e.forEach((function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(i=t.z.times.indexOf(e)),-1!==a){const e=t.x.values[a];s.push(e),n[0]=e}else s.push(n[0]);if(-1!==o){const e=t.y.values[o];s.push(e),n[1]=e}else s.push(n[1]);if(-1!==i){const e=t.z.values[i];s.push(e),n[2]=e}else s.push(n[2])})),s}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const r=e.values[t-1],n=e.values[t]-r,s=Math.abs(n);if(s>=180){const a=s/180,o=n/a;let i=r+o;const c=e.times[t-1],l=(e.times[t]-c)/a;let u=c+l;const h=[],p=[];for(;u<e.times[t];)h.push(u),u+=l,p.push(i),i+=o;e.times=ji(e.times,t,h),e.values=ji(e.values,t,p)}}}}class Li{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Oi,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,r=e.split(/[\r\n]+/);return r.forEach((function(e,n){const s=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(s||a)return;const o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),i=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):i?t.parseNodeProperty(e,i,r[++n]):c?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const r=t[1].trim().replace(/^"/,"").replace(/"$/,""),n=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),s={name:r},a=this.parseNodeAttr(n),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,s):r in o?("PoseNode"===r?o.PoseNode.push(s):void 0!==o[r].id&&(o[r]={},o[r][o[r].id]=o[r]),""!==a.id&&(o[r][a.id]=s)):"number"==typeof a.id?(o[r]={},o[r][a.id]=s):"Properties70"!==r&&(o[r]="PoseNode"===r?[s]:s),"number"==typeof a.id&&(s.id=a.id),""!==a.name&&(s.attrName=a.name),""!==a.type&&(s.attrType=a.type),this.pushStack(s)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let r="",n="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:t,name:r,type:n}}parseNodeProperty(e,t,r){let n=t[1].replace(/^"/,"").replace(/"$/,"").trim(),s=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===s&&(s=r.replace(/"/g,"").replace(/,$/,"").trim());const a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===n){const e=s.split(",").slice(1),t=parseInt(e[0]),r=parseInt(e[1]);let o=s.split(",").slice(3);o=o.map((function(e){return e.trim().replace(/^"/,"")})),n="connections",s=[t,r],function(e,t){for(let r=0,n=e.length,s=t.length;r<s;r++,n++)e[n]=t[r]}(s,o),void 0===a[n]&&(a[n]=[])}"Node"===n&&(a.id=s),n in a&&Array.isArray(a[n])?a[n].push(s):"a"!==n?a[n]=s:a.a=s,this.setCurrentProp(a,n),"a"===n&&","!==s.slice(-1)&&(a.a=Vi(s))}else this.parseNodeSpecialProperty(e,n,s)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=Vi(t.a))}parseNodeSpecialProperty(e,t,r){const n=r.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),s=n[0],a=n[1],o=n[2],i=n[3];let c=n[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=Vi(c)}this.getPrevNode()[s]={type:a,type2:o,flag:i,value:c},this.setCurrentProp(this.getPrevNode(),s)}}class Ci{parse(e){const t=new Ri(e);t.skip(23);const r=t.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);const n=new Oi;for(;!this.endOfContent(t);){const e=this.parseNode(t,r);null!==e&&n.add(e.name,e)}return n}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const r={},n=t>=7500?e.getUint64():e.getUint32(),s=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const a=e.getUint8(),o=e.getString(a);if(0===n)return null;const i=[];for(let t=0;t<s;t++)i.push(this.parseProperty(e));const c=i.length>0?i[0]:"",l=i.length>1?i[1]:"",u=i.length>2?i[2]:"";for(r.singleProperty=1===s&&e.getOffset()===n;n>e.getOffset();){const n=this.parseNode(e,t);null!==n&&this.parseSubNode(o,r,n)}return r.propertyList=i,"number"==typeof c&&(r.id=c),""!==l&&(r.attrName=l),""!==u&&(r.attrType=u),""!==o&&(r.name=o),r}parseSubNode(e,t,r){if(!0===r.singleProperty){const e=r.propertyList[0];Array.isArray(e)?(t[r.name]=r,r.a=e):t[r.name]=e}else if("Connections"===e&&"C"===r.name){const e=[];r.propertyList.forEach((function(t,r){0!==r&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===r.name){Object.keys(r).forEach((function(e){t[e]=r[e]}))}else if("Properties70"===e&&"P"===r.name){let e=r.propertyList[0],n=r.propertyList[1];const s=r.propertyList[2],a=r.propertyList[3];let o;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===n.indexOf("Lcl ")&&(n=n.replace("Lcl ","Lcl_")),o="Color"===n||"ColorRGB"===n||"Vector"===n||"Vector3D"===n||0===n.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[e]={type:n,type2:s,flag:a,value:o}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)}parseProperty(e){const t=e.getString(1);let r;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return r=e.getUint32(),e.getArrayBuffer(r);case"S":return r=e.getUint32(),e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const n=e.getUint32(),s=e.getUint32(),a=e.getUint32();if(0===s)switch(t){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}void 0===xi&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const o=qo(new Uint8Array(e.getArrayBuffer(a))),i=new Ri(o.buffer);switch(t){case"b":case"c":return i.getBooleanArray(n);case"d":return i.getFloat64Array(n);case"f":return i.getFloat32Array(n);case"i":return i.getInt32Array(n);case"l":return i.getInt64Array(n)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Ri{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(e){const t=[];for(let r=0;r<e;r++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(t){let r=[];for(let e=0;e<t;e++)r[e]=this.getUint8();const n=r.indexOf(0);return n>=0&&(r=r.slice(0,n)),e.LoaderUtils.decodeText(new Uint8Array(r))}}class Oi{add(e,t){this[e]=t}}function Ni(e){const t=e.match(/FBXVersion: (\d+)/);if(t){return parseInt(t[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Ui(e){return e/46186158e3}const Di=[];function Pi(e,t,r,n){let s;switch(n.mappingType){case"ByPolygonVertex":s=e;break;case"ByPolygon":s=t;break;case"ByVertice":s=r;break;case"AllSame":s=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}"IndexToDirect"===n.referenceType&&(s=n.indices[s]);const a=s*n.dataSize,o=a+n.dataSize;return function(e,t,r,n){for(let s=r,a=0;s<n;s++,a++)e[a]=t[s];return e}(Di,n.buffer,a,o)}const Bi=new e.Euler,Gi=new e.Vector3;function _i(t){const r=new e.Matrix4,n=new e.Matrix4,s=new e.Matrix4,a=new e.Matrix4,o=new e.Matrix4,i=new e.Matrix4,c=new e.Matrix4,l=new e.Matrix4,u=new e.Matrix4,h=new e.Matrix4,p=new e.Matrix4,d=new e.Matrix4,f=t.inheritType?t.inheritType:0;if(t.translation&&r.setPosition(Gi.fromArray(t.translation)),t.preRotation){const r=t.preRotation.map(e.MathUtils.degToRad);r.push(t.eulerOrder),n.makeRotationFromEuler(Bi.fromArray(r))}if(t.rotation){const r=t.rotation.map(e.MathUtils.degToRad);r.push(t.eulerOrder),s.makeRotationFromEuler(Bi.fromArray(r))}if(t.postRotation){const r=t.postRotation.map(e.MathUtils.degToRad);r.push(t.eulerOrder),a.makeRotationFromEuler(Bi.fromArray(r)),a.invert()}t.scale&&o.scale(Gi.fromArray(t.scale)),t.scalingOffset&&c.setPosition(Gi.fromArray(t.scalingOffset)),t.scalingPivot&&i.setPosition(Gi.fromArray(t.scalingPivot)),t.rotationOffset&&l.setPosition(Gi.fromArray(t.rotationOffset)),t.rotationPivot&&u.setPosition(Gi.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(p.copy(t.parentMatrix),h.copy(t.parentMatrixWorld));const g=(new e.Matrix4).copy(n).multiply(s).multiply(a),m=new e.Matrix4;m.extractRotation(h);const v=new e.Matrix4;v.copyPosition(h);const y=new e.Matrix4,b=(new e.Matrix4).copy(v).invert().multiply(h);y.copy(m).invert().multiply(b);const x=o,w=new e.Matrix4;if(0===f)w.copy(m).multiply(g).multiply(y).multiply(x);else if(1===f)w.copy(m).multiply(y).multiply(g).multiply(x);else{const t=(new e.Matrix4).scale((new e.Vector3).setFromMatrixScale(p)),r=(new e.Matrix4).copy(t).invert(),n=(new e.Matrix4).copy(y).multiply(r);w.copy(m).multiply(g).multiply(n).multiply(x)}const S=new e.Matrix4;S.copy(u).invert();const T=new e.Matrix4;T.copy(i).invert();let F=new e.Matrix4;F.copy(r).multiply(l).multiply(u).multiply(n).multiply(s).multiply(a).multiply(S).multiply(c).multiply(i).multiply(o).multiply(T);const k=(new e.Matrix4).copyPosition(F),E=(new e.Matrix4).copy(h).multiply(k);return d.copyPosition(E),F=(new e.Matrix4).copy(d).multiply(w),F.premultiply(h.invert()),F}function Hi(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function Vi(e){return e.split(",").map((function(e){return parseFloat(e)}))}function zi(t,r,n){return void 0===r&&(r=0),void 0===n&&(n=t.byteLength),e.LoaderUtils.decodeText(new Uint8Array(t,r,n))}function ji(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}function Wi(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}return r}function Xi(e){this.IFF=e}function qi(e){this.IFF=e}function Yi(){this.debugger=new Zi}function Ki(e){this.dv=new DataView(e),this.offset=0}function Zi(){this.active=!1,this.depth=0,this.formList=[]}function Qi(e){return e%2}function $i(e){return e.length+1+(Qi(e.length+1)?1:0)}let Ji;Xi.prototype={constructor:Xi,parseBlock:function(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();var e=this.IFF.reader.getIDTag(),t=this.IFF.reader.getUint32();switch(t>this.IFF.reader.dv.byteLength-this.IFF.reader.offset&&(this.IFF.reader.offset-=4,t=this.IFF.reader.getUint16()),this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=t,e){case"FORM":this.IFF.parseForm(t);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"AUVO":case"STCK":case"PROC":case"VALU":case"FUNC":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NVSK":case"NCRD":case"WRPW":case"WRPH":case"NMOD":case"NPRW":case"NPLA":case"NODS":case"VERS":case"ENUM":case"TAG ":case"OPAC":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"GLOW":case"GVAL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"LINE":case"ALPH":case"VCOL":case"ENAB":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"SURF":this.IFF.parseSurfaceLwo2(t);break;case"CLIP":this.IFF.parseClipLwo2(t);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":4===t?this.IFF.currentNode[e]=this.IFF.reader.getInt32():this.IFF.reader.skip(t);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(t);break;case"PNTS":this.IFF.parsePoints(t);break;case"VMAP":this.IFF.parseVertexMapping(t);break;case"AUVU":case"AUVN":this.IFF.reader.skip(t-1),this.IFF.reader.getVariableLengthIndex();break;case"POLS":this.IFF.parsePolygonList(t);break;case"TAGS":this.IFF.parseTagStrings(t);break;case"PTAG":this.IFF.parsePolygonTagMapping(t);break;case"VMAD":this.IFF.parseVertexMapping(t,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":var r=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=r;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":4===t?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(t);break;case"SMAN":var n=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(n<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.reader.skip(2);break;case"TMAP":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(t);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;case"BLOK":break;default:this.IFF.parseUnknownCHUNK(e,t)}"FORM"!=e&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=e,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}},qi.prototype={constructor:qi,parseBlock:function(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();var e=this.IFF.reader.getIDTag(),t=this.IFF.reader.getUint32();switch(this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=t,e){case"FORM":this.IFF.parseForm(t);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"STCK":case"VALU":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NCRD":case"NMOD":case"NSEL":case"NPRW":case"NPLA":case"VERS":case"ENUM":case"TAG ":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"GLOW":case"LINE":case"ALPH":case"VCOL":case"ENAB":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(t);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":4===t?this.IFF.currentNode[e]=this.IFF.reader.getInt32():this.IFF.reader.skip(t);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(t);break;case"PNTS":this.IFF.parsePoints(t);break;case"VMAP":this.IFF.parseVertexMapping(t);break;case"POLS":this.IFF.parsePolygonList(t);break;case"TAGS":this.IFF.parseTagStrings(t);break;case"PTAG":this.IFF.parsePolygonTagMapping(t);break;case"VMAD":this.IFF.parseVertexMapping(t,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":var r=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=r;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":4===t?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(t);break;case"SMAN":var n=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(n<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.currentSurface.attributes.imageMapIndex=this.IFF.reader.getUint32();break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(t);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;default:this.IFF.parseUnknownCHUNK(e,t)}"FORM"!=e&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=e,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}},Yi.prototype={constructor:Yi,parse:function(e){if(this.reader=new Ki(e),this.tree={materials:{},layers:[],tags:[],textures:[]},this.currentLayer=this.tree,this.currentForm=this.tree,this.parseTopForm(),void 0!==this.tree.format){if("LWO2"===this.tree.format)for(this.parser=new Xi(this);!this.reader.endOfFile();)this.parser.parseBlock();else if("LWO3"===this.tree.format)for(this.parser=new qi(this);!this.reader.endOfFile();)this.parser.parseBlock();return this.debugger.offset=this.reader.offset,this.debugger.closeForms(),this.tree}},parseTopForm(){if(this.debugger.offset=this.reader.offset,"FORM"===this.reader.getIDTag()){var e=this.reader.getUint32();this.debugger.dataOffset=this.reader.offset,this.debugger.length=e;var t=this.reader.getIDTag();("LWO2"===t||"LWO3"===t)&&(this.tree.format=t),this.debugger.node=0,this.debugger.nodeID=t,this.debugger.log()}else console.warn("LWOLoader: Top-level FORM missing.")},parseForm(e){var t=this.reader.getIDTag();switch(t){case"ISEQ":case"ANIM":case"STCC":case"VPVL":case"VPRM":case"NROT":case"WRPW":case"WRPH":case"FUNC":case"FALL":case"OPAC":case"GRAD":case"ENVS":case"VMOP":case"VMBG":case"OMAX":case"STEX":case"CKBG":case"CKEY":case"VMLA":case"VMLB":this.debugger.skipped=!0,this.skipForm(e);break;case"META":case"NNDS":case"NODS":case"NDTA":case"ADAT":case"AOVS":case"BLOK":case"IBGC":case"IOPC":case"IIMG":case"TXTR":this.debugger.length=4,this.debugger.skipped=!0;break;case"IFAL":case"ISCL":case"IPOS":case"IROT":case"IBMP":case"IUTD":case"IVTD":this.parseTextureNodeAttribute(t);break;case"ENVL":this.parseEnvelope(e);break;case"CLIP":"LWO2"===this.tree.format?this.parseForm(e):this.parseClip(e);break;case"STIL":this.parseImage();break;case"XREF":this.reader.skip(8),this.currentForm.referenceTexture={index:this.reader.getUint32(),refName:this.reader.getString()};break;case"IMST":this.parseImageStateForm(e);break;case"SURF":this.parseSurfaceForm(e);break;case"VALU":this.parseValueForm(e);break;case"NTAG":this.parseSubNode(e);break;case"ATTR":case"SATR":this.setupForm("attributes",e);break;case"NCON":this.parseConnections(e);break;case"SSHA":this.parentForm=this.currentForm,this.currentForm=this.currentSurface,this.setupForm("surfaceShader",e);break;case"SSHD":this.setupForm("surfaceShaderData",e);break;case"ENTR":this.parseEntryForm(e);break;case"IMAP":this.parseImageMap(e);break;case"TAMP":this.parseXVAL("amplitude",e);break;case"TMAP":this.setupForm("textureMap",e);break;case"CNTR":this.parseXVAL3("center",e);break;case"SIZE":this.parseXVAL3("scale",e);break;case"ROTA":this.parseXVAL3("rotation",e);break;default:this.parseUnknownForm(t,e)}this.debugger.node=0,this.debugger.nodeID=t,this.debugger.log()},setupForm(e,t){this.currentForm||(this.currentForm=this.currentNode),this.currentFormEnd=this.reader.offset+t,this.parentForm=this.currentForm,this.currentForm[e]?(console.warn("LWOLoader: form already exists on parent: ",e,this.currentForm),this.currentForm=this.currentForm[e]):(this.currentForm[e]={},this.currentForm=this.currentForm[e])},skipForm(e){this.reader.skip(e-4)},parseUnknownForm(t,r){var n,s,a;console.warn("LWOLoader: unknown FORM encountered: "+t,r),n=this.reader.dv.buffer,s=this.reader.offset,a=r-4,console.log(e.LoaderUtils.decodeText(new Uint8Array(n,s,a))),this.reader.skip(r-4)},parseSurfaceForm(e){this.reader.skip(8);var t=this.reader.getString(),r={attributes:{},connections:{},name:t,inputName:t,nodes:{},source:this.reader.getString()};this.tree.materials[t]=r,this.currentSurface=r,this.parentForm=this.tree.materials,this.currentForm=r,this.currentFormEnd=this.reader.offset+e},parseSurfaceLwo2(e){var t=this.reader.getString(),r={attributes:{},connections:{},name:t,nodes:{},source:this.reader.getString()};this.tree.materials[t]=r,this.currentSurface=r,this.parentForm=this.tree.materials,this.currentForm=r,this.currentFormEnd=this.reader.offset+e},parseSubNode(e){this.reader.skip(8);var t={name:this.reader.getString()};this.currentForm=t,this.currentNode=t,this.currentFormEnd=this.reader.offset+e},parseConnections(e){this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.currentForm=this.currentSurface.connections},parseEntryForm(e){this.reader.skip(8);var t=this.reader.getString();this.currentForm=this.currentNode.attributes,this.setupForm(t,e)},parseValueForm(){this.reader.skip(8);var e=this.reader.getString();"double"===e?this.currentForm.value=this.reader.getUint64():"int"===e?this.currentForm.value=this.reader.getUint32():"vparam"===e?(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64()):"vparam3"===e&&(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64Array(3))},parseImageStateForm(){this.reader.skip(8),this.currentForm.mipMapLevel=this.reader.getFloat32()},parseImageMap(e){this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.currentForm.maps||(this.currentForm.maps=[]);var t={};this.currentForm.maps.push(t),this.currentForm=t,this.reader.skip(10)},parseTextureNodeAttribute(e){switch(this.reader.skip(28),this.reader.skip(20),e){case"ISCL":this.currentNode.scale=this.reader.getFloat32Array(3);break;case"IPOS":this.currentNode.position=this.reader.getFloat32Array(3);break;case"IROT":this.currentNode.rotation=this.reader.getFloat32Array(3);break;case"IFAL":this.currentNode.falloff=this.reader.getFloat32Array(3);break;case"IBMP":this.currentNode.amplitude=this.reader.getFloat32();break;case"IUTD":this.currentNode.uTiles=this.reader.getFloat32();break;case"IVTD":this.currentNode.vTiles=this.reader.getFloat32()}this.reader.skip(2)},parseEnvelope(e){this.reader.skip(e-4)},parseClip(e){if("FORM"===this.reader.getIDTag())return this.reader.skip(16),void(this.currentNode.fileName=this.reader.getString());this.reader.setOffset(this.reader.offset-4),this.currentFormEnd=this.reader.offset+e,this.parentForm=this.currentForm,this.reader.skip(8);var t={index:this.reader.getUint32()};this.tree.textures.push(t),this.currentForm=t},parseClipLwo2(e){for(var t={index:this.reader.getUint32(),fileName:""};;){var r=this.reader.getIDTag(),n=this.reader.getUint16();if("STIL"===r){t.fileName=this.reader.getString();break}if(n>=e)break}this.tree.textures.push(t),this.currentForm=t},parseImage(){this.reader.skip(8),this.currentForm.fileName=this.reader.getString()},parseXVAL(e,t){var r=this.reader.offset+t-4;this.reader.skip(8),this.currentForm[e]=this.reader.getFloat32(),this.reader.setOffset(r)},parseXVAL3(e,t){var r=this.reader.offset+t-4;this.reader.skip(8),this.currentForm[e]={x:this.reader.getFloat32(),y:this.reader.getFloat32(),z:this.reader.getFloat32()},this.reader.setOffset(r)},parseObjectTag(){this.tree.objectTags||(this.tree.objectTags={}),this.tree.objectTags[this.reader.getIDTag()]={tagString:this.reader.getString()}},parseLayer(e){var t={number:this.reader.getUint16(),flags:this.reader.getUint16(),pivot:this.reader.getFloat32Array(3),name:this.reader.getString()};this.tree.layers.push(t),this.currentLayer=t;var r=16+$i(this.currentLayer.name);this.currentLayer.parent=r<e?this.reader.getUint16():-1},parsePoints(e){this.currentPoints=[];for(var t=0;t<e/4;t+=3)this.currentPoints.push(this.reader.getFloat32(),this.reader.getFloat32(),-this.reader.getFloat32())},parseVertexMapping(e,t){var r=this.reader.offset+e,n=this.reader.getString();if(this.reader.offset!==r){this.reader.setOffset(this.reader.offset-$i(n));var s=this.reader.getIDTag();this.reader.getUint16();var a=this.reader.getString(),o=e-6-$i(a);switch(s){case"TXUV":this.parseUVMapping(a,r,t);break;case"MORF":case"SPOT":this.parseMorphTargets(a,r,s);break;case"APSL":case"NORM":case"WGHT":case"MNVW":case"PICK":case"RGB ":case"RGBA":this.reader.skip(o);break;default:console.warn("LWOLoader: unknown vertex map type: "+s),this.reader.skip(o)}}else this.currentForm.UVChannel=n},parseUVMapping(e,t,r){for(var n=[],s=[],a=[];this.reader.offset<t;)n.push(this.reader.getVariableLengthIndex()),r&&s.push(this.reader.getVariableLengthIndex()),a.push(this.reader.getFloat32(),this.reader.getFloat32());r?(this.currentLayer.discontinuousUVs||(this.currentLayer.discontinuousUVs={}),this.currentLayer.discontinuousUVs[e]={uvIndices:n,polyIndices:s,uvs:a}):(this.currentLayer.uvs||(this.currentLayer.uvs={}),this.currentLayer.uvs[e]={uvIndices:n,uvs:a})},parseMorphTargets(e,t,r){var n=[],s=[];for(r="MORF"===r?"relative":"absolute";this.reader.offset<t;)n.push(this.reader.getVariableLengthIndex()),s.push(this.reader.getFloat32(),this.reader.getFloat32(),-this.reader.getFloat32());this.currentLayer.morphTargets||(this.currentLayer.morphTargets={}),this.currentLayer.morphTargets[e]={indices:n,points:s,type:r}},parsePolygonList(e){for(var t=this.reader.offset+e,r=this.reader.getIDTag(),n=[],s=[];this.reader.offset<t;){var a=this.reader.getUint16();a&=1023,s.push(a);for(var o=0;o<a;o++)n.push(this.reader.getVariableLengthIndex())}var i={type:r,vertexIndices:n,polygonDimensions:s,points:this.currentPoints};1===s[0]?i.type="points":2===s[0]&&(i.type="lines"),this.currentLayer.geometry=i},parseTagStrings(e){this.tree.tags=this.reader.getStringArray(e)},parsePolygonTagMapping(e){var t=this.reader.offset+e;"SURF"===this.reader.getIDTag()?this.parseMaterialIndices(t):this.reader.skip(e-4)},parseMaterialIndices(e){for(this.currentLayer.geometry.materialIndices=[];this.reader.offset<e;){var t=this.reader.getVariableLengthIndex(),r=this.reader.getUint16();this.currentLayer.geometry.materialIndices.push(t,r)}},parseUnknownCHUNK(e,t){console.warn("LWOLoader: unknown chunk type: "+e+" length: "+t);var r=this.reader.getString(t);this.currentForm[e]=r}},Ki.prototype={constructor:Ki,size:function(){return this.dv.buffer.byteLength},setOffset(e){e>0&&e<this.dv.buffer.byteLength?this.offset=e:console.error("LWOLoader: invalid buffer offset")},endOfFile:function(){return this.offset>=this.size()},skip:function(e){this.offset+=e},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getUint16:function(){var e=this.dv.getUint16(this.offset);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,!1);return this.offset+=4,e},getUint32:function(){var e=this.dv.getUint32(this.offset,!1);return this.offset+=4,e},getUint64:function(){return 4294967296*this.getUint32()+this.getUint32()},getFloat32:function(){var e=this.dv.getFloat32(this.offset,!1);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],r=0;r<e;r++)t.push(this.getFloat64());return t},getVariableLengthIndex(){var e=this.getUint8();return 255===e?65536*this.getUint8()+256*this.getUint8()+this.getUint8():256*e+this.getUint8()},getIDTag(){return this.getString(4)},getString:function(t){if(0!==t){var r=[];if(t)for(var n=0;n<t;n++)r[n]=this.getUint8();else{for(var s,a=0;0!==s;)0!==(s=this.getUint8())&&r.push(s),a++;Qi(a+1)||this.getUint8()}return e.LoaderUtils.decodeText(new Uint8Array(r))}},getStringArray:function(e){var t=this.getString(e);return(t=t.split("\0")).filter(Boolean)}},Zi.prototype={constructor:Zi,enable:function(){this.active=!0},log:function(){if(this.active){var e;switch(this.node){case 0:e="FORM";break;case 1:e="CHK";break;case 2:e="S-CHK"}console.log("| ".repeat(this.depth)+e,this.nodeID,`( ${this.offset} ) -> ( ${this.dataOffset+this.length} )`,0==this.node?" {":"",this.skipped?"SKIPPED":"",0==this.node&&this.skipped?"}":""),0!=this.node||this.skipped||(this.depth+=1,this.formList.push(this.dataOffset+this.length)),this.skipped=!1}},closeForms:function(){if(this.active)for(var e=this.formList.length-1;e>=0;e--)this.offset>=this.formList[e]&&(this.depth-=1,console.log("| ".repeat(this.depth)+"}"),this.formList.splice(-1,1))}};class ec extends e.Loader{constructor(e,t={}){super(e),this.resourcePath=void 0!==t.resourcePath?t.resourcePath:""}load(t,r,n,s){const a=this,o=""===a.path?function(e,t){const r=e.indexOf(t);return-1===r?"./":e.substr(0,r)}(t,"Objects"):a.path,i=t.split(o).pop().split(".")[0],c=new e.FileLoader(this.manager);c.setPath(a.path),c.setResponseType("arraybuffer"),c.load(t,(function(e){try{r(a.parse(e,o,i))}catch(e){s?s(e):console.error(e),a.manager.itemError(t)}}),n,s)}parse(t,r,n){Ji=(new Yi).parse(t);const s=new e.TextureLoader(this.manager).setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin);return new tc(s).parse(n)}}class tc{constructor(e){this.textureLoader=e}parse(e){return this.materials=new rc(this.textureLoader).parse(),this.defaultLayerName=e,this.meshes=this.parseLayers(),{materials:this.materials,meshes:this.meshes}}parseLayers(){const e=[],t=[],r=new nc,n=this;return Ji.layers.forEach((function(s){const a=r.parse(s.geometry,s),o=n.parseMesh(a,s);e[s.number]=o,-1===s.parent?t.push(o):e[s.parent].add(o)})),this.applyPivots(t),t}parseMesh(t,r){let n;const s=this.getMaterials(t.userData.matNames,r.geometry.type);return this.duplicateUVs(t,s),n="points"===r.geometry.type?new e.Points(t,s):"lines"===r.geometry.type?new e.LineSegments(t,s):new e.Mesh(t,s),r.name?n.name=r.name:n.name=this.defaultLayerName+"_layer_"+r.number,n.userData.pivot=r.pivot,n}applyPivots(e){e.forEach((function(e){e.traverse((function(e){const t=e.userData.pivot;if(e.position.x+=t[0],e.position.y+=t[1],e.position.z+=t[2],e.parent){const t=e.parent.userData.pivot;e.position.x-=t[0],e.position.y-=t[1],e.position.z-=t[2]}}))}))}getMaterials(t,r){const n=[],s=this;t.forEach((function(e,t){n[t]=s.getMaterialByName(e)})),"points"!==r&&"lines"!==r||n.forEach((function(t,s){const a={color:t.color};"points"===r?(a.size=.1,a.map=t.map,a.morphTargets=t.morphTargets,n[s]=new e.PointsMaterial(a)):"lines"===r&&(n[s]=new e.LineBasicMaterial(a))}));const a=n.filter(Boolean);return 1===a.length?a[0]:n}getMaterialByName(e){return this.materials.filter((function(t){return t.name===e}))[0]}duplicateUVs(t,r){let n=!1;Array.isArray(r)?r.forEach((function(e){e.aoMap&&(n=!0)})):r.aoMap&&(n=!0),n&&t.setAttribute("uv2",new e.BufferAttribute(t.attributes.uv.array,2))}}class rc{constructor(e){this.textureLoader=e}parse(){const e=[];this.textures={};for(const t in Ji.materials)"LWO3"===Ji.format?e.push(this.parseMaterial(Ji.materials[t],t,Ji.textures)):"LWO2"===Ji.format&&e.push(this.parseMaterialLwo2(Ji.materials[t],t,Ji.textures));return e}parseMaterial(e,t,r){let n={name:t,side:this.getSide(e.attributes),flatShading:this.getSmooth(e.attributes)};const s=this.parseConnections(e.connections,e.nodes),a=this.parseTextureNodes(s.maps);this.parseAttributeImageMaps(s.attributes,r,a,e.maps);const o=this.parseAttributes(s.attributes,a);this.parseEnvMap(s,a,o),n=Object.assign(a,n),n=Object.assign(n,o);return new(this.getMaterialType(s.attributes))(n)}parseMaterialLwo2(t,r){let n={name:r,side:this.getSide(t.attributes),flatShading:this.getSmooth(t.attributes)};const s=this.parseAttributes(t.attributes,{});return n=Object.assign(n,s),new e.MeshPhongMaterial(n)}getSide(t){if(!t.side)return e.BackSide;switch(t.side){case 0:case 1:return e.BackSide;case 2:return e.FrontSide;case 3:return e.DoubleSide}}getSmooth(e){return!e.smooth||!e.smooth}parseConnections(e,t){const r={maps:{}},n=e.inputName,s=e.inputNodeName,a=e.nodeName,o=this;return n.forEach((function(e,n){if("Material"===e){const e=o.getNodeByRefName(s[n],t);r.attributes=e.attributes,r.envMap=e.fileName,r.name=s[n]}})),a.forEach((function(e,a){e===r.name&&(r.maps[n[a]]=o.getNodeByRefName(s[a],t))})),r}getNodeByRefName(e,t){for(const r in t)if(t[r].refName===e)return t[r]}parseTextureNodes(t){const r={};for(const n in t){const s=t[n],a=s.fileName;if(!a)return;const o=this.loadTexture(a);switch(void 0!==s.widthWrappingMode&&(o.wrapS=this.getWrappingType(s.widthWrappingMode)),void 0!==s.heightWrappingMode&&(o.wrapT=this.getWrappingType(s.heightWrappingMode)),n){case"Color":r.map=o;break;case"Roughness":r.roughnessMap=o,r.roughness=.5;break;case"Specular":r.specularMap=o,r.specular=16777215;break;case"Luminous":r.emissiveMap=o,r.emissive=8421504;break;case"Luminous Color":r.emissive=8421504;break;case"Metallic":r.metalnessMap=o,r.metalness=.5;break;case"Transparency":case"Alpha":r.alphaMap=o,r.transparent=!0;break;case"Normal":r.normalMap=o,void 0!==s.amplitude&&(r.normalScale=new e.Vector2(s.amplitude,s.amplitude));break;case"Bump":r.bumpMap=o}}return r.roughnessMap&&r.specularMap&&delete r.specularMap,r}parseAttributeImageMaps(e,t,r){for(const n in e){const s=e[n];if(s.maps){const e=s.maps[0],a=this.getTexturePathByIndex(e.imageIndex,t);if(!a)return;const o=this.loadTexture(a);switch(void 0!==e.wrap&&(o.wrapS=this.getWrappingType(e.wrap.w)),void 0!==e.wrap&&(o.wrapT=this.getWrappingType(e.wrap.h)),n){case"Color":r.map=o;break;case"Diffuse":r.aoMap=o;break;case"Roughness":r.roughnessMap=o,r.roughness=1;break;case"Specular":r.specularMap=o,r.specular=16777215;break;case"Luminosity":r.emissiveMap=o,r.emissive=8421504;break;case"Metallic":r.metalnessMap=o,r.metalness=1;break;case"Transparency":case"Alpha":r.alphaMap=o,r.transparent=!0;break;case"Normal":r.normalMap=o;break;case"Bump":r.bumpMap=o}}}}parseAttributes(t,r){const n={};return t.Color&&!r.map?n.color=(new e.Color).fromArray(t.Color.value):n.color=new e.Color,t.Transparency&&0!==t.Transparency.value&&(n.opacity=1-t.Transparency.value,n.transparent=!0),t["Bump Height"]&&(n.bumpScale=.1*t["Bump Height"].value),t["Refraction Index"]&&(n.refractionRatio=1/t["Refraction Index"].value),this.parsePhysicalAttributes(n,t,r),this.parseStandardAttributes(n,t,r),this.parsePhongAttributes(n,t,r),n}parsePhysicalAttributes(e,t){t.Clearcoat&&t.Clearcoat.value>0&&(e.clearcoat=t.Clearcoat.value,t["Clearcoat Gloss"]&&(e.clearcoatRoughness=.5*(1-t["Clearcoat Gloss"].value)))}parseStandardAttributes(t,r,n){r.Luminous&&(t.emissiveIntensity=r.Luminous.value,r["Luminous Color"]&&!n.emissive?t.emissive=(new e.Color).fromArray(r["Luminous Color"].value):t.emissive=new e.Color(8421504)),r.Roughness&&!n.roughnessMap&&(t.roughness=r.Roughness.value),r.Metallic&&!n.metalnessMap&&(t.metalness=r.Metallic.value)}parsePhongAttributes(t,r,n){r.Diffuse&&t.color.multiplyScalar(r.Diffuse.value),r.Reflection&&(t.reflectivity=r.Reflection.value,t.combine=e.AddOperation),r.Luminosity&&(t.emissiveIntensity=r.Luminosity.value,n.emissiveMap||n.map?t.emissive=new e.Color(8421504):t.emissive=t.color),r.Roughness||!r.Specular||n.specularMap||(r["Color Highlight"]?t.specular=(new e.Color).setScalar(r.Specular.value).lerp(t.color.clone().multiplyScalar(r.Specular.value),r["Color Highlight"].value):t.specular=(new e.Color).setScalar(r.Specular.value)),t.specular&&r.Glossiness&&(t.shininess=7+Math.pow(2,12*r.Glossiness.value+2))}parseEnvMap(t,r,n){if(t.envMap){const s=this.loadTexture(t.envMap);n.transparent&&n.opacity<.999?(s.mapping=e.EquirectangularRefractionMapping,void 0!==n.reflectivity&&(delete n.reflectivity,delete n.combine),void 0!==n.metalness&&delete n.metalness):s.mapping=e.EquirectangularReflectionMapping,r.envMap=s}}getTexturePathByIndex(e){let t="";return Ji.textures?(Ji.textures.forEach((function(r){r.index===e&&(t=r.fileName)})),t):t}loadTexture(e){if(!e)return null;return this.textureLoader.load(e,void 0,void 0,(function(){console.warn("LWOLoader: non-standard resource hierarchy. Use `resourcePath` parameter to specify root content directory.")}))}getWrappingType(t){switch(t){case 0:return console.warn('LWOLoader: "Reset" texture wrapping type is not supported in three.js'),e.ClampToEdgeWrapping;case 1:return e.RepeatWrapping;case 2:return e.MirroredRepeatWrapping;case 3:return e.ClampToEdgeWrapping}}getMaterialType(t){return t.Clearcoat&&t.Clearcoat.value>0?e.MeshPhysicalMaterial:t.Roughness?e.MeshStandardMaterial:e.MeshPhongMaterial}}class nc{parse(t,r){const n=new e.BufferGeometry;n.setAttribute("position",new e.Float32BufferAttribute(t.points,3));const s=this.splitIndices(t.vertexIndices,t.polygonDimensions);return n.setIndex(s),this.parseGroups(n,t),n.computeVertexNormals(),this.parseUVs(n,r,s),this.parseMorphTargets(n,r,s),n.translate(-r.pivot[0],-r.pivot[1],-r.pivot[2]),n}splitIndices(e,t){const r=[];let n=0;return t.forEach((function(t){if(t<4)for(let s=0;s<t;s++)r.push(e[n+s]);else if(4===t)r.push(e[n],e[n+1],e[n+2],e[n],e[n+2],e[n+3]);else if(t>4){for(let s=1;s<t-1;s++)r.push(e[n],e[n+s],e[n+s+1]);console.warn("LWOLoader: polygons with greater than 4 sides are not supported")}n+=t})),r}parseGroups(e,t){const r=Ji.tags,n=[];let s=3;"lines"===t.type&&(s=2),"points"===t.type&&(s=1);const a=this.splitMaterialIndices(t.polygonDimensions,t.materialIndices);let o=0;const i={};let c,l,u=0,h=0;for(let t=0;t<a.length;t+=2){if(l=a[t+1],0===t&&(n[o]=r[l]),void 0===c&&(c=l),l!==c){let t;i[r[c]]?t=i[r[c]]:(t=o,i[r[c]]=o,n[o]=r[c],o++),e.addGroup(u,h,t),u+=h,c=l,h=0}h+=s}if(e.groups.length>0){let t;i[r[l]]?t=i[r[l]]:(t=o,i[r[l]]=o,n[o]=r[l]),e.addGroup(u,h,t)}e.userData.matNames=n}splitMaterialIndices(e,t){const r=[];return e.forEach((function(e,n){if(e<=3)r.push(t[2*n],t[2*n+1]);else if(4===e)r.push(t[2*n],t[2*n+1],t[2*n],t[2*n+1]);else for(let s=0;s<e-2;s++)r.push(t[2*n],t[2*n+1])})),r}parseUVs(t,r){const n=Array.from(Array(2*t.attributes.position.count),(function(){return 0}));for(const e in r.uvs){const t=r.uvs[e].uvs;r.uvs[e].uvIndices.forEach((function(e,r){n[2*e]=t[2*r],n[2*e+1]=t[2*r+1]}))}t.setAttribute("uv",new e.Float32BufferAttribute(n,2))}parseMorphTargets(t,r){let n=0;for(const s in r.morphTargets){const a=t.attributes.position.array.slice();t.morphAttributes.position||(t.morphAttributes.position=[]);const o=r.morphTargets[s].points,i=r.morphTargets[s].indices,c=r.morphTargets[s].type;i.forEach((function(e,t){"relative"===c?(a[3*e]+=o[3*t],a[3*e+1]+=o[3*t+1],a[3*e+2]+=o[3*t+2]):(a[3*e]=o[3*t],a[3*e+1]=o[3*t+1],a[3*e+2]=o[3*t+2])})),t.morphAttributes.position[n]=new e.Float32BufferAttribute(a,3),t.morphAttributes.position[n].name=s,n++}t.morphTargetsRelative=!1}}class sc extends e.Loader{constructor(e){super(e)}load(t,r,n,s){const a=this,o=""===this.path?e.LoaderUtils.extractUrlBase(t):this.path,i=new e.FileLoader(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(t,(function(e){try{r(a.parse(e,o))}catch(e){s?s(e):console.error(e),a.manager.itemError(t)}}),n,s)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const r=e.split("\n");let n={};const s=/\s+/,a={};for(let e=0;e<r.length;e++){let t=r[e];if(t=t.trim(),0===t.length||"#"===t.charAt(0))continue;const o=t.indexOf(" ");let i=o>=0?t.substring(0,o):t;i=i.toLowerCase();let c=o>=0?t.substring(o+1):"";if(c=c.trim(),"newmtl"===i)n={name:c},a[c]=n;else if("ka"===i||"kd"===i||"ks"===i||"ke"===i){const e=c.split(s,3);n[i]=[parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]}else n[i]=c}const o=new ac(this.resourcePath||t,this.materialOptions);return o.setCrossOrigin(this.crossOrigin),o.setManager(this.manager),o.setMaterials(a),o}}class ac{constructor(t="",r={}){this.baseUrl=t,this.options=r,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=void 0!==this.options.side?this.options.side:e.FrontSide,this.wrap=void 0!==this.options.wrap?this.options.wrap:e.RepeatWrapping}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const r in e){const n=e[r],s={};t[r]=s;for(const e in n){let t=!0,r=n[e];const a=e.toLowerCase();switch(a){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(r=[r[0]/255,r[1]/255,r[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===r[0]&&0===r[1]&&0===r[2]&&(t=!1)}t&&(s[a]=r)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]}createMaterial_(t){const r=this,n=this.materialsInfo[t],s={name:t,side:this.side};function a(e,t){if(s[e])return;const n=r.getTextureParams(t,s),a=r.loadTexture(function(e,t){return"string"!=typeof t||""===t?"":/^https?:\/\//i.test(t)?t:e+t}(r.baseUrl,n.url));a.repeat.copy(n.scale),a.offset.copy(n.offset),a.wrapS=r.wrap,a.wrapT=r.wrap,s[e]=a}for(const t in n){const r=n[t];let o;if(""!==r)switch(t.toLowerCase()){case"kd":s.color=(new e.Color).fromArray(r);break;case"ks":s.specular=(new e.Color).fromArray(r);break;case"ke":s.emissive=(new e.Color).fromArray(r);break;case"map_kd":a("map",r);break;case"map_ks":a("specularMap",r);break;case"map_ke":a("emissiveMap",r);break;case"norm":a("normalMap",r);break;case"map_bump":case"bump":a("bumpMap",r);break;case"map_d":a("alphaMap",r),s.transparent=!0;break;case"ns":s.shininess=parseFloat(r);break;case"d":o=parseFloat(r),o<1&&(s.opacity=o,s.transparent=!0);break;case"tr":o=parseFloat(r),this.options&&this.options.invertTrProperty&&(o=1-o),o>0&&(s.opacity=1-o,s.transparent=!0)}}return this.materials[t]=new e.MeshPhongMaterial(s),this.materials[t]}getTextureParams(t,r){const n={scale:new e.Vector2(1,1),offset:new e.Vector2(0,0)},s=t.split(/\s+/);let a;return a=s.indexOf("-bm"),a>=0&&(r.bumpScale=parseFloat(s[a+1]),s.splice(a,2)),a=s.indexOf("-s"),a>=0&&(n.scale.set(parseFloat(s[a+1]),parseFloat(s[a+2])),s.splice(a,4)),a=s.indexOf("-o"),a>=0&&(n.offset.set(parseFloat(s[a+1]),parseFloat(s[a+2])),s.splice(a,4)),n.url=s.join(" ").trim(),n}loadTexture(t,r,n,s,a){const o=void 0!==this.manager?this.manager:e.DefaultLoadingManager;let i=o.getHandler(t);null===i&&(i=new e.TextureLoader(o)),i.setCrossOrigin&&i.setCrossOrigin(this.crossOrigin);const c=i.load(t,n,s,a);return void 0!==r&&(c.mapping=r),c}}class oc extends e.CompressedTextureLoader{constructor(e){super(e)}parse(t,r){const n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function s(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function a(e,t,r,n){const s=r*n*4,a=new Uint8Array(e,t,s),o=new Uint8Array(s);let i=0,c=0;for(let e=0;e<n;e++)for(let e=0;e<r;e++){const e=a[c];c++;const t=a[c];c++;const r=a[c];c++;const n=a[c];c++,o[i]=r,i++,o[i]=t,i++,o[i]=e,i++,o[i]=n,i++}return o}const o=s("DXT1"),i=s("DXT3"),c=s("DXT5"),l=s("ETC1"),u=new Int32Array(t,0,31);if(542327876!==u[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),n;if(4&!u[20])return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),n;let h;const p=u[21];let d=!1;switch(p){case o:h=8,n.format=e.RGB_S3TC_DXT1_Format;break;case i:h=16,n.format=e.RGBA_S3TC_DXT3_Format;break;case c:h=16,n.format=e.RGBA_S3TC_DXT5_Format;break;case l:h=8,n.format=e.RGB_ETC1_Format;break;default:if(!(32===u[22]&&16711680&u[23]&&65280&u[24]&&255&u[25]&&4278190080&u[26]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",(f=p,String.fromCharCode(255&f,f>>8&255,f>>16&255,f>>24&255))),n;d=!0,h=64,n.format=e.RGBAFormat}var f;n.mipmapCount=1,131072&u[2]&&!1!==r&&(n.mipmapCount=Math.max(1,u[7]));const g=u[28];if(n.isCubemap=!!(512&g),n.isCubemap&&(!(1024&g)||!(2048&g)||!(4096&g)||!(8192&g)||!(16384&g)||!(32768&g)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),n;n.width=u[4],n.height=u[3];let m=u[1]+4;const v=n.isCubemap?6:1;for(let e=0;e<v;e++){let e=n.width,r=n.height;for(let s=0;s<n.mipmapCount;s++){let s,o;d?(s=a(t,m,e,r),o=s.length):(o=Math.max(4,e)/4*Math.max(4,r)/4*h,s=new Uint8Array(t,m,o));const i={data:s,width:e,height:r};n.mipmaps.push(i),m+=o,e=Math.max(e>>1,1),r=Math.max(r>>1,1)}}return n}}const ic=/^[og]\s*(.+)?/,cc=/^mtllib /,lc=/^usemtl /,uc=/^usemap /,hc=new e.Vector3,pc=new e.Vector3,dc=new e.Vector3,fc=new e.Vector3,gc=new e.Vector3;function mc(){const e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);const r=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){const r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);const n={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==r?r.smooth:this.smooth,groupStart:void 0!==r?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){const t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(n),n},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){const t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(let e=this.materials.length-1;e>=0;e--)this.materials[e].groupCount<=0&&this.materials.splice(e,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},r&&r.name&&"function"==typeof r.clone){const e=r.clone(0);e.inherited=!0,this.object.materials.push(e)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){const r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){const r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){const n=this.vertices,s=this.object.geometry.vertices;s.push(n[e+0],n[e+1],n[e+2]),s.push(n[t+0],n[t+1],n[t+2]),s.push(n[r+0],n[r+1],n[r+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){const n=this.normals,s=this.object.geometry.normals;s.push(n[e+0],n[e+1],n[e+2]),s.push(n[t+0],n[t+1],n[t+2]),s.push(n[r+0],n[r+1],n[r+2])},addFaceNormal:function(e,t,r){const n=this.vertices,s=this.object.geometry.normals;hc.fromArray(n,e),pc.fromArray(n,t),dc.fromArray(n,r),gc.subVectors(dc,pc),fc.subVectors(hc,pc),gc.cross(fc),gc.normalize(),s.push(gc.x,gc.y,gc.z),s.push(gc.x,gc.y,gc.z),s.push(gc.x,gc.y,gc.z)},addColor:function(e,t,r){const n=this.colors,s=this.object.geometry.colors;void 0!==n[e]&&s.push(n[e+0],n[e+1],n[e+2]),void 0!==n[t]&&s.push(n[t+0],n[t+1],n[t+2]),void 0!==n[r]&&s.push(n[r+0],n[r+1],n[r+2])},addUV:function(e,t,r){const n=this.uvs,s=this.object.geometry.uvs;s.push(n[e+0],n[e+1]),s.push(n[t+0],n[t+1]),s.push(n[r+0],n[r+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,n,s,a,o,i,c){const l=this.vertices.length;let u=this.parseVertexIndex(e,l),h=this.parseVertexIndex(t,l),p=this.parseVertexIndex(r,l);if(this.addVertex(u,h,p),this.addColor(u,h,p),void 0!==o&&""!==o){const e=this.normals.length;u=this.parseNormalIndex(o,e),h=this.parseNormalIndex(i,e),p=this.parseNormalIndex(c,e),this.addNormal(u,h,p)}else this.addFaceNormal(u,h,p);if(void 0!==n&&""!==n){const e=this.uvs.length;u=this.parseUVIndex(n,e),h=this.parseUVIndex(s,e),p=this.parseUVIndex(a,e),this.addUV(u,h,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let r=0,n=e.length;r<n;r++){const n=this.parseVertexIndex(e[r],t);this.addVertexPoint(n),this.addColor(n)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const r=this.vertices.length,n=this.uvs.length;for(let t=0,n=e.length;t<n;t++)this.addVertexLine(this.parseVertexIndex(e[t],r));for(let e=0,r=t.length;e<r;e++)this.addUVLine(this.parseUVIndex(t[e],n))}};return e.startObject("",!1),e}class vc extends e.Loader{constructor(e){super(e),this.materials=null}load(t,r,n,s){const a=this,o=new e.FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(e){try{r(a.parse(e))}catch(e){s?s(e):console.error(e),a.manager.itemError(t)}}),n,s)}setMaterials(e){return this.materials=e,this}parse(t){const r=new mc;-1!==t.indexOf("\r\n")&&(t=t.replace(/\r\n/g,"\n")),-1!==t.indexOf("\\\n")&&(t=t.replace(/\\\n/g,""));const n=t.split("\n");let s="",a="",o=0,i=[];const c="function"==typeof"".trimLeft;for(let e=0,t=n.length;e<t;e++)if(s=n[e],s=c?s.trimLeft():s.trim(),o=s.length,0!==o&&(a=s.charAt(0),"#"!==a))if("v"===a){const e=s.split(/\s+/);switch(e[0]){case"v":r.vertices.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])),e.length>=7?r.colors.push(parseFloat(e[4]),parseFloat(e[5]),parseFloat(e[6])):r.colors.push(void 0,void 0,void 0);break;case"vn":r.normals.push(parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]));break;case"vt":r.uvs.push(parseFloat(e[1]),parseFloat(e[2]))}}else if("f"===a){const e=s.substr(1).trim().split(/\s+/),t=[];for(let r=0,n=e.length;r<n;r++){const n=e[r];if(n.length>0){const e=n.split("/");t.push(e)}}const n=t[0];for(let e=1,s=t.length-1;e<s;e++){const s=t[e],a=t[e+1];r.addFace(n[0],s[0],a[0],n[1],s[1],a[1],n[2],s[2],a[2])}}else if("l"===a){const e=s.substring(1).trim().split(" ");let t=[];const n=[];if(-1===s.indexOf("/"))t=e;else for(let r=0,s=e.length;r<s;r++){const s=e[r].split("/");""!==s[0]&&t.push(s[0]),""!==s[1]&&n.push(s[1])}r.addLineGeometry(t,n)}else if("p"===a){const e=s.substr(1).trim().split(" ");r.addPointGeometry(e)}else if(null!==(i=ic.exec(s))){const e=(" "+i[0].substr(1).trim()).substr(1);r.startObject(e)}else if(lc.test(s))r.object.startMaterial(s.substring(7).trim(),r.materialLibraries);else if(cc.test(s))r.materialLibraries.push(s.substring(7).trim());else if(uc.test(s))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===a){if(i=s.split(" "),i.length>1){const e=i[1].trim().toLowerCase();r.object.smooth="0"!==e&&"off"!==e}else r.object.smooth=!0;const e=r.object.currentMaterial();e&&(e.smooth=r.object.smooth)}else{if("\0"===s)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+s+'"')}r.finalize();const l=new e.Group;l.materialLibraries=[].concat(r.materialLibraries);if(!0===!(1===r.objects.length&&0===r.objects[0].geometry.vertices.length))for(let t=0,n=r.objects.length;t<n;t++){const n=r.objects[t],s=n.geometry,a=n.materials,o="Line"===s.type,i="Points"===s.type;let c=!1;if(0===s.vertices.length)continue;const u=new e.BufferGeometry;u.setAttribute("position",new e.Float32BufferAttribute(s.vertices,3)),s.normals.length>0&&u.setAttribute("normal",new e.Float32BufferAttribute(s.normals,3)),s.colors.length>0&&(c=!0,u.setAttribute("color",new e.Float32BufferAttribute(s.colors,3))),!0===s.hasUVIndices&&u.setAttribute("uv",new e.Float32BufferAttribute(s.uvs,2));const h=[];for(let t=0,n=a.length;t<n;t++){const n=a[t],s=n.name+"_"+n.smooth+"_"+c;let l=r.materials[s];if(null!==this.materials)if(l=this.materials.create(n.name),!o||!l||l instanceof e.LineBasicMaterial){if(i&&l&&!(l instanceof e.PointsMaterial)){const t=new e.PointsMaterial({size:10,sizeAttenuation:!1});e.Material.prototype.copy.call(t,l),t.color.copy(l.color),t.map=l.map,l=t}}else{const t=new e.LineBasicMaterial;e.Material.prototype.copy.call(t,l),t.color.copy(l.color),l=t}void 0===l&&(l=o?new e.LineBasicMaterial:i?new e.PointsMaterial({size:1,sizeAttenuation:!1}):new e.MeshPhongMaterial,l.name=n.name,l.flatShading=!n.smooth,l.vertexColors=c,r.materials[s]=l),h.push(l)}let p;if(h.length>1){for(let e=0,t=a.length;e<t;e++){const t=a[e];u.addGroup(t.groupStart,t.groupCount,e)}p=o?new e.LineSegments(u,h):i?new e.Points(u,h):new e.Mesh(u,h)}else p=o?new e.LineSegments(u,h[0]):i?new e.Points(u,h[0]):new e.Mesh(u,h[0]);p.name=n.name,l.add(p)}else if(r.vertices.length>0){const t=new e.PointsMaterial({size:1,sizeAttenuation:!1}),n=new e.BufferGeometry;n.setAttribute("position",new e.Float32BufferAttribute(r.vertices,3)),r.colors.length>0&&void 0!==r.colors[0]&&(n.setAttribute("color",new e.Float32BufferAttribute(r.colors,3)),t.vertexColors=!0);const s=new e.Points(n,t);l.add(s)}return l}}class yc extends e.DataTextureLoader{constructor(t){super(t),this.type=e.FloatType}parse(t){const r=65536,n=14,s=65537,a=16384,o=Math.pow(2.7182818,2.2);var i=new DataView(new ArrayBuffer(8));function c(e){if(0===e)return[e,0];i.setFloat64(0,e);var t=i.getUint32(0)>>>20&2047;0===t&&(i.setFloat64(0,e*Math.pow(2,64)),t=(i.getUint32(0)>>>20&2047)-64);var r=t-1022;return[function(e,t){for(var r=Math.min(3,Math.ceil(Math.abs(t)/1023)),n=e,s=0;s<r;s++)n*=Math.pow(2,Math.floor((t+s)/r));return n}(e,-r),r]}const l={l:0,c:0,lc:0};function u(e,t,r,n,s){for(;r<e;)t=t<<8|H(n,s),r+=8;r-=e,l.l=t>>r&(1<<e)-1,l.c=t,l.lc=r}const h=new Array(59);function p(e,t,r,n,a,o,i){for(var c=r,p=0,d=0;a<=o;a++){if(c.value-r.value>n)return!1;u(6,p,d,e,c);var f=l.l;if(p=l.c,d=l.lc,i[a]=f,63==f){if(c.value-r.value>n)throw"Something wrong with hufUnpackEncTable";u(8,p,d,e,c);var g=l.l+6;if(p=l.c,d=l.lc,a+g>o+1)throw"Something wrong with hufUnpackEncTable";for(;g--;)i[a++]=0;a--}else if(f>=59){if(a+(g=f-59+2)>o+1)throw"Something wrong with hufUnpackEncTable";for(;g--;)i[a++]=0;a--}}!function(e){for(var t=0;t<=58;++t)h[t]=0;for(t=0;t<s;++t)h[e[t]]+=1;var r=0;for(t=58;t>0;--t){var n=r+h[t]>>1;h[t]=r,r=n}for(t=0;t<s;++t){var a=e[t];a>0&&(e[t]=a|h[a]++<<6)}}(i)}function d(e){return 63&e}function f(e){return e>>6}const g={c:0,lc:0};function m(e,t,r,n){e=e<<8|H(r,n),t+=8,g.c=e,g.lc=t}const v={c:0,lc:0};function y(e,t,r,n,s,a,o,i,c,l){if(e==t){n<8&&(m(r,n,s,o),r=g.c,n=g.lc);var u=r>>(n-=8);u=new Uint8Array([u])[0];if(c.value+u>l)return!1;for(var h=i[c.value-1];u-- >0;)i[c.value++]=h}else{if(!(c.value<l))return!1;i[c.value++]=e}v.c=r,v.lc=n}function b(e){return 65535&e}function x(e){var t=b(e);return t>32767?t-65536:t}const w={a:0,b:0};function S(e,t){var r=x(e),n=x(t),s=r+(1&n)+(n>>1),a=s,o=s-n;w.a=a,w.b=o}function T(e,t){var r=b(e),n=b(t),s=r-(n>>1)&65535,a=n+s-32768&65535;w.a=a,w.b=s}function F(e,t,r,n,s,a,o){for(var i,c=o<16384,l=r>s?s:r,u=1;u<=l;)u<<=1;for(i=u>>=1,u>>=1;u>=1;){for(var h,p,d,f,g=0,m=g+a*(s-i),v=a*u,y=a*i,b=n*u,x=n*i;g<=m;g+=y){for(var F=g,k=g+n*(r-i);F<=k;F+=x){var E=F+b,A=(I=F+v)+b;c?(S(e[F+t],e[I+t]),h=w.a,d=w.b,S(e[E+t],e[A+t]),p=w.a,f=w.b,S(h,p),e[F+t]=w.a,e[E+t]=w.b,S(d,f),e[I+t]=w.a,e[A+t]=w.b):(T(e[F+t],e[I+t]),h=w.a,d=w.b,T(e[E+t],e[A+t]),p=w.a,f=w.b,T(h,p),e[F+t]=w.a,e[E+t]=w.b,T(d,f),e[I+t]=w.a,e[A+t]=w.b)}if(r&u){var I=F+v;c?S(e[F+t],e[I+t]):T(e[F+t],e[I+t]),h=w.a,e[I+t]=w.b,e[F+t]=h}}if(s&u)for(F=g,k=g+n*(r-i);F<=k;F+=x){E=F+b;c?S(e[F+t],e[E+t]):T(e[F+t],e[E+t]),h=w.a,e[E+t]=w.b,e[F+t]=h}i=u,u>>=1}return g}function k(e,t,r,o,i,c){var l=r.value,u=_(t,r),h=_(t,r);r.value+=4;var b=_(t,r);if(r.value+=4,u<0||u>=s||h<0||h>=s)throw"Something wrong with HUF_ENCSIZE";var x=new Array(s),w=new Array(a);if(function(e){for(var t=0;t<a;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(w),p(e,0,r,o-(r.value-l),u,h,x),b>8*(o-(r.value-l)))throw"Something wrong with hufUncompress";!function(e,t,r,s){for(;t<=r;t++){var a=f(e[t]),o=d(e[t]);if(a>>o)throw"Invalid table entry";if(o>n){if((u=s[a>>o-n]).len)throw"Invalid table entry";if(u.lit++,u.p){var i=u.p;u.p=new Array(u.lit);for(var c=0;c<u.lit-1;++c)u.p[c]=i[c]}else u.p=new Array(1);u.p[u.lit-1]=t}else if(o){var l=0;for(c=1<<n-o;c>0;c--){var u;if((u=s[(a<<n-o)+l]).len||u.p)throw"Invalid table entry";u.len=o,u.lit=t,l++}}}}(x,u,h,w),function(e,t,r,s,a,o,i,c,l,u){for(var h=0,p=0,b=c,x=Math.trunc(a.value+(o+7)/8);a.value<x;)for(m(h,p,r,a),h=g.c,p=g.lc;p>=n;)if((F=t[h>>p-n&16383]).len)p-=F.len,y(F.lit,i,h,p,r,0,a,l,u,b),h=v.c,p=v.lc;else{if(!F.p)throw"hufDecode issues";var w;for(w=0;w<F.lit;w++){for(var S=d(e[F.p[w]]);p<S&&a.value<x;)m(h,p,r,a),h=g.c,p=g.lc;if(p>=S&&f(e[F.p[w]])==(h>>p-S&(1<<S)-1)){p-=S,y(F.p[w],i,h,p,r,0,a,l,u,b),h=v.c,p=v.lc;break}}if(w==F.lit)throw"hufDecode issues"}var T=8-o&7;for(h>>=T,p-=T;p>0;){var F;if(!(F=t[h<<n-p&16383]).len)throw"hufDecode issues";p-=F.len,y(F.lit,i,h,p,r,0,a,l,u,b),h=v.c,p=v.lc}}(x,w,e,0,r,b,h,c,i,{value:0})}function E(e){for(var t=1;t<e.length;t++){var r=e[t-1]+e[t]-128;e[t]=r}}function A(e,t){for(var r=0,n=Math.floor((e.length+1)/2),s=0,a=e.length-1;!(s>a||(t[s++]=e[r++],s>a));)t[s++]=e[n++]}function I(e){for(var t=e.byteLength,r=new Array,n=0,s=new DataView(e);t>0;){var a=s.getInt8(n++);if(a<0){t-=(i=-a)+1;for(var o=0;o<i;o++)r.push(s.getUint8(n++))}else{var i=a;t-=2;var c=s.getUint8(n++);for(o=0;o<i+1;o++)r.push(c)}}return r}function M(e,t,r){for(var n,s=1;s<64;)65280==(n=t[e.value])?s=64:n>>8==255?s+=255&n:(r[s]=n,s++),e.value++}function L(e,t){t[0]=W(e[0]),t[1]=W(e[1]),t[2]=W(e[5]),t[3]=W(e[6]),t[4]=W(e[14]),t[5]=W(e[15]),t[6]=W(e[27]),t[7]=W(e[28]),t[8]=W(e[2]),t[9]=W(e[4]),t[10]=W(e[7]),t[11]=W(e[13]),t[12]=W(e[16]),t[13]=W(e[26]),t[14]=W(e[29]),t[15]=W(e[42]),t[16]=W(e[3]),t[17]=W(e[8]),t[18]=W(e[12]),t[19]=W(e[17]),t[20]=W(e[25]),t[21]=W(e[30]),t[22]=W(e[41]),t[23]=W(e[43]),t[24]=W(e[9]),t[25]=W(e[11]),t[26]=W(e[18]),t[27]=W(e[24]),t[28]=W(e[31]),t[29]=W(e[40]),t[30]=W(e[44]),t[31]=W(e[53]),t[32]=W(e[10]),t[33]=W(e[19]),t[34]=W(e[23]),t[35]=W(e[32]),t[36]=W(e[39]),t[37]=W(e[45]),t[38]=W(e[52]),t[39]=W(e[54]),t[40]=W(e[20]),t[41]=W(e[22]),t[42]=W(e[33]),t[43]=W(e[38]),t[44]=W(e[46]),t[45]=W(e[51]),t[46]=W(e[55]),t[47]=W(e[60]),t[48]=W(e[21]),t[49]=W(e[34]),t[50]=W(e[37]),t[51]=W(e[47]),t[52]=W(e[50]),t[53]=W(e[56]),t[54]=W(e[59]),t[55]=W(e[61]),t[56]=W(e[35]),t[57]=W(e[36]),t[58]=W(e[48]),t[59]=W(e[49]),t[60]=W(e[57]),t[61]=W(e[58]),t[62]=W(e[62]),t[63]=W(e[63])}function C(e){const t=.5*Math.cos(.7853975),r=.5*Math.cos(3.14159/16),n=.5*Math.cos(3.14159/8),s=.5*Math.cos(3*3.14159/16),a=.5*Math.cos(.981746875),o=.5*Math.cos(3*3.14159/8),i=.5*Math.cos(1.374445625);for(var c=new Array(4),l=new Array(4),u=new Array(4),h=new Array(4),p=0;p<8;++p){var d=8*p;c[0]=n*e[d+2],c[1]=o*e[d+2],c[2]=n*e[d+6],c[3]=o*e[d+6],l[0]=r*e[d+1]+s*e[d+3]+a*e[d+5]+i*e[d+7],l[1]=s*e[d+1]-i*e[d+3]-r*e[d+5]-a*e[d+7],l[2]=a*e[d+1]-r*e[d+3]+i*e[d+5]+s*e[d+7],l[3]=i*e[d+1]-a*e[d+3]+s*e[d+5]-r*e[d+7],u[0]=t*(e[d+0]+e[d+4]),u[3]=t*(e[d+0]-e[d+4]),u[1]=c[0]+c[3],u[2]=c[1]-c[2],h[0]=u[0]+u[1],h[1]=u[3]+u[2],h[2]=u[3]-u[2],h[3]=u[0]-u[1],e[d+0]=h[0]+l[0],e[d+1]=h[1]+l[1],e[d+2]=h[2]+l[2],e[d+3]=h[3]+l[3],e[d+4]=h[3]-l[3],e[d+5]=h[2]-l[2],e[d+6]=h[1]-l[1],e[d+7]=h[0]-l[0]}for(var f=0;f<8;++f)c[0]=n*e[16+f],c[1]=o*e[16+f],c[2]=n*e[48+f],c[3]=o*e[48+f],l[0]=r*e[8+f]+s*e[24+f]+a*e[40+f]+i*e[56+f],l[1]=s*e[8+f]-i*e[24+f]-r*e[40+f]-a*e[56+f],l[2]=a*e[8+f]-r*e[24+f]+i*e[40+f]+s*e[56+f],l[3]=i*e[8+f]-a*e[24+f]+s*e[40+f]-r*e[56+f],u[0]=t*(e[f]+e[32+f]),u[3]=t*(e[f]-e[32+f]),u[1]=c[0]+c[3],u[2]=c[1]-c[2],h[0]=u[0]+u[1],h[1]=u[3]+u[2],h[2]=u[3]-u[2],h[3]=u[0]-u[1],e[0+f]=h[0]+l[0],e[8+f]=h[1]+l[1],e[16+f]=h[2]+l[2],e[24+f]=h[3]+l[3],e[32+f]=h[3]-l[3],e[40+f]=h[2]-l[2],e[48+f]=h[1]-l[1],e[56+f]=h[0]-l[0]}function R(e){for(var t=0;t<64;++t){var r=e[0][t],n=e[1][t],s=e[2][t];e[0][t]=r+1.5747*s,e[1][t]=r-.1873*n-.4682*s,e[2][t]=r+1.8556*n}}function O(t,r,n){for(var s=0;s<64;++s)r[n+s]=e.DataUtils.toHalfFloat(N(t[s]))}function N(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(o,Math.abs(e)-1)}function U(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size);void 0===xi&&console.error("THREE.EXRLoader: External library fflate.min.js required.");var r=qo(t),n=new Uint8Array(r.length);return E(r),A(r,n),new DataView(n.buffer)}function D(e){var t=e.viewer,r={value:e.offset.value},n=new Uint8Array(e.width*e.lines*(Z.channels.length*e.type*2)),s={version:z(t,r),unknownUncompressedSize:z(t,r),unknownCompressedSize:z(t,r),acCompressedSize:z(t,r),dcCompressedSize:z(t,r),rleCompressedSize:z(t,r),rleUncompressedSize:z(t,r),rleRawSize:z(t,r),totalAcUncompressedCount:z(t,r),totalDcUncompressedCount:z(t,r),acCompression:z(t,r)};if(s.version<2)throw"EXRLoader.parse: "+Z.compression+" version "+s.version+" is unsupported";for(var a=new Array,o=X(t,r)-2;o>0;){var i=P(t.buffer,r),c=V(t,r),l=c>>2&3,u=new Int8Array([(c>>4)-1])[0],h=V(t,r);a.push({name:i,index:u,type:h,compression:l}),o-=i.length+3}for(var p=Z.channels,d=new Array(e.channels),f=0;f<e.channels;++f){var g=d[f]={},m=p[f];g.name=m.name,g.compression=0,g.decoded=!1,g.type=m.pixelType,g.pLinear=m.pLinear,g.width=e.width,g.height=e.lines}for(var v={idx:new Array(3)},y=0;y<e.channels;++y)for(g=d[y],f=0;f<a.length;++f){var b=a[f];g.name==b.name&&(g.compression=b.compression,b.index>=0&&(v.idx[b.index]=y),g.offset=y)}if(s.acCompressedSize>0)switch(s.acCompression){case 0:var x=new Uint16Array(s.totalAcUncompressedCount);k(e.array,t,r,s.acCompressedSize,x,s.totalAcUncompressedCount);break;case 1:var w=qo(e.array.slice(r.value,r.value+s.totalAcUncompressedCount));x=new Uint16Array(w.buffer);r.value+=s.totalAcUncompressedCount}if(s.dcCompressedSize>0){var S={array:e.array,offset:r,size:s.dcCompressedSize},T=new Uint16Array(U(S).buffer);r.value+=s.dcCompressedSize}if(s.rleRawSize>0){var F=I((w=qo(e.array.slice(r.value,r.value+s.rleCompressedSize))).buffer);r.value+=s.rleCompressedSize}var E=0,A=new Array(d.length);for(f=0;f<A.length;++f)A[f]=new Array;for(var N=0;N<e.lines;++N)for(var D=0;D<d.length;++D)A[D].push(E),E+=d[D].width*e.type*2;!function(e,t,r,n,s,a){var o=new DataView(a.buffer),i=r[e.idx[0]].width,c=r[e.idx[0]].height,l=Math.floor(i/8),u=Math.ceil(i/8),h=Math.ceil(c/8),p=i-8*(u-1),d=c-8*(h-1),f={value:0},g=new Array(3),m=new Array(3),v=new Array(3),y=new Array(3),b=new Array(3);for(let r=0;r<3;++r)b[r]=t[e.idx[r]],g[r]=r<1?0:g[r-1]+u*h,m[r]=new Float32Array(64),v[r]=new Uint16Array(64),y[r]=new Uint16Array(64*u);for(let t=0;t<h;++t){var x=8;t==h-1&&(x=d);var w=8;for(let e=0;e<u;++e){e==u-1&&(w=p);for(let e=0;e<3;++e)v[e].fill(0),v[e][0]=s[g[e]++],M(f,n,v[e]),L(v[e],m[e]),C(m[e]);R(m);for(let t=0;t<3;++t)O(m[t],y[t],64*e)}let a=0;for(let n=0;n<3;++n){const s=r[e.idx[n]].type;for(let e=8*t;e<8*t+x;++e){a=b[n][e];for(let t=0;t<l;++t){const r=64*t+8*(7&e);o.setUint16(a+0*s,y[n][r+0],!0),o.setUint16(a+2*s,y[n][r+1],!0),o.setUint16(a+4*s,y[n][r+2],!0),o.setUint16(a+6*s,y[n][r+3],!0),o.setUint16(a+8*s,y[n][r+4],!0),o.setUint16(a+10*s,y[n][r+5],!0),o.setUint16(a+12*s,y[n][r+6],!0),o.setUint16(a+14*s,y[n][r+7],!0),a+=16*s}}if(l!=u)for(let e=8*t;e<8*t+x;++e){const t=b[n][e]+8*l*2*s,r=64*l+8*(7&e);for(let e=0;e<w;++e)o.setUint16(t+2*e*s,y[n][r+e],!0)}}}for(var S=new Uint16Array(i),T=(o=new DataView(a.buffer),0);T<3;++T){r[e.idx[T]].decoded=!0;var F=r[e.idx[T]].type;if(2==r[T].type)for(var k=0;k<c;++k){const e=b[T][k];for(var E=0;E<i;++E)S[E]=o.getUint16(e+2*E*F,!0);for(E=0;E<i;++E)o.setFloat32(e+2*E*F,W(S[E]),!0)}}}(v,A,d,x,T,n);for(f=0;f<d.length;++f){if(!(g=d[f]).decoded)switch(g.compression){case 2:var B=0,G=0;for(N=0;N<e.lines;++N){for(var _=A[f][B],H=0;H<g.width;++H){for(var j=0;j<2*g.type;++j)n[_++]=F[G+j*g.width*g.height];G++}B++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(n.buffer)}function P(t,r){for(var n=new Uint8Array(t),s=0;0!=n[r.value+s];)s+=1;var a=(new e.$TextDecoder).decode(n.slice(r.value,r.value+s));return r.value=r.value+s+1,a}function B(e,t){var r=e.getUint32(0,!0);return t.value=t.value+8,r}function G(e,t){var r=e.getInt32(t.value,!0);return t.value=t.value+4,r}function _(e,t){var r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function H(e,t){var r=e[t.value];return t.value=t.value+1,r}function V(e,t){var r=e.getUint8(t.value);return t.value=t.value+1,r}function z(e,t){var r=Number(e.getBigInt64(t.value,!0));return t.value+=8,r}function j(e,t){var r=e.getFloat32(t.value,!0);return t.value+=4,r}function W(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function X(e,t){var r=e.getUint16(t.value,!0);return t.value+=2,r}function q(t,r,n,s,a){return"string"===s||"stringvector"===s||"iccProfile"===s?function(t,r,n){var s=(new e.$TextDecoder).decode(new Uint8Array(t).slice(r.value,r.value+n));return r.value=r.value+n,s}(r,n,a):"chlist"===s?function(e,t,r,n){for(var s=r.value,a=[];r.value<s+n-1;){var o=P(t,r),i=G(e,r),c=V(e,r);r.value+=3;var l=G(e,r),u=G(e,r);a.push({name:o,pixelType:i,pLinear:c,xSampling:l,ySampling:u})}return r.value+=1,a}(t,r,n,a):"chromaticities"===s?function(e,t){return{redX:j(e,t),redY:j(e,t),greenX:j(e,t),greenY:j(e,t),blueX:j(e,t),blueY:j(e,t),whiteX:j(e,t),whiteY:j(e,t)}}(t,n):"compression"===s?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][V(e,t)]}(t,n):"box2i"===s?function(e,t){return{xMin:_(e,t),yMin:_(e,t),xMax:_(e,t),yMax:_(e,t)}}(t,n):"lineOrder"===s?function(e,t){return["INCREASING_Y"][V(e,t)]}(t,n):"float"===s?j(t,n):"v2f"===s?function(e,t){return[j(e,t),j(e,t)]}(t,n):"v3f"===s?function(e,t){return[j(e,t),j(e,t),j(e,t)]}(t,n):"int"===s?G(t,n):"rational"===s?function(e,t){return[G(e,t),_(e,t)]}(t,n):"timecode"===s?function(e,t){return[_(e,t),_(e,t)]}(t,n):"preview"===s?(n.value+=a,"skipped"):void(n.value+=a)}var Y=new DataView(t),K=new Uint8Array(t),Z={};Y.getUint32(0,!0),Y.getUint8(4,!0),Y.getUint8(5,!0);for(var Q={value:8},$=!0;$;){var J=P(t,Q);if(0==J)$=!1;else{var ee=P(t,Q),te=q(Y,t,Q,ee,_(Y,Q));void 0===te?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${ee}'.`):Z[J]=te}}var re,ne,se,ae,oe=Z.dataWindow.yMax+1;switch(Z.compression){case"NO_COMPRESSION":ne=1,re=function(e){return new DataView(e.array.buffer,e.offset.value,e.size)};break;case"RLE_COMPRESSION":ne=1,re=function(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),r=new Uint8Array(I(t)),n=new Uint8Array(r.length);return E(r),A(r,n),new DataView(n.buffer)};break;case"ZIPS_COMPRESSION":ne=1,re=U;break;case"ZIP_COMPRESSION":ne=16,re=U;break;case"PIZ_COMPRESSION":ne=32,re=function(e){for(var t=e.viewer,n={value:e.offset.value},s=e.width*ne*(Z.channels.length*e.type),a=new Uint16Array(s),o=new Uint8Array(8192),i=0,c=new Array(e.channels),l=0;l<e.channels;l++)c[l]={},c[l].start=i,c[l].end=c[l].start,c[l].nx=e.width,c[l].ny=e.lines,c[l].size=e.type,i+=c[l].nx*c[l].ny*c[l].size;var u=X(t,n),h=X(t,n);if(h>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(u<=h)for(l=0;l<h-u+1;l++)o[l+u]=V(t,n);var p=new Uint16Array(r),d=function(e,t){for(var n=0,s=0;s<r;++s)(0==s||e[s>>3]&1<<(7&s))&&(t[n++]=s);for(var a=n-1;n<r;)t[n++]=0;return a}(o,p),f=_(t,n);for(k(e.array,t,n,f,a,i),l=0;l<e.channels;++l)for(var g=c[l],m=0;m<c[l].size;++m)F(a,g.start+m,g.nx,g.size,g.ny,g.nx*g.size,d);!function(e,t,r){for(var n=0;n<r;++n)t[n]=e[t[n]]}(p,a,i);for(var v=0,y=new Uint8Array(a.buffer.byteLength),b=0;b<e.lines;b++)for(var x=0;x<e.channels;x++){var w=(g=c[x]).nx*g.size,S=new Uint8Array(a.buffer,2*g.end,2*w);y.set(S,v),v+=2*w,g.end+=w}return new DataView(y.buffer)};break;case"PXR24_COMPRESSION":ne=16,re=function(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size);void 0===xi&&console.error("THREE.EXRLoader: External library fflate.min.js required.");var r=qo(t);const n=e.lines*e.channels*e.width,s=1==e.type?new Uint16Array(n):new Uint32Array(n);let a=0,o=0;const i=new Array(4);for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){let t=0;switch(e.type){case 1:i[0]=a,i[1]=i[0]+e.width,a=i[1]+e.width;for(let n=0;n<e.width;++n)t+=r[i[0]++]<<8|r[i[1]++],s[o]=t,o++;break;case 2:i[0]=a,i[1]=i[0]+e.width,i[2]=i[1]+e.width,a=i[2]+e.width;for(let n=0;n<e.width;++n)t+=r[i[0]++]<<24|r[i[1]++]<<16|r[i[2]++]<<8,s[o]=t,o++}}return new DataView(s.buffer)};break;case"DWAA_COMPRESSION":ne=32,re=D;break;case"DWAB_COMPRESSION":ne=256,re=D;break;default:throw"EXRLoader.parse: "+Z.compression+" is unsupported"}var ie=Z.channels[0].pixelType;if(1===ie)switch(this.type){case e.UnsignedByteType:case e.FloatType:ae=function(e,t){return W(X(e,t))},se=2;break;case e.HalfFloatType:ae=X,se=2}else{if(2!==ie)throw"EXRLoader.parse: unsupported pixelType "+ie+" for "+Z.compression+".";switch(this.type){case e.UnsignedByteType:case e.FloatType:ae=j,se=4;break;case e.HalfFloatType:ae=function(t,r){return e.DataUtils.toHalfFloat(j(t,r))},se=4}}for(var ce=oe/ne,le=0;le<ce;le++)B(Y,Q);var ue=Z.dataWindow.xMax-Z.dataWindow.xMin+1,he=Z.dataWindow.yMax-Z.dataWindow.yMin+1,pe=ue*he*4;switch(this.type){case e.UnsignedByteType:case e.FloatType:var de=new Float32Array(pe);Z.channels.length<4&&de.fill(1,0,pe);break;case e.HalfFloatType:de=new Uint16Array(pe);Z.channels.length<4&&de.fill(15360,0,pe);break;default:console.error("THREE.EXRLoader: unsupported type: ",this.type)}for(var fe,ge,me={R:0,G:1,B:2,A:3},ve={size:0,width:ue,lines:ne,offset:Q,array:K,viewer:Y,type:ie,channels:Z.channels.length},ye={value:0},be=0;be<he/ne;be++){fe=_(Y,Q),pe=_(Y,Q),ve.lines=fe+ne>he?he-fe:ne,ve.offset=Q,ve.size=pe,ge=re(ve),Q.value+=pe;for(var xe=0;xe<ne;xe++){var we=xe+be*ne;if(we>=he)break;for(var Se=0;Se<Z.channels.length;Se++)for(var Te=me[Z.channels[Se].name],Fe=0;Fe<ue;Fe++){var ke=xe*(Z.channels.length*ue)+Se*ue+Fe;ye.value=ke*se;var Ee=ae(ge,ye);de[4*ue*(he-1-we)+4*Fe+Te]=Ee}}}if(this.type===e.UnsignedByteType){let e,t;const r=de.length,n=new Uint8Array(r);for(let r=0;r<he;++r)for(let s=0;s<ue;++s){t=r*ue*4+4*s;const a=de[t],o=de[t+1],i=de[t+2];if(e=a>o?a:o,e=i>e?i:e,e<1e-32)n[t]=n[t+1]=n[t+2]=n[t+3]=0;else{const r=c(e);e=256*r[0]/e,n[t]=a*e,n[t+1]=o*e,n[t+2]=i*e,n[t+3]=r[1]+128}}de=n}const Ae=this.type===e.UnsignedByteType?e.RGBEFormat:e.RGBAFormat;return{header:Z,width:ue,height:he,data:de,format:Ae,type:this.type}}setDataType(e){return this.type=e,this}load(t,r,n,s){return super.load(t,(function(t,n){switch(t.type){case e.UnsignedByteType:t.encoding=e.RGBEEncoding,t.minFilter=e.NearestFilter,t.magFilter=e.NearestFilter,t.generateMipmaps=!1,t.flipY=!1;break;case e.FloatType:case e.HalfFloatType:t.encoding=e.LinearEncoding,t.minFilter=e.LinearFilter,t.magFilter=e.LinearFilter,t.generateMipmaps=!1,t.flipY=!1}r&&r(t,n)}),n,s)}}class bc extends e.Loader{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(t,r,n,s){const a=this,o=new e.FileLoader(a.manager);o.setPath(a.path),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(t,(function(e){try{r(a.parse(e))}catch(e){s?s(e):console.error(e),a.manager.itemError(t)}}),n,s)}parse(t){const r=this;function n(e,t,r,n,a,o,i,c){if(0==t||0==r)return void e.lineTo(c.x,c.y);n=n*Math.PI/180,t=Math.abs(t),r=Math.abs(r);const l=(i.x-c.x)/2,u=(i.y-c.y)/2,h=Math.cos(n)*l+Math.sin(n)*u,p=-Math.sin(n)*l+Math.cos(n)*u;let d=t*t,f=r*r;const g=h*h,m=p*p,v=g/d+m/f;if(v>1){const e=Math.sqrt(v);d=(t*=e)*t,f=(r*=e)*r}const y=d*m+f*g,b=(d*f-y)/y;let x=Math.sqrt(Math.max(0,b));a===o&&(x=-x);const w=x*t*p/r,S=-x*r*h/t,T=Math.cos(n)*w-Math.sin(n)*S+(i.x+c.x)/2,F=Math.sin(n)*w+Math.cos(n)*S+(i.y+c.y)/2,k=s(1,0,(h-w)/t,(p-S)/r),E=s((h-w)/t,(p-S)/r,(-h-w)/t,(-p-S)/r)%(2*Math.PI);e.currentPath.absellipse(T,F,t,r,k,k+E,0===o,n)}function s(e,t,r,n){const s=e*r+t*n,a=Math.sqrt(e*e+t*t)*Math.sqrt(r*r+n*n);let o=Math.acos(Math.max(-1,Math.min(1,s/a)));return e*n-t*r<0&&(o=-o),o}function a(e,t){t=Object.assign({},t);let r={};if(e.hasAttribute("class")){const t=e.getAttribute("class").split(/\s/).filter(Boolean).map((e=>e.trim()));for(let e=0;e<t.length;e++)r=Object.assign(r,f["."+t[e]])}function n(n,s,a){void 0===a&&(a=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(n)&&(t[s]=a(e.getAttribute(n))),r[n]&&(t[s]=a(r[n])),e.style&&""!==e.style[n]&&(t[s]=a(e.style[n]))}function s(e){return Math.max(0,Math.min(1,u(e)))}function a(e){return Math.max(0,u(e))}return e.hasAttribute("id")&&(r=Object.assign(r,f["#"+e.getAttribute("id")])),n("fill","fill"),n("fill-opacity","fillOpacity",s),n("opacity","opacity",s),n("stroke","stroke"),n("stroke-opacity","strokeOpacity",s),n("stroke-width","strokeWidth",a),n("stroke-linejoin","strokeLineJoin"),n("stroke-linecap","strokeLineCap"),n("stroke-miterlimit","strokeMiterLimit",a),n("visibility","visibility"),t}function o(e,t){return e-(t-e)}function i(e,t,r){if("string"!=typeof e)throw new TypeError("Invalid input: "+typeof e);const n={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/};let s=0,a=!0,o="",i="";const c=[];function l(e,t,r){const n=new SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw n.partial=r,n}function u(){""!==o&&(""===i?c.push(Number(o)):c.push(Number(o)*Math.pow(10,Number(i)))),o="",i=""}let h;const p=e.length;for(let d=0;d<p;d++)if(h=e[d],Array.isArray(t)&&t.includes(c.length%r)&&n.FLAGS.test(h))s=1,o=h,u();else{if(0===s){if(n.WHITESPACE.test(h))continue;if(n.DIGIT.test(h)||n.SIGN.test(h)){s=1,o=h;continue}if(n.POINT.test(h)){s=2,o=h;continue}n.COMMA.test(h)&&(a&&l(h,d,c),a=!0)}if(1===s){if(n.DIGIT.test(h)){o+=h;continue}if(n.POINT.test(h)){o+=h,s=2;continue}if(n.EXP.test(h)){s=3;continue}n.SIGN.test(h)&&1===o.length&&n.SIGN.test(o[0])&&l(h,d,c)}if(2===s){if(n.DIGIT.test(h)){o+=h;continue}if(n.EXP.test(h)){s=3;continue}n.POINT.test(h)&&"."===o[o.length-1]&&l(h,d,c)}if(3===s){if(n.DIGIT.test(h)){i+=h;continue}if(n.SIGN.test(h)){if(""===i){i+=h;continue}1===i.length&&n.SIGN.test(i)&&l(h,d,c)}}n.WHITESPACE.test(h)?(u(),s=0,a=!1):n.COMMA.test(h)?(u(),s=0,a=!0):n.SIGN.test(h)?(u(),s=1,o=h):n.POINT.test(h)?(u(),s=2,o=h):l(h,d,c)}return u(),c}const c=["mm","cm","in","pt","pc","px"],l={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function u(e){let t,n="px";if("string"==typeof e||e instanceof String)for(let t=0,r=c.length;t<r;t++){const r=c[t];if(e.endsWith(r)){n=r,e=e.substring(0,e.length-r.length);break}}return"px"===n&&"px"!==r.defaultUnit?t=l.in[r.defaultUnit]/r.defaultDPI:(t=l[n][r.defaultUnit],t<0&&(t=l[n].in*r.defaultDPI)),t*parseFloat(e)}function h(e){const t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function p(e){const t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}const d=[],f={},g=[],m=new e.Matrix3,v=new e.Matrix3,y=new e.Matrix3,b=new e.Matrix3,x=new e.Vector2,w=new e.Vector3,S=new e.Matrix3,T=(new e.$DOMParser).parseFromString(t,"image/svg+xml");!function t(r,s){if(1!==r.nodeType)return;const c=function(t){if(!(t.hasAttribute("transform")||"use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))))return null;const r=function(t){const r=new e.Matrix3,n=m;if("use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))){const e=u(t.getAttribute("x")),n=u(t.getAttribute("y"));r.translate(e,n)}if(t.hasAttribute("transform")){const e=t.getAttribute("transform").split(")");for(let t=e.length-1;t>=0;t--){const s=e[t].trim();if(""===s)continue;const a=s.indexOf("("),o=s.length;if(a>0&&a<o){const e=s.substr(0,a),t=i(s.substr(a+1,o-a-1));switch(n.identity(),e){case"translate":if(t.length>=1){const e=t[0];let r=e;t.length>=2&&(r=t[1]),n.translate(e,r)}break;case"rotate":if(t.length>=1){let e=0,r=0,s=0;e=-t[0]*Math.PI/180,t.length>=3&&(r=t[1],s=t[2]),v.identity().translate(-r,-s),y.identity().rotate(e),b.multiplyMatrices(y,v),v.identity().translate(r,s),n.multiplyMatrices(v,b)}break;case"scale":if(t.length>=1){const e=t[0];let r=e;t.length>=2&&(r=t[1]),n.scale(e,r)}break;case"skewX":1===t.length&&n.set(1,Math.tan(t[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===t.length&&n.set(1,0,0,Math.tan(t[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===t.length&&n.set(t[0],t[2],t[4],t[1],t[3],t[5],0,0,1)}}r.premultiply(n)}}return r}(t);g.length>0&&r.premultiply(g[g.length-1]);return S.copy(r),g.push(r),r}(r);let l=!0,T=null;switch(r.nodeName){case"svg":break;case"style":!function(e){if(!e.sheet||!e.sheet.cssRules||!e.sheet.cssRules.length)return;for(let t=0;t<e.sheet.cssRules.length;t++){const r=e.sheet.cssRules[t];if(1!==r.type)continue;const n=r.selectorText.split(/,/gm).filter(Boolean).map((e=>e.trim()));for(let e=0;e<n.length;e++)f[n[e]]=Object.assign(f[n[e]]||{},r.style)}}(r);break;case"g":s=a(r,s);break;case"path":s=a(r,s),r.hasAttribute("d")&&(T=function(t){const r=new e.ShapePath,s=new e.Vector2,a=new e.Vector2,c=new e.Vector2;let l=!0,u=!1;const h=t.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi);for(let e=0,t=h.length;e<t;e++){const t=h[e],p=t.charAt(0),d=t.substr(1).trim();let f;switch(!0===l&&(u=!0,l=!1),p){case"M":f=i(d);for(let e=0,t=f.length;e<t;e+=2)s.x=f[e+0],s.y=f[e+1],a.x=s.x,a.y=s.y,0===e?r.moveTo(s.x,s.y):r.lineTo(s.x,s.y),0===e&&!0===u&&c.copy(s);break;case"H":f=i(d);for(let e=0,t=f.length;e<t;e++)s.x=f[e],a.x=s.x,a.y=s.y,r.lineTo(s.x,s.y),0===e&&!0===u&&c.copy(s);break;case"V":f=i(d);for(let e=0,t=f.length;e<t;e++)s.y=f[e],a.x=s.x,a.y=s.y,r.lineTo(s.x,s.y),0===e&&!0===u&&c.copy(s);break;case"L":f=i(d);for(let e=0,t=f.length;e<t;e+=2)s.x=f[e+0],s.y=f[e+1],a.x=s.x,a.y=s.y,r.lineTo(s.x,s.y),0===e&&!0===u&&c.copy(s);break;case"C":f=i(d);for(let e=0,t=f.length;e<t;e+=6)r.bezierCurveTo(f[e+0],f[e+1],f[e+2],f[e+3],f[e+4],f[e+5]),a.x=f[e+2],a.y=f[e+3],s.x=f[e+4],s.y=f[e+5],0===e&&!0===u&&c.copy(s);break;case"S":f=i(d);for(let e=0,t=f.length;e<t;e+=4)r.bezierCurveTo(o(s.x,a.x),o(s.y,a.y),f[e+0],f[e+1],f[e+2],f[e+3]),a.x=f[e+0],a.y=f[e+1],s.x=f[e+2],s.y=f[e+3],0===e&&!0===u&&c.copy(s);break;case"Q":f=i(d);for(let e=0,t=f.length;e<t;e+=4)r.quadraticCurveTo(f[e+0],f[e+1],f[e+2],f[e+3]),a.x=f[e+0],a.y=f[e+1],s.x=f[e+2],s.y=f[e+3],0===e&&!0===u&&c.copy(s);break;case"T":f=i(d);for(let e=0,t=f.length;e<t;e+=2){const t=o(s.x,a.x),n=o(s.y,a.y);r.quadraticCurveTo(t,n,f[e+0],f[e+1]),a.x=t,a.y=n,s.x=f[e+0],s.y=f[e+1],0===e&&!0===u&&c.copy(s)}break;case"A":f=i(d,[3,4],7);for(let e=0,t=f.length;e<t;e+=7){if(f[e+5]==s.x&&f[e+6]==s.y)continue;const t=s.clone();s.x=f[e+5],s.y=f[e+6],a.x=s.x,a.y=s.y,n(r,f[e],f[e+1],f[e+2],f[e+3],f[e+4],t,s),0===e&&!0===u&&c.copy(s)}break;case"m":f=i(d);for(let e=0,t=f.length;e<t;e+=2)s.x+=f[e+0],s.y+=f[e+1],a.x=s.x,a.y=s.y,0===e?r.moveTo(s.x,s.y):r.lineTo(s.x,s.y),0===e&&!0===u&&c.copy(s);break;case"h":f=i(d);for(let e=0,t=f.length;e<t;e++)s.x+=f[e],a.x=s.x,a.y=s.y,r.lineTo(s.x,s.y),0===e&&!0===u&&c.copy(s);break;case"v":f=i(d);for(let e=0,t=f.length;e<t;e++)s.y+=f[e],a.x=s.x,a.y=s.y,r.lineTo(s.x,s.y),0===e&&!0===u&&c.copy(s);break;case"l":f=i(d);for(let e=0,t=f.length;e<t;e+=2)s.x+=f[e+0],s.y+=f[e+1],a.x=s.x,a.y=s.y,r.lineTo(s.x,s.y),0===e&&!0===u&&c.copy(s);break;case"c":f=i(d);for(let e=0,t=f.length;e<t;e+=6)r.bezierCurveTo(s.x+f[e+0],s.y+f[e+1],s.x+f[e+2],s.y+f[e+3],s.x+f[e+4],s.y+f[e+5]),a.x=s.x+f[e+2],a.y=s.y+f[e+3],s.x+=f[e+4],s.y+=f[e+5],0===e&&!0===u&&c.copy(s);break;case"s":f=i(d);for(let e=0,t=f.length;e<t;e+=4)r.bezierCurveTo(o(s.x,a.x),o(s.y,a.y),s.x+f[e+0],s.y+f[e+1],s.x+f[e+2],s.y+f[e+3]),a.x=s.x+f[e+0],a.y=s.y+f[e+1],s.x+=f[e+2],s.y+=f[e+3],0===e&&!0===u&&c.copy(s);break;case"q":f=i(d);for(let e=0,t=f.length;e<t;e+=4)r.quadraticCurveTo(s.x+f[e+0],s.y+f[e+1],s.x+f[e+2],s.y+f[e+3]),a.x=s.x+f[e+0],a.y=s.y+f[e+1],s.x+=f[e+2],s.y+=f[e+3],0===e&&!0===u&&c.copy(s);break;case"t":f=i(d);for(let e=0,t=f.length;e<t;e+=2){const t=o(s.x,a.x),n=o(s.y,a.y);r.quadraticCurveTo(t,n,s.x+f[e+0],s.y+f[e+1]),a.x=t,a.y=n,s.x=s.x+f[e+0],s.y=s.y+f[e+1],0===e&&!0===u&&c.copy(s)}break;case"a":f=i(d,[3,4],7);for(let e=0,t=f.length;e<t;e+=7){if(0==f[e+5]&&0==f[e+6])continue;const t=s.clone();s.x+=f[e+5],s.y+=f[e+6],a.x=s.x,a.y=s.y,n(r,f[e],f[e+1],f[e+2],f[e+3],f[e+4],t,s),0===e&&!0===u&&c.copy(s)}break;case"Z":case"z":r.currentPath.autoClose=!0,r.currentPath.curves.length>0&&(s.copy(c),r.currentPath.currentPoint.copy(s),l=!0);break;default:console.warn(t)}u=!1}return r}(r));break;case"rect":s=a(r,s),T=function(t){const r=u(t.getAttribute("x")||0),n=u(t.getAttribute("y")||0),s=u(t.getAttribute("rx")||0),a=u(t.getAttribute("ry")||0),o=u(t.getAttribute("width")),i=u(t.getAttribute("height")),c=new e.ShapePath;c.moveTo(r+2*s,n),c.lineTo(r+o-2*s,n),(0!==s||0!==a)&&c.bezierCurveTo(r+o,n,r+o,n,r+o,n+2*a);c.lineTo(r+o,n+i-2*a),(0!==s||0!==a)&&c.bezierCurveTo(r+o,n+i,r+o,n+i,r+o-2*s,n+i);c.lineTo(r+2*s,n+i),(0!==s||0!==a)&&c.bezierCurveTo(r,n+i,r,n+i,r,n+i-2*a);c.lineTo(r,n+2*a),(0!==s||0!==a)&&c.bezierCurveTo(r,n,r,n,r+2*s,n);return c}(r);break;case"polygon":s=a(r,s),T=function(t){function r(e,t,r){const n=u(t),o=u(r);0===a?s.moveTo(n,o):s.lineTo(n,o),a++}const n=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,s=new e.ShapePath;let a=0;return t.getAttribute("points").replace(n,r),s.currentPath.autoClose=!0,s}(r);break;case"polyline":s=a(r,s),T=function(t){function r(e,t,r){const n=u(t),o=u(r);0===a?s.moveTo(n,o):s.lineTo(n,o),a++}const n=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,s=new e.ShapePath;let a=0;return t.getAttribute("points").replace(n,r),s.currentPath.autoClose=!1,s}(r);break;case"circle":s=a(r,s),T=function(t){const r=u(t.getAttribute("cx")||0),n=u(t.getAttribute("cy")||0),s=u(t.getAttribute("r")||0),a=new e.Path;a.absarc(r,n,s,0,2*Math.PI);const o=new e.ShapePath;return o.subPaths.push(a),o}(r);break;case"ellipse":s=a(r,s),T=function(t){const r=u(t.getAttribute("cx")||0),n=u(t.getAttribute("cy")||0),s=u(t.getAttribute("rx")||0),a=u(t.getAttribute("ry")||0),o=new e.Path;o.absellipse(r,n,s,a,0,2*Math.PI);const i=new e.ShapePath;return i.subPaths.push(o),i}(r);break;case"line":s=a(r,s),T=function(t){const r=u(t.getAttribute("x1")||0),n=u(t.getAttribute("y1")||0),s=u(t.getAttribute("x2")||0),a=u(t.getAttribute("y2")||0),o=new e.ShapePath;return o.moveTo(r,n),o.lineTo(s,a),o.currentPath.autoClose=!1,o}(r);break;case"defs":l=!1;break;case"use":s=a(r,s);const c=r.href.baseVal.substring(1),h=r.viewportElement.getElementById(c);h?t(h,s):console.warn("SVGLoader: 'use node' references non-existent node id: "+c)}if(T&&(void 0!==s.fill&&"none"!==s.fill&&T.color.setStyle(s.fill),function(e,t){function r(e){w.set(e.x,e.y,1).applyMatrix3(t),e.set(w.x,w.y)}const n=function(e){return 0!==e.elements[1]||0!==e.elements[3]}(t),s=e.subPaths;for(let e=0,a=s.length;e<a;e++){const a=s[e].curves;for(let e=0;e<a.length;e++){const s=a[e];s.isLineCurve?(r(s.v1),r(s.v2)):s.isCubicBezierCurve?(r(s.v0),r(s.v1),r(s.v2),r(s.v3)):s.isQuadraticBezierCurve?(r(s.v0),r(s.v1),r(s.v2)):s.isEllipseCurve&&(n&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),x.set(s.aX,s.aY),r(x),s.aX=x.x,s.aY=x.y,s.xRadius*=h(t),s.yRadius*=p(t))}}}(T,S),d.push(T),T.userData={node:r,style:s}),l){const e=r.childNodes;for(let r=0;r<e.length;r++)t(e[r],s)}c&&(g.pop(),g.length>0?S.copy(g[g.length-1]):S.identity())}(T.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4});return{paths:d,xml:T.documentElement}}static createShapes(t){const r=999999999,n=0,s=1,a=2,o=3,i=4,c=5,l=6,u={loc:n,t:0};function h(e,t,r,s){const o=e.x,i=t.x,c=r.x,l=s.x,h=e.y,d=t.y,f=r.y,g=s.y,m=(l-c)*(h-f)-(g-f)*(o-c),v=(g-f)*(i-o)-(l-c)*(d-h),y=m/v,b=((i-o)*(h-f)-(d-h)*(o-c))/v;if(0===v&&0!==m||y<=0||y>=1||b<0||b>1)return null;if(0===m&&0===v){for(let c=0;c<2;c++){if(p(0===c?r:s,e,t),u.loc==n){const e=0===c?r:s;return{x:e.x,y:e.y,t:u.t}}if(u.loc==a){return{x:+(o+u.t*(i-o)).toPrecision(10),y:+(h+u.t*(d-h)).toPrecision(10),t:u.t}}}return null}for(let a=0;a<2;a++)if(p(0===a?r:s,e,t),u.loc==n){const e=0===a?r:s;return{x:e.x,y:e.y,t:u.t}}return{x:+(o+y*(i-o)).toPrecision(10),y:+(h+y*(d-h)).toPrecision(10),t:y}}function p(e,t,r){const h=r.x-t.x,p=r.y-t.y,d=e.x-t.x,f=e.y-t.y,g=h*f-d*p;if(e.x===t.x&&e.y===t.y)return u.loc=n,void(u.t=0);if(e.x===r.x&&e.y===r.y)return u.loc=s,void(u.t=1);if(g<-Number.EPSILON)return void(u.loc=o);if(g>Number.EPSILON)return void(u.loc=i);if(h*d<0||p*f<0)return void(u.loc=c);if(Math.sqrt(h*h+p*p)<Math.sqrt(d*d+f*f))return void(u.loc=l);let m;m=0!==h?d/h:f/p,u.loc=a,u.t=m}function d(t,r,n){const s=new e.Vector2;r.getCenter(s);const a=[];return n.forEach((r=>{if(r.boundingBox.containsPoint(s)){(function(t,r){const n=[],s=[];for(let a=1;a<t.length;a++){const o=t[a-1],i=t[a];for(let t=1;t<r.length;t++){const a=h(o,i,r[t-1],r[t]);null!==a&&void 0===n.find((e=>e.t<=a.t+Number.EPSILON&&e.t>=a.t-Number.EPSILON))&&(n.push(a),s.push(new e.Vector2(a.x,a.y)))}}return s})(t,r.points).forEach((e=>{a.push({identifier:r.identifier,isCW:r.isCW,point:e})}))}})),a.sort(((e,t)=>e.point.x-t.point.x)),a}let f=0,g=r,m=-999999999,v=t.subPaths.map((t=>{const n=t.getPoints();let s=-999999999,a=r,o=-999999999,i=r;for(let e=0;e<n.length;e++){const t=n[e];t.y>s&&(s=t.y),t.y<a&&(a=t.y),t.x>o&&(o=t.x),t.x<i&&(i=t.x)}return m<=o&&(m=o+1),g>=i&&(g=i-1),{points:n,isCW:e.ShapeUtils.isClockWise(n),identifier:f++,boundingBox:new e.Box2(new e.Vector2(i,a),new e.Vector2(o,s))}}));v=v.filter((e=>e.points.length>1));const y=v.map((r=>function(t,r,n,s,a){null!=a&&""!==a||(a="nonzero");const o=new e.Vector2;t.boundingBox.getCenter(o);const i=d([new e.Vector2(n,o.y),new e.Vector2(s,o.y)],t.boundingBox,r);i.sort(((e,t)=>e.point.x-t.point.x));const c=[],l=[];i.forEach((e=>{e.identifier===t.identifier?c.push(e):l.push(e)}));const u=c[0].point.x,h=[];let p=0;for(;p<l.length&&l[p].point.x<u;)h.length>0&&h[h.length-1]===l[p].identifier?h.pop():h.push(l[p].identifier),p++;if(h.push(t.identifier),"evenodd"===a){const e=h.length%2==0,r=h[h.length-2];return{identifier:t.identifier,isHole:e,for:r}}if("nonzero"===a){let e=!0,n=null,s=null;for(let t=0;t<h.length;t++){const a=h[t];e?(s=r[a].isCW,e=!1,n=a):s!==r[a].isCW&&(s=r[a].isCW,e=!0)}return{identifier:t.identifier,isHole:e,for:n}}console.warn('fill-rule: "'+a+'" is currently not implemented.')}(r,v,g,m,t.userData.style.fillRule))),b=[];return v.forEach((t=>{if(!y[t.identifier].isHole){const r=new e.Shape(t.points);y.filter((e=>e.isHole&&e.for===t.identifier)).forEach((t=>{const n=v[t.identifier];r.holes.push(new e.Path(n.points))})),b.push(r)}})),b}static getStrokeStyle(e,t,r,n,s){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:r=void 0!==r?r:"miter",strokeLineCap:n=void 0!==n?n:"butt",strokeMiterLimit:s=void 0!==s?s:4}}static pointsToStroke(t,r,n,s){const a=[],o=[],i=[];if(0===bc.pointsToStrokeWithBuffers(t,r,n,s,a,o,i))return null;const c=new e.BufferGeometry;return c.setAttribute("position",new e.Float32BufferAttribute(a,3)),c.setAttribute("normal",new e.Float32BufferAttribute(o,3)),c.setAttribute("uv",new e.Float32BufferAttribute(i,2)),c}static pointsToStrokeWithBuffers(t,r,n,s,a,o,i,c){const l=new e.Vector2,u=new e.Vector2,h=new e.Vector2,p=new e.Vector2,d=new e.Vector2,f=new e.Vector2,g=new e.Vector2,m=new e.Vector2,v=new e.Vector2,y=new e.Vector2,b=new e.Vector2,x=new e.Vector2,w=new e.Vector2,S=new e.Vector2,T=new e.Vector2,F=new e.Vector2,k=new e.Vector2;n=void 0!==n?n:12,s=void 0!==s?s:.001,c=void 0!==c?c:0;const E=(t=function(e){let t=!1;for(let r=1,n=e.length-1;r<n;r++)if(e[r].distanceTo(e[r+1])<s){t=!0;break}if(!t)return e;const r=[];r.push(e[0]);for(let t=1,n=e.length-1;t<n;t++)e[t].distanceTo(e[t+1])>=s&&r.push(e[t]);return r.push(e[e.length-1]),r}(t)).length;if(E<2)return 0;const A=t[0].equals(t[E-1]);let I,M,L=t[0];const C=r.strokeWidth/2,R=1/(E-1);let O,N,U,D,P=0,B=!1,G=0,_=3*c,H=2*c;V(t[0],t[1],l).multiplyScalar(C),m.copy(t[0]).sub(l),v.copy(t[0]).add(l),y.copy(m),b.copy(v);for(let e=1;e<E;e++){I=t[e],M=e===E-1?A?t[1]:void 0:t[e+1];const n=l;if(V(L,I,n),h.copy(n).multiplyScalar(C),x.copy(I).sub(h),w.copy(I).add(h),O=P+R,N=!1,void 0!==M){V(I,M,u),h.copy(u).multiplyScalar(C),S.copy(I).sub(h),T.copy(I).add(h),U=!0,h.subVectors(M,L),n.dot(h)<0&&(U=!1),1===e&&(B=U),h.subVectors(M,I),h.normalize();const t=Math.abs(n.dot(h));if(0!==t){const e=C/t;h.multiplyScalar(-e),p.subVectors(I,L),d.copy(p).setLength(e).add(h),F.copy(d).negate();const n=d.length(),s=p.length();p.divideScalar(s),f.subVectors(M,I);const a=f.length();switch(f.divideScalar(a),p.dot(F)<s&&f.dot(F)<a&&(N=!0),k.copy(d).add(I),F.add(I),D=!1,N?U?(T.copy(F),w.copy(F)):(S.copy(F),x.copy(F)):W(),r.strokeLineJoin){case"bevel":X(U,N,O);break;case"round":q(U,N),U?j(I,x,S,O,0):j(I,T,w,O,1);break;case"miter":case"miter-clip":default:const e=C*r.strokeMiterLimit/n;if(e<1){if("miter-clip"!==r.strokeLineJoin){X(U,N,O);break}q(U,N),U?(f.subVectors(k,x).multiplyScalar(e).add(x),g.subVectors(k,S).multiplyScalar(e).add(S),z(x,O,0),z(f,O,0),z(I,O,.5),z(I,O,.5),z(f,O,0),z(g,O,0),z(I,O,.5),z(g,O,0),z(S,O,0)):(f.subVectors(k,w).multiplyScalar(e).add(w),g.subVectors(k,T).multiplyScalar(e).add(T),z(w,O,1),z(f,O,1),z(I,O,.5),z(I,O,.5),z(f,O,1),z(g,O,1),z(I,O,.5),z(g,O,1),z(T,O,1))}else N?(U?(z(v,P,1),z(m,P,0),z(k,O,0),z(v,P,1),z(k,O,0),z(F,O,1)):(z(v,P,1),z(m,P,0),z(k,O,1),z(m,P,0),z(F,O,0),z(k,O,1)),U?S.copy(k):T.copy(k)):U?(z(x,O,0),z(k,O,0),z(I,O,.5),z(I,O,.5),z(k,O,0),z(S,O,0)):(z(w,O,1),z(k,O,1),z(I,O,.5),z(I,O,.5),z(k,O,1),z(T,O,1)),D=!0}}else W()}else W();A||e!==E-1||Y(t[0],y,b,U,!0,P),P=O,L=I,m.copy(S),v.copy(T)}if(A){if(N&&a){let e=k,t=F;B!==U&&(e=F,t=k),U?(D||B)&&(t.toArray(a,0),t.toArray(a,9),D&&e.toArray(a,3)):!D&&B||(t.toArray(a,3),t.toArray(a,9),D&&e.toArray(a,0))}}else Y(I,x,w,U,!1,O);return G;function V(e,t,r){return r.subVectors(t,e),r.set(-r.y,r.x).normalize()}function z(e,t,r){a&&(a[_]=e.x,a[_+1]=e.y,a[_+2]=0,o&&(o[_]=0,o[_+1]=0,o[_+2]=1),_+=3,i&&(i[H]=t,i[H+1]=r,H+=2)),G+=3}function j(e,t,r,s,a){l.copy(t).sub(e).normalize(),u.copy(r).sub(e).normalize();let o=Math.PI;const i=l.dot(u);Math.abs(i)<1&&(o=Math.abs(Math.acos(i))),o/=n,h.copy(t);for(let t=0,r=n-1;t<r;t++)p.copy(h).rotateAround(e,o),z(h,s,a),z(p,s,a),z(e,s,.5),h.copy(p);z(p,s,a),z(r,s,a),z(e,s,.5)}function W(){z(v,P,1),z(m,P,0),z(x,O,0),z(v,P,1),z(x,O,1),z(w,O,0)}function X(e,t,r){t?e?(z(v,P,1),z(m,P,0),z(x,O,0),z(v,P,1),z(x,O,0),z(F,O,1),z(x,r,0),z(S,r,0),z(F,r,.5)):(z(v,P,1),z(m,P,0),z(w,O,1),z(m,P,0),z(F,O,0),z(w,O,1),z(w,r,1),z(T,r,0),z(F,r,.5)):e?(z(x,r,0),z(S,r,0),z(I,r,.5)):(z(w,r,1),z(T,r,0),z(I,r,.5))}function q(e,t){t&&(e?(z(v,P,1),z(m,P,0),z(x,O,0),z(v,P,1),z(x,O,0),z(F,O,1),z(x,P,0),z(I,O,.5),z(F,O,1),z(I,O,.5),z(S,P,0),z(F,O,1)):(z(v,P,1),z(m,P,0),z(w,O,1),z(m,P,0),z(F,O,0),z(w,O,1),z(w,P,1),z(F,O,0),z(I,O,.5),z(I,O,.5),z(F,O,0),z(T,P,1)))}function Y(e,t,n,s,o,i){switch(r.strokeLineCap){case"round":o?j(e,n,t,i,.5):j(e,t,n,i,.5);break;case"square":if(o)l.subVectors(t,e),u.set(l.y,-l.x),h.addVectors(l,u).add(e),p.subVectors(u,l).add(e),s?(h.toArray(a,3),p.toArray(a,0),p.toArray(a,9)):(h.toArray(a,3),h.toArray(a,9),p.toArray(a,0));else{l.subVectors(n,e),u.set(l.y,-l.x),h.addVectors(l,u).add(e),p.subVectors(u,l).add(e);const t=a.length;s?(h.toArray(a,t-3),p.toArray(a,t-6),p.toArray(a,t-12)):(h.toArray(a,t-6),p.toArray(a,t-3),p.toArray(a,t-12))}}}}}class xc extends e.DataTextureLoader{constructor(t){super(t),this.type=e.UnsignedByteType}parse(t){const r=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},n=function(e,t,r){t=t||1024;let n=e.pos,s=-1,a=0,o="",i=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));for(;0>(s=i.indexOf("\n"))&&a<t&&n<e.byteLength;)o+=i,a+=i.length,n+=128,i+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return-1<s&&(!1!==r&&(e.pos+=a+s+1),o+i.slice(0,s))},s=function(e,t,r,n){const s=e[t+3],a=Math.pow(2,s-128)/255;r[n+0]=e[t+0]*a,r[n+1]=e[t+1]*a,r[n+2]=e[t+2]*a},a=function(t,r,n,s){const a=t[r+3],o=Math.pow(2,a-128)/255;n[s+0]=e.DataUtils.toHalfFloat(t[r+0]*o),n[s+1]=e.DataUtils.toHalfFloat(t[r+1]*o),n[s+2]=e.DataUtils.toHalfFloat(t[r+2]*o)},o=new Uint8Array(t);o.pos=0;const i=function(e){const t=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,i={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let c,l;if(e.pos>=e.byteLength||!(c=n(e)))return r(1,"no header found");if(!(l=c.match(/^#\?(\S+)/)))return r(3,"bad initial token");for(i.valid|=1,i.programtype=l[1],i.string+=c+"\n";c=n(e),!1!==c;)if(i.string+=c+"\n","#"!==c.charAt(0)){if((l=c.match(t))&&(i.gamma=parseFloat(l[1],10)),(l=c.match(s))&&(i.exposure=parseFloat(l[1],10)),(l=c.match(a))&&(i.valid|=2,i.format=l[1]),(l=c.match(o))&&(i.valid|=4,i.height=parseInt(l[1],10),i.width=parseInt(l[2],10)),2&i.valid&&4&i.valid)break}else i.comments+=c+"\n";return 2&i.valid?4&i.valid?i:r(3,"missing image size specifier"):r(3,"missing format specifier")}(o);if(-1!==i){const t=i.width,n=i.height,c=function(e,t,n){const s=t;if(s<8||s>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(s!==(e[2]<<8|e[3]))return r(3,"wrong scanline width");const a=new Uint8Array(4*t*n);if(!a.length)return r(4,"unable to allocate buffer space");let o=0,i=0;const c=4*s,l=new Uint8Array(4),u=new Uint8Array(c);let h=n;for(;h>0&&i<e.byteLength;){if(i+4>e.byteLength)return r(1);if(l[0]=e[i++],l[1]=e[i++],l[2]=e[i++],l[3]=e[i++],2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=s)return r(3,"bad rgbe scanline format");let t,n=0;for(;n<c&&i<e.byteLength;){t=e[i++];const s=t>128;if(s&&(t-=128),0===t||n+t>c)return r(3,"bad scanline data");if(s){const r=e[i++];for(let e=0;e<t;e++)u[n++]=r}else u.set(e.subarray(i,i+t),n),n+=t,i+=t}const p=s;for(let e=0;e<p;e++){let t=0;a[o]=u[e+t],t+=s,a[o+1]=u[e+t],t+=s,a[o+2]=u[e+t],t+=s,a[o+3]=u[e+t],o+=4}h--}return a}(o.subarray(o.pos),t,n);if(-1!==c){let r,o,l,u;switch(this.type){case e.UnsignedByteType:r=c,o=e.RGBEFormat,l=e.UnsignedByteType;break;case e.FloatType:u=c.length/4*3;const t=new Float32Array(u);for(let e=0;e<u;e++)s(c,4*e,t,3*e);r=t,o=e.RGBFormat,l=e.FloatType;break;case e.HalfFloatType:u=c.length/4*3;const n=new Uint16Array(u);for(let e=0;e<u;e++)a(c,4*e,n,3*e);r=n,o=e.RGBFormat,l=e.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:t,height:n,data:r,header:i.string,gamma:i.gamma,exposure:i.exposure,format:o,type:l}}}return null}setDataType(e){return this.type=e,this}load(t,r,n,s){return super.load(t,(function(t,n){switch(t.type){case e.UnsignedByteType:t.encoding=e.RGBEEncoding,t.minFilter=e.NearestFilter,t.magFilter=e.NearestFilter,t.generateMipmaps=!1,t.flipY=!0;break;case e.FloatType:case e.HalfFloatType:t.encoding=e.LinearEncoding,t.minFilter=e.LinearFilter,t.magFilter=e.LinearFilter,t.generateMipmaps=!1,t.flipY=!0}r&&r(t,n)}),n,s)}}const wc="https://techbrood.com/threejs";function Sc(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}return r}class Tc extends e.Loader{constructor(e){super(e)}load(t,r,n,s){const a=this,o=""===a.path?e.LoaderUtils.extractUrlBase(t):a.path,i=new e.FileLoader(a.manager);i.setPath(a.path),i.setRequestHeader(a.requestHeader),i.setWithCredentials(a.withCredentials),i.load(t,(function(e){try{r(a.parse(e,o))}catch(e){s?s(e):console.error(e),a.manager.itemError(t)}}),n,s)}parse(t,r){function n(e,t){const r=[],n=e.childNodes;for(let e=0,s=n.length;e<s;e++){const s=n[e];s.nodeName===t&&r.push(s)}return r}function s(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),r=new Array(t.length);for(let e=0,n=t.length;e<n;e++)r[e]=t[e];return r}function a(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),r=new Array(t.length);for(let e=0,n=t.length;e<n;e++)r[e]=parseFloat(t[e]);return r}function o(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),r=new Array(t.length);for(let e=0,n=t.length;e<n;e++)r[e]=parseInt(t[e]);return r}function i(e){return e.substring(1)}function c(e){return 0===Object.keys(e).length}function l(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function u(e){return void 0!==e?e.textContent:"Y_UP"}function h(e,t,r,s){const a=n(e,t)[0];if(void 0!==a){const e=n(a,r);for(let t=0;t<e.length;t++)s(e[t])}}function p(e,t){for(const r in e){e[r].build=t(e[r])}}function d(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function f(e){const t={inputs:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":const e=i(n.getAttribute("source")),r=n.getAttribute("semantic");t.inputs[r]=e}}return t}function g(e){const t={};let r=e.getAttribute("target").split("/");const n=r.shift();let s=r.shift();const a=-1!==s.indexOf("("),o=-1!==s.indexOf(".");if(o)r=s.split("."),s=r.shift(),t.member=r.shift();else if(a){const e=s.split("(");s=e.shift();for(let t=0;t<e.length;t++)e[t]=parseInt(e[t].replace(/\)/,""));t.indices=e}return t.id=n,t.sid=s,t.arraySyntax=a,t.memberSyntax=o,t.sampler=i(e.getAttribute("source")),t}function m(e){const t=[],r=e.channels,n=e.samplers,s=e.sources;for(const e in r)if(r.hasOwnProperty(e)){const a=r[e],o=n[a.sampler],i=o.inputs.INPUT,c=o.inputs.OUTPUT;S(y(a,s[i],s[c]),t)}return t}function v(e){return d(Ze.animations[e],m)}function y(e,t,r){const n=Ze.nodes[e.id],s=Pe(n.id),a=n.transforms[e.sid],o=n.matrix.clone().transpose();let i,c,l,u,h,p;const d={};switch(a){case"matrix":for(l=0,u=t.array.length;l<u;l++)if(i=t.array[l],c=l*r.stride,void 0===d[i]&&(d[i]={}),!0===e.arraySyntax){const t=r.array[c],n=e.indices[0]+4*e.indices[1];d[i][n]=t}else for(h=0,p=r.stride;h<p;h++)d[i][h]=r.array[c+h];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',a)}const f=function(e,t){const r=[];for(const t in e)r.push({time:parseFloat(t),value:e[t]});r.sort(n);for(let e=0;e<16;e++)T(r,e,t.elements[e]);return r;function n(e,t){return e.time-t.time}}(d,o);return{name:s.uuid,keyframes:f}}const b=new e.Vector3,x=new e.Vector3,w=new e.Quaternion;function S(t,r){const n=t.keyframes,s=t.name,a=[],o=[],i=[],c=[];for(let e=0,t=n.length;e<t;e++){const t=n[e],r=t.time,s=t.value;ke.fromArray(s).transpose(),ke.decompose(b,w,x),a.push(r),o.push(b.x,b.y,b.z),i.push(w.x,w.y,w.z,w.w),c.push(x.x,x.y,x.z)}return o.length>0&&r.push(new e.VectorKeyframeTrack(s+".position",a,o)),i.length>0&&r.push(new e.QuaternionKeyframeTrack(s+".quaternion",a,i)),c.length>0&&r.push(new e.VectorKeyframeTrack(s+".scale",a,c)),r}function T(e,t,r){let n,s,a,o=!0;for(s=0,a=e.length;s<a;s++)n=e[s],void 0===n.value[t]?n.value[t]=null:o=!1;if(!0===o)for(s=0,a=e.length;s<a;s++)n=e[s],n.value[t]=r;else!function(e,t){let r,n;for(let s=0,a=e.length;s<a;s++){const a=e[s];if(null===a.value[t]){if(r=F(e,s,t),n=k(e,s,t),null===r){a.value[t]=n.value[t];continue}if(null===n){a.value[t]=r.value[t];continue}E(a,r,n,t)}}}(e,t)}function F(e,t,r){for(;t>=0;){const n=e[t];if(null!==n.value[r])return n;t--}return null}function k(e,t,r){for(;t<e.length;){const n=e[t];if(null!==n.value[r])return n;t++}return null}function E(e,t,r,n){r.time-t.time!=0?e.value[n]=(e.time-t.time)*(r.value[n]-t.value[n])/(r.time-t.time)+t.value[n]:e.value[n]=t.value[n]}function A(t){const r=[],n=t.name,s=t.end-t.start||-1,a=t.animations;for(let e=0,t=a.length;e<t;e++){const t=v(a[e]);for(let e=0,n=t.length;e<n;e++)r.push(t[e])}return new e.AnimationClip(n,s,r)}function I(e){return d(Ze.clips[e],A)}function M(e){const t={sources:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=a(n.textContent);break;case"source":const e=n.getAttribute("id");t.sources[e]=ae(n);break;case"joints":t.joints=L(n);break;case"vertex_weights":t.vertexWeights=C(n)}}return t}function L(e){const t={inputs:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":const e=n.getAttribute("semantic"),r=i(n.getAttribute("source"));t.inputs[e]=r}}return t}function C(e){const t={inputs:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":const e=n.getAttribute("semantic"),r=i(n.getAttribute("source")),s=parseInt(n.getAttribute("offset"));t.inputs[e]={id:r,offset:s};break;case"vcount":t.vcount=o(n.textContent);break;case"v":t.v=o(n.textContent)}}return t}function R(t){const r={id:t.id},n=Ze.geometries[r.id];return void 0!==t.skin&&(r.skin=function(t){const r=4,n={joints:[],indices:{array:[],stride:r},weights:{array:[],stride:r}},s=t.sources,a=t.vertexWeights,o=a.vcount,i=a.v,c=a.inputs.JOINT.offset,l=a.inputs.WEIGHT.offset,u=t.sources[t.joints.inputs.JOINT],h=t.sources[t.joints.inputs.INV_BIND_MATRIX],p=s[a.inputs.WEIGHT.id].array;let d,f,g,m=0;for(d=0,g=o.length;d<g;d++){const e=o[d],t=[];for(f=0;f<e;f++){const e=i[m+c],r=p[i[m+l]];t.push({index:e,weight:r}),m+=2}for(t.sort(v),f=0;f<r;f++){const e=t[f];void 0!==e?(n.indices.array.push(e.index),n.weights.array.push(e.weight)):(n.indices.array.push(0),n.weights.array.push(0))}}t.bindShapeMatrix?n.bindMatrix=(new e.Matrix4).fromArray(t.bindShapeMatrix).transpose():n.bindMatrix=(new e.Matrix4).identity();for(d=0,g=u.array.length;d<g;d++){const t=u.array[d],r=(new e.Matrix4).fromArray(h.array,d*h.stride).transpose();n.joints.push({name:t,boneInverse:r})}return n;function v(e,t){return t.weight-e.weight}}(t.skin),n.sources.skinIndices=r.skin.indices,n.sources.skinWeights=r.skin.weights),r}function O(e){return void 0!==e.build?e.build:e.init_from}function N(e){const t=Ze.images[e];return void 0!==t?d(t,O):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function U(e){const t={surfaces:{},samplers:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"newparam":D(n,t);break;case"technique":t.technique=G(n);break;case"extra":t.extra=W(n)}}return t}function D(e,t){const r=e.getAttribute("sid");for(let n=0,s=e.childNodes.length;n<s;n++){const s=e.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"surface":t.surfaces[r]=P(s);break;case"sampler2D":t.samplers[r]=B(s)}}}function P(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"init_from":t.init_from=n.textContent}}return t}function B(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"source":t.source=n.textContent}}return t}function G(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=n.nodeName,t.parameters=_(n)}}return t}function _(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[n.nodeName]=H(n);break;case"transparent":t[n.nodeName]={opaque:n.getAttribute("opaque"),data:H(n)}}}return t}function H(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"color":t[n.nodeName]=a(n.textContent);break;case"float":t[n.nodeName]=parseFloat(n.textContent);break;case"texture":t[n.nodeName]={id:n.getAttribute("texture"),extra:V(n)}}}return t}function V(e){const t={technique:{}};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"extra":z(n,t)}}return t}function z(e,t){for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique":j(n,t)}}}function j(e,t){for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":"TRUE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=1:"FALSE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=0:t.technique[n.nodeName]=parseInt(n.textContent)}}}function W(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique":t.technique=X(n)}}return t}function X(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"double_sided":t[n.nodeName]=parseInt(n.textContent)}}return t}function q(e){return e}function Y(t){const r=(n=t.url,d(Ze.effects[n],q));var n;const s=r.profile.technique,a=r.profile.extra;let o;switch(s.type){case"phong":case"blinn":o=new e.MeshPhongMaterial;break;case"lambert":o=new e.MeshLambertMaterial;break;default:o=new e.MeshBasicMaterial}function i(t){const n=r.profile.samplers[t.id];let s=null;if(void 0!==n){s=N(r.profile.surfaces[n.source].init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),s=N(t.id);if(null!==s){const r=function(e){let t,r=e.slice(2+(e.lastIndexOf(".")-1>>>0));switch(r=r.toLowerCase(),r){case"tga":t=Xe;break;default:t=We}return t}(s);if(void 0!==r){const n=r.load(s),a=t.extra;if(void 0!==a&&void 0!==a.technique&&!1===c(a.technique)){const t=a.technique;n.wrapS=t.wrapU?e.RepeatWrapping:e.ClampToEdgeWrapping,n.wrapT=t.wrapV?e.RepeatWrapping:e.ClampToEdgeWrapping,n.offset.set(t.offsetU||0,t.offsetV||0),n.repeat.set(t.repeatU||1,t.repeatV||1)}else n.wrapS=e.RepeatWrapping,n.wrapT=e.RepeatWrapping;return n}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",s),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",t.id),null}o.name=t.name||"";const l=s.parameters;for(const e in l){const t=l[e];switch(e){case"diffuse":t.color&&o.color.fromArray(t.color),t.texture&&(o.map=i(t.texture));break;case"specular":t.color&&o.specular&&o.specular.fromArray(t.color),t.texture&&(o.specularMap=i(t.texture));break;case"bump":t.texture&&(o.normalMap=i(t.texture));break;case"ambient":t.texture&&(o.lightMap=i(t.texture));break;case"shininess":t.float&&o.shininess&&(o.shininess=t.float);break;case"emission":t.color&&o.emissive&&o.emissive.fromArray(t.color),t.texture&&(o.emissiveMap=i(t.texture))}}let u=l.transparent,h=l.transparency;if(void 0===h&&u&&(h={float:1}),void 0===u&&h&&(u={opaque:"A_ONE",data:{color:[1,1,1,1]}}),u&&h)if(u.data.texture)o.transparent=!0;else{const e=u.data.color;switch(u.opaque){case"A_ONE":o.opacity=e[3]*h.float;break;case"RGB_ZERO":o.opacity=1-e[0]*h.float;break;case"A_ZERO":o.opacity=1-e[3]*h.float;break;case"RGB_ONE":o.opacity=e[0]*h.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',u.opaque)}o.opacity<1&&(o.transparent=!0)}return void 0!==a&&void 0!==a.technique&&1===a.technique.double_sided&&(o.side=e.DoubleSide),o}function K(e){return d(Ze.materials[e],Y)}function Z(e){for(let t=0;t<e.childNodes.length;t++){const r=e.childNodes[t];switch(r.nodeName){case"technique_common":return Q(r)}}return{}}function Q(e){const t={};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];switch(n.nodeName){case"perspective":case"orthographic":t.technique=n.nodeName,t.parameters=$(n)}}return t}function $(e){const t={};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[n.nodeName]=parseFloat(n.textContent)}}return t}function J(t){let r;switch(t.optics.technique){case"perspective":r=new e.PerspectiveCamera(t.optics.parameters.yfov,t.optics.parameters.aspect_ratio,t.optics.parameters.znear,t.optics.parameters.zfar);break;case"orthographic":let n=t.optics.parameters.ymag,s=t.optics.parameters.xmag;const a=t.optics.parameters.aspect_ratio;s=void 0===s?n*a:s,n=void 0===n?s/a:n,s*=.5,n*=.5,r=new e.OrthographicCamera(-s,s,n,-n,t.optics.parameters.znear,t.optics.parameters.zfar);break;default:r=new e.PerspectiveCamera}return r.name=t.name||"",r}function ee(e){const t=Ze.cameras[e];return void 0!==t?d(t,J):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function te(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=n.nodeName,t.parameters=re(n)}}return t}function re(t){const r={};for(let n=0,s=t.childNodes.length;n<s;n++){const s=t.childNodes[n];if(1===s.nodeType)switch(s.nodeName){case"color":const t=a(s.textContent);r.color=(new e.Color).fromArray(t);break;case"falloff_angle":r.falloffAngle=parseFloat(s.textContent);break;case"quadratic_attenuation":const n=parseFloat(s.textContent);r.distance=n?Math.sqrt(1/n):0}}return r}function ne(t){let r;switch(t.technique){case"directional":r=new e.DirectionalLight;break;case"point":r=new e.PointLight;break;case"spot":r=new e.SpotLight;break;case"ambient":r=new e.AmbientLight}return t.parameters.color&&r.color.copy(t.parameters.color),t.parameters.distance&&(r.distance=t.parameters.distance),r}function se(e){const t=Ze.lights[e];return void 0!==t?d(t,ne):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function ae(e){const t={array:[],stride:3};for(let r=0;r<e.childNodes.length;r++){const o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=a(o.textContent);break;case"Name_array":t.array=s(o.textContent);break;case"technique_common":const e=n(o,"accessor")[0];void 0!==e&&(t.stride=parseInt(e.getAttribute("stride")))}}return t}function oe(e){const t={};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];1===n.nodeType&&(t[n.getAttribute("semantic")]=i(n.getAttribute("source")))}return t}function ie(e){const t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"input":const e=i(n.getAttribute("source")),r=n.getAttribute("semantic"),s=parseInt(n.getAttribute("offset")),a=parseInt(n.getAttribute("set")),c=a>0?r+a:r;t.inputs[c]={id:e,offset:s},t.stride=Math.max(t.stride,s+1),"TEXCOORD"===r&&(t.hasUV=!0);break;case"vcount":t.vcount=o(n.textContent);break;case"p":t.p=o(n.textContent)}}return t}function ce(e){let t=0;for(let r=0,n=e.length;r<n;r++){!0===e[r].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function le(e){const t={},r=e.sources,n=e.vertices,s=e.primitives;if(0===s.length)return{};const a=function(e){const t={};for(let r=0;r<e.length;r++){const n=e[r];void 0===t[n.type]&&(t[n.type]=[]),t[n.type].push(n)}return t}(s);for(const e in a){const s=a[e];ce(s),t[e]=ue(s,r,n)}return t}function ue(t,r,n){const s={},a={array:[],stride:0},o={array:[],stride:0},i={array:[],stride:0},c={array:[],stride:0},l={array:[],stride:0},u=[],h=4,p=[],d=4,f=new e.BufferGeometry,g=[];let m=0;for(let e=0;e<t.length;e++){const s=t[e],h=s.inputs;let d=0;switch(s.type){case"lines":case"linestrips":d=2*s.count;break;case"triangles":d=3*s.count;break;case"polylist":for(let e=0;e<s.count;e++){const t=s.vcount[e];switch(t){case 3:d+=3;break;case 4:d+=6;break;default:d+=3*(t-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",s.type)}f.addGroup(m,d,e),m+=d,s.material&&g.push(s.material);for(const e in h){const d=h[e];switch(e){case"VERTEX":for(const e in n){const h=n[e];switch(e){case"POSITION":const n=a.array.length;if(he(s,r[h],d.offset,a.array),a.stride=r[h].stride,r.skinWeights&&r.skinIndices&&(he(s,r.skinIndices,d.offset,u),he(s,r.skinWeights,d.offset,p)),!1===s.hasUV&&!0===t.uvsNeedsFix){const e=(a.array.length-n)/a.stride;for(let t=0;t<e;t++)i.array.push(0,0)}break;case"NORMAL":he(s,r[h],d.offset,o.array),o.stride=r[h].stride;break;case"COLOR":he(s,r[h],d.offset,l.array),l.stride=r[h].stride;break;case"TEXCOORD":he(s,r[h],d.offset,i.array),i.stride=r[h].stride;break;case"TEXCOORD1":he(s,r[h],d.offset,c.array),i.stride=r[h].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',e)}}break;case"NORMAL":he(s,r[d.id],d.offset,o.array),o.stride=r[d.id].stride;break;case"COLOR":he(s,r[d.id],d.offset,l.array),l.stride=r[d.id].stride;break;case"TEXCOORD":he(s,r[d.id],d.offset,i.array),i.stride=r[d.id].stride;break;case"TEXCOORD1":he(s,r[d.id],d.offset,c.array),c.stride=r[d.id].stride}}}return a.array.length>0&&f.setAttribute("position",new e.Float32BufferAttribute(a.array,a.stride)),o.array.length>0&&f.setAttribute("normal",new e.Float32BufferAttribute(o.array,o.stride)),l.array.length>0&&f.setAttribute("color",new e.Float32BufferAttribute(l.array,l.stride)),i.array.length>0&&f.setAttribute("uv",new e.Float32BufferAttribute(i.array,i.stride)),c.array.length>0&&f.setAttribute("uv2",new e.Float32BufferAttribute(c.array,c.stride)),u.length>0&&f.setAttribute("skinIndex",new e.Float32BufferAttribute(u,h)),p.length>0&&f.setAttribute("skinWeight",new e.Float32BufferAttribute(p,d)),s.data=f,s.type=t[0].type,s.materialKeys=g,s}function he(e,t,r,n){const s=e.p,a=e.stride,o=e.vcount;function i(e){let t=s[e+r]*l;const a=t+l;for(;t<a;t++)n.push(c[t])}const c=t.array,l=t.stride;if(void 0!==e.vcount){let e=0;for(let t=0,r=o.length;t<r;t++){const r=o[t];if(4===r){const t=e+1*a,r=e+2*a,n=e+3*a;i(e+0*a),i(t),i(n),i(t),i(r),i(n)}else if(3===r){const t=e+1*a,r=e+2*a;i(e+0*a),i(t),i(r)}else if(r>4)for(let t=1,n=r-2;t<=n;t++){const r=e+a*t,n=e+a*(t+1);i(e+0*a),i(r),i(n)}e+=a*r}}else for(let e=0,t=s.length;e<t;e+=a)i(e)}function pe(e){return d(Ze.geometries[e],le)}function de(e){return void 0!==e.build?e.build:e}function fe(e,t){for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"joint":t.joints[n.getAttribute("sid")]=ge(n);break;case"link":t.links.push(ve(n))}}}function ge(e){let t;for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"prismatic":case"revolute":t=me(n)}}return t}function me(t){const r={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",axis:new e.Vector3,limits:{min:0,max:0},type:t.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let e=0;e<t.childNodes.length;e++){const n=t.childNodes[e];if(1===n.nodeType)switch(n.nodeName){case"axis":const e=a(n.textContent);r.axis.fromArray(e);break;case"limits":const t=n.getElementsByTagName("max")[0],s=n.getElementsByTagName("min")[0];r.limits.max=parseFloat(t.textContent),r.limits.min=parseFloat(s.textContent)}}return r.limits.min>=r.limits.max&&(r.static=!0),r.middlePosition=(r.limits.min+r.limits.max)/2,r}function ve(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"attachment_full":t.attachments.push(ye(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(be(n))}}return t}function ye(e){const t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"link":t.links.push(ve(n));break;case"matrix":case"translate":case"rotate":t.transforms.push(be(n))}}return t}function be(t){const r={type:t.nodeName},n=a(t.textContent);switch(r.type){case"matrix":r.obj=new e.Matrix4,r.obj.fromArray(n).transpose();break;case"translate":r.obj=new e.Vector3,r.obj.fromArray(n);break;case"rotate":r.obj=new e.Vector3,r.obj.fromArray(n),r.angle=e.MathUtils.degToRad(n[3])}return r}function xe(e,t){for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":we(n,t)}}}function we(e,t){for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"inertia":t.inertia=a(n.textContent);break;case"mass":t.mass=a(n.textContent)[0]}}}function Se(e){const t={target:e.getAttribute("target").split("/").pop()};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"axis":const e=n.getElementsByTagName("param")[0];t.axis=e.textContent;const r=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=r.substr(0,r.length-1)}}return t}function Te(e){return void 0!==e.build?e.build:e}function Fe(t){const r=[],n=He.querySelector('[id="'+t.id+'"]');for(let t=0;t<n.childNodes.length;t++){const s=n.childNodes[t];if(1!==s.nodeType)continue;let o,i;switch(s.nodeName){case"matrix":o=a(s.textContent);const t=(new e.Matrix4).fromArray(o).transpose();r.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:t});break;case"translate":case"scale":o=a(s.textContent),i=(new e.Vector3).fromArray(o),r.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:i});break;case"rotate":o=a(s.textContent),i=(new e.Vector3).fromArray(o);const n=e.MathUtils.degToRad(o[3]);r.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:i,angle:n})}}return r}const ke=new e.Matrix4,Ee=new e.Vector3;function Ae(t){const r={name:t.getAttribute("name")||"",type:t.getAttribute("type"),id:t.getAttribute("id"),sid:t.getAttribute("sid"),matrix:new e.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let n=0;n<t.childNodes.length;n++){const s=t.childNodes[n];if(1!==s.nodeType)continue;let o;switch(s.nodeName){case"node":r.nodes.push(s.getAttribute("id")),Ae(s);break;case"instance_camera":r.instanceCameras.push(i(s.getAttribute("url")));break;case"instance_controller":r.instanceControllers.push(Ie(s));break;case"instance_light":r.instanceLights.push(i(s.getAttribute("url")));break;case"instance_geometry":r.instanceGeometries.push(Ie(s));break;case"instance_node":r.instanceNodes.push(i(s.getAttribute("url")));break;case"matrix":o=a(s.textContent),r.matrix.multiply(ke.fromArray(o).transpose()),r.transforms[s.getAttribute("sid")]=s.nodeName;break;case"translate":o=a(s.textContent),Ee.fromArray(o),r.matrix.multiply(ke.makeTranslation(Ee.x,Ee.y,Ee.z)),r.transforms[s.getAttribute("sid")]=s.nodeName;break;case"rotate":o=a(s.textContent);const t=e.MathUtils.degToRad(o[3]);r.matrix.multiply(ke.makeRotationAxis(Ee.fromArray(o),t)),r.transforms[s.getAttribute("sid")]=s.nodeName;break;case"scale":o=a(s.textContent),r.matrix.scale(Ee.fromArray(o)),r.transforms[s.getAttribute("sid")]=s.nodeName;break;case"extra":break;default:console.log(s)}}return De(r.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",r.id):Ze.nodes[r.id]=r,r}function Ie(e){const t={id:i(e.getAttribute("url")),materials:{},skeletons:[]};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];switch(n.nodeName){case"bind_material":const e=n.getElementsByTagName("instance_material");for(let r=0;r<e.length;r++){const n=e[r],s=n.getAttribute("symbol"),a=n.getAttribute("target");t.materials[s]=i(a)}break;case"skeleton":t.skeletons.push(i(n.textContent))}}return t}function Le(t,r){const n=[],s=[];let a,o,i;for(a=0;a<t.length;a++){const e=t[a];let s;if(De(e))s=Pe(e),Ce(s,r,n);else if(c=e,void 0!==Ze.visualScenes[c]){const t=Ze.visualScenes[e].children;for(let e=0;e<t.length;e++){const s=t[e];if("JOINT"===s.type){Ce(Pe(s.id),r,n)}}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",e)}var c;for(a=0;a<r.length;a++)for(o=0;o<n.length;o++)if(i=n[o],i.bone.name===r[a].name){s[a]=i,i.processed=!0;break}for(a=0;a<n.length;a++)i=n[a],!1===i.processed&&(s.push(i),i.processed=!0);const l=[],u=[];for(a=0;a<s.length;a++)i=s[a],l.push(i.bone),u.push(i.boneInverse);return new e.Skeleton(l,u)}function Ce(t,r,n){t.traverse((function(t){if(!0===t.isBone){let s;for(let e=0;e<r.length;e++){const n=r[e];if(n.name===t.name){s=n.boneInverse;break}}void 0===s&&(s=new e.Matrix4),n.push({bone:t,boneInverse:s,processed:!1})}}))}function Re(t){const r=[],n=t.matrix,s=t.nodes,a=t.type,o=t.instanceCameras,i=t.instanceControllers,c=t.instanceLights,l=t.instanceGeometries,u=t.instanceNodes;for(let e=0,t=s.length;e<t;e++)r.push(Pe(s[e]));for(let e=0,t=o.length;e<t;e++){const t=ee(o[e]);null!==t&&r.push(t.clone())}for(let e=0,t=i.length;e<t;e++){const t=i[e],n=(h=t.id,d(Ze.controllers[h],R)),s=Ue(pe(n.id),t.materials),a=Le(t.skeletons,n.skin.joints);for(let e=0,t=s.length;e<t;e++){const t=s[e];t.isSkinnedMesh&&(t.bind(a,n.skin.bindMatrix),t.normalizeSkinWeights()),r.push(t)}}var h;for(let e=0,t=c.length;e<t;e++){const t=se(c[e]);null!==t&&r.push(t.clone())}for(let e=0,t=l.length;e<t;e++){const t=l[e],n=Ue(pe(t.id),t.materials);for(let e=0,t=n.length;e<t;e++)r.push(n[e])}for(let e=0,t=u.length;e<t;e++)r.push(Pe(u[e]).clone());let p;if(0===s.length&&1===r.length)p=r[0];else{p="JOINT"===a?new e.Bone:new e.Group;for(let e=0;e<r.length;e++)p.add(r[e])}return p.name="JOINT"===a?t.sid:t.name,p.matrix.copy(n),p.matrix.decompose(p.position,p.quaternion,p.scale),p}const Oe=new e.MeshBasicMaterial({color:16711935});function Ne(e,t){const r=[];for(let n=0,s=e.length;n<s;n++){const s=t[e[n]];void 0===s?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[n]),r.push(Oe)):r.push(K(s))}return r}function Ue(t,r){const n=[];for(const s in t){const a=t[s],o=Ne(a.materialKeys,r);0===o.length&&("lines"===s||"linestrips"===s?o.push(new e.LineBasicMaterial):o.push(new e.MeshPhongMaterial));const i=void 0!==a.data.attributes.skinIndex,c=1===o.length?o[0]:o;let l;switch(s){case"lines":l=new e.LineSegments(a.data,c);break;case"linestrips":l=new e.Line(a.data,c);break;case"triangles":case"polylist":l=i?new e.SkinnedMesh(a.data,c):new e.Mesh(a.data,c)}n.push(l)}return n}function De(e){return void 0!==Ze.nodes[e]}function Pe(e){return d(Ze.nodes[e],Re)}function Be(t){const r=new e.Group;r.name=t.name;const n=t.children;for(let e=0;e<n.length;e++){const t=n[e];r.add(Pe(t.id))}return r}function Ge(e){return d(Ze.visualScenes[e],Be)}if(0===t.length)return{scene:new e.Scene};const _e=(new e.$DOMParser).parseFromString(t,"application/xml"),He=n(_e,"COLLADA")[0],Ve=_e.getElementsByTagName("parsererror")[0];if(void 0!==Ve){const e=n(Ve,"div")[0];let t;return t=e?e.textContent:function(e){let t="";const r=[e];for(;r.length;){const e=r.shift();e.nodeType===Node.TEXT_NODE?t+=e.textContent:(t+="\n",r.push.apply(r,e.childNodes))}return t.trim()}(Ve),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",t),null}const ze=He.getAttribute("version");console.log("THREE.ColladaLoader: File version",ze);const je=function(e){return{unit:l(n(e,"unit")[0]),upAxis:u(n(e,"up_axis")[0])}}(n(He,"asset")[0]),We=new e.TextureLoader(this.manager);let Xe;We.setPath(this.resourcePath||r).setCrossOrigin(this.crossOrigin),Me&&(Xe=new Me(this.manager),Xe.setPath(this.resourcePath||r));const qe=[];let Ye={},Ke=0;const Ze={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};h(He,"library_animations","animation",(function t(r){const n={sources:{},samplers:{},channels:{}};let s=!1;for(let e=0,a=r.childNodes.length;e<a;e++){const a=r.childNodes[e];if(1!==a.nodeType)continue;let o;switch(a.nodeName){case"source":o=a.getAttribute("id"),n.sources[o]=ae(a);break;case"sampler":o=a.getAttribute("id"),n.samplers[o]=f(a);break;case"channel":o=a.getAttribute("target"),n.channels[o]=g(a);break;case"animation":t(a),s=!0;break;default:console.log(a)}}!1===s&&(Ze.animations[r.getAttribute("id")||e.MathUtils.generateUUID()]=n)})),h(He,"library_animation_clips","animation_clip",(function(e){const t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"instance_animation":t.animations.push(i(n.getAttribute("url")))}}Ze.clips[e.getAttribute("id")]=t})),h(He,"library_controllers","controller",(function(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"skin":t.id=i(n.getAttribute("source")),t.skin=M(n);break;case"morph":t.id=i(n.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Ze.controllers[e.getAttribute("id")]=t})),h(He,"library_images","image",(function(e){const t={init_from:n(e,"init_from")[0].textContent};Ze.images[e.getAttribute("id")]=t})),h(He,"library_effects","effect",(function(e){const t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"profile_COMMON":t.profile=U(n)}}Ze.effects[e.getAttribute("id")]=t})),h(He,"library_materials","material",(function(e){const t={name:e.getAttribute("name")};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"instance_effect":t.url=i(n.getAttribute("url"))}}Ze.materials[e.getAttribute("id")]=t})),h(He,"library_cameras","camera",(function(e){const t={name:e.getAttribute("name")};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"optics":t.optics=Z(n)}}Ze.cameras[e.getAttribute("id")]=t})),h(He,"library_lights","light",(function(e){let t={};for(let r=0,n=e.childNodes.length;r<n;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":t=te(n)}}Ze.lights[e.getAttribute("id")]=t})),h(He,"library_geometries","geometry",(function(e){const t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=n(e,"mesh")[0];if(void 0!==r){for(let e=0;e<r.childNodes.length;e++){const n=r.childNodes[e];if(1!==n.nodeType)continue;const s=n.getAttribute("id");switch(n.nodeName){case"source":t.sources[s]=ae(n);break;case"vertices":t.vertices=oe(n);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",n.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(ie(n));break;default:console.log(n)}}Ze.geometries[e.getAttribute("id")]=t}})),h(He,"library_nodes","node",Ae),h(He,"library_visual_scenes","visual_scene",(function(e){const t={name:e.getAttribute("name"),children:[]};!function(e){const t=e.getElementsByTagName("node");for(let e=0;e<t.length;e++){const r=t[e];!1===r.hasAttribute("id")&&r.setAttribute("id","three_default_"+Ke++)}}(e);const r=n(e,"node");for(let e=0;e<r.length;e++)t.children.push(Ae(r[e]));Ze.visualScenes[e.getAttribute("id")]=t})),h(He,"library_kinematics_models","kinematics_model",(function(e){const t={name:e.getAttribute("name")||"",joints:{},links:[]};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"technique_common":fe(n,t)}}Ze.kinematicsModels[e.getAttribute("id")]=t})),h(He,"library_physics_models","physics_model",(function(e){const t={name:e.getAttribute("name")||"",rigidBodies:{}};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"rigid_body":t.rigidBodies[n.getAttribute("name")]={},xe(n,t.rigidBodies[n.getAttribute("name")])}}Ze.physicsModels[e.getAttribute("id")]=t})),h(He,"scene","instance_kinematics_scene",(function(e){const t={bindJointAxis:[]};for(let r=0;r<e.childNodes.length;r++){const n=e.childNodes[r];if(1===n.nodeType)switch(n.nodeName){case"bind_joint_axis":t.bindJointAxis.push(Se(n))}}Ze.kinematicsScenes[i(e.getAttribute("url"))]=t})),p(Ze.animations,m),p(Ze.clips,A),p(Ze.controllers,R),p(Ze.images,O),p(Ze.effects,q),p(Ze.materials,Y),p(Ze.cameras,J),p(Ze.lights,ne),p(Ze.geometries,le),p(Ze.visualScenes,Be),function(){const t=Ze.clips;if(!0===c(t)){if(!1===c(Ze.animations)){const t=[];for(const e in Ze.animations){const r=v(e);for(let e=0,n=r.length;e<n;e++)t.push(r[e])}qe.push(new e.AnimationClip("default",-1,t))}}else for(const e in t)qe.push(I(e))}(),function(){const t=Object.keys(Ze.kinematicsModels)[0],r=Object.keys(Ze.kinematicsScenes)[0],n=Object.keys(Ze.visualScenes)[0];if(void 0===t||void 0===r)return;const s=(a=t,d(Ze.kinematicsModels[a],de));var a;const o=function(e){return d(Ze.kinematicsScenes[e],Te)}(r),i=Ge(n),c=o.bindJointAxis,l={};for(let e=0,t=c.length;e<t;e++){const t=c[e],r=He.querySelector('[sid="'+t.target+'"]');if(r){const e=r.parentElement;u(t.jointIndex,e)}}function u(e,t){const r=t.getAttribute("name"),n=s.joints[e];i.traverse((function(s){s.name===r&&(l[e]={object:s,transforms:Fe(t),joint:n,position:n.zeroPosition})}))}const h=new e.Matrix4;Ye={joints:s&&s.joints,getJointValue:function(e){const t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(t,r){const n=l[t];if(n){const s=n.joint;if(r>s.limits.max||r<s.limits.min)console.warn("THREE.ColladaLoader: Joint "+t+" value "+r+" outside of limits (min: "+s.limits.min+", max: "+s.limits.max+").");else if(s.static)console.warn("THREE.ColladaLoader: Joint "+t+" is static.");else{const a=n.object,o=s.axis,i=n.transforms;ke.identity();for(let n=0;n<i.length;n++){const a=i[n];if(a.sid&&-1!==a.sid.indexOf(t))switch(s.type){case"revolute":ke.multiply(h.makeRotationAxis(o,e.MathUtils.degToRad(r)));break;case"prismatic":ke.multiply(h.makeTranslation(o.x*r,o.y*r,o.z*r));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+s.type)}else switch(a.type){case"matrix":ke.multiply(a.obj);break;case"translate":ke.multiply(h.makeTranslation(a.obj.x,a.obj.y,a.obj.z));break;case"scale":ke.scale(a.obj);break;case"rotate":ke.multiply(h.makeRotationAxis(a.obj,a.angle))}}a.matrix.copy(ke),a.matrix.decompose(a.position,a.quaternion,a.scale),l[t].position=r}}else console.log("THREE.ColladaLoader: "+t+" does not exist.")}}}();const Qe=function(e){return Ge(i(n(e,"instance_visual_scene")[0].getAttribute("url")))}(n(He,"scene")[0]);return Qe.animations=qe,"Z_UP"===je.upAxis&&Qe.quaternion.setFromEuler(new e.Euler(-Math.PI/2,0,0)),Qe.scale.multiplyScalar(je.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),qe},kinematics:Ye,library:Ze,scene:Qe}}}function Fc(e,t){return null!=e?e:t()}class kc{__init(){this.currFrame=0}constructor(e,t,r,n,s=24,a=!0){this.tiles=e,this.totalFrame=t,this.row=r,this.col=n,kc.prototype.__init.call(this),this.playing=!0,this.currFrame=0,this.frameGap=1e3/s,e.forEach((e=>{e.repeat.set(1/this.col,1/this.row),a&&(e.encoding=3001)})),this.updateOffset()}stop(){this.playing=!1}play(){this.playing=!0,this.startTime=Date.now(),this.startFrame=this.currFrame}get texture(){return this.tiles[this.currTile]}animate(){if(!this.playing||1===this.totalFrame)return;const e=Date.now();this.startTime=Fc(this.startTime,(()=>e)),this.startFrame=Fc(this.startFrame,(()=>this.currFrame));const t=this.startFrame+~~((e-this.startTime)/this.frameGap);this.currFrame=t%this.totalFrame,t>this.currFrame&&(this.startTime=e,this.startFrame=this.currFrame),this.updateOffset()}updateOffset(){this.currTile=~~(this.currFrame/(this.col*this.row)),this.currTileOffset=this.currFrame%(this.col*this.row);const e=this.tiles[this.currTile],t=1/this.row,r=this.currTileOffset%this.col,n=~~(this.currTileOffset/this.col);e&&(e.offset.x=r/this.col,e.offset.y=1-n/this.row-t)}dispose(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.mesh,"optionalAccess",e=>e.material,"access",e=>e.dispose,"call",e=>e()]),this.tiles.forEach((e=>e.dispose())),this.tiles.length=0,this.mesh=null}}const Ec={url:["https://s3.ax1x.com/2021/02/26/yx0ObV.png","https://s3.ax1x.com/2021/02/26/yx0LD0.png","https://s3.ax1x.com/2021/02/26/yx0Hvn.png"],x:0,y:0,z:-15,w:10,h:10,col:2,row:2,total:10,fps:16};const Ac=new e.Vector3(0,0,1),Ic=new e.Euler,Mc=new e.Quaternion,Lc=new e.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),Cc={type:"change"};class Rc extends e.EventDispatcher{constructor(t){super(),!1===e.$window.isSecureContext&&console.error("THREE.DeviceOrientationControls: DeviceOrientationEvent is only available in secure contexts (https)");const r=this,n=new e.Quaternion;this.object=t,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.deviceOrientation={},this.screenOrientation=0,this.alphaOffset=0;const s=function(e){r.deviceOrientation=e},a=function(){r.screenOrientation=e.$window.orientation||0};this.connect=function(){a(),void 0!==e.$window.DeviceOrientationEvent&&"function"==typeof e.$window.DeviceOrientationEvent.requestPermission?e.$window.DeviceOrientationEvent.requestPermission().then((function(t){"granted"==t&&(e.$window.addEventListener("orientationchange",a),e.$window.addEventListener("deviceorientation",s))})).catch((function(e){console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)})):(e.$window.addEventListener("orientationchange",a),e.$window.addEventListener("deviceorientation",s)),r.enabled=!0},this.disconnect=function(){e.$window.removeEventListener("orientationchange",a),e.$window.removeEventListener("deviceorientation",s),r.enabled=!1},this.update=function(){if(!1===r.enabled)return;const t=r.deviceOrientation;if(t){const s=t.alpha?e.MathUtils.degToRad(t.alpha)+r.alphaOffset:0,a=t.beta?e.MathUtils.degToRad(t.beta):0,o=t.gamma?e.MathUtils.degToRad(t.gamma):0,i=r.screenOrientation?e.MathUtils.degToRad(r.screenOrientation):0;!function(e,t,r,n,s){Ic.set(r,t,-n,"YXZ"),e.setFromEuler(Ic),e.multiply(Lc),e.multiply(Mc.setFromAxisAngle(Ac,-s))}(r.object.quaternion,s,a,o,i),8*(1-n.dot(r.object.quaternion))>1e-6&&(n.copy(r.object.quaternion),r.dispatchEvent(Cc))}},this.dispose=function(){r.disconnect()},this.connect()}}function Oc(e,t,r,n){if(Array.isArray(e)){for(var s=Oc(new Float64Array(e),t,r,n),a=0;a<e.length;a++)e[a]=s[a];return e}if(!t||!r)throw Error("Bad dimensions");n||(n=e.length/(t*r));for(var o=r>>1,i=t*n,c=new(0,e.constructor)(t*n),l=0;l<o;++l){var u=l*i,h=(r-l-1)*i;c.set(e.subarray(u,u+i)),e.copyWithin(u,h,h+i),e.set(c,h)}return e}exports.DemoBVHLoader=class extends ke{async init(){const{scene:t,camera:r}=this.deps,n=new na;r.position.set(0,200,300);const s=await n.loadAsync(Fe+"/models/bvh/pirouette.bvh"),a=new e.SkeletonHelper(s.skeleton.bones[0]);a.skeleton=s.skeleton;const o=new e.Group;o.add(s.skeleton.bones[0]),this.add(a),this.add(o),t.background=new e.Color(15658734),this.add(new e.GridHelper(400,10)),this.mixer=new e.AnimationMixer(a),this.mixer.clipAction(s.clip).setEffectiveWeight(1).play(),this.addControl(),this.orbitControl.minDistance=300,this.orbitControl.maxDistance=700}update(){sa([this,"access",e=>e.mixer,"optionalAccess",e=>e.update,"call",e=>e(this.deps.clock.getDelta())]),sa([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset(),this.mixer.stopAllAction(),this.mixer=null}},exports.DemoColladaLoader=class extends ke{async init(){const{camera:t}=this.deps;t.position.set(8,10,8),t.lookAt(0,3,0);const r=new Tc,n=await r.loadAsync(Fe+"/models/collada/elf/elf.dae");this.add(n.scene);const s=new e.AmbientLight(13421772,.4);this.add(s);const a=new e.DirectionalLight(16777215,.8);a.position.set(1,1,0).normalize(),this.add(a),this.addControl()}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoDeviceOrientationControls=class extends ke{async init(){const{camera:t,textureLoader:r}=this.deps;this.control=new Rc(t);const n=new e.SphereGeometry(500,60,40);n.scale(-1,1,1);const s=new e.MeshBasicMaterial({map:await r.loadAsync("https://s3.ax1x.com/2021/02/26/yx0quq.jpg")}),a=new e.BoxGeometry(100,100,100,4,4,4),o=new e.MeshBasicMaterial({color:16711935,wireframe:!0});this.add(new e.Mesh(n,s)),this.add(new e.Mesh(a,o))}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.control,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset(),this.control.disconnect(),this.control.dispose(),this.control=null}},exports.DemoEXRLoader=class extends ke{async init(){const{renderer:t}=this.deps,r=(new yc).setDataType(e.FloatType),n=await r.loadAsync(Fe+"/textures/memorial.exr"),s=new e.MeshBasicMaterial({map:n}),a=new e.PlaneGeometry(4.5*n.image.width/n.image.height,4.5);this.add(new e.Mesh(a,s)),this.lastToneMapping=t.toneMapping,this.lastToneMappingExposure=t.toneMappingExposure,t.toneMapping=e.ReinhardToneMapping,t.toneMappingExposure=2}update(){}dispose(){this.deps.renderer.toneMapping=this.lastToneMapping,this.deps.renderer.toneMappingExposure=this.lastToneMappingExposure,this.reset()}},exports.DemoFBXLoader=class extends ke{async init(){const{camera:t,scene:r}=this.deps;t.position.set(100,200,300),r.background=new e.Color(10526880),r.fog=new e.Fog(10526880,200,1e3);const n=new e.HemisphereLight(16777215,4473924);n.position.set(0,200,0),this.add(n);const s=new e.DirectionalLight(16777215);s.position.set(0,200,100),s.castShadow=!0,s.shadow.camera.top=180,s.shadow.camera.bottom=-100,s.shadow.camera.left=-120,s.shadow.camera.right=120,this.add(s);const a=new e.Mesh(new e.PlaneGeometry(2e3,2e3),new e.MeshPhongMaterial({color:10066329,depthWrite:!1}));a.rotation.x=-Math.PI/2,a.receiveShadow=!0,this.add(a);const o=new e.GridHelper(2e3,20,0,0);o.material.opacity=.2,o.material.transparent=!0,this.add(o);const i=new Ei,c=await i.loadAsync(Fe+"/models/fbx/Samba Dancing.fbx"),l=new e.AnimationMixer(c);l.clipAction(c.animations[0]).play(),c.traverse((function(e){e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),this.add(c),this.addControl(),this.orbitControl.target.set(0,100,0),this.orbitControl.update(),this.mixer=l}update(){Wi([this,"access",e=>e.mixer,"optionalAccess",e=>e.update,"call",e=>e(this.deps.clock.getDelta())]),Wi([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset(),this.mixer.stopAllAction(),this.mixer=null}},exports.DemoGLTFLoader=class extends ke{async init(){const t=await this.deps.gltfLoader.loadAsync("https://dtmall-tel.alicdn.com/edgeComputingConfig/upload_models/1591673169101/RobotExpressive.glb");t.scene.position.z=2.5,t.scene.position.y=-2,this.add(new e.DirectionalLight(16777215,1)),this.add(new e.AmbientLight(16777215,1)),this.add(t.scene),this.deps.camera.position.z=10;const r=["Idle","Walking","Running","Dance","Death","Sitting","Standing"],n=["Jump","Yes","No","Wave","Punch","ThumbsUp"];this.mixer=new e.AnimationMixer(t.scene);const s={};for(let a=0;a<t.animations.length;a++){const o=t.animations[a],i=this.mixer.clipAction(o);s[o.name]=i,(n.indexOf(o.name)>=0||r.indexOf(o.name)>=4)&&(i.clampWhenFinished=!0,i.loop=e.LoopOnce)}s.Walking.play(),this.addControl()}update(){Sc([this,"access",e=>e.mixer,"optionalAccess",e=>e.update,"call",e=>e(this.deps.clock.getDelta())]),Sc([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.mixer.stopAllAction(),this.mixer=null,this.reset()}},exports.DemoHDRPrefilterTexture=class extends ke{async init(){const{scene:t,camera:r}=this.deps,n=await this.deps.textureLoader.loadAsync("https://cdn.static.oppenlab.com/weblf/test/hdr-prefilter.png");!function(t,r=!0){r&&(t.format=e.RGBEFormat,t.encoding=e.RGBEEncoding),t.generateMipmaps=!1,t.magFilter=e.NearestFilter,t.minFilter=e.NearestFilter,t.type=e.UnsignedByteType,t.mapping=e.CubeUVReflectionMapping,t.name="PMREM.cubeUv"}(n);const s=new e.PlaneGeometry(3,3),a=new e.MeshBasicMaterial({map:n}),o=new e.Mesh(s,a);this.add(o),t.background=n,r.position.z=1,this.addControl()}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoLWOLoader=class extends ke{async init(){const{scene:t,renderer:r,camera:n}=this.deps;n.position.set(-.7,14.6,43.2),t.background=new e.Color(10526880);const s=new e.AmbientLight(11184810,1.75);this.add(s);const a=new e.DirectionalLight(16777215,1);a.position.set(0,200,100),a.castShadow=!0,a.shadow.camera.top=180,a.shadow.camera.bottom=-100,a.shadow.camera.left=-120,a.shadow.camera.right=120,this.add(a);const o=new e.DirectionalLight(16777215,.7);o.position.set(-100,200,-100),this.add(o);const i=new e.DirectionalLight(16777215,.4);i.position.set(100,-200,100),this.add(i);const c=new e.DirectionalLight(16777215,1);c.position.set(-100,-100,100),this.add(c);const l=new e.GridHelper(200,20,0,0);l.material.opacity=.3,l.material.transparent=!0,this.add(l);const u=new ec,h=await u.loadAsync(Fe+"/models/lwo/Objects/LWO3/Demo.lwo"),p=h.meshes[0];p.position.set(-2,12,0);const d=h.meshes[1];d.position.set(2,12,0);const f=h.meshes[2];f.position.set(0,10.5,-1),this.add(p),this.add(f),this.add(d),r.shadowMap.enabled=!0,r.physicallyCorrectLights=!0,r.gammaFactor=1.18,this.addControl(),this.orbitControl.target.set(1.33,10,-6.7)}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoMTLLoader=class extends ke{async init(){const{camera:t,renderer:r}=this.deps,n=new e.LoadingManager;n.addHandler(/\.dds$/i,new oc);const s=new sc(n),a=new vc(n),o=await s.loadAsync(Fe+"/models/obj/male02/male02.mtl");o.preload();const i=await a.setMaterials(o).loadAsync(Fe+"/models/obj/male02/male02.obj");i.position.y=-95,this.addControl(),this.add(new e.AmbientLight(13421772,.4)),this.addCamera(new e.PointLight(16777215,.8)),this.add(i),this.add(t),i.position.y=-95,t.position.z=200,r.outputEncoding=e.LinearEncoding}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoMemoryTest=class extends ke{async init(){this.reset(!1);const t=await this.deps.gltfLoader.loadAsync(Fe+"/models/gltf/Soldier.glb");this.add(new e.DirectionalLight(16777215,1)),this.add(new e.AmbientLight(16777215,1)),this.add(t.scene),this.timer=setTimeout((()=>this.init()),300)}update(){}dispose(){this.reset(),clearTimeout(this.timer)}},exports.DemoMeshOpt=class extends ke{async init(){const{gltfLoader:t,camera:r,scene:n}=this.deps;Ie.setWasmPath("/decoder_base.wasm"),t.setMeshoptDecoder(Ie);const s=Date.now(),a=await t.loadAsync("https://cdn.static.oppenlab.com/weblf/test/pirate.glb");console.log(Date.now()-s);const o=new e.PointLight(16777215,.8);o.position.set(3,3,0),this.add(new e.AmbientLight(13421772,.3)),this.add(a.scene),this.add(r),this.addCamera(o),a.scene.position.y=-1,n.position.z=0,r.position.y=1,r.position.z=3,n.background=new e.Color(3148324),this.addControl()}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoMeshQuantization=class extends ke{async init(){const{camera:t,gltfLoader:r,scene:n}=this.deps,s=Date.now();Ie.setWasmPath("/decoder_base.wasm"),r.setMeshoptDecoder(Ie);const a=await r.loadAsync("https://cdn.static.oppenlab.com/weblf/test/PrimaryIonDrive-EXT_MESH_QUANTIZATION.glb"),o=Date.now();console.log("load glb time",o-s),this.add(a.scene),this.add(new e.DirectionalLight(16777215,1)),this.add(new e.AmbientLight(16777215,1)),t.position.z=3,n.position.z=0,this.addControl()}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoOBJLoader=class extends ke{async init(){const{textureLoader:t,camera:r,renderer:n}=this.deps,s=await t.loadAsync(Fe+"/textures/UV_Grid_Sm.jpg"),a=new vc,o=await a.loadAsync(Fe+"/models/obj/male02/male02.obj");this.add(new e.AmbientLight(13421772,.4)),this.addCamera(new e.PointLight(16777215,.8)),this.add(o),this.add(r),o.traverse((function(e){e.isMesh&&(e.material.map=s)})),o.position.y=-95,r.position.z=200,n.outputEncoding=e.LinearEncoding,this.addControl()}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoPDBLoader=class extends ke{async init(){const{camera:t,scene:r,renderer:n}=this.deps;t.position.z=100,r.position.z=0,r.background=new e.Color(328965),n.outputEncoding=e.LinearEncoding,this.addControl(),this.obj=new e.Group,this.obj.scale.set(.1,.1,.1),this.add(this.obj);const s=new e.DirectionalLight(16777215,.8);s.position.set(1,1,1);const a=new e.DirectionalLight(16777215,.5);a.position.set(-1,-1,1),this.add(s),this.add(a);const o=new Le,i=await o.loadAsync(Fe+"/models/molecules/caffeine.pdb");this.loadMolecule(i)}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}loadMolecule(t){var r=t.geometryAtoms,n=t.geometryBonds,s=t.json,a=new e.Vector3,o=new e.BoxGeometry(1,1,1),i=new e.IcosahedronGeometry(1,2);r.computeBoundingBox(),r.boundingBox.getCenter(a).negate(),r.translate(a.x,a.y,a.z),n.translate(a.x,a.y,a.z);for(var c=r.getAttribute("position"),l=r.getAttribute("color"),u=new e.Vector3,h=new e.Color,p=0;p<c.count;p++){u.x=c.getX(p),u.y=c.getY(p),u.z=c.getZ(p),h.r=l.getX(p),h.g=l.getY(p),h.b=l.getZ(p);var d=new e.MeshPhongMaterial({color:h});(m=new e.Mesh(i,d)).position.copy(u),m.position.multiplyScalar(75),m.scale.multiplyScalar(25),this.obj.add(m);s.atoms[p]}c=n.getAttribute("position");var f=new e.Vector3,g=new e.Vector3;for(p=0;p<c.count;p+=2){var m;f.x=c.getX(p),f.y=c.getY(p),f.z=c.getZ(p),g.x=c.getX(p+1),g.y=c.getY(p+1),g.z=c.getZ(p+1),f.multiplyScalar(75),g.multiplyScalar(75),(m=new e.Mesh(o,new e.MeshPhongMaterial({color:16777215}))).position.copy(f),m.position.lerp(g,.5),m.scale.set(5,5,f.distanceTo(g)),m.lookAt(g),this.obj.add(m)}}},exports.DemoRGBELoader=class extends ke{async init(){const{renderer:t,gltfLoader:r,scene:n,camera:s}=this.deps,a=await r.loadAsync(wc+"/examples/models/gltf/MetalRoughSpheres/glTF/MetalRoughSpheres.gltf");a.scene.rotation.copy(new e.Euler(0,0,0)),t.physicallyCorrectLights=!0;const o=new xc,i=new e.PMREMGenerator(t);i.compileEquirectangularShader();const c=Date.now(),l=await o.setDataType(e.UnsignedByteType).loadAsync(wc+"/examples/textures/equirectangular/venice_sunset_2k.hdr"),u=Date.now(),h=i.fromEquirectangular(l).texture;console.log("time cost",Date.now()-u,u-c),l.dispose(),i.dispose(),n.background=h,a.scene.traverse((function(e){e.material&&(e.material.isMeshStandardMaterial||e.material.isShaderMaterial&&void 0!==e.material.envMap)&&(e.material.envMap=h,e.material.envMapIntensity=1.5),(e.isMesh||e.isLight)&&(e.castShadow=!0)}));const p=new e.DirectionalLight(14540253,4);p.position.set(0,0,1).normalize();const d=new e.SpotLight(16777215,1);d.position.set(5,10,5),d.angle=.5,d.penumbra=.75,d.intensity=100,d.decay=2,s.position.set(2,1,15),this.add(a.scene),this.add(p),this.add(new e.AmbientLight(2236962)),this.add(d),this.addControl()}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoSTLLoader=class extends ke{async init(){const{camera:t,renderer:r,scene:n}=this.deps;t.position.set(3,.15,3),r.setClearColor(16777215),n.position.z=0,n.background=new e.Color(7496795),n.fog=new e.Fog(7496795,2,15),r.shadowMap.enabled=!0;const s=new e.Mesh(new e.PlaneGeometry(40,40),new e.MeshPhongMaterial({color:10066329,specular:1052688}));s.rotation.x=-Math.PI/2,s.position.y=-.5,s.receiveShadow=!0,this.add(s),this.add(new e.AmbientLight(4473924)),this.addShadowedLight(1,1,1,16777215,1.35),this.addShadowedLight(.5,1,-1,16755200,1),this.addControl(),this.loadModels()}addShadowedLight(t,r,n,s,a){const o=new e.DirectionalLight(s,a);o.position.set(t,r,n),this.add(o),o.castShadow=!0;o.shadow.camera.left=-1,o.shadow.camera.right=1,o.shadow.camera.top=1,o.shadow.camera.bottom=-1,o.shadow.camera.near=1,o.shadow.camera.far=4,o.shadow.bias=-.002}loadModels(){const t=new Ce;t.load(Fe+"/models/stl/ascii/slotted_disk.stl",(t=>{const r=new e.MeshPhongMaterial({color:16733491,specular:1118481,shininess:200}),n=new e.Mesh(t,r);n.position.set(0,-.25,.6),n.rotation.set(0,-Math.PI/2,0),n.scale.set(.5,.5,.5),n.castShadow=!0,n.receiveShadow=!0,this.add(n)}));const r=new e.MeshPhongMaterial({color:11184810,specular:1118481,shininess:200});t.load(Fe+"/models/stl/binary/pr2_head_pan.stl",(t=>{const n=new e.Mesh(t,r);n.position.set(0,-.37,-.6),n.rotation.set(-Math.PI/2,0,0),n.scale.set(2,2,2),n.castShadow=!0,n.receiveShadow=!0,this.add(n)})),t.load("./models/stl/binary/pr2_head_tilt.stl",(t=>{const n=new e.Mesh(t,r);n.position.set(.136,-.37,-.6),n.rotation.set(-Math.PI/2,.3,0),n.scale.set(2,2,2),n.castShadow=!0,n.receiveShadow=!0,this.add(n)})),t.load(Fe+"/models/stl/binary/colored.stl",(t=>{let n=r;t.hasColors&&(n=new e.MeshPhongMaterial({opacity:t.alpha,vertexColors:!0}));const s=new e.Mesh(t,n);s.position.set(.5,.2,0),s.rotation.set(-Math.PI/2,Math.PI/2,0),s.scale.set(.3,.3,.3),s.castShadow=!0,s.receiveShadow=!0,this.add(s)}))}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()]),this.deps.camera.lookAt(new e.Vector3(0,-.25,0))}dispose(){this.reset()}},exports.DemoSVGLoader=class extends ke{async init(){const{camera:t,renderer:r}=this.deps,n=new bc,s=await n.loadAsync("https://techbrood.com/threejs/examples/models/svg/tiger.svg"),a=new e.GridHelper(160,10);a.rotation.x=Math.PI/2,this.add(a),this.add(this.initSVG(s)),this.addControl(),t.position.set(0,0,200),r.outputEncoding=e.LinearEncoding}initSVG(t){const r=!1,n=!1,{paths:s}=t;var a=new e.Group;a.scale.multiplyScalar(.25),a.position.x=-70,a.position.y=70,a.scale.y*=-1;for(var o=0;o<s.length;o++){var i=s[o],c=i.userData.style.fill;if(void 0!==c&&"none"!==c)for(var l=new e.MeshBasicMaterial({color:(new e.Color).setStyle(c),opacity:i.userData.style.fillOpacity,transparent:i.userData.style.fillOpacity<1,side:e.DoubleSide,depthWrite:!1,wireframe:r}),u=i.toShapes(!0),h=0;h<u.length;h++){var p=u[h],d=new e.ShapeGeometry(p),f=new e.Mesh(d,l);a.add(f)}var g=i.userData.style.stroke;if(void 0!==g&&"none"!==g){l=new e.MeshBasicMaterial({color:(new e.Color).setStyle(g),opacity:i.userData.style.strokeOpacity,transparent:i.userData.style.strokeOpacity<1,side:e.DoubleSide,depthWrite:!1,wireframe:n}),h=0;for(var m=i.subPaths.length;h<m;h++){var v=i.subPaths[h];if(d=bc.pointsToStroke(v.getPoints(),i.userData.style)){f=new e.Mesh(d,l);a.add(f)}}}}return a}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoTGALoader=class extends ke{async init(){const{camera:t,renderer:r}=this.deps,n=new Me,[s,a]=await Promise.all([n.loadAsync(Fe+"/textures/crate_grey8.tga"),n.loadAsync(Fe+"/textures/crate_color8.tga")]);t.position.set(0,50,250);const o=new e.BoxGeometry(50,50,50),i=new e.MeshPhongMaterial({color:16777215,map:s}),c=new e.Mesh(o,i);c.position.x=-50;const l=new e.MeshPhongMaterial({color:16777215,map:a}),u=new e.Mesh(o,l);u.position.x=50;const h=new e.DirectionalLight(16777215,1);h.position.set(1,1,1),this.add(c),this.add(u),this.add(h),this.add(new e.AmbientLight(16777215,.4)),this.addControl(),r.outputEncoding=e.LinearEncoding}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoTTFLoader=class extends ke{async init(){const{camera:t,scene:r,renderer:n}=this.deps;t.position.set(0,400,700),r.background=new e.Color(0),r.fog=new e.Fog(0,250,1400);const s=new e.DirectionalLight(16777215,.125);s.position.set(0,0,1).normalize(),this.add(s);const a=new e.PointLight(16777215,1.5);a.position.set(0,100,90),a.color.setHSL(Math.random(),1,.5),this.add(a);const o=new e.MeshPhongMaterial({color:16777215,flatShading:!0}),i=new e.Group;i.position.y=100,this.add(i);const c=new ra,l=await c.loadAsync(Fe+"/fonts/ttf/kenpixel.ttf");console.log(l),this.createText(new e.Font(l),i,o);const u=new e.Mesh(new e.PlaneGeometry(1e4,1e4),new e.MeshBasicMaterial({color:16777215,opacity:.5,transparent:!0}));u.position.y=100,u.rotation.x=-Math.PI/2,n.outputEncoding=e.LinearEncoding,this.add(u),this.addControl()}createText(t,r,n){const s=new e.TextGeometry("three.js",{font:t,size:70,height:20,curveSegments:4,bevelThickness:2,bevelSize:1.5,bevelEnabled:!0});s.computeBoundingBox(),s.computeVertexNormals();const a=-.5*(s.boundingBox.max.x-s.boundingBox.min.x),o=new e.Mesh(s,n);o.position.x=a,o.position.y=30,o.position.z=0,o.rotation.x=0,o.rotation.y=2*Math.PI,r.add(o);{const t=new e.Mesh(s,n);t.position.x=a,t.position.y=-30,t.position.z=20,t.rotation.x=Math.PI,t.rotation.y=2*Math.PI,r.add(t)}}update(){!function(e){let t,r=e[0],n=1;for(;n<e.length;){const s=e[n],a=e[n+1];if(n+=2,("optionalAccess"===s||"optionalCall"===s)&&null==r)return;"access"===s||"optionalAccess"===s?(t=r,r=a(r)):"call"!==s&&"optionalCall"!==s||(r=a(((...e)=>r.call(t,...e))),t=void 0)}}([this,"access",e=>e.orbitControl,"optionalAccess",e=>e.update,"call",e=>e()])}dispose(){this.reset()}},exports.DemoThreeSpritePlayer=class extends ke{async init(){const{textureLoader:t}=this.deps,r=await Promise.all(Ec.url.map((e=>t.loadAsync(e)))),n=new kc(r,Ec.total,Ec.row,Ec.col,Ec.fps,!0),s=new e.PlaneGeometry(Ec.w,Ec.h),a=new e.MeshBasicMaterial({map:n.texture,transparent:!1}),o=new e.Mesh(s,a),i=new e.BoxGeometry,c=new e.Mesh(i,a);c.position.y=-1.2,o.position.z=-8,o.position.y=4,this.add(o),this.add(c),this.mesh=o,this.player=n}update(){this.player.animate(),this.mesh.material.map=this.player.texture}dispose(){this.reset(),this.player.dispose(),this.player=null,this.mesh=null}},exports.GLTFLoader=T,exports.WechatPlatform=class{constructor(e,t,r){const n=wx.getSystemInfoSync(),s="android"===n.platform;this.canvas=e,this.canvasW=void 0===t?e.width:t,this.canvasH=void 0===r?e.height:r,this.document={createElementNS:(t,r)=>"canvas"===r?e:"img"===r?e.createImage():void 0},this.window={innerWidth:n.windowWidth,innerHeight:n.windowHeight,devicePixelRatio:n.pixelRatio,URL:new a,AudioContext:function(){},requestAnimationFrame:this.canvas.requestAnimationFrame,cancelAnimationFrame:this.canvas.cancelAnimationFrame,DeviceOrientationEvent:{requestPermission:()=>Promise.resolve("granted")},DOMParser:x,TextDecoder:w},[this.canvas,this.document,this.window].forEach((e=>{const t=e.__proto__;e.__proto__={},e.__proto__.__proto__=t,function(e,t){for(let r of Object.getOwnPropertyNames(t))if("constructor"!==r&&"prototype"!==r&&"name"!==r){let n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n)}}(e.__proto__,u.prototype)})),this.patchCanvas(),this.onDeviceMotionChange=e=>{e.type="deviceorientation",s&&(e.alpha*=-1,e.beta*=-1,e.gamma*=-1),this.window.dispatchEvent(e)}}patchCanvas(){const{canvasH:e,canvasW:t}=this;Object.defineProperty(this.canvas,"style",{get(){return{width:this.width+"px",height:this.height+"px"}}}),Object.defineProperty(this.canvas,"clientHeight",{get(){return e||this.height}}),Object.defineProperty(this.canvas,"clientWidth",{get(){return t||this.width}}),this.canvas.ownerDocument=this.document}patchXHR(){return v.useFetchPatch=!0,this}getGlobals(){return{atob:o,Blob:t,window:this.window,document:this.document,HTMLCanvasElement:void 0,XMLHttpRequest:v,OffscreenCanvas:S,createImageBitmap:void 0}}enableDeviceOrientation(e){return new Promise(((t,r)=>{wx.onDeviceMotionChange(this.onDeviceMotionChange),wx.startDeviceMotionListening({interval:e,success:e=>{t(e),this.enabledDeviceMotion=!0},fail:r})}))}disableDeviceOrientation(){return new Promise(((e,t)=>{wx.offDeviceMotionChange(this.onDeviceMotionChange),this.enabledDeviceMotion&&wx.stopDeviceMotionListening({success:()=>{e(),this.enabledDeviceMotion=!1},fail:t})}))}dispatchTouchEvent(e={}){const t={...this},r={changedTouches:e.changedTouches.map((e=>new l(e))),touches:e.touches.map((e=>new l(e))),targetTouches:Array.prototype.slice.call(e.touches.map((e=>new l(e)))),timeStamp:e.timeStamp,target:t,currentTarget:t,type:e.type,cancelBubble:!1,cancelable:!1};this.canvas.dispatchEvent(r)}dispose(){this.disableDeviceOrientation(),this.canvas.width=0,this.canvas.height=0,this.canvas&&(this.canvas.ownerDocument=null),this.onDeviceMotionChange=null,this.document=null,this.window=null,this.canvas=null}},exports.screenshot=function(e,t,r,n){const{width:s,height:a}=e.domElement,o=new n(s,a),i=new Uint8Array(s*a*4);return o.texture.encoding=e.outputEncoding,e.setRenderTarget(o),e.render(t,r),e.readRenderTargetPixels(o,0,0,s,a,i),e.setRenderTarget(null),o.dispose(),Oc(i,s,a,4),[i,s,a]};
